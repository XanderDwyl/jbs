/*! Socket.IO.js build:0.9.11, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */
var io="undefined"==typeof module?{}:module.exports;!function(){/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
!function(t,e){var n=t;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,r){var o,i,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),o=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),(a["force new connection"]||!n.sockets[o])&&(i=new n.Socket(a)),!a["force new connection"]&&i&&(n.sockets[o]=i),i=i||n.sockets[o],i.of(s.path.length>1?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){var n=t.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(t){for(var e=r.exec(t||""),n={},i=14;i--;)n[o[i]]=e[i]||"";return n},n.uniqueUri=function(t){var n=t.protocol,r=t.host,o=t.port;return"document"in e?(r=r||document.domain,o=o||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",o||"https"!=n||(o=443)),(n||"http")+"://"+r+":"+(o||80)},n.query=function(t,e){var r=n.chunkQuery(t||""),o=[];n.merge(r,n.chunkQuery(e||""));for(var i in r)r.hasOwnProperty(i)&&o.push(i+"="+r[i]);return o.length?"?"+o.join("&"):""},n.chunkQuery=function(t){for(var e,n={},r=t.split("&"),o=0,i=r.length;i>o;++o)e=r[o].split("="),e[0]&&(n[e[0]]=e[1]);return n};var i=!1;n.load=function(t){return"document"in e&&"complete"===document.readyState||i?t():(n.on(e,"load",t,!1),void 0)
},n.on=function(t,e,n,r){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,r)},n.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||n.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){i=!0}),n.defer=function(t){return n.ua.webkit&&"undefined"==typeof importScripts?(n.load(function(){setTimeout(t,100)}),void 0):t()},n.merge=function(t,e,r,o){var i,s=o||[],a="undefined"==typeof r?2:r;for(i in e)e.hasOwnProperty(i)&&n.indexOf(s,i)<0&&("object"==typeof t[i]&&a?n.merge(t[i],e[i],a-1,s):(t[i]=e[i],s.push(e[i])));return t},n.mixin=function(t,e){n.merge(t.prototype,e.prototype)},n.inherit=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)
},n.intersect=function(t,e){for(var r=[],o=t.length>e.length?t:e,i=t.length>e.length?e:t,s=0,a=i.length;a>s;s++)~n.indexOf(o,i[s])&&r.push(i[s]);return r},n.indexOf=function(t,e,n){for(var r=t.length,n=0>n?0>n+r?0:n+r:n||0;r>n&&t[n]!==e;n++);return n>=r?-1:n},n.toArray=function(t){for(var e=[],n=0,r=t.length;r>n;n++)e.push(t[n]);return e},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){function n(){}t.EventEmitter=n,n.prototype.on=function(t,n){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(n):this.$events[t]=[this.$events[t],n]:this.$events[t]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(t,e){function n(){r.removeListener(t,n),e.apply(this,arguments)}var r=this;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,n){if(this.$events&&this.$events[t]){var r=this.$events[t];if(e.util.isArray(r)){for(var o=-1,i=0,s=r.length;s>i;i++)if(r[i]===n||r[i].listener&&r[i].listener===n){o=i;break}if(0>o)return this;r.splice(o,1),r.length||delete this.$events[t]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[t]}return this},n.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},n.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]
},n.prototype.emit=function(t){if(!this.$events)return!1;var n=this.$events[t];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!e.util.isArray(n))return!1;for(var o=n.slice(),i=0,s=o.length;s>i;i++)o[i].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(exports,nativeJSON){"use strict";function f(t){return 10>t?"0"+t:t}function date(t){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,r,o,i,s,a=gap,l=e[t];switch(l instanceof Date&&(l=date(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(i=l.length,n=0;i>n;n+=1)s[n]=str(n,l)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,l),o&&s.push(quote(r)+(gap?": ":":")+o));
else for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(o=str(r,l),o&&s.push(quote(r)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(t,e,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})},JSON.parse=function(text,reviver){function walk(t,e){var n,r,o=t[e];
if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){var n=t.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],o=n.reasons=["transport not supported","client not handshaken","unauthorized"],i=n.advice=["reconnect"],s=e.JSON,a=e.util.indexOf;n.encodePacket=function(t){var e=a(r,t.type),n=t.id||"",l=t.endpoint||"",u=t.ack,c=null;switch(t.type){case"error":var p=t.reason?a(o,t.reason):"",h=t.advice?a(i,t.advice):"";(""!==p||""!==h)&&(c=p+(""!==h?"+"+h:""));break;case"message":""!==t.data&&(c=t.data);break;case"event":var d={name:t.name};t.args&&t.args.length&&(d.args=t.args),c=s.stringify(d);break;case"json":c=s.stringify(t.data);break;case"connect":t.qs&&(c=t.qs);break;case"ack":c=t.ackId+(t.args&&t.args.length?"+"+s.stringify(t.args):"")}var f=[e,n+("data"==u?"+":""),l];return null!==c&&void 0!==c&&f.push(c),f.join(":")},n.encodePayload=function(t){var e="";if(1==t.length)return t[0];for(var n=0,r=t.length;r>n;n++){var o=t[n];e+="\ufffd"+o.length+"\ufffd"+t[n]}return e};var l=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
n.decodePacket=function(t){var e=t.match(l);if(!e)return{};var n=e[2]||"",t=e[5]||"",a={type:r[e[1]],endpoint:e[4]||""};switch(n&&(a.id=n,a.ack=e[3]?"data":!0),a.type){case"error":var e=t.split("+");a.reason=o[e[0]]||"",a.advice=i[e[1]]||"";break;case"message":a.data=t||"";break;case"event":try{var u=s.parse(t);a.name=u.name,a.args=u.args}catch(c){}a.args=a.args||[];break;case"json":try{a.data=s.parse(t)}catch(c){}break;case"connect":a.qs=t||"";break;case"ack":var e=t.match(/^([0-9]+)(\+)?(.*)/);if(e&&(a.ackId=e[1],a.args=[],e[3]))try{a.args=e[3]?s.parse(e[3]):[]}catch(c){}break;case"disconnect":case"heartbeat":}return a},n.decodePayload=function(t){if("\ufffd"==t.charAt(0)){for(var e=[],r=1,o="";r<t.length;r++)"\ufffd"==t.charAt(r)?(e.push(n.decodePacket(t.substr(r+1).substr(0,o))),r+=Number(o)+1,o=""):o+=t.charAt(r);return e}return[n.decodePacket(t)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){function n(t,e){this.socket=t,this.sessid=e}t.Transport=n,e.util.mixin(n,e.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t){var n=e.parser.decodePayload(t);if(n&&n.length)for(var r=0,o=n.length;o>r;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this
},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(t,e){e.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e,n){function r(t){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var r=this;e.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function o(){}t.Socket=r,e.util.mixin(r,e.EventEmitter),r.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},r.prototype.publish=function(){this.emit.apply(this,arguments);
var t;for(var e in this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))},r.prototype.handshake=function(t){function n(e){e instanceof Error?(r.connecting=!1,r.onError(e.message)):t.apply(null,e.split(":"))}var r=this,i=this.options,s=["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!e.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],l=document.createElement("script");l.src=s+"&jsonp="+e.j.length,a.parentNode.insertBefore(l,a),e.j.push(function(t){n(t),l.parentNode.removeChild(l)})}else{var u=e.util.request();u.open("GET",s,!0),this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=o,200==u.status?n(u.responseText):403==u.status?r.onError(u.responseText):(r.connecting=!1,!r.reconnecting&&r.onError(u.responseText)))},u.send(null)}},r.prototype.getTransport=function(t){for(var n,r=t||this.transports,o=0;n=r[o];o++)if(e.Transport[n]&&e.Transport[n].check(this)&&(!this.isXDomain()||e.Transport[n].xdomainCheck(this)))return new e.Transport[n](this,this.sessionid);
return null},r.prototype.connect=function(t){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(r,o,i,s){function a(t){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(t),n.transport?(n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var t=n.transports;t.length>0&&t.splice(0,1)[0]!=n.transport.name;);t.length?a(t):n.publish("connect_failed")}},n.options["connect timeout"]))}),void 0):n.publish("connect_failed")}n.sessionid=r,n.closeTimeout=1e3*i,n.heartbeatTimeout=1e3*o,n.transports||(n.transports=n.origTransports=s?e.util.intersect(s.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),a(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},r.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;
this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},r.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},r.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},r.prototype.disconnectSync=function(){var t=e.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",n,!1),t.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var t=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=t
},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.emit("connect"),this.doBuffer||this.setBuffer(!1))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},r.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},r.prototype.onDisconnect=function(t){var e=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||n)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function t(){if(n.connected){for(var t in n.namespaces)n.namespaces.hasOwnProperty(t)&&""!==t&&n.namespaces[t].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)
}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",e),n.removeListener("connect",e),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=o}function e(){return n.reconnecting?n.connected?t():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(e,1e3):(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),t()):(n.on("connect_failed",e),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<i&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(e,n.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],o=this.options["try multiple transports"],i=this.options["reconnection limit"];
this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){function n(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(t,e){this.namespace=t,this.name=e}t.SocketNamespace=n,e.util.mixin(n,e.EventEmitter),n.prototype.$emit=e.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},n.prototype.send=function(t,e){var n={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=e),this.packet(n)},n.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n=e[e.length-1],r={type:"event",name:t};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,e=e.slice(0,e.length-1)),r.args=e,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this
},n.prototype.onPacket=function(t){function n(){r.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var r=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var o=["message",t.data];"data"==t.ack?o.push(n):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,o);break;case"event":var o=[t.name].concat(t.args);"data"==t.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e,n){function r(){e.Transport.apply(this,arguments)}t.websocket=r,e.util.inherit(r,e.Transport),r.prototype.name="websocket",r.prototype.open=function(){var t,r=e.util.query(this.socket.options.query),o=this;return t||(t=n.MozWebSocket||n.WebSocket),this.websocket=new t(this.prepareUrl()+r),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(t){o.onData(t.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(t){o.onError(t)},this},r.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){try{e.websocket.send(t)}catch(n){e.onError(n)}},0),this}:function(t){try{this.websocket.send(t)}catch(e){this.onError(e)}return this},r.prototype.payload=function(t){for(var e=0,n=t.length;n>e;e++)this.packet(t[e]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(t){this.socket.onError(t)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"
},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},e.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e,n){function r(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function o(){}t.XHR=r,e.util.inherit(r,e.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(t){for(var n=[],r=0,o=t.length;o>r;r++)n.push(e.parser.encodePacket(t[r]));this.send(e.parser.encodePayload(n))},r.prototype.send=function(t){return this.post(t),this},r.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=o,i.posting=!1,200==this.status?i.socket.setBuffer(!1):i.onClose())}function r(){this.onload=o,i.socket.setBuffer(!1)}var i=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=r:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(t){var n=e.util.request(this.socket.isXDomain()),r=e.util.query(this.socket.options.query,"t="+ +new Date);
if(n.open(t||"GET",this.prepareUrl()+r,!0),"POST"==t)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(o){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(t,r){try{var o=e.util.request(r),i=n.XDomainRequest&&o instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",a=n.location&&s!=n.location.protocol;if(o&&(!i||!a))return!0}catch(l){}return!1},r.xdomainCheck=function(t){return r.check(t,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e,n){function r(){e.Transport.XHR.apply(this,arguments)}function o(){}t["xhr-polling"]=r,e.util.inherit(r,e.Transport.XHR),e.util.merge(r,e.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var t=this;return e.Transport.XHR.prototype.open.call(t),!1},r.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=o,200==this.status?(i.onData(this.responseText),i.get()):i.onClose())}function e(){this.onload=o,this.onerror=o,i.retryCounter=1,i.onData(this.responseText),i.get()}function r(){i.retryCounter++,!i.retryCounter||i.retryCounter>3?i.onClose():i.get()}if(this.isOpen){var i=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=r):this.xhr.onreadystatechange=t,this.xhr.send(null)}},r.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o;try{this.xhr.abort()
}catch(t){}this.xhr=null}},r.prototype.ready=function(t,n){var r=this;e.util.defer(function(){n.call(r)})},e.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */
function(t,e){function n(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=n,e.util.inherit(n,e.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var t=this.doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var n=this,r=e.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+r,e.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(t,e){this.onData(t);try{var n=e.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)
},n.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&e.Transport.XHR.check(t)}catch(r){}return!1},n.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports)}(),function(){var t=this,e=t._,n={},r=Array.prototype,o=Object.prototype,i=Function.prototype,s=r.push,a=r.slice,l=r.concat,u=o.toString,c=o.hasOwnProperty,p=r.forEach,h=r.map,d=r.reduce,f=r.reduceRight,m=r.filter,g=r.every,y=r.some,v=r.indexOf,w=r.lastIndexOf,_=Array.isArray,b=Object.keys,k=i.bind,x=function(t){return t instanceof x?t:this instanceof x?(this._wrapped=t,void 0):new x(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):t._=x,x.VERSION="1.6.0";var T=x.each=x.forEach=function(t,e,r){if(null==t)return t;if(p&&t.forEach===p)t.forEach(e,r);else if(t.length===+t.length){for(var o=0,i=t.length;i>o;o++)if(e.call(r,t[o],o,t)===n)return
}else for(var s=x.keys(t),o=0,i=s.length;i>o;o++)if(e.call(r,t[s[o]],s[o],t)===n)return;return t};x.map=x.collect=function(t,e,n){var r=[];return null==t?r:h&&t.map===h?t.map(e,n):(T(t,function(t,o,i){r.push(e.call(n,t,o,i))}),r)};var C="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(t,e,n,r){var o=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return r&&(e=x.bind(e,r)),o?t.reduce(e,n):t.reduce(e);if(T(t,function(t,i,s){o?n=e.call(r,n,t,i,s):(n=t,o=!0)}),!o)throw new TypeError(C);return n},x.reduceRight=x.foldr=function(t,e,n,r){var o=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return r&&(e=x.bind(e,r)),o?t.reduceRight(e,n):t.reduceRight(e);var i=t.length;if(i!==+i){var s=x.keys(t);i=s.length}if(T(t,function(a,l,u){l=s?s[--i]:--i,o?n=e.call(r,n,t[l],l,u):(n=t[l],o=!0)}),!o)throw new TypeError(C);return n},x.find=x.detect=function(t,e,n){var r;return P(t,function(t,o,i){return e.call(n,t,o,i)?(r=t,!0):void 0}),r},x.filter=x.select=function(t,e,n){var r=[];return null==t?r:m&&t.filter===m?t.filter(e,n):(T(t,function(t,o,i){e.call(n,t,o,i)&&r.push(t)
}),r)},x.reject=function(t,e,n){return x.filter(t,function(t,r,o){return!e.call(n,t,r,o)},n)},x.every=x.all=function(t,e,r){e||(e=x.identity);var o=!0;return null==t?o:g&&t.every===g?t.every(e,r):(T(t,function(t,i,s){return(o=o&&e.call(r,t,i,s))?void 0:n}),!!o)};var P=x.some=x.any=function(t,e,r){e||(e=x.identity);var o=!1;return null==t?o:y&&t.some===y?t.some(e,r):(T(t,function(t,i,s){return o||(o=e.call(r,t,i,s))?n:void 0}),!!o)};x.contains=x.include=function(t,e){return null==t?!1:v&&t.indexOf===v?-1!=t.indexOf(e):P(t,function(t){return t===e})},x.invoke=function(t,e){var n=a.call(arguments,2),r=x.isFunction(e);return x.map(t,function(t){return(r?e:t[e]).apply(t,n)})},x.pluck=function(t,e){return x.map(t,x.property(e))},x.where=function(t,e){return x.filter(t,x.matches(e))},x.findWhere=function(t,e){return x.find(t,x.matches(e))},x.max=function(t,e,n){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var r=-1/0,o=-1/0;return T(t,function(t,i,s){var a=e?e.call(n,t,i,s):t;a>o&&(r=t,o=a)
}),r},x.min=function(t,e,n){if(!e&&x.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var r=1/0,o=1/0;return T(t,function(t,i,s){var a=e?e.call(n,t,i,s):t;o>a&&(r=t,o=a)}),r},x.shuffle=function(t){var e,n=0,r=[];return T(t,function(t){e=x.random(n++),r[n-1]=r[e],r[e]=t}),r},x.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=x.values(t)),t[x.random(t.length-1)]):x.shuffle(t).slice(0,Math.max(0,e))};var S=function(t){return null==t?x.identity:x.isFunction(t)?t:x.property(t)};x.sortBy=function(t,e,n){return e=S(e),x.pluck(x.map(t,function(t,r,o){return{value:t,index:r,criteria:e.call(n,t,r,o)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index-e.index}),"value")};var E=function(t){return function(e,n,r){var o={};return n=S(n),T(e,function(i,s){var a=n.call(r,i,s,e);t(o,a,i)}),o}};x.groupBy=E(function(t,e,n){x.has(t,e)?t[e].push(n):t[e]=[n]}),x.indexBy=E(function(t,e,n){t[e]=n}),x.countBy=E(function(t,e){x.has(t,e)?t[e]++:t[e]=1
}),x.sortedIndex=function(t,e,n,r){n=S(n);for(var o=n.call(r,e),i=0,s=t.length;s>i;){var a=i+s>>>1;n.call(r,t[a])<o?i=a+1:s=a}return i},x.toArray=function(t){return t?x.isArray(t)?a.call(t):t.length===+t.length?x.map(t,x.identity):x.values(t):[]},x.size=function(t){return null==t?0:t.length===+t.length?t.length:x.keys(t).length},x.first=x.head=x.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:0>e?[]:a.call(t,0,e)},x.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},x.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},x.rest=x.tail=x.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},x.compact=function(t){return x.filter(t,x.identity)};var $=function(t,e,n){return e&&x.every(t,x.isArray)?l.apply(n,t):(T(t,function(t){x.isArray(t)||x.isArguments(t)?e?s.apply(n,t):$(t,e,n):n.push(t)}),n)};x.flatten=function(t,e){return $(t,e,[])},x.without=function(t){return x.difference(t,a.call(arguments,1))},x.partition=function(t,e){var n=[],r=[];
return T(t,function(t){(e(t)?n:r).push(t)}),[n,r]},x.uniq=x.unique=function(t,e,n,r){x.isFunction(e)&&(r=n,n=e,e=!1);var o=n?x.map(t,n,r):t,i=[],s=[];return T(o,function(n,r){(e?r&&s[s.length-1]===n:x.contains(s,n))||(s.push(n),i.push(t[r]))}),i},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(t){var e=a.call(arguments,1);return x.filter(x.uniq(t),function(t){return x.every(e,function(e){return x.contains(e,t)})})},x.difference=function(t){var e=l.apply(r,a.call(arguments,1));return x.filter(t,function(t){return!x.contains(e,t)})},x.zip=function(){for(var t=x.max(x.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=x.pluck(arguments,""+n);return e},x.object=function(t,e){if(null==t)return{};for(var n={},r=0,o=t.length;o>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},x.indexOf=function(t,e,n){if(null==t)return-1;var r=0,o=t.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(t,e),t[r]===e?r:-1;r=0>n?Math.max(0,o+n):n}if(v&&t.indexOf===v)return t.indexOf(e,n);
for(;o>r;r++)if(t[r]===e)return r;return-1},x.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(w&&t.lastIndexOf===w)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var o=r?n:t.length;o--;)if(t[o]===e)return o;return-1},x.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),o=0,i=new Array(r);r>o;)i[o++]=t,t+=n;return i};var F=function(){};x.bind=function(t,e){var n,r;if(k&&t.bind===k)return k.apply(t,a.call(arguments,1));if(!x.isFunction(t))throw new TypeError;return n=a.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,n.concat(a.call(arguments)));F.prototype=t.prototype;var o=new F;F.prototype=null;var i=t.apply(o,n.concat(a.call(arguments)));return Object(i)===i?i:o}},x.partial=function(t){var e=a.call(arguments,1);return function(){for(var n=0,r=e.slice(),o=0,i=r.length;i>o;o++)r[o]===x&&(r[o]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return t.apply(this,r)}},x.bindAll=function(t){var e=a.call(arguments,1);
if(0===e.length)throw new Error("bindAll must be passed function names");return T(e,function(e){t[e]=x.bind(t[e],t)}),t},x.memoize=function(t,e){var n={};return e||(e=x.identity),function(){var r=e.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},x.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},x.defer=function(t){return x.delay.apply(x,[t,1].concat(a.call(arguments,1)))},x.throttle=function(t,e,n){var r,o,i,s=null,a=0;n||(n={});var l=function(){a=n.leading===!1?0:x.now(),s=null,i=t.apply(r,o),r=o=null};return function(){var u=x.now();a||n.leading!==!1||(a=u);var c=e-(u-a);return r=this,o=arguments,0>=c?(clearTimeout(s),s=null,a=u,i=t.apply(r,o),r=o=null):s||n.trailing===!1||(s=setTimeout(l,c)),i}},x.debounce=function(t,e,n){var r,o,i,s,a,l=function(){var u=x.now()-s;e>u?r=setTimeout(l,e-u):(r=null,n||(a=t.apply(i,o),i=o=null))};return function(){i=this,o=arguments,s=x.now();var u=n&&!r;return r||(r=setTimeout(l,e)),u&&(a=t.apply(i,o),i=o=null),a
}},x.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},x.wrap=function(t,e){return x.partial(e,t)},x.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},x.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},x.keys=function(t){if(!x.isObject(t))return[];if(b)return b(t);var e=[];for(var n in t)x.has(t,n)&&e.push(n);return e},x.values=function(t){for(var e=x.keys(t),n=e.length,r=new Array(n),o=0;n>o;o++)r[o]=t[e[o]];return r},x.pairs=function(t){for(var e=x.keys(t),n=e.length,r=new Array(n),o=0;n>o;o++)r[o]=[e[o],t[e[o]]];return r},x.invert=function(t){for(var e={},n=x.keys(t),r=0,o=n.length;o>r;r++)e[t[n[r]]]=n[r];return e},x.functions=x.methods=function(t){var e=[];for(var n in t)x.isFunction(t[n])&&e.push(n);return e.sort()},x.extend=function(t){return T(a.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},x.pick=function(t){var e={},n=l.apply(r,a.call(arguments,1));
return T(n,function(n){n in t&&(e[n]=t[n])}),e},x.omit=function(t){var e={},n=l.apply(r,a.call(arguments,1));for(var o in t)x.contains(n,o)||(e[o]=t[o]);return e},x.defaults=function(t){return T(a.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},x.clone=function(t){return x.isObject(t)?x.isArray(t)?t.slice():x.extend({},t):t},x.tap=function(t,e){return e(t),t};var R=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof x&&(t=t._wrapped),e instanceof x&&(e=e._wrapped);var o=u.call(t);if(o!=u.call(e))return!1;switch(o){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var i=n.length;i--;)if(n[i]==t)return r[i]==e;var s=t.constructor,a=e.constructor;if(s!==a&&!(x.isFunction(s)&&s instanceof s&&x.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1;
n.push(t),r.push(e);var l=0,c=!0;if("[object Array]"==o){if(l=t.length,c=l==e.length)for(;l--&&(c=R(t[l],e[l],n,r)););}else{for(var p in t)if(x.has(t,p)&&(l++,!(c=x.has(e,p)&&R(t[p],e[p],n,r))))break;if(c){for(p in e)if(x.has(e,p)&&!l--)break;c=!l}}return n.pop(),r.pop(),c};x.isEqual=function(t,e){return R(t,e,[],[])},x.isEmpty=function(t){if(null==t)return!0;if(x.isArray(t)||x.isString(t))return 0===t.length;for(var e in t)if(x.has(t,e))return!1;return!0},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isArray=_||function(t){return"[object Array]"==u.call(t)},x.isObject=function(t){return t===Object(t)},T(["Arguments","Function","String","Number","Date","RegExp"],function(t){x["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(t){return!(!t||!x.has(t,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(t){return"function"==typeof t}),x.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},x.isNaN=function(t){return x.isNumber(t)&&t!=+t
},x.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==u.call(t)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.has=function(t,e){return c.call(t,e)},x.noConflict=function(){return t._=e,this},x.identity=function(t){return t},x.constant=function(t){return function(){return t}},x.property=function(t){return function(e){return e[t]}},x.matches=function(t){return function(e){if(e===t)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0}},x.times=function(t,e,n){for(var r=Array(Math.max(0,t)),o=0;t>o;o++)r[o]=e.call(n,o);return r},x.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},x.now=Date.now||function(){return(new Date).getTime()};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};N.unescape=x.invert(N.escape);var A={escape:new RegExp("["+x.keys(N.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(N.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(t){x[t]=function(e){return null==e?"":(""+e).replace(A[t],function(e){return N[t][e]
})}}),x.result=function(t,e){if(null==t)return void 0;var n=t[e];return x.isFunction(n)?n.call(t):n},x.mixin=function(t){T(x.functions(t),function(e){var n=x[e]=t[e];x.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),D.call(this,n.apply(x,t))}})};var M=0;x.uniqueId=function(t){var e=++M+"";return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(t,e,n){var r;n=x.defaults({},n,x.templateSettings);var o=new RegExp([(n.escape||O).source,(n.interpolate||O).source,(n.evaluate||O).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(o,function(e,n,r,o,a){return s+=t.slice(i,a).replace(L,function(t){return"\\"+I[t]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=a+e.length,e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";
try{r=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return r(e,x);var l=function(t){return r.call(this,t,x)};return l.source="function("+(n.variable||"obj")+"){\n"+s+"}",l},x.chain=function(t){return x(t).chain()};var D=function(t){return this._chain?x(t).chain():t};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];x.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],D.call(this,n)}}),T(["concat","join","slice"],function(t){var e=r[t];x.prototype[t]=function(){return D.call(this,e.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(t,e){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(n,r,o){t.Backbone=e(t,o,n,r)});else if("undefined"!=typeof exports){var n=require("underscore");
e(t,exports,n)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,n,r){{var o=t.Backbone,i=[],s=(i.push,i.slice);i.splice}e.VERSION="1.1.2",e.$=r,e.noConflict=function(){return t.Backbone=o,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(t,e,n){if(!u(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!u(this,"once",t,[e,r])||!e)return this;var o=this,i=n.once(function(){o.off(t,i),e.apply(this,arguments)});return i._callback=e,this.on(t,i,r)},off:function(t,e,r){var o,i,s,a,l,c,p,h;if(!this._events||!u(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events=void 0,this;for(a=t?[t]:n.keys(this._events),l=0,c=a.length;c>l;l++)if(t=a[l],s=this._events[t]){if(this._events[t]=o=[],e||r)for(p=0,h=s.length;h>p;p++)i=s[p],(e&&e!==i.callback&&e!==i.callback._callback||r&&r!==i.context)&&o.push(i);o.length||delete this._events[t]
}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!u(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&c(n,e),r&&c(r,arguments),this},stopListening:function(t,e,r){var o=this._listeningTo;if(!o)return this;var i=!e&&!r;r||"object"!=typeof e||(r=this),t&&((o={})[t._listenId]=t);for(var s in o)t=o[s],t.off(e,r,this),(i||n.isEmpty(t._events))&&delete this._listeningTo[s];return this}},l=/\s+/,u=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(r));return!1}if(l.test(n)){for(var i=n.split(l),s=0,a=i.length;a>s;s++)t[e].apply(t,[i[s]].concat(r));return!1}return!0},c=function(t,e){var n,r=-1,o=t.length,i=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e);
return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(t,e){a[e]=function(e,r,o){var i=this._listeningTo||(this._listeningTo={}),s=e._listenId||(e._listenId=n.uniqueId("l"));return i[s]=e,o||"object"!=typeof r||(o=this),e[t](r,o,this),this}}),a.bind=a.on,a.unbind=a.off,n.extend(e,a);var h=e.Model=function(t,e){var r=t||{};e||(e={}),this.cid=n.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(h.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,r){var o,i,s,a,l,u,c,p;if(null==t)return this;if("object"==typeof t?(i=t,r=e):(i={})[t]=e,r||(r={}),!this._validate(i,r))return!1;
s=r.unset,l=r.silent,a=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=n.clone(this.attributes),this.changed={}),p=this.attributes,c=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(o in i)e=i[o],n.isEqual(p[o],e)||a.push(o),n.isEqual(c[o],e)?delete this.changed[o]:this.changed[o]=e,s?delete p[o]:p[o]=e;if(!l){a.length&&(this._pending=r);for(var h=0,d=a.length;d>h;h++)this.trigger("change:"+a[h],this,p[a[h]],r)}if(u)return this;if(!l)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?n.clone(this.changed):!1;var e,r=!1,o=this._changing?this._previousAttributes:this.attributes;
for(var i in t)n.isEqual(o[i],e=t[i])||((r||(r={}))[i]=e);return r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,r=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(r&&r(e,n,t),e.trigger("sync",e,n,t),void 0):!1},L(this,t),this.sync("read",this,t)},save:function(t,e,r){var o,i,s,a=this.attributes;if(null==t||"object"==typeof t?(o=t,r=e):(o={})[t]=e,r=n.extend({validate:!0},r),o&&!r.wait){if(!this.set(o,r))return!1}else if(!this._validate(o,r))return!1;o&&r.wait&&(this.attributes=n.extend({},a,o)),void 0===r.parse&&(r.parse=!0);var l=this,u=r.success;return r.success=function(t){l.attributes=a;var e=l.parse(t,r);return r.wait&&(e=n.extend(o||{},e)),n.isObject(e)&&!l.set(e,r)?!1:(u&&u(l,t,r),l.trigger("sync",l,t,r),void 0)},L(this,r),i=this.isNew()?"create":r.patch?"patch":"update","patch"===i&&(r.attrs=o),s=this.sync(i,this,r),o&&r.wait&&(this.attributes=a),s
},destroy:function(t){t=t?n.clone(t):{};var e=this,r=t.success,o=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(n){(t.wait||e.isNew())&&o(),r&&r(e,n,t),e.isNew()||e.trigger("sync",e,n,t)},this.isNew())return t.success(),!1;L(this,t);var i=this.sync("delete",this,t);return t.wait||o(),i},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||I();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;return r?(this.trigger("invalid",this,r,n.extend(e,{validationError:r})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];n.each(d,function(t){h.prototype[t]=function(){var e=s.call(arguments);
return e.unshift(this.attributes),n[t].apply(n,e)}});var f=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};n.extend(f.prototype,a,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,g))},remove:function(t,e){var r=!n.isArray(t);t=r?[t]:n.clone(t),e||(e={});var o,i,s,a;for(o=0,i=t.length;i>o;o++)a=t[o]=this.get(t[o]),a&&(delete this._byId[a.id],delete this._byId[a.cid],s=this.indexOf(a),this.models.splice(s,1),this.length--,e.silent||(e.index=s,a.trigger("remove",a,this,e)),this._removeReference(a,e));return r?t[0]:t},set:function(t,e){e=n.defaults({},e,m),e.parse&&(t=this.parse(t,e));var r=!n.isArray(t);t=r?t?[t]:[]:n.clone(t);var o,i,s,a,l,u,c,p=e.at,d=this.model,f=this.comparator&&null==p&&e.sort!==!1,g=n.isString(this.comparator)?this.comparator:null,y=[],v=[],w={},_=e.add,b=e.merge,k=e.remove,x=!f&&_&&k?[]:!1;
for(o=0,i=t.length;i>o;o++){if(l=t[o]||{},s=l instanceof h?a=l:l[d.prototype.idAttribute||"id"],u=this.get(s))k&&(w[u.cid]=!0),b&&(l=l===a?a.attributes:l,e.parse&&(l=u.parse(l,e)),u.set(l,e),f&&!c&&u.hasChanged(g)&&(c=!0)),t[o]=u;else if(_){if(a=t[o]=this._prepareModel(l,e),!a)continue;y.push(a),this._addReference(a,e)}a=u||a,a&&(!x||!a.isNew()&&w[a.id]||x.push(a),w[a.id]=!0)}if(k){for(o=0,i=this.length;i>o;++o)w[(a=this.models[o]).cid]||v.push(a);v.length&&this.remove(v,e)}if(y.length||x&&x.length)if(f&&(c=!0),this.length+=y.length,null!=p)for(o=0,i=y.length;i>o;o++)this.models.splice(p+o,0,y[o]);else{x&&(this.models.length=0);var T=x||y;for(o=0,i=T.length;i>o;o++)this.models.push(T[o])}if(c&&this.sort({silent:!0}),!e.silent){for(o=0,i=y.length;i>o;o++)(a=y[o]).trigger("add",a,this,e);(c||x&&x.length)&&this.trigger("sort",this,e)}return r?t[0]:t},reset:function(t,e){e||(e={});for(var r=0,o=this.models.length;o>r;r++)this._removeReference(this.models[r],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t
},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return n.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return n.invoke(this.models,"get",t)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);
var e=t.success,r=this;return t.success=function(n){var o=t.reset?"reset":"set";r[o](n,t),e&&e(r,n,t),r.trigger("sync",r,n,t)},L(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?n.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var r=this,o=e.success;return e.success=function(t,n){e.wait&&r.add(t,e),o&&o(t,n,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof h)return t;e=e?n.clone(e):{},e.collection=this;var r=new this.model(t,e);return r.validationError?(this.trigger("invalid",this,r.validationError,e),!1):r},_addReference:function(t){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))
}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(y,function(t){f.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),n[t].apply(n,e)}});var v=["groupBy","countBy","sortBy","indexBy"];n.each(v,function(t){f.prototype[t]=function(e,r){var o=n.isFunction(e)?e:function(t){return t.get(e)};return n[t](this.models,o,r)}});var w=e.View=function(t){this.cid=n.uniqueId("view"),t||(t={}),n.extend(this,n.pick(t,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];n.extend(w.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this
},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=n.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var r=t[e];if(n.isFunction(r)||(r=this[t[e]]),r){var o=e.match(_),i=o[1],s=o[2];r=n.bind(r,this),i+=".delegateEvents"+this.cid,""===s?this.$el.on(i,r):this.$el.on(i,s,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t["class"]=n.result(this,"className"));var r=e.$("<"+n.result(this,"tagName")+">").attr(t);this.setElement(r,!1)}}}),e.sync=function(t,r,o){var i=x[t];n.defaults(o||(o={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:i,dataType:"json"};
if(o.url||(s.url=n.result(r,"url")||I()),null!=o.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||r.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){s.type="POST",o.emulateJSON&&(s.data._method=i);var a=o.beforeSend;o.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",i),a?a.apply(this,arguments):void 0}}"GET"===s.type||o.emulateJSON||(s.processData=!1),"PATCH"===s.type&&k&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=o.xhr=e.ajax(n.extend(s,o));return r.trigger("request",r,l,o),l};var k=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var T=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)
},C=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,S=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(T.prototype,a,{initialize:function(){},route:function(t,r,o){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(r)&&(o=r,r=""),o||(o=this[r]);var i=this;return e.history.route(t,function(n){var s=i._extractParameters(t,n);i.execute(o,s)!==!1&&(i.trigger.apply(i,["route:"+r].concat(s)),i.trigger("route",r,s),e.history.trigger("route",i,r,s))}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(E,"\\$&").replace(C,"(?:$1)?").replace(P,function(t,e){return e?t:"([^/?]+)"}).replace(S,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return n.map(r,function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null
})}});var $=e.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,R=/^\/+|\/+$/g,N=/msie [\w.]+/,A=/\/$/,M=/#.*$/;$.started=!1,n.extend($.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(A,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace(F,"")},start:function(t){if($.started)throw new Error("Backbone.history has already been started");$.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);
var r=this.getFragment(),o=document.documentMode,i=N.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);if(this.root=("/"+this.root+"/").replace(R,"/"),i&&this._wantsHashChange){var s=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),$.started=!1
},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl(),void 0)},loadUrl:function(t){return t=this.fragment=this.getFragment(t),n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!$.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(M,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0
}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),e.history=new $;var O=function(t,e){var r,o=this;r=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(r,o,e);var i=function(){this.constructor=r};return i.prototype=o.prototype,r.prototype=new i,t&&n.extend(r.prototype,t),r.__super__=o.prototype,r};h.extend=f.extend=T.extend=w.extend=$.extend=O;var I=function(){throw new Error('A "url" property or function must be specified')},L=function(t,e){var n=e.error;e.error=function(r){n&&n(t,r,e),t.trigger("error",t,r,e)}};return e}),Backbone.History.prototype.navigate=function(t,e){if(!Backbone.History.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);
this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},function(t,e){"object"==typeof exports&&t.require?module.exports=e(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],function(n,r){return e(n||t._,r||t.Backbone)}):e(_,Backbone)}(this,function(t,e){function n(r,o){function i(t){return String(t).replace(s,encodeURIComponent(s))}var s=e.Router.arrayValueSplit;if(!r)return"";o=o||"";var a=[];return t.each(r,function(e,r){if(r=o+r,t.isString(e)||t.isNumber(e)||t.isBoolean(e)||t.isDate(e))null!=e&&a.push(r+"="+i(encodeURIComponent(e)));else if(t.isArray(e)){for(var l="",u=0;u<e.length;u++){var c=e[u];null!=c&&(l+=s+i(c))}l&&a.push(r+"="+l)}else{var p=n(e,r+".");p&&a.push(p)}}),a.join("&")}function r(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t
}}function o(e,n){var r=e.split("&");t.each(r,function(t){var e=t.split("=");n(e.shift(),e.join("="))})}var i=/^\?(.*)/,s=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,l=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g,c=/^([^\?]*)/,p=/[\:\*]([^\:\?\/]+)/g,h=/^[#\/]|\s+$/g,d=/\/$/;e.Router.arrayValueSplit="|",t.extend(e.History.prototype,{getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(d,""),r=this.location.search;t.indexOf(n)||(t=t.substr(n.length)),r&&this._hasPushState&&(t+=r)}else t=this.getHash();return t.replace(h,"")},getQueryParameters:function(e,n){e=this.getFragment(e,n);var s=e.replace(c,""),a=s.match(i);if(a){s=a[1];var l={};return o(s,function(e,n){n=r(n),l[e]?t.isString(l[e])?l[e]=[l[e],n]:l[e].push(n):l[e]=n}),l}return{}}}),t.extend(e.Router.prototype,{initialize:function(t){this.encodedSplatParts=t&&t.encodedSplatParts},_routeToRegExp:function(e){var n=l.exec(e)||{index:-1},r=a.exec(e)||{index:-1},o=e.match(p)||[];e=e.replace(u,"\\$&").replace(s,"(?:$1)?").replace(a,function(t,e){return e?t:"([^\\/\\?]+)"
}).replace(l,"([^??]*?)"),e+="(\\?.*)?";var i=new RegExp("^"+e+"$");return n.index>=0&&(i.splatMatch=r>=0?n.index-r.index:-1),i.paramNames=t.map(o,function(t){return t.substring(1)}),i.namedParameters=this.namedParameters,i},_extractParameters:function(n,s){var a=n.exec(s).slice(1),l={};a.length>0&&t.isUndefined(a[a.length-1])&&a.splice(a.length-1,1);var u=a.length&&a[a.length-1]&&a[a.length-1].match(i);if(u){var c=u[1],p={};if(c){var h=this;o(c,function(t,e){h._setParamValue(t,e,p)})}a[a.length-1]=p,t.extend(l,p)}var d=a.length;if(n.splatMatch&&this.encodedSplatParts){if(n.splatMatch<0)return a;d-=1}for(var f=0;d>f;f++)t.isString(a[f])&&(a[f]=r(a[f]),n.paramNames&&n.paramNames.length>=f-1&&(l[n.paramNames[f]]=a[f]));return e.Router.namedParameters||n.namedParameters?[l]:a},_setParamValue:function(t,e,n){t=t.replace("[]",""),t=t.replace("%5B%5D","");for(var r=t.split("."),o=n,i=0;i<r.length;i++){var s=r[i];i===r.length-1?o[s]=this._decodeParamValue(e,o[s]):o=o[s]=o[s]||{}}},_decodeParamValue:function(n,o){var i=e.Router.arrayValueSplit;
if(i&&n.indexOf(i)>=0){for(var s=n.split(i),a=s.length-1;a>=0;a--)s[a]?s[a]=r(s[a]):s.splice(a,1);return s}return n=r(n),o?t.isArray(o)?(o.push(n),o):[o,n]:n},toFragment:function(e,r){return r&&(t.isString(r)||(r=n(r)),r&&(e+="?"+r)),e}})}),function(t){if("function"==typeof bootstrap)bootstrap("backboneprojections",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeBackboneProjections=t}else"undefined"!=typeof window?window.BackboneProjections=t():global.BackboneProjections=t()}(function(){return function(t,e,n){function r(n,i){if(!e[n]){if(!t[n]){var s="function"==typeof require&&require;if(!i&&s)return s(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var a=e[n]={exports:{}};t[n][0].call(a.exports,function(e){var o=t[n][1][e];return r(o?o:e)},a,a.exports)}return e[n].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({"lib/index.js":[function(t,e){var n;
n=(("undefined"!=typeof window&&null!==window?window._:void 0)||t("underscore")).extend,e.exports=n({},t("./capped"),t("./filtered"),t("./sorted"))},{"./capped":"lib/capped.js","./filtered":"lib/filtered.js","./sorted":"lib/sorted.js",underscore:"underscore"}],"lib/capped.js":[function(t,e,n){var r,o,i,s,a,l={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||t("backbone")).Collection,a=("undefined"!=typeof window&&null!==window?window._:void 0)||t("underscore"),s=a.toArray,o=a.extend,i=function(t){var e;return e=function(e){return t.indexOf(e)},e.induced=!0,e},n.Capped=function(t){function e(t,n){var r=this;null==n&&(n={}),this.underlying=t,this.model=t.model,this.comparator=n.comparator||i(t),this.options=o({cap:5},t.options,n),e.__super__.constructor.call(this,this._capped(this.underlying.models),n),this.listenTo(this.underlying,{reset:function(){return r.reset(r._capped(r.underlying.models))
},remove:function(t){var e;return r.contains(t)?(r.remove(t),e=r._capped(r.underlying.models),r.add(e[r.options.cap-1])):void 0},add:function(t){return r.length<r.options.cap?r.add(t):r.comparator(t)<r.comparator(r.last())?(r.add(t),r.remove(r.at(r.options.cap))):void 0},sort:function(){return r.comparator.induced?r.reset(r._capped(r.underlying.models)):void 0}})}return u(e,t),e.prototype._capped=function(t){var e=this;return t=s(t),t.sort(function(t,n){return t=e.comparator(t),n=e.comparator(n),t>n?1:n>t?-1:0}),t.slice(0,this.options.cap)},e.prototype.resize=function(t){var e,n,r,o,i;if(this.options.cap>t)for(this.options.cap=t,i=this.models,n=o=i.length-1;o>=0&&(r=i[n],!(t>n));n=o+=-1)this.remove(r);else this.options.cap<t&&(this.options.cap=t,e=this._capped(this.underlying.models),this.add(e.slice(this.length,this.options.cap)));return this.trigger("resize")},e}(r),n.CappedCollection=n.Capped},{backbone:"backbone",underscore:"underscore"}],"lib/filtered.js":[function(t,e,n){var r,o,i,s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t
}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||t("backbone")).Collection,o=(("undefined"!=typeof window&&null!==window?window._:void 0)||t("underscore")).extend,i=function(t){var e;return e=function(e){return t.indexOf(e)},e.induced=!0,e},n.Filtered=function(t){function e(t,n){var r=this;null==n&&(n={}),this.underlying=t,this.model=t.model,this.comparator=n.comparator||i(t),this.options=o({},t.options,n),e.__super__.constructor.call(this,this.underlying.models.filter(this.options.filter),n),this.listenTo(this.underlying,{reset:function(){return r.reset(r.underlying.models.filter(r.options.filter))},remove:function(t){return r.contains(t)?r.remove(t):void 0},add:function(t){return r.options.filter(t)?r.add(t):void 0},change:function(t){return r.decideOn(t)},sort:function(){return r.comparator.induced?r.sort():void 0}})}return a(e,t),e.prototype.update=function(){var t,e,n,r,o;
for(r=this.underlying.models,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.decideOn(t));return o},e.prototype.decideOn=function(t){if(this.contains(t)){if(!this.options.filter(t))return this.remove(t)}else if(this.options.filter(t))return this.add(t)},e}(r),n.FilteredCollection=n.Filtered},{backbone:"backbone",underscore:"underscore"}],"lib/sorted.js":[function(t,e,n){var r,o,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||t("backbone")).Collection,o=(("undefined"!=typeof window&&null!==window?window._:void 0)||t("underscore")).extend,n.Sorted=function(t){function e(t,n){var r=this;if(null==n&&(n={}),!n.comparator)throw new Error("provide a comparator");this.underlying=t,this.model=t.model,this.comparator=n.comparator,this.options=o({},t.options,n),e.__super__.constructor.call(this,this.underlying.models,n),this.listenTo(this.underlying,{reset:function(){return r.reset(r.underlying.models)
},remove:function(t){return r.remove(t)},add:function(t){return r.add(t)}})}return s(e,t),e}(r),n.Reversed=function(t){function e(t,n){null==n&&(n={}),n.comparator=function(e){return-t.indexOf(e)},e.__super__.constructor.call(this,t,n),this.listenTo(this.underlying,{sort:this.sort})}return s(e,t),e}(n.Sorted),n.SortedCollection=n.Sorted,n.ReversedCollection=n.Reversed},{backbone:"backbone",underscore:"underscore"}]},{},["lib/index.js"])("lib/index.js")}),function(){var t,e,n,r,o,i,s,a,l,u,c,p,h,d,f,m,g,y,v,w,_,b,k,x,T,C,P,S,E,$,F,R,N,A,M,O,I,L,D,H,z,V,U,j,q,B,W,Y,G,K,X,Z,Q,J,te=[].slice,ee={}.hasOwnProperty,ne=function(t,e){function n(){this.constructor=t}for(var r in e)ee.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},re=function(t,e){return function(){return t.apply(e,arguments)}};t={},t.version="0.6.22",t.fromBinder=function(e,n){return null==n&&(n=X.id),new a(function(r){var o;return o=e(function(){var e,i,a,l,u,c;for(e=1<=arguments.length?te.call(arguments,0):[],l=n.apply(null,e),l instanceof Array&&X.last(l)instanceof s||(l=[l]),a=t.more,u=0,c=l.length;c>u;u++)if(i=l[u],a=r(i=q(i)),a===t.noMore||i.isEnd())return null!=o?o():t.scheduler.setTimeout(function(){return o()
},0),a;return a})})},t.$={asEventStream:function(e,n,r){var o,i=this;return A(n)&&(o=[n,null],r=o[0],n=o[1]),t.fromBinder(function(t){return i.on(e,n,t),function(){return i.off(e,n,t)}},r)}},null!=(Z="undefined"!=typeof jQuery&&null!==jQuery?jQuery:"undefined"!=typeof Zepto&&null!==Zepto?Zepto:null)&&(Z.fn.asEventStream=t.$.asEventStream),t.fromEventTarget=function(e,n,r){var o,i,s,a,l,u;return o=null!=(s=e.addEventListener)?s:null!=(a=e.addListener)?a:e.bind,i=null!=(l=e.removeEventListener)?l:null!=(u=e.removeListener)?u:e.unbind,t.fromBinder(function(t){return o.call(e,n,t),function(){return i.call(e,n,t)}},r)},t.fromPromise=function(e,n){return t.fromBinder(function(t){return e.then(t,function(e){return t(new i(e))}),function(){return n?"function"==typeof e.abort?e.abort():void 0:void 0}},function(t){return[t,E()]})},t.noMore=["<no-more>"],t.more=["<more>"],t.later=function(e,n){return t.sequentially(e,[n])},t.sequentially=function(e,n){var r;return r=0,t.fromPoll(e,function(){var t;return t=n[r++],r<n.length?t:r===n.length?[t,E()]:E()
})},t.repeatedly=function(e,n){var r;return r=0,t.fromPoll(e,function(){return n[r++%n.length]})},K=function(t){return function(){var e,n,r,o;return r=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],"object"==typeof r&&e.length&&(n=r,o=e[0],r=function(){return n[o].apply(n,arguments)},e=e.slice(1)),t.apply(null,[r].concat(te.call(e)))}},O=function(e){return K(function(){var n,r,o;return r=arguments[0],n=2<=arguments.length?te.call(arguments,1):[],o=U(e,[function(t,e){return r.apply(null,te.call(t).concat([e]))}]),t.combineAsArray(n).flatMap(o)})},t.fromCallback=O(function(){var e,n;return n=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],t.fromBinder(function(t){return I(n,e)(t),V},function(t){return[t,E()]})}),t.fromNodeCallback=O(function(){var e,n;return n=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],t.fromBinder(function(t){return I(n,e)(t),V},function(t,e){return t?[new i(t),E()]:[e,E()]})}),t.fromPoll=function(e,n){return t.fromBinder(function(n){var r;return r=t.scheduler.setInterval(n,e),function(){return t.scheduler.clearInterval(r)
}},n)},t.interval=function(e,n){return null==n&&(n={}),t.fromPoll(e,function(){return z(n)})},t.constant=function(t){return new h(function(e){return e(R(t)),e(E()),V})},t.never=function(){return t.fromArray([])},t.once=function(e){return t.fromArray([e])},t.fromArray=function(e){return w(e),e=C(e),new a(function(n){var r,o;return o=!1,r=function(){var i,s;return X.empty(e)?n(E()):(s=e.splice(0,1)[0],i=n(q(s)),i===t.noMore||o?void 0:r())},r(),function(){return o=!0}})},t.mergeAll=function(){var e;return e=1<=arguments.length?te.call(arguments,0):[],e[0]instanceof Array&&(e=e[0]),X.fold(e,t.never(),function(t,e){return t.merge(e)})},t.zipAsArray=function(){var e;return e=1<=arguments.length?te.call(arguments,0):[],e[0]instanceof Array&&(e=e[0]),t.zipWith(e,function(){var t;return t=1<=arguments.length?te.call(arguments,0):[]})},t.zipWith=function(){var e,n,r;return e=arguments[0],n=2<=arguments.length?te.call(arguments,1):[],A(e)||(r=[e,n[0]],n=r[0],e=r[1]),t.when(X.map(function(t){return t.toEventStream()},n),e)
},t.combineAsArray=function(){var e,n,r,o,i,s,a;for(i=1<=arguments.length?te.call(arguments,0):[],1===i.length&&i[0]instanceof Array&&(i=i[0]),e=s=0,a=i.length;a>s;e=++s)o=i[e],o instanceof p||(i[e]=t.constant(o));return i.length?(r=function(){var t,e,r;for(r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(new g(n,!0,!1,n.subscribeInternal));return r}(),t.when(r,function(){var t;return t=1<=arguments.length?te.call(arguments,0):[]}).toProperty()):t.constant([])},t.onValues=function(){var e,n,r;return n=2<=arguments.length?te.call(arguments,0,r=arguments.length-1):(r=0,[]),e=arguments[r++],t.combineAsArray(n).onValues(e)},t.combineWith=function(){var e,n;return e=arguments[0],n=2<=arguments.length?te.call(arguments,1):[],t.combineAsArray(n).map(function(t){return e.apply(null,t)})},t.combineTemplate=function(e){var n,r,o,i,s,a,l,u,c,h;return l=[],h=[],a=function(t){return t[t.length-1]},c=function(t,e,n){return a(t)[e]=n},n=function(t,e){return function(n,r){return c(n,t,r[e])}},s=function(t,e){return function(n){return c(n,t,e)
}},u=function(t){return t instanceof Array?[]:{}},o=function(t,e){var r,o;return e instanceof p?(h.push(e),l.push(n(t,h.length-1))):e===Object(e)&&"function"!=typeof e?(o=function(t){return function(n){var r;return r=u(e),c(n,t,r),n.push(r)}},r=function(t){return t.pop()},l.push(o(t)),i(e),l.push(r)):l.push(s(t,e))},i=function(t){return X.each(t,o)},i(e),r=function(t){var n,r,o,i,s;for(o=u(e),n=[o],i=0,s=l.length;s>i;i++)(r=l[i])(n,t);return o},t.combineAsArray(h).map(r)},s=function(){function t(){}return t.prototype.isEvent=function(){return!0},t.prototype.isEnd=function(){return!1},t.prototype.isInitial=function(){return!1},t.prototype.isNext=function(){return!1},t.prototype.isError=function(){return!1},t.prototype.hasValue=function(){return!1},t.prototype.filter=function(){return!0},t}(),u=function(t){function e(t){this.value=A(t)?X.cached(t):X.always(t)}return ne(e,t),e.prototype.isNext=function(){return!0},e.prototype.hasValue=function(){return!0},e.prototype.fmap=function(t){var e=this;return this.apply(function(){return t(e.value())
})},e.prototype.apply=function(t){return new e(t)},e.prototype.filter=function(t){return t(this.value())},e.prototype.describe=function(){return this.value()},e}(s),l=function(t){function e(){return Q=e.__super__.constructor.apply(this,arguments)}return ne(e,t),e.prototype.isInitial=function(){return!0},e.prototype.isNext=function(){return!1},e.prototype.apply=function(t){return new e(t)},e.prototype.toNext=function(){return new u(this.value)},e}(u),o=function(t){function e(){return J=e.__super__.constructor.apply(this,arguments)}return ne(e,t),e.prototype.isEnd=function(){return!0},e.prototype.fmap=function(){return this},e.prototype.apply=function(){return this},e.prototype.describe=function(){return"<end>"},e}(s),i=function(t){function e(t){this.error=t}return ne(e,t),e.prototype.isError=function(){return!0},e.prototype.fmap=function(){return this},e.prototype.apply=function(){return this},e.prototype.describe=function(){return"<error> "+this.error},e}(s),p=function(){function e(){this.combine=re(this.combine,this),this.flatMapLatest=re(this.flatMapLatest,this),this.fold=re(this.fold,this),this.scan=re(this.scan,this),this.assign=this.onValue
}return e.prototype.onValue=function(){var t;return t=L(arguments),this.subscribe(function(e){return e.hasValue()?t(e.value()):void 0})},e.prototype.onValues=function(t){return this.onValue(function(e){return t.apply(null,e)})},e.prototype.onError=function(){var t;return t=L(arguments),this.subscribe(function(e){return e.isError()?t(e.error):void 0})},e.prototype.onEnd=function(){var t;return t=L(arguments),this.subscribe(function(e){return e.isEnd()?t():void 0})},e.prototype.errors=function(){return this.filter(function(){return!1})},e.prototype.filter=function(){var e,n;return n=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],S(this,n,e,function(e){return this.withHandler(function(n){return n.filter(e)?this.push(n):t.more})})},e.prototype.takeWhile=function(){var e,n;return n=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],S(this,n,e,function(e){return this.withHandler(function(n){return n.filter(e)?this.push(n):(this.push(E()),t.noMore)})})},e.prototype.endOnError=function(){var t,e;return e=arguments[0],t=2<=arguments.length?te.call(arguments,1):[],null==e&&(e=!0),S(this,e,t,function(t){return this.withHandler(function(e){return e.isError()&&t(e.error)?(this.push(e),this.push(E())):this.push(e)
})})},e.prototype.take=function(e){return 0>=e?t.never():this.withHandler(function(n){return n.hasValue()?(e--,e>0?this.push(n):(0===e&&this.push(n),this.push(E()),t.noMore)):this.push(n)})},e.prototype.map=function(){var t,e;return e=arguments[0],t=2<=arguments.length?te.call(arguments,1):[],e instanceof h?e.sampledBy(this,$):S(this,e,t,function(t){return this.withHandler(function(e){return this.push(e.fmap(t))})})},e.prototype.mapError=function(){var t;return t=L(arguments),this.withHandler(function(e){return e.isError()?this.push(z(t(e.error))):this.push(e)})},e.prototype.mapEnd=function(){var e;return e=L(arguments),this.withHandler(function(n){return n.isEnd()?(this.push(z(e(n))),this.push(E()),t.noMore):this.push(n)})},e.prototype.doAction=function(){var t;return t=L(arguments),this.withHandler(function(e){return e.hasValue()&&t(e.value()),this.push(e)})},e.prototype.skip=function(e){return this.withHandler(function(n){return n.hasValue()?e>0?(e--,t.more):this.push(n):this.push(n)})},e.prototype.skipDuplicates=function(t){return null==t&&(t=function(t,e){return t===e
}),this.withStateMachine(c,function(e,n){return n.hasValue()?n.isInitial()||e===c||!t(e.get(),n.value())?[new m(n.value()),[n]]:[e,[]]:[e,[n]]})},e.prototype.skipErrors=function(){return this.withHandler(function(e){return e.isError()?t.more:this.push(e)})},e.prototype.withStateMachine=function(e,n){var r;return r=e,this.withHandler(function(e){var o,i,s,a,l,u,c;for(o=n(r,e),i=o[0],a=o[1],r=i,l=t.more,u=0,c=a.length;c>u;u++)if(s=a[u],l=this.push(s),l===t.noMore)return l;return l})},e.prototype.scan=function(e,n,r){var o,i,s,a=this;return i=j(n),n=r?i:function(t,e){return i(t(),e())},o=Y(e).map(function(t){return X.always(t)}),s=function(e){var r,i,s,u;return r=!1,u=V,i=t.more,s=function(){return r?void 0:(r=!0,o.forEach(function(n){return i=e(new l(n)),i===t.noMore?(u(),u=V):void 0}))},u=a.subscribe(function(a){var l,u;return a.hasValue()?r&&a.isInitial()?t.more:(a.isInitial()||s(),r=!0,u=o.getOrElse(function(){return void 0}),l=X.cached(function(){return n(u,a.value)}),o=new m(l),e(a.apply(l))):(a.isEnd()&&(i=s()),i!==t.noMore?e(a):void 0)
}),s(),u},new h(s)},e.prototype.fold=function(t,e){return this.scan(t,e).sampledBy(this.filter(!1).mapEnd().toProperty())},e.prototype.zip=function(e,n){return null==n&&(n=Array),t.zipWith([this,e],n)},e.prototype.diff=function(t,e){return e=j(e),this.scan([t],function(t,n){return[n,e(t[0],n)]}).filter(function(t){return 2===t.length}).map(function(t){return t[1]})},e.prototype.flatMap=function(r,o){var i;return r=H(r),i=this,new a(function(s){var a,u;return u=new n,a=function(t){return t(),u.empty()?s(E()):void 0},u.add(function(n,c){return i.subscribe(function(n){var i;return n.isEnd()?a(c):n.isError()?s(n):o&&u.count()>1?t.more:u.unsubscribed?t.noMore:(i=r(n.value()),i instanceof e||(i=t.once(i)),u.add(function(e,n){return i.subscribe(function(r){var o;return r.isEnd()?(a(n),t.noMore):(r instanceof l&&(r=r.toNext()),o=s(r),o===t.noMore&&e(),o)})}))})}),u.unsubscribe})},e.prototype.flatMapFirst=function(t){return this.flatMap(t,!0)},e.prototype.flatMapLatest=function(t){var e;return t=H(t),e=this.toEventStream(),e.flatMap(function(n){return t(n).takeUntil(e)
})},e.prototype.not=function(){return this.map(function(t){return!t})},e.prototype.log=function(){var t;return t=1<=arguments.length?te.call(arguments,0):[],this.subscribe(function(e){return"undefined"!=typeof console&&null!==console?"function"==typeof console.log?console.log.apply(console,te.call(t).concat([e.describe()])):void 0:void 0}),this},e.prototype.slidingWindow=function(t,e){return null==e&&(e=0),this.scan([],function(e,n){return e.concat([n]).slice(-t)}).filter(function(t){return t.length>=e})},e.prototype.combine=function(e,n){var r;return r=j(n),t.combineAsArray(this,e).map(function(t){return r(t[0],t[1])})},e.prototype.decode=function(e){return this.combine(t.combineTemplate(e),function(t,e){return e[t]})},e.prototype.awaiting=function(t){return this.toEventStream().map(!0).merge(t.toEventStream().map(!1)).toProperty(!1)},e}(),p.prototype.reduce=p.prototype.fold,a=function(e){function n(t){this.takeUntil=re(this.takeUntil,this),this.sampledBy=re(this.sampledBy,this);var e;n.__super__.constructor.call(this),k(t),e=new r(t),this.subscribe=e.subscribe,this.subscribeInternal=this.subscribe,this.hasSubscribers=e.hasSubscribers
}return ne(n,e),n.prototype.delay=function(e){return this.flatMap(function(n){return t.later(e,n)})},n.prototype.debounce=function(e){return this.flatMapLatest(function(n){return t.later(e,n)})},n.prototype.debounceImmediate=function(e){return this.flatMapFirst(function(n){return t.once(n).concat(t.later(e).filter(!1))})},n.prototype.throttle=function(t){return this.bufferWithTime(t).map(function(t){return t[t.length-1]})},n.prototype.bufferWithTime=function(t){return this.bufferWithTimeOrCount(t,Number.MAX_VALUE)},n.prototype.bufferWithCount=function(t){return this.bufferWithTimeOrCount(void 0,t)},n.prototype.bufferWithTimeOrCount=function(t,e){var n;return n=function(n){return n.values.length===e?n.flush():void 0!==t?n.schedule():void 0},this.buffer(t,n,n)},n.prototype.buffer=function(e,n,r){var o,i,s;return null==n&&(n=function(){}),null==r&&(r=function(){}),o={scheduled:!1,end:null,values:[],flush:function(){var e;if(this.scheduled=!1,this.values.length>0){if(e=this.push(z(this.values)),this.values=[],null!=this.end)return this.push(this.end);
if(e!==t.noMore)return r(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){var t=this;return this.scheduled?void 0:(this.scheduled=!0,e(function(){return t.flush()}))}},s=t.more,A(e)||(i=e,e=function(e){return t.scheduler.setTimeout(e,i)}),this.withHandler(function(t){return o.push=this.push,t.isError()?s=this.push(t):t.isEnd()?(o.end=t,o.scheduled||o.flush()):(o.values.push(t.value()),n(o)),s})},n.prototype.merge=function(e){var r;return b(e),r=this,new n(function(n){var o,i;return o=0,i=function(e){return function(r){return e.subscribe(function(e){var i;return e.isEnd()?(o++,2===o?n(E()):t.more):(i=n(e),i===t.noMore&&r(),i)})}},P(i(r),i(e))})},n.prototype.toProperty=function(t){return 0===arguments.length&&(t=c),this.scan(t,M,!0)},n.prototype.toEventStream=function(){return this},n.prototype.sampledBy=function(t,e){return this.toProperty().sampledBy(t,e)},n.prototype.concat=function(t){var e;return e=this,new n(function(n){var r,o;return o=V,r=e.subscribe(function(e){return e.isEnd()?o=t.subscribe(n):n(e)
}),function(){return r(),o()}})},n.prototype.takeUntil=function(e){var r;return r=this,new n(function(n){var o,i;return i=function(r){return e.onValue(function(){return n(E()),r(),t.noMore})},o=function(e){return r.subscribe(function(r){var o;return o=n(r),(r.isEnd()||o===t.noMore)&&e(),o})},P(i,o)})},n.prototype.skipUntil=function(t){var e;return e=t.take(1).map(!0).toProperty(!1),this.filter(e)},n.prototype.skipWhile=function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?te.call(arguments,1):[],r=!1,S(this,n,e,function(e){return this.withHandler(function(n){return!r&&n.hasValue()&&e(n.value())?t.more:(n.hasValue()&&(r=!0),this.push(n))})})},n.prototype.startWith=function(e){return t.once(e).concat(this)},n.prototype.withHandler=function(t){var e;return e=new r(this.subscribe,t),new n(e.subscribe)},n.prototype.withSubscribe=function(t){return new n(t)},n}(p),h=function(e){function n(e,r){this.toEventStream=re(this.toEventStream,this),this.toProperty=re(this.toProperty,this),this.changes=re(this.changes,this),this.sample=re(this.sample,this);
var o=this;n.__super__.constructor.call(this),this.subscribeInternal=r===!0?e:new d(e,r).subscribe,this.sampledBy=function(e,r){var i,s,a,l;return null!=r?r=j(r):(i=!0,r=function(t){return t()}),l=new g(o,!1,!1,o.subscribeInternal,i),s=new g(e,!0,!1,e.subscribe,i),a=t.when([l,s],r),e instanceof n?a.toProperty():a},this.subscribe=function(e){var n,r,i,s,a;return i=t.more,n=function(){function n(){}return n.prototype.set=function(t){return this.event=t},n.prototype.send=function(){var n;return n=this.event,this.event=null,null!=n&&i!==t.noMore&&(i=e(n),i===t.noMore)?s():void 0},n}(),a=new n,r=new n,s=V,s=o.subscribeInternal(function(n){return n.isError()?i!==t.noMore&&(i=e(n)):(n.hasValue()?a.set(n):n.isEnd()&&r.set(n),f.onDone(function(){return a.send(),r.send()})),i}),function(){return i=t.noMore,s()}}}return ne(n,e),n.prototype.sample=function(e){return this.sampledBy(t.interval(e,{}))},n.prototype.changes=function(){var t=this;return new a(function(e){return t.subscribe(function(t){return t.isInitial()?void 0:e(t)
})})},n.prototype.withHandler=function(t){return new n(this.subscribeInternal,t)},n.prototype.withSubscribe=function(t){return new n(t)},n.prototype.toProperty=function(){return x(arguments),this},n.prototype.toEventStream=function(){var t=this;return new a(function(e){return t.subscribe(function(t){return t.isInitial()&&(t=t.toNext()),e(t)})})},n.prototype.and=function(t){return this.combine(t,function(t,e){return t&&e})},n.prototype.or=function(t){return this.combine(t,function(t,e){return t||e})},n.prototype.delay=function(t){return this.delayChanges(function(e){return e.delay(t)})},n.prototype.debounce=function(t){return this.delayChanges(function(e){return e.debounce(t)})},n.prototype.throttle=function(t){return this.delayChanges(function(e){return e.throttle(t)})},n.prototype.delayChanges=function(t){return y(this,t(this.changes()))},n.prototype.takeUntil=function(t){var e;return e=this.changes().takeUntil(t),y(this,e)},n.prototype.startWith=function(t){return this.scan(t,function(t,e){return e})},n}(p),S=function(t,e,n,r){var o;
return e instanceof h?(o=e.sampledBy(t,function(t,e){return[t,e]}),r.apply(o,[function(t){var e,n;return e=t[0],n=t[1],e}]).map(function(t){var e,n;return e=t[0],n=t[1]})):(e=I(e,n),r.apply(t,[e]))},y=function(e,n){var r;return r=function(e){var n;return n=c,e.subscribe(function(e){return e.hasValue()&&(n=new m(e.value())),t.noMore}),n},n.toProperty(r(e))},r=function(){function e(e,n){var r,o,i,s,a,l,u,c,p,h=this;null==e&&(e=function(){return V}),u=[],a=null,s=!1,o=!1,this.hasSubscribers=function(){return u.length>0},i=null,c=V,l=function(t){return u=X.without(t,u)},p=null,r=function(){var t,e,n,r,o;if(null!=p){for(e=p,p=null,o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(t());return o}},this.push=function(e){var n,o,c,p,d,f;if(s)return a=(a||[]).concat([e]),t.more;if(e!==i){e.isError()&&(i=e),c=!1;try{for(s=!0,p=u,d=0,f=p.length;f>d;d++)o=p[d],n=o.sink(e),(n===t.noMore||e.isEnd())&&l(o);c=!0}finally{s=!1,c||(a=null)}for(c=!0;null!=a?a.length:void 0;)e=X.head(a),a=X.tail(a),h.push(e);return r(e),h.hasSubscribers()?t.more:t.noMore
}},null==n&&(n=function(t){return this.push(t)}),this.handleEvent=function(t){return t.isEnd()&&(o=!0),n.apply(h,[t])},this.subscribe=function(t){var n;return o?(t(E()),V):(k(t),n={sink:t},u=u.concat(n),1===u.length&&(c=e(h.handleEvent)),k(c),function(){return l(n),h.hasSubscribers()?void 0:c()})}}return e}(),d=function(e){function n(e,r){var o,i,s,a=this;n.__super__.constructor.call(this,e,r),o=c,s=this.push,e=this.subscribe,i=!1,this.push=function(t){return t.isEnd()&&(i=!0),t.hasValue()&&(o=new m(t.value)),f.inTransaction(function(){return s.apply(a,[t])})},this.subscribe=function(n){var r,s,l;return r=!1,l=function(){return a.hasSubscribers()||i},s=o.filter(l).map(function(t){return n(R(t()))}),s.getOrElse(t.more)===t.noMore?V:i?(n(E()),V):e.apply(a,[n])}}return ne(n,e),n}(r),f=function(){var t,e,n,r;return r=[],n=!1,e=function(t){return n?r.push(t):t()},t=function(t){var e,o,i,s,a;if(n)return t();n=!0;try{i=t()}finally{n=!1}for(o=r,r=[],s=0,a=o.length;a>s;s++)(e=o[s])();return i},{onDone:e,inTransaction:t}
}(),e=function(e){function n(){var e,r,o,s,a,l,u,c;o=void 0,l=[],e=!1,r=function(e){return function(n){return n.isEnd()?(c(e),t.noMore):o(n)}},u=function(){var t,e,n,r;for(r=[],e=0,n=l.length;n>e;e++)t=l[e],r.push("function"==typeof t.unsub?t.unsub():void 0);return r},a=function(t){return t.unsub=t.input.subscribe(r(t.input))},c=function(t){var e,n,r,o;for(e=r=0,o=l.length;o>r;e=++r)if(n=l[e],n.input===t)return"function"==typeof n.unsub&&n.unsub(),l.splice(e,1),void 0},s=function(t){var e,n,r,i;for(o=t,i=C(l),n=0,r=i.length;r>n;n++)e=i[n],a(e);return u},n.__super__.constructor.call(this,s),this.plug=function(t){var n;if(!e)return n={input:t},l.push(n),null!=o&&a(n),function(){return c(t)}},this.push=function(t){return"function"==typeof o?o(z(t)):void 0},this.error=function(t){return"function"==typeof o?o(new i(t)):void 0},this.end=function(){return e=!0,u(),"function"==typeof o?o(E()):void 0}}return ne(n,e),n}(a),g=function(){function t(t,e,n,r,o){var i,s;this.sync=e,this.subscribe=r,null==o&&(o=!1),s=[],i=o?X.id:function(t){return t()
},null==this.subscribe&&(this.subscribe=t.subscribe),this.markEnded=function(){return this.ended=!0},n?(this.consume=function(){return i(s.shift())},this.push=function(t){return s.push(t)},this.mayHave=function(t){return!this.ended||s.length>=t},this.hasAtLeast=function(t){return s.length>=t}):(this.consume=function(){return i(s[0])},this.push=function(t){return s=[t]},this.mayHave=function(){return!0},this.hasAtLeast=function(){return s.length})}return t}(),g.fromObservable=function(t){return t instanceof g?t:t instanceof h?new g(t,!1,!1):new g(t,!0,!0)},t.when=function(){var e,n,r,o,i,s,l,u,c,h,d,f,m,y,w,_,b;if(c=1<=arguments.length?te.call(arguments,0):[],0===c.length)return t.never();for(i=c.length,f="when: expecting arguments in the form (Observable+,function)+",v(f,i%2===0),d=[],u=[],n=0;i>n;){for(l=X.toArray(c[n]),e=c[n+1],s={f:A(e)?e:function(){return e},ixs:[]},m=0,w=l.length;w>m;m++){for(h=l[m],v(h instanceof p,f),r=F(d,h),0>r&&(d.push(h),r=d.length-1),b=s.ixs,y=0,_=b.length;_>y;y++)o=b[y],o.index===r&&o.count++;
s.ixs.push({index:r,count:1})}l.length>0&&u.push(s),n+=2}return d.length?(d=X.map(g.fromObservable,d),new a(function(e){var r,o,i,s;return i=function(t){return X.all(t.ixs,function(t){return d[t.index].hasAtLeast(t.count)})},o=function(t){return!t.sync||t.ended},r=function(t){return X.any(t.ixs,function(t){return!d[t.index].mayHave(t.count)})},s=function(s){return function(a){return s.subscribe(function(l){var c,p,h,f,m;if(l.isEnd())s.markEnded(),(X.all(d,o)||X.all(u,r))&&(p=t.noMore,e(E()));else if(l.isError())p=e(l);else if(s.push(l.value),s.sync)for(f=0,m=u.length;m>f;f++)if(c=u[f],i(c)){h=function(){return c.f.apply(c,function(){var t,e,r,o;for(r=c.ixs,o=[],t=0,e=r.length;e>t;t++)n=r[t],o.push(d[n.index].consume());return o}())},p=e(l.apply(h));break}return p===t.noMore&&a(),p||t.more})}},P.apply(null,function(){var t,e,r;for(r=[],n=t=0,e=d.length;e>t;n=++t)h=d[n],r.push(s(h,n));return r}())})):t.never()},t.update=function(){var e,n,r,o;for(n=arguments[0],o=2<=arguments.length?te.call(arguments,1):[],r=function(t){return function(){var e;
return e=1<=arguments.length?te.call(arguments,0):[],function(n){return t.apply(null,[n].concat(e))}}},e=o.length-1;e>0;)o[e]instanceof Function||(o[e]=function(t){return function(){return t}}(o[e])),o[e]=r(o[e]),e-=2;return t.when.apply(t,o).scan(n,function(t,e){return e(t)})},P=function(){var t;return t=1<=arguments.length?te.call(arguments,0):[],new n(t).unsubscribe},n=function(){function t(t){var e,n,r;for(null==t&&(t=[]),this.empty=re(this.empty,this),this.count=re(this.count,this),this.unsubscribe=re(this.unsubscribe,this),this.add=re(this.add,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[],n=0,r=t.length;r>n;n++)e=t[n],this.add(e)}return t.prototype.add=function(t){var e,n,r,o=this;if(!this.unsubscribed)return e=!1,n=V,this.starting.push(t),r=function(){return o.unsubscribed?void 0:(e=!0,o.remove(n),X.remove(t,o.starting))},n=t(this.unsubscribe,r),this.unsubscribed||e||this.subscriptions.push(n),X.remove(t,this.starting),n},t.prototype.remove=function(t){return this.unsubscribed?void 0:void 0!==X.remove(t,this.subscriptions)?t():void 0
},t.prototype.unsubscribe=function(){var t,e,n,r;if(!this.unsubscribed){for(this.unsubscribed=!0,r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return this.subscriptions=[],this.starting=[]}},t.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},t.prototype.empty=function(){return 0===this.count()},t}(),t.CompositeUnsubscribe=n,m=function(){function t(t){this.value=t}return t.prototype.getOrElse=function(){return this.value},t.prototype.get=function(){return this.value},t.prototype.filter=function(e){return e(this.value)?new t(this.value):c},t.prototype.map=function(e){return new t(e(this.value))},t.prototype.forEach=function(t){return t(this.value)},t.prototype.isDefined=!0,t.prototype.toArray=function(){return[this.value]},t}(),c={getOrElse:function(t){return t},filter:function(){return c},map:function(){return c},forEach:function(){},isDefined:!1,toArray:function(){return[]}},t.EventStream=a,t.Property=h,t.Observable=p,t.Bus=e,t.Initial=l,t.Next=u,t.End=o,t.Error=i,V=function(){},M=function(t,e){return e()
},$=function(t){return t},R=function(t){return new l(X.always(t))},z=function(t){return new u(X.always(t))},E=function(){return new o},q=function(t){return t instanceof s?t:z(t)},C=function(t){return t.slice(0)},F=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){var n,r,o,i;for(n=o=0,i=t.length;i>o;n=++o)if(r=t[n],e===r)return n;return-1},v=function(t,e){if(!e)throw t},_=function(t){return v("not an event : "+t,t instanceof s&&t.isEvent())},b=function(t){return v("not an EventStream : "+t,t instanceof a)},k=function(t){return v("not a function : "+t,A(t))},A=function(t){return"function"==typeof t},w=function(t){return v("not an array : "+t,t instanceof Array)},x=function(t){return v("no arguments supported",0===t.length)},T=function(t){return v("not a string : "+t,"string"==typeof t)},U=function(t,e){return function(){var n;return n=1<=arguments.length?te.call(arguments,0):[],t.apply(null,e.concat(n))}},H=function(t){return t instanceof p&&(t=X.always(t)),k(t),t},L=function(t){return t=Array.prototype.slice.call(t),D.apply(null,t)
},D=K(function(){var t,e;return e=arguments[0],t=2<=arguments.length?te.call(arguments,1):[],A(e)?t.length?U(e,t):e:N(e)?B(e,t):X.always(e)}),I=function(t,e){return D.apply(null,[t].concat(te.call(e)))},N=function(t){return"string"==typeof t&&t.length>1&&"."===t.charAt(0)},t.isFieldKey=N,B=function(t,e){var n,r;return r=t.slice(1).split("."),n=X.map(G(e),r),function(e){var r,o;for(r=0,o=n.length;o>r;r++)t=n[r],e=t(e);return e}},G=function(t){return function(e){return function(n){var r;return null==n?void 0:(r=n[e],A(r)?r.apply(n,t):r)}}},W=function(t){return t.slice(1)},j=function(t){var e;return A(t)?t:N(t)?(e=W(t),function(t,n){return t[e](n)}):v("not a function or a field key: "+t,!1)},Y=function(t){return t instanceof m||t===c?t:new m(t)},X={head:function(t){return t[0]},always:function(t){return function(){return t}},negate:function(t){return function(e){return!t(e)}},empty:function(t){return 0===t.length},tail:function(t){return t.slice(1,t.length)},filter:function(t,e){var n,r,o,i;for(n=[],o=0,i=e.length;i>o;o++)r=e[o],t(r)&&n.push(r);
return n},map:function(t,e){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r],i.push(t(n));return i},each:function(t,e){var n,r,o;o=[];for(n in t)r=t[n],o.push(e(n,r));return o},toArray:function(t){return t instanceof Array?t:[t]},contains:function(t,e){return-1!==F(t,e)},id:function(t){return t},last:function(t){return t[t.length-1]},all:function(t,e){var n,r,o;for(null==e&&(e=X.id),r=0,o=t.length;o>r;r++)if(n=t[r],!e(n))return!1;return!0},any:function(t,e){var n,r,o;for(null==e&&(e=X.id),r=0,o=t.length;o>r;r++)if(n=t[r],e(n))return!0;return!1},without:function(t,e){return X.filter(function(e){return e!==t},e)},remove:function(t,e){var n;return n=F(e,t),n>=0?e.splice(n,1):void 0},fold:function(t,e,n){var r,o,i;for(o=0,i=t.length;i>o;o++)r=t[o],e=n(e,r);return e},cached:function(t){var e;return e=c,function(){return e===c&&(e=t(),t=null),e}}},t._=X,t.scheduler={setTimeout:function(t,e){return setTimeout(t,e)},setInterval:function(t,e){return setInterval(t,e)},clearInterval:function(t){return clearInterval(t)},now:function(){return(new Date).getTime()
}},"undefined"!=typeof module&&null!==module?(module.exports=t,t.Bacon=t):("undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return t}),this.Bacon=t)}.call(this),/*!
 * Modernizr v2.6.2
 * www.modernizr.com
 *
 * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton
 * Available under the BSD and MIT licenses: www.modernizr.com/license/
 */
window.Modernizr=function(t,e,n){function r(t){w.cssText=t}function o(t,e){return r(x.join(t+";")+(e||""))}function i(t,e){return typeof t===e}function s(t,e){return!!~(""+t).indexOf(e)}function a(t,e){for(var r in t){var o=t[r];if(!s(o,"-")&&w[o]!==n)return"pfx"==e?o:!0}return!1}function l(t,e,r){for(var o in t){var s=e[t[o]];if(s!==n)return r===!1?t[o]:i(s,"function")?s.bind(r||e):s}return!1}function u(t,e,n){var r=t.charAt(0).toUpperCase()+t.slice(1),o=(t+" "+C.join(r+" ")+r).split(" ");return i(e,"string")||i(e,"undefined")?a(o,e):(o=(t+" "+P.join(r+" ")+r).split(" "),l(o,e,n))}function c(){f.input=function(n){for(var r=0,o=n.length;o>r;r++)F[n[r]]=!!(n[r]in _);return F.list&&(F.list=!(!e.createElement("datalist")||!t.HTMLDataListElement)),F}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),f.inputtypes=function(t){for(var r,o,i,s=0,a=t.length;a>s;s++)_.setAttribute("type",o=t[s]),r="text"!==_.type,r&&(_.value=b,_.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(o)&&_.style.WebkitAppearance!==n?(g.appendChild(_),i=e.defaultView,r=i.getComputedStyle&&"textfield"!==i.getComputedStyle(_,null).WebkitAppearance&&0!==_.offsetHeight,g.removeChild(_)):/^(search|tel)$/.test(o)||(r=/^(url|email)$/.test(o)?_.checkValidity&&_.checkValidity()===!1:_.value!=b)),$[t[s]]=!!r;
return $}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var p,h,d="2.6.2",f={},m=!0,g=e.documentElement,y="modernizr",v=e.createElement(y),w=v.style,_=e.createElement("input"),b=":)",k={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),T="Webkit Moz O ms",C=T.split(" "),P=T.toLowerCase().split(" "),S={svg:"http://www.w3.org/2000/svg"},E={},$={},F={},R=[],N=R.slice,A=function(t,n,r,o){var i,s,a,l,u=e.createElement("div"),c=e.body,p=c||e.createElement("body");if(parseInt(r,10))for(;r--;)a=e.createElement("div"),a.id=o?o[r]:y+(r+1),u.appendChild(a);return i=["&#173;",'<style id="s',y,'">',t,"</style>"].join(""),u.id=y,(c?u:p).innerHTML+=i,p.appendChild(u),c||(p.style.background="",p.style.overflow="hidden",l=g.style.overflow,g.style.overflow="hidden",g.appendChild(p)),s=n(u,t),c?u.parentNode.removeChild(u):(p.parentNode.removeChild(p),g.style.overflow=l),!!s},M=function(e){var n=t.matchMedia||t.msMatchMedia;if(n)return n(e).matches;var r;return A("@media "+e+" { #"+y+" { position: absolute; } }",function(e){r="absolute"==(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle).position
}),r},O=function(){function t(t,o){o=o||e.createElement(r[t]||"div"),t="on"+t;var s=t in o;return s||(o.setAttribute||(o=e.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(t,""),s=i(o[t],"function"),i(o[t],"undefined")||(o[t]=n),o.removeAttribute(t))),o=null,s}var r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),I={}.hasOwnProperty;h=i(I,"undefined")||i(I.call,"undefined")?function(t,e){return e in t&&i(t.constructor.prototype[e],"undefined")}:function(t,e){return I.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=N.call(arguments,1),r=function(){if(this instanceof r){var o=function(){};o.prototype=e.prototype;var i=new o,s=e.apply(i,n.concat(N.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(N.call(arguments)))};return r}),E.flexbox=function(){return u("flexWrap")},E.flexboxlegacy=function(){return u("boxDirection")},E.canvas=function(){var t=e.createElement("canvas");
return!(!t.getContext||!t.getContext("2d"))},E.canvastext=function(){return!(!f.canvas||!i(e.createElement("canvas").getContext("2d").fillText,"function"))},E.webgl=function(){return!!t.WebGLRenderingContext},E.touch=function(){var n;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?n=!0:A(["@media (",x.join("touch-enabled),("),y,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){n=9===t.offsetTop}),n},E.geolocation=function(){return"geolocation"in navigator},E.postmessage=function(){return!!t.postMessage},E.websqldatabase=function(){return!!t.openDatabase},E.indexedDB=function(){return!!u("indexedDB",t)},E.hashchange=function(){return O("hashchange",t)&&(e.documentMode===n||e.documentMode>7)},E.history=function(){return!(!t.history||!history.pushState)},E.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},E.websockets=function(){return"WebSocket"in t||"MozWebSocket"in t},E.rgba=function(){return r("background-color:rgba(150,255,150,.5)"),s(w.backgroundColor,"rgba")
},E.hsla=function(){return r("background-color:hsla(120,40%,100%,.5)"),s(w.backgroundColor,"rgba")||s(w.backgroundColor,"hsla")},E.multiplebgs=function(){return r("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(w.background)},E.backgroundsize=function(){return u("backgroundSize")},E.borderimage=function(){return u("borderImage")},E.borderradius=function(){return u("borderRadius")},E.boxshadow=function(){return u("boxShadow")},E.textshadow=function(){return""===e.createElement("div").style.textShadow},E.opacity=function(){return o("opacity:.55"),/^0.55$/.test(w.opacity)},E.cssanimations=function(){return u("animationName")},E.csscolumns=function(){return u("columnCount")},E.cssgradients=function(){var t="background-image:",e="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return r((t+"-webkit- ".split(" ").join(e+t)+x.join(n+t)).slice(0,-t.length)),s(w.backgroundImage,"gradient")},E.cssreflections=function(){return u("boxReflect")
},E.csstransforms=function(){return!!u("transform")},E.csstransforms3d=function(){var t=!!u("perspective");return t&&"webkitPerspective"in g.style&&A("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(e){t=9===e.offsetLeft&&3===e.offsetHeight}),t},E.csstransitions=function(){return u("transition")},E.fontface=function(){var t;return A('@font-face {font-family:"font";src:url("https://")}',function(n,r){var o=e.getElementById("smodernizr"),i=o.sheet||o.styleSheet,s=i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"";t=/src/i.test(s)&&0===s.indexOf(r.split(" ")[0])}),t},E.generatedcontent=function(){var t;return A(["#",y,"{font:0/0 a}#",y,':after{content:"',b,'";visibility:hidden;font:3px/1 a}'].join(""),function(e){t=e.offsetHeight>=3}),t},E.video=function(){var t=e.createElement("video"),n=!1;try{(n=!!t.canPlayType)&&(n=new Boolean(n),n.ogg=t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))
}catch(r){}return n},E.audio=function(){var t=e.createElement("audio"),n=!1;try{(n=!!t.canPlayType)&&(n=new Boolean(n),n.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(r){}return n},E.localstorage=function(){try{return localStorage.setItem(y,y),localStorage.removeItem(y),!0}catch(t){return!1}},E.sessionstorage=function(){try{return sessionStorage.setItem(y,y),sessionStorage.removeItem(y),!0}catch(t){return!1}},E.webworkers=function(){return!!t.Worker},E.applicationcache=function(){return!!t.applicationCache},E.svg=function(){return!!e.createElementNS&&!!e.createElementNS(S.svg,"svg").createSVGRect},E.inlinesvg=function(){var t=e.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==S.svg},E.smil=function(){return!!e.createElementNS&&/SVGAnimate/.test(k.call(e.createElementNS(S.svg,"animate")))
},E.svgclippaths=function(){return!!e.createElementNS&&/SVGClipPath/.test(k.call(e.createElementNS(S.svg,"clipPath")))};for(var L in E)h(E,L)&&(p=L.toLowerCase(),f[p]=E[L](),R.push((f[p]?"":"no-")+p));return f.input||c(),f.addTest=function(t,e){if("object"==typeof t)for(var r in t)h(t,r)&&f.addTest(r,t[r]);else{if(t=t.toLowerCase(),f[t]!==n)return f;e="function"==typeof e?e():e,"undefined"!=typeof m&&m&&(g.className+=" "+(e?"":"no-")+t),f[t]=e}return f},r(""),v=_=null,function(t,e){function n(t,e){var n=t.createElement("p"),r=t.getElementsByTagName("head")[0]||t.documentElement;return n.innerHTML="x<style>"+e+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var t=y.elements;return"string"==typeof t?t.split(" "):t}function o(t){var e=g[t[f]];return e||(e={},m++,t[f]=m,g[m]=e),e}function i(t,n,r){if(n||(n=e),c)return n.createElement(t);r||(r=o(n));var i;return i=r.cache[t]?r.cache[t].cloneNode():d.test(t)?(r.cache[t]=r.createElem(t)).cloneNode():r.createElem(t),i.canHaveChildren&&!h.test(t)?r.frag.appendChild(i):i
}function s(t,n){if(t||(t=e),c)return t.createDocumentFragment();n=n||o(t);for(var i=n.frag.cloneNode(),s=0,a=r(),l=a.length;l>s;s++)i.createElement(a[s]);return i}function a(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(n){return y.shivMethods?i(n,t,e):e.createElem(n)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/\w+/g,function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'})+");return n}")(y,e.frag)}function l(t){t||(t=e);var r=o(t);return!y.shivCSS||u||r.hasCSS||(r.hasCSS=!!n(t,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),c||a(t,r),t}var u,c,p=t.html5||{},h=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,d=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f="_html5shiv",m=0,g={};
!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",u="hidden"in t,c=1==t.childNodes.length||function(){e.createElement("a");var t=e.createDocumentFragment();return"undefined"==typeof t.cloneNode||"undefined"==typeof t.createDocumentFragment||"undefined"==typeof t.createElement}()}catch(n){u=!0,c=!0}}();var y={elements:p.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:p.shivCSS!==!1,supportsUnknownElements:c,shivMethods:p.shivMethods!==!1,type:"default",shivDocument:l,createElement:i,createDocumentFragment:s};t.html5=y,l(e)}(this,e),f._version=d,f._prefixes=x,f._domPrefixes=P,f._cssomPrefixes=C,f.mq=M,f.hasEvent=O,f.testProp=function(t){return a([t])},f.testAllProps=u,f.testStyles=A,f.prefixed=function(t,e,n){return e?u(t,e,n):u(t,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(m?" js "+R.join(" "):""),f}(this,this.document),function(t){function e(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}
}function n(t,e){return function(n){return c(t.call(this,n),e)}}function r(t,e){return function(n){return this.lang().ordinal(t.call(this,n),e)}}function o(){}function i(t){k(t),a(this,t)}function s(t){var e=g(t),n=e.year||0,r=e.month||0,o=e.week||0,i=e.day||0,s=e.hour||0,a=e.minute||0,l=e.second||0,u=e.millisecond||0;this._milliseconds=+u+1e3*l+6e4*a+36e5*s,this._days=+i+7*o,this._months=+r+12*n,this._data={},this._bubble()}function a(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function l(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&ge.hasOwnProperty(e)&&(n[e]=t[e]);return n}function u(t){return 0>t?Math.ceil(t):Math.floor(t)}function c(t,e,n){for(var r=""+Math.abs(t),o=t>=0;r.length<e;)r="0"+r;return(o?n?"+":"":"-")+r}function p(t,e,n,r){var o,i,s=e._milliseconds,a=e._days,l=e._months;s&&t._d.setTime(+t._d+s*n),(a||l)&&(o=t.minute(),i=t.hour()),a&&t.date(t.date()+a*n),l&&t.month(t.month()+l*n),s&&!r&&re.updateOffset(t),(a||l)&&(t.minute(o),t.hour(i))
}function h(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function f(t,e,n){var r,o=Math.min(t.length,e.length),i=Math.abs(t.length-e.length),s=0;for(r=0;o>r;r++)(n&&t[r]!==e[r]||!n&&v(t[r])!==v(e[r]))&&s++;return s+i}function m(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=Be[t]||We[e]||e}return t}function g(t){var e,n,r={};for(n in t)t.hasOwnProperty(n)&&(e=m(n),e&&(r[e]=t[n]));return r}function y(e){var n,r;if(0===e.indexOf("week"))n=7,r="day";else{if(0!==e.indexOf("month"))return;n=12,r="month"}re[e]=function(o,i){var s,a,l=re.fn._lang[e],u=[];if("number"==typeof o&&(i=o,o=t),a=function(t){var e=re().utc().set(r,t);return l.call(re.fn._lang,e,o||"")},null!=i)return a(i);for(s=0;n>s;s++)u.push(a(s));return u}}function v(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=e>=0?Math.floor(e):Math.ceil(e)),n}function w(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function _(t){return b(t)?366:365
}function b(t){return t%4===0&&t%100!==0||t%400===0}function k(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[ue]<0||t._a[ue]>11?ue:t._a[ce]<1||t._a[ce]>w(t._a[le],t._a[ue])?ce:t._a[pe]<0||t._a[pe]>23?pe:t._a[he]<0||t._a[he]>59?he:t._a[de]<0||t._a[de]>59?de:t._a[fe]<0||t._a[fe]>999?fe:-1,t._pf._overflowDayOfYear&&(le>e||e>ce)&&(e=ce),t._pf.overflow=e)}function x(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function T(t){return t?t.toLowerCase().replace("_","-"):t}function C(t,e){return e._isUTC?re(t).zone(e._offset||0):re(t).local()}function P(t,e){return e.abbr=t,me[t]||(me[t]=new o),me[t].set(e),me[t]}function S(t){delete me[t]}function E(t){var e,n,r,o,i=0,s=function(t){if(!me[t]&&ye)try{require("./lang/"+t)}catch(e){}return me[t]};if(!t)return re.fn._lang;if(!h(t)){if(n=s(t))return n;
t=[t]}for(;i<t.length;){for(o=T(t[i]).split("-"),e=o.length,r=T(t[i+1]),r=r?r.split("-"):null;e>0;){if(n=s(o.slice(0,e).join("-")))return n;if(r&&r.length>=e&&f(o,r,!0)>=e-1)break;e--}i++}return re.fn._lang}function $(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function F(t){var e,n,r=t.match(be);for(e=0,n=r.length;n>e;e++)r[e]=Xe[r[e]]?Xe[r[e]]:$(r[e]);return function(o){var i="";for(e=0;n>e;e++)i+=r[e]instanceof Function?r[e].call(o,t):r[e];return i}}function R(t,e){return t.isValid()?(e=N(e,t.lang()),Ye[e]||(Ye[e]=F(e)),Ye[e](t)):t.lang().invalidDate()}function N(t,e){function n(t){return e.longDateFormat(t)||t}var r=5;for(ke.lastIndex=0;r>=0&&ke.test(t);)t=t.replace(ke,n),ke.lastIndex=0,r-=1;return t}function A(t,e){var n,r=e._strict;switch(t){case"DDDD":return Me;case"YYYY":case"GGGG":case"gggg":return r?Oe:Ce;case"Y":case"G":case"g":return Le;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?Ie:Pe;case"S":if(r)return Ne;case"SS":if(r)return Ae;case"SSS":if(r)return Me;
case"DDD":return Te;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Ee;case"a":case"A":return E(e._l)._meridiemParse;case"X":return Re;case"Z":case"ZZ":return $e;case"T":return Fe;case"SSSS":return Se;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?Ae:xe;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return xe;default:return n=new RegExp(V(z(t.replace("\\","")),"i"))}}function M(t){t=t||"";var e=t.match($e)||[],n=e[e.length-1]||[],r=(n+"").match(Ue)||["-",0,0],o=+(60*r[1])+v(r[2]);return"+"===r[0]?-o:o}function O(t,e,n){var r,o=n._a;switch(t){case"M":case"MM":null!=e&&(o[ue]=v(e)-1);break;case"MMM":case"MMMM":r=E(n._l).monthsParse(e),null!=r?o[ue]=r:n._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(o[ce]=v(e));break;case"DDD":case"DDDD":null!=e&&(n._dayOfYear=v(e));break;case"YY":o[le]=v(e)+(v(e)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":o[le]=v(e);break;case"a":case"A":n._isPm=E(n._l).isPM(e);
break;case"H":case"HH":case"h":case"hh":o[pe]=v(e);break;case"m":case"mm":o[he]=v(e);break;case"s":case"ss":o[de]=v(e);break;case"S":case"SS":case"SSS":case"SSSS":o[fe]=v(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=M(e);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":t=t.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(n._w=n._w||{},n._w[t]=e)}}function I(t){var e,n,r,o,i,s,a,l,u,c,p=[];if(!t._d){for(r=D(t),t._w&&null==t._a[ce]&&null==t._a[ue]&&(i=function(e){var n=parseInt(e,10);return e?e.length<3?n>68?1900+n:2e3+n:n:null==t._a[le]?re().weekYear():t._a[le]},s=t._w,null!=s.GG||null!=s.W||null!=s.E?a=Z(i(s.GG),s.W||1,s.E,4,1):(l=E(t._l),u=null!=s.d?Y(s.d,l):null!=s.e?parseInt(s.e,10)+l._week.dow:0,c=parseInt(s.w,10)||1,null!=s.d&&u<l._week.dow&&c++,a=Z(i(s.gg),c,u,l._week.doy,l._week.dow)),t._a[le]=a.year,t._dayOfYear=a.dayOfYear),t._dayOfYear&&(o=null==t._a[le]?r[le]:t._a[le],t._dayOfYear>_(o)&&(t._pf._overflowDayOfYear=!0),n=W(o,0,t._dayOfYear),t._a[ue]=n.getUTCMonth(),t._a[ce]=n.getUTCDate()),e=0;3>e&&null==t._a[e];++e)t._a[e]=p[e]=r[e];
for(;7>e;e++)t._a[e]=p[e]=null==t._a[e]?2===e?1:0:t._a[e];p[pe]+=v((t._tzm||0)/60),p[he]+=v((t._tzm||0)%60),t._d=(t._useUTC?W:B).apply(null,p)}}function L(t){var e;t._d||(e=g(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],I(t))}function D(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function H(t){t._a=[],t._pf.empty=!0;var e,n,r,o,i,s=E(t._l),a=""+t._i,l=a.length,u=0;for(r=N(t._f,s).match(be)||[],e=0;e<r.length;e++)o=r[e],n=(a.match(A(o,t))||[])[0],n&&(i=a.substr(0,a.indexOf(n)),i.length>0&&t._pf.unusedInput.push(i),a=a.slice(a.indexOf(n)+n.length),u+=n.length),Xe[o]?(n?t._pf.empty=!1:t._pf.unusedTokens.push(o),O(o,n,t)):t._strict&&!n&&t._pf.unusedTokens.push(o);t._pf.charsLeftOver=l-u,a.length>0&&t._pf.unusedInput.push(a),t._isPm&&t._a[pe]<12&&(t._a[pe]+=12),t._isPm===!1&&12===t._a[pe]&&(t._a[pe]=0),I(t),k(t)}function z(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,r,o){return e||n||r||o
})}function V(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function U(t){var n,r,o,i,s;if(0===t._f.length)return t._pf.invalidFormat=!0,t._d=new Date(0/0),void 0;for(i=0;i<t._f.length;i++)s=0,n=a({},t),n._pf=e(),n._f=t._f[i],H(n),x(n)&&(s+=n._pf.charsLeftOver,s+=10*n._pf.unusedTokens.length,n._pf.score=s,(null==o||o>s)&&(o=s,r=n));a(t,r||n)}function j(t){var e,n,r=t._i,o=De.exec(r);if(o){for(t._pf.iso=!0,e=0,n=ze.length;n>e;e++)if(ze[e][1].exec(r)){t._f=ze[e][0]+(o[6]||" ");break}for(e=0,n=Ve.length;n>e;e++)if(Ve[e][1].exec(r)){t._f+=Ve[e][0];break}r.match($e)&&(t._f+="Z"),H(t)}else t._d=new Date(r)}function q(e){var n=e._i,r=ve.exec(n);n===t?e._d=new Date:r?e._d=new Date(+r[1]):"string"==typeof n?j(e):h(n)?(e._a=n.slice(0),I(e)):d(n)?e._d=new Date(+n):"object"==typeof n?L(e):e._d=new Date(n)}function B(t,e,n,r,o,i,s){var a=new Date(t,e,n,r,o,i,s);return 1970>t&&a.setFullYear(t),a}function W(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function Y(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null
}else t=parseInt(t,10);return t}function G(t,e,n,r,o){return o.relativeTime(e||1,!!n,t,r)}function K(t,e,n){var r=ae(Math.abs(t)/1e3),o=ae(r/60),i=ae(o/60),s=ae(i/24),a=ae(s/365),l=45>r&&["s",r]||1===o&&["m"]||45>o&&["mm",o]||1===i&&["h"]||22>i&&["hh",i]||1===s&&["d"]||25>=s&&["dd",s]||45>=s&&["M"]||345>s&&["MM",ae(s/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=t>0,l[4]=n,G.apply({},l)}function X(t,e,n){var r,o=n-e,i=n-t.day();return i>o&&(i-=7),o-7>i&&(i+=7),r=re(t).add("d",i),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function Z(t,e,n,r,o){var i,s,a=W(t,0,1).getUTCDay();return n=null!=n?n:o,i=o-a+(a>r?7:0)-(o>a?7:0),s=7*(e-1)+(n-o)+i+1,{year:s>0?t:t-1,dayOfYear:s>0?s:_(t-1)+s}}function Q(t){var e=t._i,n=t._f;return null===e?re.invalid({nullInput:!0}):("string"==typeof e&&(t._i=e=E().preparse(e)),re.isMoment(e)?(t=l(e),t._d=new Date(+e._d)):n?h(n)?U(t):H(t):q(t),new i(t))}function J(t,e){re.fn[t]=re.fn[t+"s"]=function(t){var n=this._isUTC?"UTC":"";return null!=t?(this._d["set"+n+e](t),re.updateOffset(this),this):this._d["get"+n+e]()
}}function te(t){re.duration.fn[t]=function(){return this._data[t]}}function ee(t,e){re.duration.fn["as"+t]=function(){return+this/e}}function ne(t){var e=!1,n=re;"undefined"==typeof ender&&(t?(se.moment=function(){return!e&&console&&console.warn&&(e=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),n.apply(null,arguments)},a(se.moment,n)):se.moment=re)}for(var re,oe,ie="2.5.1",se=this,ae=Math.round,le=0,ue=1,ce=2,pe=3,he=4,de=5,fe=6,me={},ge={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},ye="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,ve=/^\/?Date\((\-?\d+)/i,we=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,_e=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,be=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,ke=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,xe=/\d\d?/,Te=/\d{1,3}/,Ce=/\d{1,4}/,Pe=/[+\-]?\d{1,6}/,Se=/\d+/,Ee=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,$e=/Z|[\+\-]\d\d:?\d\d/gi,Fe=/T/i,Re=/[\+\-]?\d+(\.\d{1,3})?/,Ne=/\d/,Ae=/\d\d/,Me=/\d{3}/,Oe=/\d{4}/,Ie=/[+-]?\d{6}/,Le=/[+-]?\d+/,De=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,He="YYYY-MM-DDTHH:mm:ssZ",ze=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Ve=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Ue=/([\+\-]|\d\d)/gi,je="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),qe={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Be={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},We={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Ye={},Ge="DDD w W M D d".split(" "),Ke="M D H h m s w W".split(" "),Xe={M:function(){return this.month()+1
},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return c(this.year()%100,2)},YYYY:function(){return c(this.year(),4)},YYYYY:function(){return c(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+c(Math.abs(t),6)},gg:function(){return c(this.weekYear()%100,2)},gggg:function(){return c(this.weekYear(),4)},ggggg:function(){return c(this.weekYear(),5)},GG:function(){return c(this.isoWeekYear()%100,2)},GGGG:function(){return c(this.isoWeekYear(),4)},GGGGG:function(){return c(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)
},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return v(this.milliseconds()/100)},SS:function(){return c(v(this.milliseconds()/10),2)},SSS:function(){return c(this.milliseconds(),3)},SSSS:function(){return c(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+c(v(t/60),2)+":"+c(v(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+c(v(t/60),2)+c(v(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Ze=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Ge.length;)oe=Ge.pop(),Xe[oe+"o"]=r(Xe[oe],oe);for(;Ke.length;)oe=Ke.pop(),Xe[oe+oe]=n(Xe[oe],2);for(Xe.DDDD=n(Xe.DDD,3),a(o.prototype,{set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e
},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,r;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=re.utc([2e3,e]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(r.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=re([2e3,1]).day(e),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e
},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,r){var o=this._relativeTime[n];return"function"==typeof o?o(t,e,n,r):o.replace(/%d/i,t)
},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return X(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),re=function(n,r,o,i){var s;return"boolean"==typeof o&&(i=o,o=t),s={},s._isAMomentObject=!0,s._i=n,s._f=r,s._l=o,s._strict=i,s._isUTC=!1,s._pf=e(),Q(s)},re.utc=function(n,r,o,i){var s;return"boolean"==typeof o&&(i=o,o=t),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=o,s._i=n,s._f=r,s._strict=i,s._pf=e(),Q(s).utc()},re.unix=function(t){return re(1e3*t)},re.duration=function(t,e){var n,r,o,i=t,a=null;return re.isDuration(t)?i={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(i={},e?i[e]=t:i.milliseconds=t):(a=we.exec(t))?(n="-"===a[1]?-1:1,i={y:0,d:v(a[ce])*n,h:v(a[pe])*n,m:v(a[he])*n,s:v(a[de])*n,ms:v(a[fe])*n}):(a=_e.exec(t))&&(n="-"===a[1]?-1:1,o=function(t){var e=t&&parseFloat(t.replace(",","."));
return(isNaN(e)?0:e)*n},i={y:o(a[2]),M:o(a[3]),d:o(a[4]),h:o(a[5]),m:o(a[6]),s:o(a[7]),w:o(a[8])}),r=new s(i),re.isDuration(t)&&t.hasOwnProperty("_lang")&&(r._lang=t._lang),r},re.version=ie,re.defaultFormat=He,re.updateOffset=function(){},re.lang=function(t,e){var n;return t?(e?P(T(t),e):null===e?(S(t),t="en"):me[t]||E(t),n=re.duration.fn._lang=re.fn._lang=E(t),n._abbr):re.fn._lang._abbr},re.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),E(t)},re.isMoment=function(t){return t instanceof i||null!=t&&t.hasOwnProperty("_isAMomentObject")},re.isDuration=function(t){return t instanceof s},oe=Ze.length-1;oe>=0;--oe)y(Ze[oe]);for(re.normalizeUnits=function(t){return m(t)},re.invalid=function(t){var e=re.utc(0/0);return null!=t?a(e._pf,t):e._pf.userInvalidated=!0,e},re.parseZone=function(t){return re(t).parseZone()},a(re.fn=i.prototype,{clone:function(){return re(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=re(this).utc();return 0<t.year()&&t.year()<=9999?R(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):R(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return x(this)},isDSTShifted:function(){return this._a?this.isValid()&&f(this._a,(this._isUTC?re.utc(this._a):re(this._a)).toArray())>0:!1},parsingFlags:function(){return a({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=R(this,t||re.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t?re.duration(+e,t):re.duration(t,e),p(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t?re.duration(+e,t):re.duration(t,e),p(this,n,-1),this},diff:function(t,e,n){var r,o,i=C(t,this),s=6e4*(this.zone()-i.zone());
return e=m(e),"year"===e||"month"===e?(r=432e5*(this.daysInMonth()+i.daysInMonth()),o=12*(this.year()-i.year())+(this.month()-i.month()),o+=(this-re(this).startOf("month")-(i-re(i).startOf("month")))/r,o-=6e4*(this.zone()-re(this).startOf("month").zone()-(i.zone()-re(i).startOf("month").zone()))/r,"year"===e&&(o/=12)):(r=this-i,o="second"===e?r/1e3:"minute"===e?r/6e4:"hour"===e?r/36e5:"day"===e?(r-s)/864e5:"week"===e?(r-s)/6048e5:r),n?o:u(o)},from:function(t,e){return re.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(re(),t)},calendar:function(){var t=C(re(),this).startOf("day"),e=this.diff(t,"days",!0),n=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){return b(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();
return null!=t?(t=Y(t,this.lang()),this.add({d:t-e})):e},month:function(t){var e,n=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(e=this.date(),this.date(1),this._d["set"+n+"Month"](t),this.date(Math.min(e,this.daysInMonth())),re.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(t){switch(t=m(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),this},endOf:function(t){return t=m(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+re(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+re(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+C(t,this).startOf(e)
},min:function(t){return t=re.apply(null,arguments),this>t?this:t},max:function(t){return t=re.apply(null,arguments),t>this?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=M(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,e!==t&&p(this,re.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?re(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return w(this.year(),this.month())},dayOfYear:function(t){var e=ae((re(this).startOf("day")-re(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(t){var e=X(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)
},isoWeekYear:function(t){var e=X(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=X(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},get:function(t){return t=m(t),this[t]()},set:function(t,e){return t=m(t),"function"==typeof this[t]&&this[t](e),this},lang:function(e){return e===t?this._lang:(this._lang=E(e),this)}}),oe=0;oe<je.length;oe++)J(je[oe].toLowerCase().replace(/s$/,""),je[oe]);J("year","FullYear"),re.fn.days=re.fn.day,re.fn.months=re.fn.month,re.fn.weeks=re.fn.week,re.fn.isoWeeks=re.fn.isoWeek,re.fn.toJSON=re.fn.toISOString,a(re.duration.fn=s.prototype,{_bubble:function(){var t,e,n,r,o=this._milliseconds,i=this._days,s=this._months,a=this._data;a.milliseconds=o%1e3,t=u(o/1e3),a.seconds=t%60,e=u(t/60),a.minutes=e%60,n=u(e/60),a.hours=n%24,i+=u(n/24),a.days=i%30,s+=u(i/30),a.months=s%12,r=u(s/12),a.years=r
},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*v(this._months/12)},humanize:function(t){var e=+this,n=K(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},add:function(t,e){var n=re.duration(t,e);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(t,e){var n=re.duration(t,e);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(t){return t=m(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=m(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:re.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),o=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(n?n+"D":"")+(r||o||i?"T":"")+(r?r+"H":"")+(o?o+"M":"")+(i?i+"S":""):"P0D"
}});for(oe in qe)qe.hasOwnProperty(oe)&&(ee(oe,qe[oe]),te(oe.toLowerCase()));ee("Weeks",6048e5),re.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},re.lang("en",{ordinal:function(t){var e=t%10,n=1===v(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),ye?(module.exports=re,ne(!0)):"function"==typeof define&&define.amd?define("moment",function(e,n,r){return r.config&&r.config()&&r.config().noGlobal!==!0&&ne(r.config().noGlobal===t),re}):ne()}.call(this),/*!
 * Joseph Myer's md5() algorithm wrapped in a self-invoked function to prevent
 * global namespace polution, modified to hash unicode characters as UTF-8.
 *  
 * Copyright 1999-2010, Joseph Myers, Paul Johnston, Greg Holt, Will Bond <will@wbond.net>
 * http://www.myersdaily.org/joseph/javascript/md5-text.html
 * http://pajhome.org.uk/crypt/md5
 * 
 * Released under the BSD license
 * http://www.opensource.org/licenses/bsd-license
 */
function(){function t(t,e){var s=t[0],a=t[1],l=t[2],u=t[3];s=n(s,a,l,u,e[0],7,-680876936),u=n(u,s,a,l,e[1],12,-389564586),l=n(l,u,s,a,e[2],17,606105819),a=n(a,l,u,s,e[3],22,-1044525330),s=n(s,a,l,u,e[4],7,-176418897),u=n(u,s,a,l,e[5],12,1200080426),l=n(l,u,s,a,e[6],17,-1473231341),a=n(a,l,u,s,e[7],22,-45705983),s=n(s,a,l,u,e[8],7,1770035416),u=n(u,s,a,l,e[9],12,-1958414417),l=n(l,u,s,a,e[10],17,-42063),a=n(a,l,u,s,e[11],22,-1990404162),s=n(s,a,l,u,e[12],7,1804603682),u=n(u,s,a,l,e[13],12,-40341101),l=n(l,u,s,a,e[14],17,-1502002290),a=n(a,l,u,s,e[15],22,1236535329),s=r(s,a,l,u,e[1],5,-165796510),u=r(u,s,a,l,e[6],9,-1069501632),l=r(l,u,s,a,e[11],14,643717713),a=r(a,l,u,s,e[0],20,-373897302),s=r(s,a,l,u,e[5],5,-701558691),u=r(u,s,a,l,e[10],9,38016083),l=r(l,u,s,a,e[15],14,-660478335),a=r(a,l,u,s,e[4],20,-405537848),s=r(s,a,l,u,e[9],5,568446438),u=r(u,s,a,l,e[14],9,-1019803690),l=r(l,u,s,a,e[3],14,-187363961),a=r(a,l,u,s,e[8],20,1163531501),s=r(s,a,l,u,e[13],5,-1444681467),u=r(u,s,a,l,e[2],9,-51403784),l=r(l,u,s,a,e[7],14,1735328473),a=r(a,l,u,s,e[12],20,-1926607734),s=o(s,a,l,u,e[5],4,-378558),u=o(u,s,a,l,e[8],11,-2022574463),l=o(l,u,s,a,e[11],16,1839030562),a=o(a,l,u,s,e[14],23,-35309556),s=o(s,a,l,u,e[1],4,-1530992060),u=o(u,s,a,l,e[4],11,1272893353),l=o(l,u,s,a,e[7],16,-155497632),a=o(a,l,u,s,e[10],23,-1094730640),s=o(s,a,l,u,e[13],4,681279174),u=o(u,s,a,l,e[0],11,-358537222),l=o(l,u,s,a,e[3],16,-722521979),a=o(a,l,u,s,e[6],23,76029189),s=o(s,a,l,u,e[9],4,-640364487),u=o(u,s,a,l,e[12],11,-421815835),l=o(l,u,s,a,e[15],16,530742520),a=o(a,l,u,s,e[2],23,-995338651),s=i(s,a,l,u,e[0],6,-198630844),u=i(u,s,a,l,e[7],10,1126891415),l=i(l,u,s,a,e[14],15,-1416354905),a=i(a,l,u,s,e[5],21,-57434055),s=i(s,a,l,u,e[12],6,1700485571),u=i(u,s,a,l,e[3],10,-1894986606),l=i(l,u,s,a,e[10],15,-1051523),a=i(a,l,u,s,e[1],21,-2054922799),s=i(s,a,l,u,e[8],6,1873313359),u=i(u,s,a,l,e[15],10,-30611744),l=i(l,u,s,a,e[6],15,-1560198380),a=i(a,l,u,s,e[13],21,1309151649),s=i(s,a,l,u,e[4],6,-145523070),u=i(u,s,a,l,e[11],10,-1120210379),l=i(l,u,s,a,e[2],15,718787259),a=i(a,l,u,s,e[9],21,-343485551),t[0]=c(s,t[0]),t[1]=c(a,t[1]),t[2]=c(l,t[2]),t[3]=c(u,t[3])
}function e(t,e,n,r,o,i){return e=c(c(e,t),c(r,i)),c(e<<o|e>>>32-o,n)}function n(t,n,r,o,i,s,a){return e(n&r|~n&o,t,n,i,s,a)}function r(t,n,r,o,i,s,a){return e(n&o|r&~o,t,n,i,s,a)}function o(t,n,r,o,i,s,a){return e(n^r^o,t,n,i,s,a)}function i(t,n,r,o,i,s,a){return e(r^(n|~o),t,n,i,s,a)}function s(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e))),txt="";var n,r=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=e.length;n+=64)t(o,a(e.substring(n-64,n)));e=e.substring(n-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<e.length;n++)i[n>>2]|=e.charCodeAt(n)<<(n%4<<3);if(i[n>>2]|=128<<(n%4<<3),n>55)for(t(o,i),n=0;16>n;n++)i[n]=0;return i[14]=8*r,t(o,i),o}function a(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function l(t){for(var e="",n=0;4>n;n++)e+=p[t>>8*n+4&15]+p[t>>8*n&15];return e}function u(t){for(var e=0;e<t.length;e++)t[e]=l(t[e]);return t.join("")}function c(t,e){return t+e&4294967295}function c(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);
return r<<16|65535&n}var p="0123456789abcdef".split("");md5=function(t){return u(s(t))},"5d41402abc4b2a76b9719d911017c592"!=md5("hello")}(),/*!
 * flowdock-text 0.1.7
 *
 * Copyright 2011 Twitter, Inc.
 * Copyright 2011 Flowdock Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this work except in compliance with the License.
 * You may obtain a copy of the License at:
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 */
("undefined"==typeof window||null===window)&&(window={FlowdockText:{}}),null==window.FlowdockText&&(window.FlowdockText={}),("undefined"==typeof FlowdockText||null===FlowdockText)&&(FlowdockText={}),function(){function t(t,e){return e=e||"","string"!=typeof t&&(t.global&&e.indexOf("g")<0&&(e+="g"),t.ignoreCase&&e.indexOf("i")<0&&(e+="i"),t.multiline&&e.indexOf("m")<0&&(e+="m"),t=t.source),new RegExp(t.replace(/#\{(\w+)\}/g,function(t,e){var n=FlowdockText.regexen[e]||"";return"string"!=typeof n&&(n=n.source),n}),e)}function e(t,e){return t.replace(/#\{(\w+)\}/g,function(t,n){return e[n]||""})}function n(t,e,n){var r=String.fromCharCode(e);return n!==e&&(r+="-"+String.fromCharCode(n)),t.push(r),t}function r(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function o(t,e,n){var r=n+t.index,o=e.slice(0,r),i=e.slice(r+t[0].length);return FlowdockText.regexen.startHashTagMatch.test(o)&&!FlowdockText.regexen.endHashtagMatch.test(i)}function i(t,e,n,r,o){if(void 0!==t&&(null===t||t.start>=r))return t;
var i=e.match(o.regex);return i?o.check(i,n,r)?{type:o.type,match:i,start:r+i.index,end:r+i.index+i[0].length}:null:i}function s(t){for(var e=[],n=0,r=[void 0,void 0,void 0,void 0];;){for(var o=t.substr(n),s=0;4>s;s++)r[s]=i(r[s],o,t,n,L[s]);for(var a=void 0,l=0;l<r.length;l++){var u=r[l];(!a||u&&u.start<a.start)&&(a=u)}if(!a)return e.push({type:"text",value:o}),e;a.start>n&&e.push({type:"text",value:o.substr(0,a.start-n)}),e.push(a),n=a.end}}function a(t,n){var r,o,i;if(t.urlEntities)for(r={},o=0,i=t.urlEntities.length;i>o;o++)r[t.urlEntities[o].url]=t.urlEntities[o];var s=n.match[2],a=n.match[3]||n.match[5],l="",u=n.match[1],c="";for(var p in t)l+=e(' #{k}="#{v}" ',{k:p,v:t[p].toString().replace(/"/,"&quot;").replace(/</,"&lt;").replace(/>/,"&gt;")});s.match(FlowdockText.regexen.validTcoUrl)&&(s=RegExp.lastMatch,c=RegExp.rightContext);var h={htmlAttrs:l,url:FlowdockText.htmlEscape(s),after:c,before:u};return h.displayUrl=r&&r[s]&&r[s].display_url?FlowdockText.htmlEscape(r[s].display_url):h.url,a||(h.url="http://"+h.url),e('#{before}<a href="#{url}"#{htmlAttrs}>#{displayUrl}</a>#{after}',h)
}function l(t,n){return n.match[0].replace(FlowdockText.regexen.email,function(n){d={subMatch:FlowdockText.htmlEscape(n)};for(var r in t)t.hasOwnProperty(r)&&(d[r]=t[r]);return e("<a href='mailto:#{subMatch}' class='#{emailClass}'>#{subMatch}</a>",d)})}function u(t,n){var r=n.match,o=r[1],i=r[2],s={hash:FlowdockText.htmlEscape(o),preText:"",text:FlowdockText.htmlEscape(i),postText:""};for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a]);return e('<a href="#{hashtagUrlBase}#{text}" title="##{text}" class="#{hashtagClass}">#{hash}#{preText}#{text}#{postText}</a>',s)}function c(t,n){var r=[];t&&t.userTags&&(r=t.userTags.map(function(t){return t.toLowerCase()}));var o=n.match,i=o[1],s=o[2],a={hash:FlowdockText.htmlEscape(i),preText:"",text:FlowdockText.htmlEscape(s),postText:""};for(var l in t)t.hasOwnProperty(l)&&(a[l]=t[l]);return 0===r.length||E(a.hash+a.text.toLowerCase(),r)?e('<a title="Search #{hash}#{text}" class="#{hashtagClass}" href="#{hashtagUrlBase}#{hash}#{text}">#{hash}#{preText}#{text}#{postText}</a>',a):e("#{hash}#{preText}#{text}#{postText}",a)
}function p(t,e,n){switch(n.type){case"text":return n.value;case"url":return a(e,n);case"hash":return u(t,n);case"mention":return c(t,n);case"email":return l(t,n)}}function h(t){return t=r(t||{}),t.hashtagClass=t.hashtagClass||I,t.hashtagUrlBase=t.hashtagUrlBase||"#flowser/all/",t.emailClass=t.emailClass||"email-link",t}function f(t){return r(t||{})}function m(t,e){return e.type===t||"text"===e.type?e:{type:"text",value:e.match[0]}}function g(t,e,n,r){e=h(e),n=f(n);var o=s(t);r&&(o=o.map(m.bind(null,r)));var i=o.map(p.bind(null,e,n));return i.join("")}function y(t){return t.email}function v(t){t=t.filter(function(t){return"email"==t.type});var e=[];return t.forEach(function(t){return t.match[0].replace(FlowdockText.regexen.email,function(n){submatch=FlowdockText.htmlEscape(n);var r=t.end+FlowdockText.regexen.extractEmails.lastIndex,o=r-submatch.length;e.push({email:submatch,indices:[o,r]})})}),e}function w(t){return t.url}function _(t){t=t.filter(function(t){return"url"==t.type});var e=[];return t.forEach(function(t){var n=t.match,r=n[1],o=n[2],i=n[3]||n[5],s=n[4]||n[6],a=n[8],l=t.start+r.length,u=t.end;
if(i)o.match(FlowdockText.regexen.validTcoUrl)&&(o=RegExp.lastMatch,u=l+o.length),e.push({url:o,indices:[l,u]});else{var c=null,p=!1,h=0;if(s.replace(FlowdockText.regexen.validAsciiDomain,function(t){var n=s.indexOf(t,h);h=n+t.length,c={url:t,indices:[l+n,l+h]},e.push(c)}),null==c)return;a&&(p&&e.push(c),c.url=o.replace(s,c.url),c.indices[1]=u)}}),e}function b(t){return t.tag}function k(t){t=t.filter(function(t){return"hash"==t.type});var e=[];return t.forEach(function(t){var n=t.match,r=(n[1],n[2]),o=t.start,i=t.end;e.push({tag:r,indices:[o,i]})}),e}function x(t){return t.tag}function T(t,e){t=t.filter(function(t){return"mention"==t.type});var n=[];return t.forEach(function(t){var e=t.match,r=e[1],o=e[2],i=t.start,s=t.end;n.push({tag:r+o,indices:[i,s]})}),e?(e=S(e.map(P)),n.filter(function(t){return E(t.tag.toLowerCase(),e)})):n}function C(t,e,n){return n?!t||t.match(e)&&RegExp["$&"]===t:"string"==typeof t&&t.match(e)&&RegExp["$&"]===t}function P(t){return"string"==typeof t?"@"===t[0]?t:"@"+t:"@"+t.nick}function S(t){return t.map(function(t){return t.toLowerCase()
})}function E(t,e){return-1!==e.indexOf(t)}function $(t){return"[object Array]"===Object.prototype.toString.call(t)}function F(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}FlowdockText={},FlowdockText.regexen={};var R={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};FlowdockText.htmlEscape=function(t){return t&&t.replace(/[&"'><]/g,function(t){return R[t]})};var N=String.fromCharCode,A=[N(32),N(133),N(160),N(5760),N(6158),N(8232),N(8233),N(8239),N(8287),N(12288)];n(A,9,13),n(A,8192,8202);var M=[N(65534),N(65279),N(65535)];n(M,8234,8238),FlowdockText.regexen.spaces_group=t(A.join("")),FlowdockText.regexen.spaces=t("["+A.join("")+"]"),FlowdockText.regexen.invalid_chars_group=t(M.join("")),FlowdockText.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/,FlowdockText.regexen.atSigns=/[@\uff20]/,FlowdockText.regexen.extractMentions=t(/(^|[^a-zA-Z0-9_!#$%&*@\uff20])(#{atSigns})([a-zA-Z0-9_]{1,20})/g);var O=[];n(O,1024,1279),n(O,1280,1319),n(O,11744,11775),n(O,42560,42655),n(O,4352,4607),n(O,12592,12677),n(O,43360,43391),n(O,44032,55215),n(O,55216,55295),n(O,65441,65500),n(O,12449,12538),n(O,12540,12542),n(O,65382,65439),n(O,65392,65392),n(O,65296,65305),n(O,65313,65338),n(O,65345,65370),n(O,12353,12438),n(O,12441,12446),n(O,13312,19903),n(O,19968,40959),n(O,12291,12291),n(O,12293,12293),n(O,12347,12347),FlowdockText.regexen.nonLatinHashtagChars=t(O.join("")),FlowdockText.regexen.latinAccentChars=t("\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\u0130\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\u0131\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf8\xf9\xfa\xfb\xfc\xfd\xfe\u015f\\303\\277"),FlowdockText.regexen.endScreenNameMatch=t(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/),FlowdockText.regexen.hashtagAlpha=t(/[a-z_#{latinAccentChars}#{nonLatinHashtagChars}]/i),FlowdockText.regexen.usernameAlphaNumeric=t(/[a-z0-9_\-\.#{latinAccentChars}#{nonLatinHashtagChars}]/i),FlowdockText.regexen.usernameAlphaNumericEnd=t(/[a-z0-9_\-#{latinAccentChars}#{nonLatinHashtagChars}]/i),FlowdockText.regexen.hashtagAlphaNumeric=t(/[a-z0-9_\-#{latinAccentChars}#{nonLatinHashtagChars}]/i),FlowdockText.regexen.endHashtagMatch=/^(?:[#\uff03]|:\/\/)/,FlowdockText.regexen.hashtagBoundary=t(/(?:^|$|[^&\/a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])/),FlowdockText.regexen.singleValidHashTag=t(/^#{hashtagAlphaNumeric}+$/i),FlowdockText.regexen.autoLinkHashtags=t(/(#{hashtagBoundary})(#|\uff03)(#{hashtagAlphaNumeric}+)/gi),FlowdockText.regexen.startHashTagMatch=t(/(?:^|[^&\/a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])$/),FlowdockText.regexen.singleHashTag=t(/(#|\uff03)(#{hashtagAlphaNumeric}+)/i),FlowdockText.regexen.singleMention=t(/(@)(#{usernameAlphaNumeric}*#{usernameAlphaNumericEnd}+)/i),FlowdockText.regexen.autoLinkMentions=t(/(#{hashtagBoundary})(@)(#{usernameAlphaNumeric}*#{usernameAlphaNumericEnd}+)/gi),FlowdockText.regexen.highlightRegex=function(t){return t&&t.length>0?new RegExp("(\\b)"+F(t)+"(\\b)","i"):void 0
},FlowdockText.regexen.validPrecedingChars=t(/(?:[^-\/"'!=A-Za-z0-9_@\uff20$#\uff03\.#{invalid_chars_group}]|^)/),FlowdockText.regexen.invalidDomainChars=e("#{punct}#{spaces_group}#{invalid_chars_group}",FlowdockText.regexen),FlowdockText.regexen.validDomainChars=t(/[^#{invalidDomainChars}]/),FlowdockText.regexen.validSubdomain=t(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/),FlowdockText.regexen.validDomainName=t(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/),FlowdockText.regexen.validGTLD=t(/(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx|local|dmz|lan|corp)(?=[^a-zA-Z]|$))/),FlowdockText.regexen.validCCTLD=t(/(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)(?=[^a-zA-Z]|$))/),FlowdockText.regexen.validPunycode=t(/(?:xn--[0-9a-z]+)/),FlowdockText.regexen.validDomain=t(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/),FlowdockText.regexen.pseudoValidIP=t(/(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/),FlowdockText.regexen.validAsciiDomain=t(/(?:(?:[a-z0-9#{latinAccentChars}\-]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi),FlowdockText.regexen.validPortNumber=t(/[0-9]+/),FlowdockText.regexen.validGeneralUrlPathChars=t(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~|&#{latinAccentChars}]/i),FlowdockText.regexen.validUrlBalancedParens=t(/\(#{validGeneralUrlPathChars}+\)/i),FlowdockText.regexen.validUrlPathEndingChars=t(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i),FlowdockText.regexen.validUrlPath=t("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:(@|@@)#{validGeneralUrlPathChars}+/?))","i"),FlowdockText.regexen.validUrlQueryChars=/[a-z0-9!?\*'\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,FlowdockText.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,FlowdockText.regexen.extractUrl=t("((#{validPrecedingChars})((?:(?:(https?:\\/\\/)?(#{validDomain}|#{pseudoValidIP}))|(?:(https?:\\/\\/)((?:#{validDomainChars}|-)+)(?=:|/|#{spaces}|$)))(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),FlowdockText.regexen.singleUrl=t("(#{validPrecedingChars})((?:(?:(https?:\\/\\/)?(#{validDomain}|#{pseudoValidIP}))|(?:(https?:\\/\\/)((?:#{validDomainChars}|-)+)(?=:|/|#{spaces}|$)))(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?)","i"),FlowdockText.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i,FlowdockText.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i,FlowdockText.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i,FlowdockText.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i,FlowdockText.regexen.validateUrlPchar=t("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|[:|@])","i"),FlowdockText.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i,FlowdockText.regexen.validateUrlUserinfo=t("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|:)*","i"),FlowdockText.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i,FlowdockText.regexen.validateUrlIpv4=t(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i),FlowdockText.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i,FlowdockText.regexen.validateUrlIp=t("(?:#{validateUrlIpv4}|#{validateUrlIpv6})","i"),FlowdockText.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i,FlowdockText.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i,FlowdockText.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i,FlowdockText.regexen.validateUrlDomain=t(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i),FlowdockText.regexen.validateUrlHost=t("(?:#{validateUrlIp}|#{validateUrlDomain})","i"),FlowdockText.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,FlowdockText.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,FlowdockText.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,FlowdockText.regexen.validateUrlUnicodeDomain=t(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i),FlowdockText.regexen.validateUrlUnicodeHost=t("(?:#{validateUrlIp}|#{validateUrlUnicodeDomain})","i"),FlowdockText.regexen.validateUrlPort=/[0-9]{1,5}/,FlowdockText.regexen.validateUrlUnicodeAuthority=t("(?:(#{validateUrlUserinfo})@)?(#{validateUrlUnicodeHost})(?::(#{validateUrlPort}))?","i"),FlowdockText.regexen.validateUrlAuthority=t("(?:(#{validateUrlUserinfo})@)?(#{validateUrlHost})(?::(#{validateUrlPort}))?","i"),FlowdockText.regexen.validateUrlPath=t(/(\/#{validateUrlPchar}*)*/i),FlowdockText.regexen.validateUrlQuery=t(/(#{validateUrlPchar}|\/|\?)*/i),FlowdockText.regexen.validateUrlFragment=t(/(#{validateUrlPchar}|\/|\?)*/i),FlowdockText.regexen.validateUrlUnencoded=t("^(?:([^:/?#]+):\\/\\/)?([^/?#]*)([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$","i"),FlowdockText.regexen.validEmailLocalPart=t("[A-z|0-9|.|_|%|+|-]+"),FlowdockText.regexen.email=t(/#{validEmailLocalPart}@#{validDomain}/,"gi"),FlowdockText.regexen.extractEmails=t(/(?:^|\s|,|"|')?(#{email})/,"gi"),FlowdockText.regexen.singleEmail=t(/(?:^|\s|,|"|')?(#{email})/,"i");
var I="app-tag-link",L=[{type:"url",regex:FlowdockText.regexen.singleUrl,check:function(){return!0}},{type:"hash",regex:FlowdockText.regexen.singleHashTag,check:o},{type:"mention",regex:FlowdockText.regexen.singleMention,check:o},{type:"email",regex:FlowdockText.regexen.singleEmail,check:function(){return!0}}];FlowdockText.autoLink=function(t,e,n){return g(t,e,n)},FlowdockText.autoLinkHashtags=function(t,e){return g(t,e,{},"hash")},FlowdockText.autoLinkEmails=function(t,e){return g(t,e,{},"email")},FlowdockText.autoLinkUrlsCustom=function(t,e){return g(t,{},e,"url")},FlowdockText.autoLinkMentions=function(t,e){return g(t,e,{},"mention")},FlowdockText.extractEmails=function(t){var e=FlowdockText.extractEmailsWithIndices(t);return e.map(y)},FlowdockText.extractEmailsWithIndices=function(t){return FlowdockText.extractAllWithIndices(t).emails},FlowdockText.extractUrls=function(t){var e=FlowdockText.extractUrlsWithIndices(t);return e.map(w)},FlowdockText.extractUrlsWithIndices=function(t){return FlowdockText.extractAllWithIndices(t).urls
},FlowdockText.extractHashtags=function(t){var e=FlowdockText.extractHashtagsWithIndices(t);return e.map(b)},FlowdockText.extractHashtagsWithIndices=function(t){return FlowdockText.extractAllWithIndices(t).hashtags},FlowdockText.modifyIndicesFromUnicodeToUTF16=function(t,e){FlowdockText.shiftIndices(t,e,1)},FlowdockText.modifyIndicesFromUTF16ToUnicode=function(t,e){FlowdockText.shiftIndices(t,e,-1)},FlowdockText.shiftIndices=function(t,e,n){for(var r=0;r<t.length-1;r++){var o=t.charCodeAt(r),i=t.charCodeAt(r+1);if(o>=55296&&56319>=o&&i>=56320&&57343>=i){r++;for(var s=0;s<e.length;s++)e[s].indices[0]>=r&&(e[s].indices[0]+=n,e[s].indices[1]+=n)}}},FlowdockText.extractMentions=function(t,e){var n=FlowdockText.extractMentionsWithIndices(t,e);return n.map(x)},FlowdockText.extractMentionsWithIndices=function(t,e){return FlowdockText.extractAllWithIndices(t,e).mentions},FlowdockText.extractAllWithIndices=function(t,e){if(!t)return{hashtags:[],mentions:[],emails:[],urls:[]};var n=s(t);return{hashtags:k(n),mentions:T(n,e),emails:v(n),urls:_(n)}
},FlowdockText.extractAll=function(t,e){var n=FlowdockText.extractAllWithIndices(t,e);return{hashtags:n.hashtags.map(b),mentions:n.mentions.map(x),emails:n.emails.map(y),urls:n.urls.map(w)}},FlowdockText.mentionsAll=function(t){return $(t)?["@everyone","@everybody","@all","@anyone","@anybody"].some(function(e){return-1!==S(t).indexOf(e)}):FlowdockText.mentionsAll(FlowdockText.extractMentions(t))},FlowdockText.mentionsUser=function(t,e){return $(t)?-1!==S(t).indexOf(P(e).toLowerCase()):FlowdockText.extractMentions(t,[P(e)]).length>0},FlowdockText.isValidUrl=function(t,e,n){if(null==e&&(e=!0),null==n&&(n=!0),!t)return!1;var r=t.match(FlowdockText.regexen.validateUrlUnencoded);if(!r||r[0]!==t)return!1;var o=r[1],i=r[2],s=r[3],a=r[4],l=r[5];return(!n||C(o,FlowdockText.regexen.validateUrlScheme)&&o.match(/^https?$/i))&&C(s,FlowdockText.regexen.validateUrlPath)&&C(a,FlowdockText.regexen.validateUrlQuery,!0)&&C(l,FlowdockText.regexen.validateUrlFragment,!0)?e&&C(i,FlowdockText.regexen.validateUrlUnicodeAuthority)||!e&&C(i,FlowdockText.regexen.validateUrlAuthority):!1
},"undefined"!=typeof module&&module.exports&&(module.exports=FlowdockText)}();// Copyright (C) 2006 Google Inc.
var IN_GLOBAL_SCOPE=!0;window.PR_SHOULD_USE_CONTINUATION=!0;var prettyPrintOne,prettyPrint;!function(){function t(t){function e(t){var e=t.charCodeAt(0);if(92!==e)return e;var n=t.charAt(1);return e=p[n],e?e:n>="0"&&"7">=n?parseInt(t.substring(1),8):"u"===n||"x"===n?parseInt(t.substring(2),16):t.charCodeAt(1)}function n(t){if(32>t)return(16>t?"\\x0":"\\x")+t.toString(16);var e=String.fromCharCode(t);return"\\"===e||"-"===e||"]"===e||"^"===e?"\\"+e:e}function r(t){var r=t.substring(1,t.length-1).match(new RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g")),o=[],i="^"===r[0],s=["["];i&&s.push("^");for(var a=i?1:0,l=r.length;l>a;++a){var u=r[a];if(/\\[bdsw]/i.test(u))s.push(u);else{var c,p=e(u);l>a+2&&"-"===r[a+1]?(c=e(r[a+2]),a+=2):c=p,o.push([p,c]),65>c||p>122||(65>c||p>90||o.push([32|Math.max(65,p),32|Math.min(c,90)]),97>c||p>122||o.push([-33&Math.max(97,p),-33&Math.min(c,122)]))}}o.sort(function(t,e){return t[0]-e[0]||e[1]-t[1]});for(var h=[],d=[],a=0;a<o.length;++a){var f=o[a];
f[0]<=d[1]+1?d[1]=Math.max(d[1],f[1]):h.push(d=f)}for(var a=0;a<h.length;++a){var f=h[a];s.push(n(f[0])),f[1]>f[0]&&(f[1]+1>f[0]&&s.push("-"),s.push(n(f[1])))}return s.push("]"),s.join("")}function o(t){for(var e=t.source.match(new RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g")),o=e.length,a=[],l=0,u=0;o>l;++l){var c=e[l];if("("===c)++u;else if("\\"===c.charAt(0)){var p=+c.substring(1);p&&(u>=p?a[p]=-1:e[l]=n(p))}}for(var l=1;l<a.length;++l)-1===a[l]&&(a[l]=++i);for(var l=0,u=0;o>l;++l){var c=e[l];if("("===c)++u,a[u]||(e[l]="(?:");else if("\\"===c.charAt(0)){var p=+c.substring(1);p&&u>=p&&(e[l]="\\"+a[p])}}for(var l=0;o>l;++l)"^"===e[l]&&"^"!==e[l+1]&&(e[l]="");if(t.ignoreCase&&s)for(var l=0;o>l;++l){var c=e[l],h=c.charAt(0);c.length>=2&&"["===h?e[l]=r(c):"\\"!==h&&(e[l]=c.replace(/[a-zA-Z]/g,function(t){var e=t.charCodeAt(0);return"["+String.fromCharCode(-33&e,32|e)+"]"}))}return e.join("")
}for(var i=0,s=!1,a=!1,l=0,u=t.length;u>l;++l){var c=t[l];if(c.ignoreCase)a=!0;else if(/[a-z]/i.test(c.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){s=!0,a=!1;break}}for(var p={b:8,t:9,n:10,v:11,f:12,r:13},h=[],l=0,u=t.length;u>l;++l){var c=t[l];if(c.global||c.multiline)throw new Error(""+c);h.push("(?:"+o(c)+")")}return new RegExp(h.join("|"),a?"gi":"g")}function e(t,e){function n(t){var l=t.nodeType;if(1==l){if(r.test(t.className))return;for(var u=t.firstChild;u;u=u.nextSibling)n(u);var c=t.nodeName.toLowerCase();("br"===c||"li"===c)&&(o[a]="\n",s[a<<1]=i++,s[a++<<1|1]=t)}else if(3==l||4==l){var p=t.nodeValue;p.length&&(p=e?p.replace(/\r\n?/g,"\n"):p.replace(/[ \t\r\n]+/g," "),o[a]=p,s[a<<1]=i,i+=p.length,s[a++<<1|1]=t)}}var r=/(?:^|\s)nocode(?:\s|$)/,o=[],i=0,s=[],a=0;return n(t),{sourceCode:o.join("").replace(/\n$/,""),spans:s}}function n(t,e,n,r){if(e){var o={sourceCode:e,basePos:t};n(o),r.push.apply(r,o.decorations)}}function r(t){for(var e=void 0,n=t.firstChild;n;n=n.nextSibling){var r=n.nodeType;
e=1===r?e?t:n:3===r?j.test(n.nodeValue)?t:e:e}return e===t?void 0:e}function o(e,r){var o,i={};!function(){for(var n=e.concat(r),s=[],a={},l=0,u=n.length;u>l;++l){var c=n[l],p=c[3];if(p)for(var h=p.length;--h>=0;)i[p.charAt(h)]=c;var d=c[1],f=""+d;a.hasOwnProperty(f)||(s.push(d),a[f]=null)}s.push(/[\0-\uffff]/),o=t(s)}();var s=r.length,a=function(t){for(var e=t.sourceCode,l=t.basePos,c=[l,O],p=0,h=e.match(o)||[],d={},f=0,m=h.length;m>f;++f){var g,y=h[f],v=d[y],w=void 0;if("string"==typeof v)g=!1;else{var _=i[y.charAt(0)];if(_)w=y.match(_[1]),v=_[0];else{for(var b=0;s>b;++b)if(_=r[b],w=y.match(_[1])){v=_[0];break}w||(v=O)}g=v.length>=5&&"lang-"===v.substring(0,5),!g||w&&"string"==typeof w[1]||(g=!1,v=D),g||(d[y]=v)}var k=p;if(p+=y.length,g){var x=w[1],T=y.indexOf(x),C=T+x.length;w[2]&&(C=y.length-w[2].length,T=C-x.length);var P=v.substring(5);n(l+k,y.substring(0,T),a,c),n(l+k+T,x,u(P,x),c),n(l+k+C,y.substring(C),a,c)}else c.push(l+k,v)}t.decorations=c};return a}function i(t){var e=[],n=[];t.tripleQuotedStrings?e.push([$,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""]):t.multiLineStrings?e.push([$,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"]):e.push([$,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"]),t.verbatimStrings&&n.push([$,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null]);
var r=t.hashComments;r&&(t.cStyleComments?(r>1?e.push([R,/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"]):e.push([R,/^#(?:(?:define|e(?:l|nd)if|else|error|ifn?def|include|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"]),n.push([$,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h(?:h|pp|\+\+)?|[a-z]\w*)>/,null])):e.push([R,/^#[^\r\n]*/,null,"#"])),t.cStyleComments&&(n.push([R,/^\/\/[^\r\n]*/,null]),n.push([R,/^\/\*[\s\S]*?(?:\*\/|$)/,null]));var i=t.regexLiterals;if(i){var s=i>1?"":"\n\r",a=s?".":"[\\S\\s]",l="/(?=[^/*"+s+"])(?:[^/\\x5B\\x5C"+s+"]|\\x5C"+a+"|\\x5B(?:[^\\x5C\\x5D"+s+"]|\\x5C"+a+")*(?:\\x5D|$))+/";n.push(["lang-regex",RegExp("^"+U+"("+l+")")])}var u=t.types;u&&n.push([N,u]);var c=(""+t.keywords).replace(/^ | $/g,"");c.length&&n.push([F,new RegExp("^(?:"+c.replace(/[\s,]+/g,"|")+")\\b"),null]),e.push([O,/^\s+/,null," \r\n	\xa0"]);var p="^.[^\\s\\w.$@'\"`/\\\\]*";return t.regexLiterals&&(p+="(?!s*/)"),n.push([A,/^@[a-z_$][a-z_$@0-9]*/i,null],[N,/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],[O,/^[a-z_$][a-z_$@0-9]*/i,null],[A,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[O,/^\\[\s\S]?/,null],[M,new RegExp(p),null]),o(e,n)
}function s(t,e,n){function r(t){var e=t.nodeType;if(1!=e||i.test(t.className)){if((3==e||4==e)&&n){var l=t.nodeValue,u=l.match(s);if(u){var c=l.substring(0,u.index);t.nodeValue=c;var p=l.substring(u.index+u[0].length);if(p){var h=t.parentNode;h.insertBefore(a.createTextNode(p),t.nextSibling)}o(t),c||t.parentNode.removeChild(t)}}}else if("br"===t.nodeName)o(t),t.parentNode&&t.parentNode.removeChild(t);else for(var d=t.firstChild;d;d=d.nextSibling)r(d)}function o(t){function e(t,n){var r=n?t.cloneNode(!1):t,o=t.parentNode;if(o){var i=e(o,1),s=t.nextSibling;i.appendChild(r);for(var a=s;a;a=s)s=a.nextSibling,i.appendChild(a)}return r}for(;!t.nextSibling;)if(t=t.parentNode,!t)return;for(var n,r=e(t.nextSibling,0);(n=r.parentNode)&&1===n.nodeType;)r=n;u.push(r)}for(var i=/(?:^|\s)nocode(?:\s|$)/,s=/\r\n?|\n/,a=t.ownerDocument,l=a.createElement("li");t.firstChild;)l.appendChild(t.firstChild);for(var u=[l],c=0;c<u.length;++c)r(u[c]);e===(0|e)&&u[0].setAttribute("value",e);var p=a.createElement("ol");p.className="linenums";
for(var h=Math.max(0,e-1|0)||0,c=0,d=u.length;d>c;++c)l=u[c],l.className="L"+(c+h)%10,l.firstChild||l.appendChild(a.createTextNode("\xa0")),p.appendChild(l);t.appendChild(p)}function a(t){var e=/\bMSIE\s(\d+)/.exec(navigator.userAgent);e=e&&+e[1]<=8;var n=/\n/g,r=t.sourceCode,o=r.length,i=0,s=t.spans,a=s.length,l=0,u=t.decorations,c=u.length,p=0;u[c]=o;var h,d;for(d=h=0;c>d;)u[d]!==u[d+2]?(u[h++]=u[d++],u[h++]=u[d++]):d+=2;for(c=h,d=h=0;c>d;){for(var f=u[d],m=u[d+1],g=d+2;c>=g+2&&u[g+1]===m;)g+=2;u[h++]=f,u[h++]=m,d=g}c=u.length=h;var y,v=t.sourceNode;v&&(y=v.style.display,v.style.display="none");try{for(;a>l;){var w,_=(s[l],s[l+2]||o),b=u[p+2]||o,g=Math.min(_,b),k=s[l+1];if(1!==k.nodeType&&(w=r.substring(i,g))){e&&(w=w.replace(n,"\r")),k.nodeValue=w;var x=k.ownerDocument,T=x.createElement("span");T.className=u[p+1];var C=k.parentNode;C.replaceChild(T,k),T.appendChild(k),_>i&&(s[l+1]=k=x.createTextNode(r.substring(g,_)),C.insertBefore(k,T.nextSibling))}i=g,i>=_&&(l+=2),i>=b&&(p+=2)}}finally{v&&(v.style.display=y)
}}function l(t,e){for(var n=e.length;--n>=0;){var r=e[n];B.hasOwnProperty(r)?d.console&&console.warn("cannot override language handler %s",r):B[r]=t}}function u(t,e){return t&&B.hasOwnProperty(t)||(t=/^\s*</.test(e)?"default-markup":"default-code"),B[t]}function c(t){var n=t.langExtension;try{var r=e(t.sourceNode,t.pre),o=r.sourceCode;t.sourceCode=o,t.spans=r.spans,t.basePos=0,u(n,o)(t),a(t)}catch(i){d.console&&console.log(i&&i.stack||i)}}function p(t,e,n){var r=document.createElement("div");r.innerHTML="<pre>"+t+"</pre>",r=r.firstChild,n&&s(r,n,!0);var o={langExtension:e,numberLines:n,sourceNode:r,pre:1};return c(o),r.innerHTML}function h(t,e){function n(t){return i.getElementsByTagName(t)}function o(){for(var e=d.PR_SHOULD_USE_CONTINUATION?m.now()+250:1/0;y<u.length&&m.now()<e;y++){for(var n=u[y],i=T,l=n;l=l.previousSibling;){var p=l.nodeType,h=(7===p||8===p)&&l.nodeValue;if(h?!/^\??prettify\b/.test(h):3!==p||/\S/.test(l.nodeValue))break;if(h){i={},h.replace(/\b(\w+)=([\w:.%+-]+)/g,function(t,e,n){i[e]=n});break
}}var f=n.className;if((i!==T||w.test(f))&&!_.test(f)){for(var C=!1,P=n.parentNode;P;P=P.parentNode){var S=P.tagName;if(x.test(S)&&P.className&&w.test(P.className)){C=!0;break}}if(!C){n.className+=" prettyprinted";var E=i.lang;if(!E){E=f.match(v);var $;!E&&($=r(n))&&k.test($.tagName)&&(E=$.className.match(v)),E&&(E=E[1])}var F;if(b.test(n.tagName))F=1;else{var R=n.currentStyle,N=a.defaultView,A=R?R.whiteSpace:N&&N.getComputedStyle?N.getComputedStyle(n,null).getPropertyValue("white-space"):0;F=A&&"pre"===A.substring(0,3)}var M=i.linenums;(M="true"===M||+M)||(M=f.match(/\blinenums\b(?::(\d+))?/),M=M?M[1]&&M[1].length?+M[1]:!0:!1),M&&s(n,M,F),g={langExtension:E,sourceNode:n,numberLines:M,pre:F},c(g)}}}y<u.length?setTimeout(o,250):"function"==typeof t&&t()}for(var i=e||document.body,a=i.ownerDocument||document,l=[n("pre"),n("code"),n("xmp")],u=[],p=0;p<l.length;++p)for(var h=0,f=l[p].length;f>h;++h)u.push(l[p][h]);l=null;var m=Date;m.now||(m={now:function(){return+new Date}});var g,y=0,v=/\blang(?:uage)?-([\w.]+)(?!\S)/,w=/\bprettyprint\b/,_=/\bprettyprinted\b/,b=/pre|xmp/i,k=/^code$/i,x=/^(?:pre|code|xmp)$/i,T={};
o()}var d=window,f=["break,continue,do,else,for,if,return,while"],m=[f,"auto,case,char,const,default,double,enum,extern,float,goto,inline,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],g=[m,"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],y=[g,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,delegate,dynamic_cast,explicit,export,friend,generic,late_check,mutable,namespace,nullptr,property,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],v=[g,"abstract,assert,boolean,byte,extends,final,finally,implements,import,instanceof,interface,null,native,package,strictfp,super,synchronized,throws,transient"],w=[g,"abstract,as,base,bool,by,byte,checked,decimal,delegate,descending,dynamic,event,finally,fixed,foreach,from,group,implicit,in,interface,internal,into,is,let,lock,null,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var,virtual,where"],_="all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes",b=[g,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],k="caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",x=[f,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],T=[f,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],C=[f,"as,assert,const,copy,drop,enum,extern,fail,false,fn,impl,let,log,loop,match,mod,move,mut,priv,pub,pure,ref,self,static,struct,true,trait,type,unsafe,use"],P=[f,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],S=[y,w,b,k,x,T,P],E=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)\b/,$="prettify-str",F="prettify-kwd",R="prettify-com",N="prettify-typ",A="prettify-lit",M="prettify-pun",O="prettify-pln",I="prettify-tag",L="prettify-dec",D="prettify-src",H="prettify-atn",z="prettify-atv",V="prettify-nocode",U="(?:^^\\.?|[+-]|[!=]=?=?|\\#|%=?|&&?=?|\\(|\\*=?|[+\\-]=|->|\\/=?|::?|<<?=?|>>?>?=?|,|;|\\?|@|\\[|~|{|\\^\\^?=?|\\|\\|?=?|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*",j=/\S/,q=i({keywords:S,hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),B={};
l(q,["default-code"]),l(o([],[[O,/^[^<?]+/],[L,/^<!\w[^>]*(?:>|$)/],[R,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[M,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),l(o([[O,/^[\s]+/,null," 	\r\n"],[z,/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[[I,/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[H,/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[M,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]),l(o([],[[z,/^[\s\S]+/]]),["uq.val"]),l(i({keywords:y,hashComments:!0,cStyleComments:!0,types:E}),["c","cc","cpp","cxx","cyc","m"]),l(i({keywords:"null,true,false"}),["json"]),l(i({keywords:w,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:E}),["cs"]),l(i({keywords:v,cStyleComments:!0}),["java"]),l(i({keywords:P,hashComments:!0,multiLineStrings:!0}),["bash","bsh","csh","sh"]),l(i({keywords:x,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py","python"]),l(i({keywords:k,hashComments:!0,multiLineStrings:!0,regexLiterals:2}),["perl","pl","pm"]),l(i({keywords:T,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb","ruby"]),l(i({keywords:b,cStyleComments:!0,regexLiterals:!0}),["javascript","js"]),l(i({keywords:_,hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),l(i({keywords:C,cStyleComments:!0,multilineStrings:!0}),["rc","rs","rust"]),l(o([],[[$,/^[\s\S]+/]]),["regex"]);
var W=d.PR={createSimpleLexer:o,registerLangHandler:l,sourceDecorator:i,PR_ATTRIB_NAME:H,PR_ATTRIB_VALUE:z,PR_COMMENT:R,PR_DECLARATION:L,PR_KEYWORD:F,PR_LITERAL:A,PR_NOCODE:V,PR_PLAIN:O,PR_PUNCTUATION:M,PR_SOURCE:D,PR_STRING:$,PR_TAG:I,PR_TYPE:N,prettyPrintOne:IN_GLOBAL_SCOPE?d.prettyPrintOne=p:prettyPrintOne=p,prettyPrint:prettyPrint=IN_GLOBAL_SCOPE?d.prettyPrint=h:prettyPrint=h};"function"==typeof define&&define.amd&&define("google-code-prettify",[],function(){return W})}(),// Copyright (C) 2009 Onno Hommes.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_COMMENT,/^#[^\r\n]*/,null,"#"],[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"']],[[PR.PR_KEYWORD,/^(?:ADS|AD|AUG|BZF|BZMF|CAE|CAF|CA|CCS|COM|CS|DAS|DCA|DCOM|DCS|DDOUBL|DIM|DOUBLE|DTCB|DTCF|DV|DXCH|EDRUPT|EXTEND|INCR|INDEX|NDX|INHINT|LXCH|MASK|MSK|MP|MSU|NOOP|OVSK|QXCH|RAND|READ|RELINT|RESUME|RETURN|ROR|RXOR|SQUARE|SU|TCR|TCAA|OVSK|TCF|TC|TS|WAND|WOR|WRITE|XCH|XLQ|XXALQ|ZL|ZQ|ADD|ADZ|SUB|SUZ|MPY|MPR|MPZ|DVP|COM|ABS|CLA|CLZ|LDQ|STO|STQ|ALS|LLS|LRS|TRA|TSQ|TMI|TOV|AXT|TIX|DLY|INP|OUT)\s/,null],[PR.PR_TYPE,/^(?:-?GENADR|=MINUS|2BCADR|VN|BOF|MM|-?2CADR|-?[1-6]DNADR|ADRES|BBCON|[SE]?BANK\=?|BLOCK|BNKSUM|E?CADR|COUNT\*?|2?DEC\*?|-?DNCHAN|-?DNPTR|EQUALS|ERASE|MEMORY|2?OCT|REMADR|SETLOC|SUBRO|ORG|BSS|BES|SYN|EQU|DEFINE|END)\s/,null],[PR.PR_LITERAL,/^\'(?:-*(?:\w|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?)?/],[PR.PR_PLAIN,/^-*(?:[!-z_]|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0()\"\\\';]+/]]),["apollo","agc","aea"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_STRING,/^(?:"(?:[^\\"\r\n]|\\.)*(?:"|$))/,null,'"'],[PR.PR_PLAIN,/^\s+/,null," \r\n	\xa0"]],[[PR.PR_COMMENT,/^REM[^\r\n]*/,null],[PR.PR_KEYWORD,/^\b(?:AND|CLOSE|CLR|CMD|CONT|DATA|DEF ?FN|DIM|END|FOR|GET|GOSUB|GOTO|IF|INPUT|LET|LIST|LOAD|NEW|NEXT|NOT|ON|OPEN|OR|POKE|PRINT|READ|RESTORE|RETURN|RUN|SAVE|STEP|STOP|SYS|THEN|TO|VERIFY|WAIT)\b/,null],[PR.PR_PLAIN,/^[A-Z][A-Z0-9]?(?:\$|%)?/i,null],[PR.PR_LITERAL,/^(?:\d+(?:\.\d*)?|\.\d+)(?:e[+\-]?\d+)?/i,null,"0123456789"],[PR.PR_PUNCTUATION,/^.[^\s\w\.$%"]*/,null]]),["basic","cbm"]),/**
 * @license Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
PR.registerLangHandler(PR.createSimpleLexer([["opn",/^[\(\{\[]+/,null,"([{"],["clo",/^[\)\}\]]+/,null,")]}"],[PR.PR_COMMENT,/^;[^\r\n]*/,null,";"],[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"']],[[PR.PR_KEYWORD,/^(?:def|if|do|let|quote|var|fn|loop|recur|throw|try|monitor-enter|monitor-exit|defmacro|defn|defn-|macroexpand|macroexpand-1|for|doseq|dosync|dotimes|and|or|when|not|assert|doto|proxy|defstruct|first|rest|cons|defprotocol|deftype|defrecord|reify|defmulti|defmethod|meta|with-meta|ns|in-ns|create-ns|import|intern|refer|alias|namespace|resolve|ref|deref|refset|new|set!|memfn|to-array|into-array|aset|gen-class|reduce|map|filter|find|nil?|empty?|hash-map|hash-set|vec|vector|seq|flatten|reverse|assoc|dissoc|list|list?|disj|get|union|difference|intersection|extend|extend-type|extend-protocol|prn)\b/,null],[PR.PR_TYPE,/^:[0-9a-zA-Z\-]+/]]),["clj"]),// Copyright (C) 2009 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[ \t\r\n\f]+/,null," 	\r\n\f"]],[[PR.PR_STRING,/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],[PR.PR_STRING,/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']+)\)/i],[PR.PR_KEYWORD,/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_COMMENT,/^(?:<!--|-->)/],[PR.PR_LITERAL,/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],[PR.PR_LITERAL,/^#(?:[0-9a-f]{3}){1,2}\b/i],[PR.PR_PLAIN,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],[PR.PR_PUNCTUATION,/^[^\s\w\'\"]+/]]),["css"]),PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_KEYWORD,/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]),PR.registerLangHandler(PR.createSimpleLexer([],[[PR.PR_STRING,/^[^\)\"\']+/]]),["css-str"]),// Copyright (C) 2013 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"]],[[PR.PR_COMMENT,/^#!(?:.*)/],[PR.PR_KEYWORD,/^\b(?:import|library|part of|part|as|show|hide)\b/i],[PR.PR_COMMENT,/^\/\/(?:.*)/],[PR.PR_COMMENT,/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],[PR.PR_KEYWORD,/^\b(?:class|interface)\b/i],[PR.PR_KEYWORD,/^\b(?:assert|break|case|catch|continue|default|do|else|finally|for|if|in|is|new|return|super|switch|this|throw|try|while)\b/i],[PR.PR_KEYWORD,/^\b(?:abstract|const|extends|factory|final|get|implements|native|operator|set|static|typedef|var)\b/i],[PR.PR_TYPE,/^\b(?:bool|double|Dynamic|int|num|Object|String|void)\b/i],[PR.PR_KEYWORD,/^\b(?:false|null|true)\b/i],[PR.PR_STRING,/^r?[\']{3}[\s|\S]*?[^\\][\']{3}/],[PR.PR_STRING,/^r?[\"]{3}[\s|\S]*?[^\\][\"]{3}/],[PR.PR_STRING,/^r?\'(\'|(?:[^\n\r\f])*?[^\\]\')/],[PR.PR_STRING,/^r?\"(\"|(?:[^\n\r\f])*?[^\\]\")/],[PR.PR_PLAIN,/^[a-z_$][a-z0-9_]*/i],[PR.PR_PUNCTUATION,/^[~!%^&*+=|?:<>/-]/],[PR.PR_LITERAL,/^\b0x[0-9a-f]+/i],[PR.PR_LITERAL,/^\b\d+(?:\.\d*)?(?:e[+-]?\d+)?/i],[PR.PR_LITERAL,/^\b\.\d+(?:e[+-]?\d+)?/i],[PR.PR_PUNCTUATION,/^[(){}\[\],.;]/]]),["dart"]),// Copyright (C) 2013 Andrew Allen
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\x0B\x0C\r ]+/,null,"	\n\f\r "],[PR.PR_STRING,/^\"(?:[^\"\\\n\x0C\r]|\\[\s\S])*(?:\"|$)/,null,'"'],[PR.PR_LITERAL,/^[a-z][a-zA-Z0-9_]*/],[PR.PR_LITERAL,/^\'(?:[^\'\\\n\x0C\r]|\\[^&])+\'?/,null,"'"],[PR.PR_LITERAL,/^\?[^ \t\n({]+/,null,"?"],[PR.PR_LITERAL,/^(?:0o[0-7]+|0x[\da-f]+|\d+(?:\.\d+)?(?:e[+\-]?\d+)?)/i,null,"0123456789"]],[[PR.PR_COMMENT,/^%[^\n]*/],[PR.PR_KEYWORD,/^(?:module|attributes|do|let|in|letrec|apply|call|primop|case|of|end|when|fun|try|catch|receive|after|char|integer|float,atom,string,var)\b/],[PR.PR_KEYWORD,/^-[a-z_]+/],[PR.PR_TYPE,/^[A-Z_][a-zA-Z0-9_]*/],[PR.PR_PUNCTUATION,/^[.,;]/]]),["erlang","erl"]),// Copyright (C) 2010 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_PLAIN,/^(?:\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)|\'(?:[^\'\\]|\\[\s\S])+(?:\'|$)|`[^`]*(?:`|$))/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:\/\/[^\r\n]*|\/\*[\s\S]*?\*\/)/],[PR.PR_PLAIN,/^(?:[^\/\"\'`]|\/(?![\/\*]))+/i]]),["go"]),// Copyright (C) 2009 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\x0B\x0C\r ]+/,null,"	\n\f\r "],[PR.PR_STRING,/^\"(?:[^\"\\\n\x0C\r]|\\[\s\S])*(?:\"|$)/,null,'"'],[PR.PR_STRING,/^\'(?:[^\'\\\n\x0C\r]|\\[^&])\'?/,null,"'"],[PR.PR_LITERAL,/^(?:0o[0-7]+|0x[\da-f]+|\d+(?:\.\d+)?(?:e[+\-]?\d+)?)/i,null,"0123456789"]],[[PR.PR_COMMENT,/^(?:(?:--+(?:[^\r\n\x0C]*)?)|(?:\{-(?:[^-]|-+[^-\}])*-\}))/],[PR.PR_KEYWORD,/^(?:case|class|data|default|deriving|do|else|if|import|in|infix|infixl|infixr|instance|let|module|newtype|of|then|type|where|_)(?=[^a-zA-Z0-9\']|$)/,null],[PR.PR_PLAIN,/^(?:[A-Z][\w\']*\.)*[a-zA-Z][\w\']*/],[PR.PR_PUNCTUATION,/^[^\t\n\x0B\x0C\r a-zA-Z0-9\'\"]+/]]),["hs"]),// Copyright (C) 2008 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([["opn",/^\(+/,null,"("],["clo",/^\)+/,null,")"],[PR.PR_COMMENT,/^;[^\r\n]*/,null,";"],[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"']],[[PR.PR_KEYWORD,/^(?:block|c[ad]+r|catch|con[ds]|def(?:ine|un)|do|eq|eql|equal|equalp|eval-when|flet|format|go|if|labels|lambda|let|load-time-value|locally|macrolet|multiple-value-call|nil|progn|progv|quote|require|return-from|setq|symbol-macrolet|t|tagbody|the|throw|unwind)\b/,null],[PR.PR_LITERAL,/^[+\-]?(?:[0#]x[0-9a-f]+|\d+\/\d+|(?:\.\d+|\d+(?:\.\d*)?)(?:[ed][+\-]?\d+)?)/i],[PR.PR_LITERAL,/^\'(?:-*(?:\w|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?)?/],[PR.PR_PLAIN,/^-*(?:[a-z_]|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0()\"\\\';]+/]]),["cl","el","lisp","lsp","scm","ss","rkt"]),// Copyright (C) 2013 Nikhil Dabas
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^!?\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"'],[PR.PR_COMMENT,/^;[^\r\n]*/,null,";"]],[[PR.PR_PLAIN,/^[%@!](?:[-a-zA-Z$._][-a-zA-Z$._0-9]*|\d+)/],[PR.PR_KEYWORD,/^[A-Za-z_][0-9A-Za-z_]*/,null],[PR.PR_LITERAL,/^\d+\.\d+/],[PR.PR_LITERAL,/^(?:\d+|0[xX][a-fA-F0-9]+)/],[PR.PR_PUNCTUATION,/^[()\[\]{},=*<>:]|\.\.\.$/]]),["llvm","ll"]),// Copyright (C) 2008 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^(?:\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)|\'(?:[^\'\\]|\\[\s\S])*(?:\'|$))/,null,"\"'"]],[[PR.PR_COMMENT,/^--(?:\[(=*)\[[\s\S]*?(?:\]\1\]|$)|[^\r\n]*)/],[PR.PR_STRING,/^\[(=*)\[[\s\S]*?(?:\]\1\]|$)/],[PR.PR_KEYWORD,/^(?:and|break|do|else|elseif|end|false|for|function|if|in|local|nil|not|or|repeat|return|then|true|until|while)\b/,null],[PR.PR_LITERAL,/^[+-]?(?:0x[\da-f]+|(?:(?:\.\d+|\d+(?:\.\d*)?)(?:e[+\-]?\d+)?))/i],[PR.PR_PLAIN,/^[a-z_]\w*/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0][^\w\t\n\r \xA0\"\'\-\+=]*/]]),["lua"]),// Copyright (c) 2013 by Amro <amroamroamro@gmail.com>
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
function(t){var e="ident",n="const",r="fun",o="fun_tbx",i="syscmd",s="codeoutput",a="err",l="wrn",u="transpose",c="linecont",p=["abs|accumarray|acos(?:d|h)?|acot(?:d|h)?|acsc(?:d|h)?|actxcontrol(?:list|select)?|actxGetRunningServer|actxserver|addlistener|addpath|addpref|addtodate|airy|align|alim|all|allchild|alpha|alphamap|amd|ancestor|and|angle|annotation|any|area|arrayfun|asec(?:d|h)?|asin(?:d|h)?|assert|assignin|atan(?:2|d|h)?|audiodevinfo|audioplayer|audiorecorder|aufinfo|auread|autumn|auwrite|avifile|aviinfo|aviread|axes|axis|balance|bar(?:3|3h|h)?|base2dec|beep|BeginInvoke|bench|bessel(?:h|i|j|k|y)|beta|betainc|betaincinv|betaln|bicg|bicgstab|bicgstabl|bin2dec|bitand|bitcmp|bitget|bitmax|bitnot|bitor|bitset|bitshift|bitxor|blanks|blkdiag|bone|box|brighten|brush|bsxfun|builddocsearchdb|builtin|bvp4c|bvp5c|bvpget|bvpinit|bvpset|bvpxtend|calendar|calllib|callSoapService|camdolly|cameratoolbar|camlight|camlookat|camorbit|campan|campos|camproj|camroll|camtarget|camup|camva|camzoom|cart2pol|cart2sph|cast|cat|caxis|cd|cdf2rdf|cdfepoch|cdfinfo|cdflib(?:.(?:close|closeVar|computeEpoch|computeEpoch16|create|createAttr|createVar|delete|deleteAttr|deleteAttrEntry|deleteAttrgEntry|deleteVar|deleteVarRecords|epoch16Breakdown|epochBreakdown|getAttrEntry|getAttrgEntry|getAttrMaxEntry|getAttrMaxgEntry|getAttrName|getAttrNum|getAttrScope|getCacheSize|getChecksum|getCompression|getCompressionCacheSize|getConstantNames|getConstantValue|getCopyright|getFileBackward|getFormat|getLibraryCopyright|getLibraryVersion|getMajority|getName|getNumAttrEntries|getNumAttrgEntries|getNumAttributes|getNumgAttributes|getReadOnlyMode|getStageCacheSize|getValidate|getVarAllocRecords|getVarBlockingFactor|getVarCacheSize|getVarCompression|getVarData|getVarMaxAllocRecNum|getVarMaxWrittenRecNum|getVarName|getVarNum|getVarNumRecsWritten|getVarPadValue|getVarRecordData|getVarReservePercent|getVarsMaxWrittenRecNum|getVarSparseRecords|getVersion|hyperGetVarData|hyperPutVarData|inquire|inquireAttr|inquireAttrEntry|inquireAttrgEntry|inquireVar|open|putAttrEntry|putAttrgEntry|putVarData|putVarRecordData|renameAttr|renameVar|setCacheSize|setChecksum|setCompression|setCompressionCacheSize|setFileBackward|setFormat|setMajority|setReadOnlyMode|setStageCacheSize|setValidate|setVarAllocBlockRecords|setVarBlockingFactor|setVarCacheSize|setVarCompression|setVarInitialRecs|setVarPadValue|SetVarReservePercent|setVarsCacheSize|setVarSparseRecords))?|cdfread|cdfwrite|ceil|cell2mat|cell2struct|celldisp|cellfun|cellplot|cellstr|cgs|checkcode|checkin|checkout|chol|cholinc|cholupdate|circshift|cla|clabel|class|clc|clear|clearvars|clf|clipboard|clock|close|closereq|cmopts|cmpermute|cmunique|colamd|colon|colorbar|colordef|colormap|colormapeditor|colperm|Combine|comet|comet3|commandhistory|commandwindow|compan|compass|complex|computer|cond|condeig|condest|coneplot|conj|containers.Map|contour(?:3|c|f|slice)?|contrast|conv|conv2|convhull|convhulln|convn|cool|copper|copyfile|copyobj|corrcoef|cos(?:d|h)?|cot(?:d|h)?|cov|cplxpair|cputime|createClassFromWsdl|createSoapMessage|cross|csc(?:d|h)?|csvread|csvwrite|ctranspose|cumprod|cumsum|cumtrapz|curl|customverctrl|cylinder|daqread|daspect|datacursormode|datatipinfo|date|datenum|datestr|datetick|datevec|dbclear|dbcont|dbdown|dblquad|dbmex|dbquit|dbstack|dbstatus|dbstep|dbstop|dbtype|dbup|dde23|ddeget|ddesd|ddeset|deal|deblank|dec2base|dec2bin|dec2hex|decic|deconv|del2|delaunay|delaunay3|delaunayn|DelaunayTri|delete|demo|depdir|depfun|det|detrend|deval|diag|dialog|diary|diff|diffuse|dir|disp|display|dither|divergence|dlmread|dlmwrite|dmperm|doc|docsearch|dos|dot|dragrect|drawnow|dsearch|dsearchn|dynamicprops|echo|echodemo|edit|eig|eigs|ellipj|ellipke|ellipsoid|empty|enableNETfromNetworkDrive|enableservice|EndInvoke|enumeration|eomday|eq|erf|erfc|erfcinv|erfcx|erfinv|error|errorbar|errordlg|etime|etree|etreeplot|eval|evalc|evalin|event.(?:EventData|listener|PropertyEvent|proplistener)|exifread|exist|exit|exp|expint|expm|expm1|export2wsdlg|eye|ezcontour|ezcontourf|ezmesh|ezmeshc|ezplot|ezplot3|ezpolar|ezsurf|ezsurfc|factor|factorial|fclose|feather|feature|feof|ferror|feval|fft|fft2|fftn|fftshift|fftw|fgetl|fgets|fieldnames|figure|figurepalette|fileattrib|filebrowser|filemarker|fileparts|fileread|filesep|fill|fill3|filter|filter2|find|findall|findfigs|findobj|findstr|finish|fitsdisp|fitsinfo|fitsread|fitswrite|fix|flag|flipdim|fliplr|flipud|floor|flow|fminbnd|fminsearch|fopen|format|fplot|fprintf|frame2im|fread|freqspace|frewind|fscanf|fseek|ftell|FTP|full|fullfile|func2str|functions|funm|fwrite|fzero|gallery|gamma|gammainc|gammaincinv|gammaln|gca|gcbf|gcbo|gcd|gcf|gco|ge|genpath|genvarname|get|getappdata|getenv|getfield|getframe|getpixelposition|getpref|ginput|gmres|gplot|grabcode|gradient|gray|graymon|grid|griddata(?:3|n)?|griddedInterpolant|gsvd|gt|gtext|guidata|guide|guihandles|gunzip|gzip|h5create|h5disp|h5info|h5read|h5readatt|h5write|h5writeatt|hadamard|handle|hankel|hdf|hdf5|hdf5info|hdf5read|hdf5write|hdfinfo|hdfread|hdftool|help|helpbrowser|helpdesk|helpdlg|helpwin|hess|hex2dec|hex2num|hgexport|hggroup|hgload|hgsave|hgsetget|hgtransform|hidden|hilb|hist|histc|hold|home|horzcat|hostid|hot|hsv|hsv2rgb|hypot|ichol|idivide|ifft|ifft2|ifftn|ifftshift|ilu|im2frame|im2java|imag|image|imagesc|imapprox|imfinfo|imformats|import|importdata|imread|imwrite|ind2rgb|ind2sub|inferiorto|info|inline|inmem|inpolygon|input|inputdlg|inputname|inputParser|inspect|instrcallback|instrfind|instrfindall|int2str|integral(?:2|3)?|interp(?:1|1q|2|3|ft|n)|interpstreamspeed|intersect|intmax|intmin|inv|invhilb|ipermute|isa|isappdata|iscell|iscellstr|ischar|iscolumn|isdir|isempty|isequal|isequaln|isequalwithequalnans|isfield|isfinite|isfloat|isglobal|ishandle|ishghandle|ishold|isinf|isinteger|isjava|iskeyword|isletter|islogical|ismac|ismatrix|ismember|ismethod|isnan|isnumeric|isobject|isocaps|isocolors|isonormals|isosurface|ispc|ispref|isprime|isprop|isreal|isrow|isscalar|issorted|isspace|issparse|isstr|isstrprop|isstruct|isstudent|isunix|isvarname|isvector|javaaddpath|javaArray|javachk|javaclasspath|javacomponent|javaMethod|javaMethodEDT|javaObject|javaObjectEDT|javarmpath|jet|keyboard|kron|lasterr|lasterror|lastwarn|lcm|ldivide|ldl|le|legend|legendre|length|libfunctions|libfunctionsview|libisloaded|libpointer|libstruct|license|light|lightangle|lighting|lin2mu|line|lines|linkaxes|linkdata|linkprop|linsolve|linspace|listdlg|listfonts|load|loadlibrary|loadobj|log|log10|log1p|log2|loglog|logm|logspace|lookfor|lower|ls|lscov|lsqnonneg|lsqr|lt|lu|luinc|magic|makehgtform|mat2cell|mat2str|material|matfile|matlab.io.MatFile|matlab.mixin.(?:Copyable|Heterogeneous(?:.getDefaultScalarElement)?)|matlabrc|matlabroot|max|maxNumCompThreads|mean|median|membrane|memmapfile|memory|menu|mesh|meshc|meshgrid|meshz|meta.(?:class(?:.fromName)?|DynamicProperty|EnumeratedValue|event|MetaData|method|package(?:.(?:fromName|getAllPackages))?|property)|metaclass|methods|methodsview|mex(?:.getCompilerConfigurations)?|MException|mexext|mfilename|min|minres|minus|mislocked|mkdir|mkpp|mldivide|mlint|mlintrpt|mlock|mmfileinfo|mmreader|mod|mode|more|move|movefile|movegui|movie|movie2avi|mpower|mrdivide|msgbox|mtimes|mu2lin|multibandread|multibandwrite|munlock|namelengthmax|nargchk|narginchk|nargoutchk|native2unicode|nccreate|ncdisp|nchoosek|ncinfo|ncread|ncreadatt|ncwrite|ncwriteatt|ncwriteschema|ndgrid|ndims|ne|NET(?:.(?:addAssembly|Assembly|convertArray|createArray|createGeneric|disableAutoRelease|enableAutoRelease|GenericClass|invokeGenericMethod|NetException|setStaticProperty))?|netcdf.(?:abort|close|copyAtt|create|defDim|defGrp|defVar|defVarChunking|defVarDeflate|defVarFill|defVarFletcher32|delAtt|endDef|getAtt|getChunkCache|getConstant|getConstantNames|getVar|inq|inqAtt|inqAttID|inqAttName|inqDim|inqDimID|inqDimIDs|inqFormat|inqGrpName|inqGrpNameFull|inqGrpParent|inqGrps|inqLibVers|inqNcid|inqUnlimDims|inqVar|inqVarChunking|inqVarDeflate|inqVarFill|inqVarFletcher32|inqVarID|inqVarIDs|open|putAtt|putVar|reDef|renameAtt|renameDim|renameVar|setChunkCache|setDefaultFormat|setFill|sync)|newplot|nextpow2|nnz|noanimate|nonzeros|norm|normest|not|notebook|now|nthroot|null|num2cell|num2hex|num2str|numel|nzmax|ode(?:113|15i|15s|23|23s|23t|23tb|45)|odeget|odeset|odextend|onCleanup|ones|open|openfig|opengl|openvar|optimget|optimset|or|ordeig|orderfields|ordqz|ordschur|orient|orth|pack|padecoef|pagesetupdlg|pan|pareto|parseSoapResponse|pascal|patch|path|path2rc|pathsep|pathtool|pause|pbaspect|pcg|pchip|pcode|pcolor|pdepe|pdeval|peaks|perl|perms|permute|pie|pink|pinv|planerot|playshow|plot|plot3|plotbrowser|plotedit|plotmatrix|plottools|plotyy|plus|pol2cart|polar|poly|polyarea|polyder|polyeig|polyfit|polyint|polyval|polyvalm|pow2|power|ppval|prefdir|preferences|primes|print|printdlg|printopt|printpreview|prod|profile|profsave|propedit|propertyeditor|psi|publish|PutCharArray|PutFullMatrix|PutWorkspaceData|pwd|qhull|qmr|qr|qrdelete|qrinsert|qrupdate|quad|quad2d|quadgk|quadl|quadv|questdlg|quit|quiver|quiver3|qz|rand|randi|randn|randperm|RandStream(?:.(?:create|getDefaultStream|getGlobalStream|list|setDefaultStream|setGlobalStream))?|rank|rat|rats|rbbox|rcond|rdivide|readasync|real|reallog|realmax|realmin|realpow|realsqrt|record|rectangle|rectint|recycle|reducepatch|reducevolume|refresh|refreshdata|regexp|regexpi|regexprep|regexptranslate|rehash|rem|Remove|RemoveAll|repmat|reset|reshape|residue|restoredefaultpath|rethrow|rgb2hsv|rgb2ind|rgbplot|ribbon|rmappdata|rmdir|rmfield|rmpath|rmpref|rng|roots|rose|rosser|rot90|rotate|rotate3d|round|rref|rsf2csf|run|save|saveas|saveobj|savepath|scatter|scatter3|schur|sec|secd|sech|selectmoveresize|semilogx|semilogy|sendmail|serial|set|setappdata|setdiff|setenv|setfield|setpixelposition|setpref|setstr|setxor|shading|shg|shiftdim|showplottool|shrinkfaces|sign|sin(?:d|h)?|size|slice|smooth3|snapnow|sort|sortrows|sound|soundsc|spalloc|spaugment|spconvert|spdiags|specular|speye|spfun|sph2cart|sphere|spinmap|spline|spones|spparms|sprand|sprandn|sprandsym|sprank|spring|sprintf|spy|sqrt|sqrtm|squeeze|ss2tf|sscanf|stairs|startup|std|stem|stem3|stopasync|str2double|str2func|str2mat|str2num|strcat|strcmp|strcmpi|stream2|stream3|streamline|streamparticles|streamribbon|streamslice|streamtube|strfind|strjust|strmatch|strncmp|strncmpi|strread|strrep|strtok|strtrim|struct2cell|structfun|strvcat|sub2ind|subplot|subsasgn|subsindex|subspace|subsref|substruct|subvolume|sum|summer|superclasses|superiorto|support|surf|surf2patch|surface|surfc|surfl|surfnorm|svd|svds|swapbytes|symamd|symbfact|symmlq|symrcm|symvar|system|tan(?:d|h)?|tar|tempdir|tempname|tetramesh|texlabel|text|textread|textscan|textwrap|tfqmr|throw|tic|Tiff(?:.(?:getTagNames|getVersion))?|timer|timerfind|timerfindall|times|timeseries|title|toc|todatenum|toeplitz|toolboxdir|trace|transpose|trapz|treelayout|treeplot|tril|trimesh|triplequad|triplot|TriRep|TriScatteredInterp|trisurf|triu|tscollection|tsearch|tsearchn|tstool|type|typecast|uibuttongroup|uicontextmenu|uicontrol|uigetdir|uigetfile|uigetpref|uiimport|uimenu|uiopen|uipanel|uipushtool|uiputfile|uiresume|uisave|uisetcolor|uisetfont|uisetpref|uistack|uitable|uitoggletool|uitoolbar|uiwait|uminus|undocheckout|unicode2native|union|unique|unix|unloadlibrary|unmesh|unmkpp|untar|unwrap|unzip|uplus|upper|urlread|urlwrite|usejava|userpath|validateattributes|validatestring|vander|var|vectorize|ver|verctrl|verLessThan|version|vertcat|VideoReader(?:.isPlatformSupported)?|VideoWriter(?:.getProfiles)?|view|viewmtx|visdiff|volumebounds|voronoi|voronoin|wait|waitbar|waitfor|waitforbuttonpress|warndlg|warning|waterfall|wavfinfo|wavplay|wavread|wavrecord|wavwrite|web|weekday|what|whatsnew|which|whitebg|who|whos|wilkinson|winopen|winqueryreg|winter|wk1finfo|wk1read|wk1write|workspace|xlabel|xlim|xlsfinfo|xlsread|xlswrite|xmlread|xmlwrite|xor|xslt|ylabel|ylim|zeros|zip|zlabel|zlim|zoom"].join("|"),h=["addedvarplot|andrewsplot|anova(?:1|2|n)|ansaribradley|aoctool|barttest|bbdesign|beta(?:cdf|fit|inv|like|pdf|rnd|stat)|bino(?:cdf|fit|inv|pdf|rnd|stat)|biplot|bootci|bootstrp|boxplot|candexch|candgen|canoncorr|capability|capaplot|caseread|casewrite|categorical|ccdesign|cdfplot|chi2(?:cdf|gof|inv|pdf|rnd|stat)|cholcov|Classification(?:BaggedEnsemble|Discriminant(?:.(?:fit|make|template))?|Ensemble|KNN(?:.(?:fit|template))?|PartitionedEnsemble|PartitionedModel|Tree(?:.(?:fit|template))?)|classify|classregtree|cluster|clusterdata|cmdscale|combnk|Compact(?:Classification(?:Discriminant|Ensemble|Tree)|Regression(?:Ensemble|Tree)|TreeBagger)|confusionmat|controlchart|controlrules|cophenet|copula(?:cdf|fit|param|pdf|rnd|stat)|cordexch|corr|corrcov|coxphfit|createns|crosstab|crossval|cvpartition|datasample|dataset|daugment|dcovary|dendrogram|dfittool|disttool|dummyvar|dwtest|ecdf|ecdfhist|ev(?:cdf|fit|inv|like|pdf|rnd|stat)|ExhaustiveSearcher|exp(?:cdf|fit|inv|like|pdf|rnd|stat)|factoran|fcdf|ff2n|finv|fitdist|fitensemble|fpdf|fracfact|fracfactgen|friedman|frnd|fstat|fsurfht|fullfact|gagerr|gam(?:cdf|fit|inv|like|pdf|rnd|stat)|GeneralizedLinearModel(?:.fit)?|geo(?:cdf|inv|mean|pdf|rnd|stat)|gev(?:cdf|fit|inv|like|pdf|rnd|stat)|gline|glmfit|glmval|glyphplot|gmdistribution(?:.fit)?|gname|gp(?:cdf|fit|inv|like|pdf|rnd|stat)|gplotmatrix|grp2idx|grpstats|gscatter|haltonset|harmmean|hist3|histfit|hmm(?:decode|estimate|generate|train|viterbi)|hougen|hyge(?:cdf|inv|pdf|rnd|stat)|icdf|inconsistent|interactionplot|invpred|iqr|iwishrnd|jackknife|jbtest|johnsrnd|KDTreeSearcher|kmeans|knnsearch|kruskalwallis|ksdensity|kstest|kstest2|kurtosis|lasso|lassoglm|lassoPlot|leverage|lhsdesign|lhsnorm|lillietest|LinearModel(?:.fit)?|linhyptest|linkage|logn(?:cdf|fit|inv|like|pdf|rnd|stat)|lsline|mad|mahal|maineffectsplot|manova1|manovacluster|mdscale|mhsample|mle|mlecov|mnpdf|mnrfit|mnrnd|mnrval|moment|multcompare|multivarichart|mvn(?:cdf|pdf|rnd)|mvregress|mvregresslike|mvt(?:cdf|pdf|rnd)|NaiveBayes(?:.fit)?|nan(?:cov|max|mean|median|min|std|sum|var)|nbin(?:cdf|fit|inv|pdf|rnd|stat)|ncf(?:cdf|inv|pdf|rnd|stat)|nct(?:cdf|inv|pdf|rnd|stat)|ncx2(?:cdf|inv|pdf|rnd|stat)|NeighborSearcher|nlinfit|nlintool|nlmefit|nlmefitsa|nlparci|nlpredci|nnmf|nominal|NonLinearModel(?:.fit)?|norm(?:cdf|fit|inv|like|pdf|rnd|stat)|normplot|normspec|ordinal|outlierMeasure|parallelcoords|paretotails|partialcorr|pcacov|pcares|pdf|pdist|pdist2|pearsrnd|perfcurve|perms|piecewisedistribution|plsregress|poiss(?:cdf|fit|inv|pdf|rnd|tat)|polyconf|polytool|prctile|princomp|ProbDist(?:Kernel|Parametric|UnivKernel|UnivParam)?|probplot|procrustes|qqplot|qrandset|qrandstream|quantile|randg|random|randsample|randtool|range|rangesearch|ranksum|rayl(?:cdf|fit|inv|pdf|rnd|stat)|rcoplot|refcurve|refline|regress|Regression(?:BaggedEnsemble|Ensemble|PartitionedEnsemble|PartitionedModel|Tree(?:.(?:fit|template))?)|regstats|relieff|ridge|robustdemo|robustfit|rotatefactors|rowexch|rsmdemo|rstool|runstest|sampsizepwr|scatterhist|sequentialfs|signrank|signtest|silhouette|skewness|slicesample|sobolset|squareform|statget|statset|stepwise|stepwisefit|surfht|tabulate|tblread|tblwrite|tcdf|tdfread|tiedrank|tinv|tpdf|TreeBagger|treedisp|treefit|treeprune|treetest|treeval|trimmean|trnd|tstat|ttest|ttest2|unid(?:cdf|inv|pdf|rnd|stat)|unif(?:cdf|inv|it|pdf|rnd|stat)|vartest(?:2|n)?|wbl(?:cdf|fit|inv|like|pdf|rnd|stat)|wblplot|wishrnd|x2fx|xptread|zscore|ztest"].join("|"),d=["adapthisteq|analyze75info|analyze75read|applycform|applylut|axes2pix|bestblk|blockproc|bwarea|bwareaopen|bwboundaries|bwconncomp|bwconvhull|bwdist|bwdistgeodesic|bweuler|bwhitmiss|bwlabel|bwlabeln|bwmorph|bwpack|bwperim|bwselect|bwtraceboundary|bwulterode|bwunpack|checkerboard|col2im|colfilt|conndef|convmtx2|corner|cornermetric|corr2|cp2tform|cpcorr|cpselect|cpstruct2pairs|dct2|dctmtx|deconvblind|deconvlucy|deconvreg|deconvwnr|decorrstretch|demosaic|dicom(?:anon|dict|info|lookup|read|uid|write)|edge|edgetaper|entropy|entropyfilt|fan2para|fanbeam|findbounds|fliptform|freqz2|fsamp2|fspecial|ftrans2|fwind1|fwind2|getheight|getimage|getimagemodel|getline|getneighbors|getnhood|getpts|getrangefromclass|getrect|getsequence|gray2ind|graycomatrix|graycoprops|graydist|grayslice|graythresh|hdrread|hdrwrite|histeq|hough|houghlines|houghpeaks|iccfind|iccread|iccroot|iccwrite|idct2|ifanbeam|im2bw|im2col|im2double|im2int16|im2java2d|im2single|im2uint16|im2uint8|imabsdiff|imadd|imadjust|ImageAdapter|imageinfo|imagemodel|imapplymatrix|imattributes|imbothat|imclearborder|imclose|imcolormaptool|imcomplement|imcontour|imcontrast|imcrop|imdilate|imdisplayrange|imdistline|imdivide|imellipse|imerode|imextendedmax|imextendedmin|imfill|imfilter|imfindcircles|imfreehand|imfuse|imgca|imgcf|imgetfile|imhandles|imhist|imhmax|imhmin|imimposemin|imlincomb|imline|immagbox|immovie|immultiply|imnoise|imopen|imoverview|imoverviewpanel|impixel|impixelinfo|impixelinfoval|impixelregion|impixelregionpanel|implay|impoint|impoly|impositionrect|improfile|imputfile|impyramid|imreconstruct|imrect|imregconfig|imregionalmax|imregionalmin|imregister|imresize|imroi|imrotate|imsave|imscrollpanel|imshow|imshowpair|imsubtract|imtool|imtophat|imtransform|imview|ind2gray|ind2rgb|interfileinfo|interfileread|intlut|ippl|iptaddcallback|iptcheckconn|iptcheckhandle|iptcheckinput|iptcheckmap|iptchecknargin|iptcheckstrs|iptdemos|iptgetapi|iptGetPointerBehavior|iptgetpref|ipticondir|iptnum2ordinal|iptPointerManager|iptprefs|iptremovecallback|iptSetPointerBehavior|iptsetpref|iptwindowalign|iradon|isbw|isflat|isgray|isicc|isind|isnitf|isrgb|isrset|lab2double|lab2uint16|lab2uint8|label2rgb|labelmatrix|makecform|makeConstrainToRectFcn|makehdr|makelut|makeresampler|maketform|mat2gray|mean2|medfilt2|montage|nitfinfo|nitfread|nlfilter|normxcorr2|ntsc2rgb|openrset|ordfilt2|otf2psf|padarray|para2fan|phantom|poly2mask|psf2otf|qtdecomp|qtgetblk|qtsetblk|radon|rangefilt|reflect|regionprops|registration.metric.(?:MattesMutualInformation|MeanSquares)|registration.optimizer.(?:OnePlusOneEvolutionary|RegularStepGradientDescent)|rgb2gray|rgb2ntsc|rgb2ycbcr|roicolor|roifill|roifilt2|roipoly|rsetwrite|std2|stdfilt|strel|stretchlim|subimage|tformarray|tformfwd|tforminv|tonemap|translate|truesize|uintlut|viscircles|warp|watershed|whitepoint|wiener2|xyz2double|xyz2uint16|ycbcr2rgb"].join("|"),f=["bintprog|color|fgoalattain|fminbnd|fmincon|fminimax|fminsearch|fminunc|fseminf|fsolve|fzero|fzmult|gangstr|ktrlink|linprog|lsqcurvefit|lsqlin|lsqnonlin|lsqnonneg|optimget|optimset|optimtool|quadprog"].join("|"),m=[[t.PR_PLAIN,/^[ \t\r\n\v\f\xA0]+/,null," 	\r\n\f\xa0"],[t.PR_COMMENT,/^%\{[^%]*%+(?:[^\}%][^%]*%+)*\}/,null],[t.PR_COMMENT,/^%[^\r\n]*/,null,"%"],[i,/^![^\r\n]*/,null,"!"]],g=[[c,/^\.\.\.\s*[\r\n]/,null],[a,/^\?\?\? [^\r\n]*/,null],[l,/^Warning: [^\r\n]*/,null],[s,/^>>\s+/,null],[s,/^octave:\d+>\s+/,null],["lang-matlab-operators",/^((?:[a-zA-Z][a-zA-Z0-9_]*(?:\.[a-zA-Z][a-zA-Z0-9_]*)*|\)|\]|\}|\.)')/,null],["lang-matlab-identifiers",/^([a-zA-Z][a-zA-Z0-9_]*(?:\.[a-zA-Z][a-zA-Z0-9_]*)*)(?!')/,null],[t.PR_STRING,/^'(?:[^']|'')*'/,null],[t.PR_LITERAL,/^[+\-]?\.?\d+(?:\.\d*)?(?:[Ee][+\-]?\d+)?[ij]?/,null],[t.PR_TAG,/^(?:\{|\}|\(|\)|\[|\])/,null],[t.PR_PUNCTUATION,/^(?:<|>|=|~|@|&|;|,|:|!|\-|\+|\*|\^|\.|\||\\|\/)/,null]],y=[[t.PR_KEYWORD,/^\b(?:break|case|catch|classdef|continue|else|elseif|end|for|function|global|if|otherwise|parfor|persistent|return|spmd|switch|try|while)\b/,null],[n,/^\b(?:true|false|inf|Inf|nan|NaN|eps|pi|ans|nargin|nargout|varargin|varargout)\b/,null],[t.PR_TYPE,/^\b(?:cell|struct|char|double|single|logical|u?int(?:8|16|32|64)|sparse)\b/,null],[r,new RegExp("^\\b(?:"+p+")\\b"),null],[o,new RegExp("^\\b(?:"+h+")\\b"),null],[o,new RegExp("^\\b(?:"+d+")\\b"),null],[o,new RegExp("^\\b(?:"+f+")\\b"),null],[e,/^[a-zA-Z][a-zA-Z0-9_]*(?:\.[a-zA-Z][a-zA-Z0-9_]*)*/,null]],v=[["lang-matlab-identifiers",/^([a-zA-Z][a-zA-Z0-9_]*(?:\.[a-zA-Z][a-zA-Z0-9_]*)*)/,null],[t.PR_TAG,/^(?:\{|\}|\(|\)|\[|\])/,null],[t.PR_PUNCTUATION,/^(?:<|>|=|~|@|&|;|,|:|!|\-|\+|\*|\^|\.|\||\\|\/)/,null],[u,/^'/,null]];
t.registerLangHandler(t.createSimpleLexer([],y),["matlab-identifiers"]),t.registerLangHandler(t.createSimpleLexer([],v),["matlab-operators"]),t.registerLangHandler(t.createSimpleLexer(m,g),["matlab"])}(window.PR),// Copyright (C) 2008 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_COMMENT,/^#(?:if[\t\n\r \xA0]+(?:[a-z_$][\w\']*|``[^\r\n\t`]*(?:``|$))|else|endif|light)/i,null,"#"],[PR.PR_STRING,/^(?:\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)|\'(?:[^\'\\]|\\[\s\S])(?:\'|$))/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:\/\/[^\r\n]*|\(\*[\s\S]*?\*\))/],[PR.PR_KEYWORD,/^(?:abstract|and|as|assert|begin|class|default|delegate|do|done|downcast|downto|elif|else|end|exception|extern|false|finally|for|fun|function|if|in|inherit|inline|interface|internal|lazy|let|match|member|module|mutable|namespace|new|null|of|open|or|override|private|public|rec|return|static|struct|then|to|true|try|type|upcast|use|val|void|when|while|with|yield|asr|land|lor|lsl|lsr|lxor|mod|sig|atomic|break|checked|component|const|constraint|constructor|continue|eager|event|external|fixed|functor|global|include|method|mixin|object|parallel|process|protected|pure|sealed|trait|virtual|volatile)\b/],[PR.PR_LITERAL,/^[+\-]?(?:0x[\da-f]+|(?:(?:\.\d+|\d+(?:\.\d*)?)(?:e[+\-]?\d+)?))/i],[PR.PR_PLAIN,/^(?:[a-z_][\w']*[!?#]?|``[^\r\n\t`]*(?:``|$))/i],[PR.PR_PUNCTUATION,/^[^\t\n\r \xA0\"\'\w]+/]]),["fs","ml"]),// Copyright (C) 2011 Kitware Inc.
function(){var t="B|BREAK|C|CLOSE|D|DO|E|ELSE|F|FOR|G|GOTO|H|HALT|H|HANG|I|IF|J|JOB|K|KILL|L|LOCK|M|MERGE|N|NEW|O|OPEN|Q|QUIT|R|READ|S|SET|TC|TCOMMIT|TRE|TRESTART|TRO|TROLLBACK|TS|TSTART|U|USE|V|VIEW|W|WRITE|X|XECUTE",e="D|DEVICE|EC|ECODE|ES|ESTACK|ET|ETRAP|H|HOROLOG|I|IO|J|JOB|K|KEY|P|PRINCIPAL|Q|QUIT|ST|STACK|S|STORAGE|SY|SYSTEM|T|TEST|TL|TLEVEL|TR|TRESTART|X|Y|Z[A-Z]*|",n="A|ASCII|C|CHAR|D|DATA|E|EXTRACT|F|FIND|FN|FNUMBER|G|GET|J|JUSTIFY|L|LENGTH|NA|NAME|O|ORDER|P|PIECE|QL|QLENGTH|QS|QSUBSCRIPT|Q|QUERY|R|RANDOM|RE|REVERSE|S|SELECT|ST|STACK|T|TEXT|TR|TRANSLATE|NaN",r=e+n,o=[[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^(?:"(?:[^"]|\\.)*")/,null,'"']],i=[[PR.PR_COMMENT,/^;[^\r\n]*/,null,";"],[PR.PR_DECLARATION,new RegExp("^(?:\\$(?:"+r+"))\\b","i"),null],[PR.PR_KEYWORD,new RegExp("^(?:[^\\$]"+t+")\\b","i"),null],[PR.PR_LITERAL,/^[+-]?(?:(?:\.\d+|\d+(?:\.\d*)?)(?:E[+\-]?\d+)?)/i],[PR.PR_PLAIN,/^[a-z][a-zA-Z0-9]*/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r\xA0\"\$;%\^]|_/]];PR.registerLangHandler(PR.createSimpleLexer(o,i),["mumps"])
}(),// Copyright (C) 2011 Zimin A.V.
function(){var t="abstract|and|as|base|catch|class|def|delegate|enum|event|extern|false|finally|fun|implements|interface|internal|is|macro|match|matches|module|mutable|namespace|new|null|out|override|params|partial|private|protected|public|ref|sealed|static|struct|syntax|this|throw|true|try|type|typeof|using|variant|virtual|volatile|when|where|with|assert|assert2|async|break|checked|continue|do|else|ensures|for|foreach|if|late|lock|new|nolate|otherwise|regexp|repeat|requires|return|surroundwith|unchecked|unless|using|while|yield";PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_STRING,/^(?:\'(?:[^\\\'\r\n]|\\.)*\'|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,'"'],[PR.PR_COMMENT,/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"],[PR.PR_PLAIN,/^\s+/,null," \r\n	\xa0"]],[[PR.PR_STRING,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null],[PR.PR_STRING,/^<#(?:[^#>])*(?:#>|$)/,null],[PR.PR_STRING,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,null],[PR.PR_COMMENT,/^\/\/[^\r\n]*/,null],[PR.PR_COMMENT,/^\/\*[\s\S]*?(?:\*\/|$)/,null],[PR.PR_KEYWORD,new RegExp("^(?:"+t+")\\b"),null],[PR.PR_TYPE,/^(?:array|bool|byte|char|decimal|double|float|int|list|long|object|sbyte|short|string|ulong|uint|ufloat|ulong|ushort|void)\b/,null],[PR.PR_LITERAL,/^@[a-z_$][a-z_$@0-9]*/i,null],[PR.PR_TYPE,/^@[A-Z]+[a-z][A-Za-z_$@0-9]*/,null],[PR.PR_PLAIN,/^'?[A-Za-z_$][a-z_$@0-9]*/i,null],[PR.PR_LITERAL,new RegExp("^(?:0x[a-f0-9]+|(?:\\d(?:_\\d+)*\\d*(?:\\.\\d*)?|\\.\\d\\+)(?:e[+\\-]?\\d+)?)[a-z]*","i"),null,"0123456789"],[PR.PR_PUNCTUATION,/^.[^\s\w\.$@\'\"\`\/\#]*/,null]]),["n","nemerle"])
}(),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_STRING,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$))/,null,"'"],[PR.PR_PLAIN,/^\s+/,null," \r\n	\xa0"]],[[PR.PR_COMMENT,/^\(\*[\s\S]*?(?:\*\)|$)|^\{[\s\S]*?(?:\}|$)/,null],[PR.PR_KEYWORD,/^(?:ABSOLUTE|AND|ARRAY|ASM|ASSEMBLER|BEGIN|CASE|CONST|CONSTRUCTOR|DESTRUCTOR|DIV|DO|DOWNTO|ELSE|END|EXTERNAL|FOR|FORWARD|FUNCTION|GOTO|IF|IMPLEMENTATION|IN|INLINE|INTERFACE|INTERRUPT|LABEL|MOD|NOT|OBJECT|OF|OR|PACKED|PROCEDURE|PROGRAM|RECORD|REPEAT|SET|SHL|SHR|THEN|TO|TYPE|UNIT|UNTIL|USES|VAR|VIRTUAL|WHILE|WITH|XOR)\b/i,null],[PR.PR_LITERAL,/^(?:true|false|self|nil)/i,null],[PR.PR_PLAIN,/^[a-z][a-z0-9]*/i,null],[PR.PR_LITERAL,/^(?:\$[a-f0-9]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+\-]?\d+)?)/i,null,"0123456789"],[PR.PR_PUNCTUATION,/^.[^\s\w\.$@\'\/]*/,null]]),["pascal"]),// Copyright (C) 2006 Google Inc.
PR.registerLangHandler(PR.sourceDecorator({keywords:"bytes,default,double,enum,extend,extensions,false,group,import,max,message,option,optional,package,repeated,required,returns,rpc,service,syntax,to,true",types:/^(bool|(double|s?fixed|[su]?int)(32|64)|float|string)\b/,cStyleComments:!0}),["proto"]),// Copyright (C) 2012 Jeffrey B. Arnold
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"'],[PR.PR_STRING,/^\'(?:[^\'\\]|\\[\s\S])*(?:\'|$)/,null,"'"]],[[PR.PR_COMMENT,/^#.*/],[PR.PR_KEYWORD,/^(?:if|else|for|while|repeat|in|next|break|return|switch|function)(?![A-Za-z0-9_.])/],[PR.PR_LITERAL,/^0[xX][a-fA-F0-9]+([pP][0-9]+)?[Li]?/],[PR.PR_LITERAL,/^[+-]?([0-9]+(\.[0-9]+)?|\.[0-9]+)([eE][+-]?[0-9]+)?[Li]?/],[PR.PR_LITERAL,/^(?:NULL|NA(?:_(?:integer|real|complex|character)_)?|Inf|TRUE|FALSE|NaN|\.\.(?:\.|[0-9]+))(?![A-Za-z0-9_.])/],[PR.PR_PUNCTUATION,/^(?:<<?-|->>?|-|==|<=|>=|<|>|&&?|!=|\|\|?|\*|\+|\^|\/|!|%.*?%|=|~|\$|@|:{1,3}|[\[\](){};,?])/],[PR.PR_PLAIN,/^(?:[A-Za-z]+[A-Za-z0-9_.]*|\.[a-zA-Z_][0-9a-zA-Z\._]*)(?![A-Za-z0-9_.])/],[PR.PR_STRING,/^`.+`/]]),["r","s","R","S","Splus"]),// Copyright (C) 2012 Jeffrey Arnold
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_COMMENT,/^%[^\r\n]*/,null,"%"]],[[PR.PR_LITERAL,/^\\(?:cr|l?dots|R|tab)\b/],[PR.PR_KEYWORD,/^\\[a-zA-Z@]+/],[PR.PR_KEYWORD,/^#(?:ifn?def|endif)/],[PR.PR_PLAIN,/^\\[{}]/],[PR.PR_PUNCTUATION,/^[{}()\[\]]+/]]),["Rd","rd"]),// Copyright (C) 2010 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^(?:"(?:(?:""(?:""?(?!")|[^\\"]|\\.)*"{0,3})|(?:[^"\r\n\\]|\\.)*"?))/,null,'"'],[PR.PR_LITERAL,/^`(?:[^\r\n\\`]|\\.)*`?/,null,"`"],[PR.PR_PUNCTUATION,/^[!#%&()*+,\-:;<=>?@\[\\\]^{|}~]+/,null,"!#%&()*+,-:;<=>?@[\\]^{|}~"]],[[PR.PR_STRING,/^'(?:[^\r\n\\']|\\(?:'|[^\r\n']+))'/],[PR.PR_LITERAL,/^'[a-zA-Z_$][\w$]*(?!['$\w])/],[PR.PR_KEYWORD,/^(?:abstract|case|catch|class|def|do|else|extends|final|finally|for|forSome|if|implicit|import|lazy|match|new|object|override|package|private|protected|requires|return|sealed|super|throw|trait|try|type|val|var|while|with|yield)\b/],[PR.PR_LITERAL,/^(?:true|false|null|this)\b/],[PR.PR_LITERAL,/^(?:(?:0(?:[0-7]+|X[0-9A-F]+))L?|(?:(?:0|[1-9][0-9]*)(?:(?:\.[0-9]+)?(?:E[+\-]?[0-9]+)?F?|L?))|\\.[0-9]+(?:E[+\-]?[0-9]+)?F?)/i],[PR.PR_TYPE,/^[$_]*[A-Z][_$A-Z0-9]*[a-z][\w$]*/],[PR.PR_PLAIN,/^[$a-zA-Z_][\w$]*/],[PR.PR_COMMENT,/^\/(?:\/.*|\*(?:\/|\**[^*/])*(?:\*+\/?)?)/],[PR.PR_PUNCTUATION,/^(?:\.+|\/)/]]),["scala"]),// Copyright (C) 2008 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^(?:"(?:[^\"\\]|\\.)*"|'(?:[^\'\\]|\\.)*')/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:--[^\r\n]*|\/\*[\s\S]*?(?:\*\/|$))/],[PR.PR_KEYWORD,/^(?:ADD|ALL|ALTER|AND|ANY|APPLY|AS|ASC|AUTHORIZATION|BACKUP|BEGIN|BETWEEN|BREAK|BROWSE|BULK|BY|CASCADE|CASE|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COMMIT|COMPUTE|CONNECT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|CURRENT_USER|CURSOR|DATABASE|DBCC|DEALLOCATE|DECLARE|DEFAULT|DELETE|DENY|DESC|DISK|DISTINCT|DISTRIBUTED|DOUBLE|DROP|DUMMY|DUMP|ELSE|END|ERRLVL|ESCAPE|EXCEPT|EXEC|EXECUTE|EXISTS|EXIT|FETCH|FILE|FILLFACTOR|FOLLOWING|FOR|FOREIGN|FREETEXT|FREETEXTTABLE|FROM|FULL|FUNCTION|GOTO|GRANT|GROUP|HAVING|HOLDLOCK|IDENTITY|IDENTITYCOL|IDENTITY_INSERT|IF|IN|INDEX|INNER|INSERT|INTERSECT|INTO|IS|JOIN|KEY|KILL|LEFT|LIKE|LINENO|LOAD|MATCH|MATCHED|MERGE|NATURAL|NATIONAL|NOCHECK|NONCLUSTERED|NOCYCLE|NOT|NULL|NULLIF|OF|OFF|OFFSETS|ON|OPEN|OPENDATASOURCE|OPENQUERY|OPENROWSET|OPENXML|OPTION|OR|ORDER|OUTER|OVER|PARTITION|PERCENT|PIVOT|PLAN|PRECEDING|PRECISION|PRIMARY|PRINT|PROC|PROCEDURE|PUBLIC|RAISERROR|READ|READTEXT|RECONFIGURE|REFERENCES|REPLICATION|RESTORE|RESTRICT|RETURN|REVOKE|RIGHT|ROLLBACK|ROWCOUNT|ROWGUIDCOL|ROWS?|RULE|SAVE|SCHEMA|SELECT|SESSION_USER|SET|SETUSER|SHUTDOWN|SOME|START|STATISTICS|SYSTEM_USER|TABLE|TEXTSIZE|THEN|TO|TOP|TRAN|TRANSACTION|TRIGGER|TRUNCATE|TSEQUAL|UNBOUNDED|UNION|UNIQUE|UNPIVOT|UPDATE|UPDATETEXT|USE|USER|USING|VALUES|VARYING|VIEW|WAITFOR|WHEN|WHERE|WHILE|WITH|WITHIN|WRITETEXT|XML)(?=[^\w-]|$)/i,null],[PR.PR_LITERAL,/^[+-]?(?:0x[\da-f]+|(?:(?:\.\d+|\d+(?:\.\d*)?)(?:e[+\-]?\d+)?))/i],[PR.PR_PLAIN,/^[a-z_][\w-]*/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0\"\'][^\w\t\n\r \xA0+\-\"\']*/]]),["sql"]),// Copyright (C) 2012 Pyrios.
PR.registerLangHandler(PR.createSimpleLexer([["opn",/^\{+/,null,"{"],["clo",/^\}+/,null,"}"],[PR.PR_COMMENT,/^#[^\r\n]*/,null,"#"],[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_STRING,/^\"(?:[^\"\\]|\\[\s\S])*(?:\"|$)/,null,'"']],[[PR.PR_KEYWORD,/^(?:after|append|apply|array|break|case|catch|continue|error|eval|exec|exit|expr|for|foreach|if|incr|info|proc|return|set|switch|trace|uplevel|upvar|while)\b/,null],[PR.PR_LITERAL,/^[+\-]?(?:[0#]x[0-9a-f]+|\d+\/\d+|(?:\.\d+|\d+(?:\.\d*)?)(?:[ed][+\-]?\d+)?)/i],[PR.PR_LITERAL,/^\'(?:-*(?:\w|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?)?/],[PR.PR_PLAIN,/^-*(?:[a-z_]|\\[\x21-\x7e])(?:[\w-]*|\\[\x21-\x7e])[=!?]?/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0()\"\\\';]+/]]),["tcl"]),// Copyright (C) 2011 Martin S.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"],[PR.PR_COMMENT,/^%[^\r\n]*/,null,"%"]],[[PR.PR_KEYWORD,/^\\[a-zA-Z@]+/],[PR.PR_KEYWORD,/^\\./],[PR.PR_TYPE,/^[$&]/],[PR.PR_LITERAL,/[+-]?(?:\.\d+|\d+(?:\.\d*)?)(cm|em|ex|in|pc|pt|bp|mm)/i],[PR.PR_PUNCTUATION,/^[{}()\[\]=]+/]]),["latex","tex"]),// Copyright (C) 2009 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0\u2028\u2029]+/,null,"	\n\r \xa0\u2028\u2029"],[PR.PR_STRING,/^(?:[\"\u201C\u201D](?:[^\"\u201C\u201D]|[\"\u201C\u201D]{2})(?:[\"\u201C\u201D]c|$)|[\"\u201C\u201D](?:[^\"\u201C\u201D]|[\"\u201C\u201D]{2})*(?:[\"\u201C\u201D]|$))/i,null,'"\u201c\u201d'],[PR.PR_COMMENT,/^[\'\u2018\u2019](?:_(?:\r\n?|[^\r]?)|[^\r\n_\u2028\u2029])*/,null,"'\u2018\u2019"]],[[PR.PR_KEYWORD,/^(?:AddHandler|AddressOf|Alias|And|AndAlso|Ansi|As|Assembly|Auto|Boolean|ByRef|Byte|ByVal|Call|Case|Catch|CBool|CByte|CChar|CDate|CDbl|CDec|Char|CInt|Class|CLng|CObj|Const|CShort|CSng|CStr|CType|Date|Decimal|Declare|Default|Delegate|Dim|DirectCast|Do|Double|Each|Else|ElseIf|End|EndIf|Enum|Erase|Error|Event|Exit|Finally|For|Friend|Function|Get|GetType|GoSub|GoTo|Handles|If|Implements|Imports|In|Inherits|Integer|Interface|Is|Let|Lib|Like|Long|Loop|Me|Mod|Module|MustInherit|MustOverride|MyBase|MyClass|Namespace|New|Next|Not|NotInheritable|NotOverridable|Object|On|Option|Optional|Or|OrElse|Overloads|Overridable|Overrides|ParamArray|Preserve|Private|Property|Protected|Public|RaiseEvent|ReadOnly|ReDim|RemoveHandler|Resume|Return|Select|Set|Shadows|Shared|Short|Single|Static|Step|Stop|String|Structure|Sub|SyncLock|Then|Throw|To|Try|TypeOf|Unicode|Until|Variant|Wend|When|While|With|WithEvents|WriteOnly|Xor|EndIf|GoSub|Let|Variant|Wend)\b/i,null],[PR.PR_COMMENT,/^REM\b[^\r\n\u2028\u2029]*/i],[PR.PR_LITERAL,/^(?:True\b|False\b|Nothing\b|\d+(?:E[+\-]?\d+[FRD]?|[FRDSIL])?|(?:&H[0-9A-F]+|&O[0-7]+)[SIL]?|\d*\.\d+(?:E[+\-]?\d+)?[FRD]?|#\s+(?:\d+[\-\/]\d+[\-\/]\d+(?:\s+\d+:\d+(?::\d+)?(\s*(?:AM|PM))?)?|\d+:\d+(?::\d+)?(\s*(?:AM|PM))?)\s+#)/i],[PR.PR_PLAIN,/^(?:(?:[a-z]|_\w)\w*(?:\[[%&@!#]+\])?|\[(?:[a-z]|_\w)\w*\])/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \"\'\[\]\xA0\u2018\u2019\u201C\u201D\u2028\u2029]+/],[PR.PR_PUNCTUATION,/^(?:\[|\])/]]),["vb","vbs"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"	\n\r \xa0"]],[[PR.PR_STRING,/^(?:[BOX]?"(?:[^\"]|"")*"|'.')/i],[PR.PR_COMMENT,/^--[^\r\n]*/],[PR.PR_KEYWORD,/^(?:abs|access|after|alias|all|and|architecture|array|assert|attribute|begin|block|body|buffer|bus|case|component|configuration|constant|disconnect|downto|else|elsif|end|entity|exit|file|for|function|generate|generic|group|guarded|if|impure|in|inertial|inout|is|label|library|linkage|literal|loop|map|mod|nand|new|next|nor|not|null|of|on|open|or|others|out|package|port|postponed|procedure|process|pure|range|record|register|reject|rem|report|return|rol|ror|select|severity|shared|signal|sla|sll|sra|srl|subtype|then|to|transport|type|unaffected|units|until|use|variable|wait|when|while|with|xnor|xor)(?=[^\w-]|$)/i,null],[PR.PR_TYPE,/^(?:bit|bit_vector|character|boolean|integer|real|time|string|severity_level|positive|natural|signed|unsigned|line|text|std_u?logic(?:_vector)?)(?=[^\w-]|$)/i,null],[PR.PR_TYPE,/^\'(?:ACTIVE|ASCENDING|BASE|DELAYED|DRIVING|DRIVING_VALUE|EVENT|HIGH|IMAGE|INSTANCE_NAME|LAST_ACTIVE|LAST_EVENT|LAST_VALUE|LEFT|LEFTOF|LENGTH|LOW|PATH_NAME|POS|PRED|QUIET|RANGE|REVERSE_RANGE|RIGHT|RIGHTOF|SIMPLE_NAME|STABLE|SUCC|TRANSACTION|VAL|VALUE)(?=[^\w-]|$)/i,null],[PR.PR_LITERAL,/^\d+(?:_\d+)*(?:#[\w\\.]+#(?:[+\-]?\d+(?:_\d+)*)?|(?:\.\d+(?:_\d+)*)?(?:E[+\-]?\d+(?:_\d+)*)?)/i],[PR.PR_PLAIN,/^(?:[a-z]\w*|\\[^\\]*\\)/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0\"\'][^\w\t\n\r \xA0\-\"\']*/]]),["vhdl","vhd"]),// Copyright (C) 2009 Google Inc.
PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t \xA0a-gi-z0-9]+/,null,"	 \xa0abcdefgijklmnopqrstuvwxyz0123456789"],[PR.PR_PUNCTUATION,/^[=*~\^\[\]]+/,null,"=*~^[]"]],[["lang-wiki.meta",/(?:^^|\r\n?|\n)(#[a-z]+)\b/],[PR.PR_LITERAL,/^(?:[A-Z][a-z][a-z0-9]+[A-Z][a-z][a-zA-Z0-9]+)\b/],["lang-",/^\{\{\{([\s\S]+?)\}\}\}/],["lang-",/^`([^\r\n`]+)`/],[PR.PR_STRING,/^https?:\/\/[^\/?#\s]*(?:\/[^?#\s]*)?(?:\?[^#\s]*)?(?:#\S*)?/i],[PR.PR_PLAIN,/^(?:\r\n|[\s\S])[^#=*~^A-Zh\{`\[\r\n]*/]]),["wiki"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_KEYWORD,/^#[a-z]+/i,null,"#"]],[]),["wiki.meta"]);// Copyright (C) 2011 Patrick Wied
var PR_FUNCTION="fun pln",PR_VARIABLE="var pln";PR.registerLangHandler(PR.createSimpleLexer([[PR_VARIABLE,/^\$[A-Za-z0-9_\-]+/,null,"$"]],[[PR.PR_PLAIN,/^[\s=][<>][\s=]/],[PR.PR_LITERAL,/^\@[\w-]+/],[PR.PR_TAG,/^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],[PR.PR_COMMENT,/^\(:[\s\S]*?:\)/],[PR.PR_PLAIN,/^[\/\{\};,\[\]\(\)]$/],[PR.PR_STRING,/^(?:\"(?:[^\"\\\{]|\\[\s\S])*(?:\"|$)|\'(?:[^\'\\\{]|\\[\s\S])*(?:\'|$))/,null,"\"'"],[PR.PR_KEYWORD,/^(?:xquery|where|version|variable|union|typeswitch|treat|to|then|text|stable|sortby|some|self|schema|satisfies|returns|return|ref|processing-instruction|preceding-sibling|preceding|precedes|parent|only|of|node|namespace|module|let|item|intersect|instance|in|import|if|function|for|follows|following-sibling|following|external|except|every|else|element|descending|descendant-or-self|descendant|define|default|declare|comment|child|cast|case|before|attribute|assert|ascending|as|ancestor-or-self|ancestor|after|eq|order|by|or|and|schema-element|document-node|node|at)\b/],[PR.PR_TYPE,/^(?:xs:yearMonthDuration|xs:unsignedLong|xs:time|xs:string|xs:short|xs:QName|xs:Name|xs:long|xs:integer|xs:int|xs:gYearMonth|xs:gYear|xs:gMonthDay|xs:gDay|xs:float|xs:duration|xs:double|xs:decimal|xs:dayTimeDuration|xs:dateTime|xs:date|xs:byte|xs:boolean|xs:anyURI|xf:yearMonthDuration)\b/,null],[PR_FUNCTION,/^(?:xp:dereference|xinc:node-expand|xinc:link-references|xinc:link-expand|xhtml:restructure|xhtml:clean|xhtml:add-lists|xdmp:zip-manifest|xdmp:zip-get|xdmp:zip-create|xdmp:xquery-version|xdmp:word-convert|xdmp:with-namespaces|xdmp:version|xdmp:value|xdmp:user-roles|xdmp:user-last-login|xdmp:user|xdmp:url-encode|xdmp:url-decode|xdmp:uri-is-file|xdmp:uri-format|xdmp:uri-content-type|xdmp:unquote|xdmp:unpath|xdmp:triggers-database|xdmp:trace|xdmp:to-json|xdmp:tidy|xdmp:subbinary|xdmp:strftime|xdmp:spawn-in|xdmp:spawn|xdmp:sleep|xdmp:shutdown|xdmp:set-session-field|xdmp:set-response-encoding|xdmp:set-response-content-type|xdmp:set-response-code|xdmp:set-request-time-limit|xdmp:set|xdmp:servers|xdmp:server-status|xdmp:server-name|xdmp:server|xdmp:security-database|xdmp:security-assert|xdmp:schema-database|xdmp:save|xdmp:role-roles|xdmp:role|xdmp:rethrow|xdmp:restart|xdmp:request-timestamp|xdmp:request-status|xdmp:request-cancel|xdmp:request|xdmp:redirect-response|xdmp:random|xdmp:quote|xdmp:query-trace|xdmp:query-meters|xdmp:product-edition|xdmp:privilege-roles|xdmp:privilege|xdmp:pretty-print|xdmp:powerpoint-convert|xdmp:platform|xdmp:permission|xdmp:pdf-convert|xdmp:path|xdmp:octal-to-integer|xdmp:node-uri|xdmp:node-replace|xdmp:node-kind|xdmp:node-insert-child|xdmp:node-insert-before|xdmp:node-insert-after|xdmp:node-delete|xdmp:node-database|xdmp:mul64|xdmp:modules-root|xdmp:modules-database|xdmp:merging|xdmp:merge-cancel|xdmp:merge|xdmp:md5|xdmp:logout|xdmp:login|xdmp:log-level|xdmp:log|xdmp:lock-release|xdmp:lock-acquire|xdmp:load|xdmp:invoke-in|xdmp:invoke|xdmp:integer-to-octal|xdmp:integer-to-hex|xdmp:http-put|xdmp:http-post|xdmp:http-options|xdmp:http-head|xdmp:http-get|xdmp:http-delete|xdmp:hosts|xdmp:host-status|xdmp:host-name|xdmp:host|xdmp:hex-to-integer|xdmp:hash64|xdmp:hash32|xdmp:has-privilege|xdmp:groups|xdmp:group-serves|xdmp:group-servers|xdmp:group-name|xdmp:group-hosts|xdmp:group|xdmp:get-session-field-names|xdmp:get-session-field|xdmp:get-response-encoding|xdmp:get-response-code|xdmp:get-request-username|xdmp:get-request-user|xdmp:get-request-url|xdmp:get-request-protocol|xdmp:get-request-path|xdmp:get-request-method|xdmp:get-request-header-names|xdmp:get-request-header|xdmp:get-request-field-names|xdmp:get-request-field-filename|xdmp:get-request-field-content-type|xdmp:get-request-field|xdmp:get-request-client-certificate|xdmp:get-request-client-address|xdmp:get-request-body|xdmp:get-current-user|xdmp:get-current-roles|xdmp:get|xdmp:function-name|xdmp:function-module|xdmp:function|xdmp:from-json|xdmp:forests|xdmp:forest-status|xdmp:forest-restore|xdmp:forest-restart|xdmp:forest-name|xdmp:forest-delete|xdmp:forest-databases|xdmp:forest-counts|xdmp:forest-clear|xdmp:forest-backup|xdmp:forest|xdmp:filesystem-file|xdmp:filesystem-directory|xdmp:exists|xdmp:excel-convert|xdmp:eval-in|xdmp:eval|xdmp:estimate|xdmp:email|xdmp:element-content-type|xdmp:elapsed-time|xdmp:document-set-quality|xdmp:document-set-property|xdmp:document-set-properties|xdmp:document-set-permissions|xdmp:document-set-collections|xdmp:document-remove-properties|xdmp:document-remove-permissions|xdmp:document-remove-collections|xdmp:document-properties|xdmp:document-locks|xdmp:document-load|xdmp:document-insert|xdmp:document-get-quality|xdmp:document-get-properties|xdmp:document-get-permissions|xdmp:document-get-collections|xdmp:document-get|xdmp:document-forest|xdmp:document-delete|xdmp:document-add-properties|xdmp:document-add-permissions|xdmp:document-add-collections|xdmp:directory-properties|xdmp:directory-locks|xdmp:directory-delete|xdmp:directory-create|xdmp:directory|xdmp:diacritic-less|xdmp:describe|xdmp:default-permissions|xdmp:default-collections|xdmp:databases|xdmp:database-restore-validate|xdmp:database-restore-status|xdmp:database-restore-cancel|xdmp:database-restore|xdmp:database-name|xdmp:database-forests|xdmp:database-backup-validate|xdmp:database-backup-status|xdmp:database-backup-purge|xdmp:database-backup-cancel|xdmp:database-backup|xdmp:database|xdmp:collection-properties|xdmp:collection-locks|xdmp:collection-delete|xdmp:collation-canonical-uri|xdmp:castable-as|xdmp:can-grant-roles|xdmp:base64-encode|xdmp:base64-decode|xdmp:architecture|xdmp:apply|xdmp:amp-roles|xdmp:amp|xdmp:add64|xdmp:add-response-header|xdmp:access|trgr:trigger-set-recursive|trgr:trigger-set-permissions|trgr:trigger-set-name|trgr:trigger-set-module|trgr:trigger-set-event|trgr:trigger-set-description|trgr:trigger-remove-permissions|trgr:trigger-module|trgr:trigger-get-permissions|trgr:trigger-enable|trgr:trigger-disable|trgr:trigger-database-online-event|trgr:trigger-data-event|trgr:trigger-add-permissions|trgr:remove-trigger|trgr:property-content|trgr:pre-commit|trgr:post-commit|trgr:get-trigger-by-id|trgr:get-trigger|trgr:document-scope|trgr:document-content|trgr:directory-scope|trgr:create-trigger|trgr:collection-scope|trgr:any-property-content|thsr:set-entry|thsr:remove-term|thsr:remove-synonym|thsr:remove-entry|thsr:query-lookup|thsr:lookup|thsr:load|thsr:insert|thsr:expand|thsr:add-synonym|spell:suggest-detailed|spell:suggest|spell:remove-word|spell:make-dictionary|spell:load|spell:levenshtein-distance|spell:is-correct|spell:insert|spell:double-metaphone|spell:add-word|sec:users-collection|sec:user-set-roles|sec:user-set-password|sec:user-set-name|sec:user-set-description|sec:user-set-default-permissions|sec:user-set-default-collections|sec:user-remove-roles|sec:user-privileges|sec:user-get-roles|sec:user-get-description|sec:user-get-default-permissions|sec:user-get-default-collections|sec:user-doc-permissions|sec:user-doc-collections|sec:user-add-roles|sec:unprotect-collection|sec:uid-for-name|sec:set-realm|sec:security-version|sec:security-namespace|sec:security-installed|sec:security-collection|sec:roles-collection|sec:role-set-roles|sec:role-set-name|sec:role-set-description|sec:role-set-default-permissions|sec:role-set-default-collections|sec:role-remove-roles|sec:role-privileges|sec:role-get-roles|sec:role-get-description|sec:role-get-default-permissions|sec:role-get-default-collections|sec:role-doc-permissions|sec:role-doc-collections|sec:role-add-roles|sec:remove-user|sec:remove-role-from-users|sec:remove-role-from-role|sec:remove-role-from-privileges|sec:remove-role-from-amps|sec:remove-role|sec:remove-privilege|sec:remove-amp|sec:protect-collection|sec:privileges-collection|sec:privilege-set-roles|sec:privilege-set-name|sec:privilege-remove-roles|sec:privilege-get-roles|sec:privilege-add-roles|sec:priv-doc-permissions|sec:priv-doc-collections|sec:get-user-names|sec:get-unique-elem-id|sec:get-role-names|sec:get-role-ids|sec:get-privilege|sec:get-distinct-permissions|sec:get-collection|sec:get-amp|sec:create-user-with-role|sec:create-user|sec:create-role|sec:create-privilege|sec:create-amp|sec:collections-collection|sec:collection-set-permissions|sec:collection-remove-permissions|sec:collection-get-permissions|sec:collection-add-permissions|sec:check-admin|sec:amps-collection|sec:amp-set-roles|sec:amp-remove-roles|sec:amp-get-roles|sec:amp-doc-permissions|sec:amp-doc-collections|sec:amp-add-roles|search:unparse|search:suggest|search:snippet|search:search|search:resolve-nodes|search:resolve|search:remove-constraint|search:parse|search:get-default-options|search:estimate|search:check-options|prof:value|prof:reset|prof:report|prof:invoke|prof:eval|prof:enable|prof:disable|prof:allowed|ppt:clean|pki:template-set-request|pki:template-set-name|pki:template-set-key-type|pki:template-set-key-options|pki:template-set-description|pki:template-in-use|pki:template-get-version|pki:template-get-request|pki:template-get-name|pki:template-get-key-type|pki:template-get-key-options|pki:template-get-id|pki:template-get-description|pki:need-certificate|pki:is-temporary|pki:insert-trusted-certificates|pki:insert-template|pki:insert-signed-certificates|pki:insert-certificate-revocation-list|pki:get-trusted-certificate-ids|pki:get-template-ids|pki:get-template-certificate-authority|pki:get-template-by-name|pki:get-template|pki:get-pending-certificate-requests-xml|pki:get-pending-certificate-requests-pem|pki:get-pending-certificate-request|pki:get-certificates-for-template-xml|pki:get-certificates-for-template|pki:get-certificates|pki:get-certificate-xml|pki:get-certificate-pem|pki:get-certificate|pki:generate-temporary-certificate-if-necessary|pki:generate-temporary-certificate|pki:generate-template-certificate-authority|pki:generate-certificate-request|pki:delete-template|pki:delete-certificate|pki:create-template|pdf:make-toc|pdf:insert-toc-headers|pdf:get-toc|pdf:clean|p:status-transition|p:state-transition|p:remove|p:pipelines|p:insert|p:get-by-id|p:get|p:execute|p:create|p:condition|p:collection|p:action|ooxml:runs-merge|ooxml:package-uris|ooxml:package-parts-insert|ooxml:package-parts|msword:clean|mcgm:polygon|mcgm:point|mcgm:geospatial-query-from-elements|mcgm:geospatial-query|mcgm:circle|math:tanh|math:tan|math:sqrt|math:sinh|math:sin|math:pow|math:modf|math:log10|math:log|math:ldexp|math:frexp|math:fmod|math:floor|math:fabs|math:exp|math:cosh|math:cos|math:ceil|math:atan2|math:atan|math:asin|math:acos|map:put|map:map|map:keys|map:get|map:delete|map:count|map:clear|lnk:to|lnk:remove|lnk:insert|lnk:get|lnk:from|lnk:create|kml:polygon|kml:point|kml:interior-polygon|kml:geospatial-query-from-elements|kml:geospatial-query|kml:circle|kml:box|gml:polygon|gml:point|gml:interior-polygon|gml:geospatial-query-from-elements|gml:geospatial-query|gml:circle|gml:box|georss:point|georss:geospatial-query|georss:circle|geo:polygon|geo:point|geo:interior-polygon|geo:geospatial-query-from-elements|geo:geospatial-query|geo:circle|geo:box|fn:zero-or-one|fn:years-from-duration|fn:year-from-dateTime|fn:year-from-date|fn:upper-case|fn:unordered|fn:true|fn:translate|fn:trace|fn:tokenize|fn:timezone-from-time|fn:timezone-from-dateTime|fn:timezone-from-date|fn:sum|fn:subtract-dateTimes-yielding-yearMonthDuration|fn:subtract-dateTimes-yielding-dayTimeDuration|fn:substring-before|fn:substring-after|fn:substring|fn:subsequence|fn:string-to-codepoints|fn:string-pad|fn:string-length|fn:string-join|fn:string|fn:static-base-uri|fn:starts-with|fn:seconds-from-time|fn:seconds-from-duration|fn:seconds-from-dateTime|fn:round-half-to-even|fn:round|fn:root|fn:reverse|fn:resolve-uri|fn:resolve-QName|fn:replace|fn:remove|fn:QName|fn:prefix-from-QName|fn:position|fn:one-or-more|fn:number|fn:not|fn:normalize-unicode|fn:normalize-space|fn:node-name|fn:node-kind|fn:nilled|fn:namespace-uri-from-QName|fn:namespace-uri-for-prefix|fn:namespace-uri|fn:name|fn:months-from-duration|fn:month-from-dateTime|fn:month-from-date|fn:minutes-from-time|fn:minutes-from-duration|fn:minutes-from-dateTime|fn:min|fn:max|fn:matches|fn:lower-case|fn:local-name-from-QName|fn:local-name|fn:last|fn:lang|fn:iri-to-uri|fn:insert-before|fn:index-of|fn:in-scope-prefixes|fn:implicit-timezone|fn:idref|fn:id|fn:hours-from-time|fn:hours-from-duration|fn:hours-from-dateTime|fn:floor|fn:false|fn:expanded-QName|fn:exists|fn:exactly-one|fn:escape-uri|fn:escape-html-uri|fn:error|fn:ends-with|fn:encode-for-uri|fn:empty|fn:document-uri|fn:doc-available|fn:doc|fn:distinct-values|fn:distinct-nodes|fn:default-collation|fn:deep-equal|fn:days-from-duration|fn:day-from-dateTime|fn:day-from-date|fn:data|fn:current-time|fn:current-dateTime|fn:current-date|fn:count|fn:contains|fn:concat|fn:compare|fn:collection|fn:codepoints-to-string|fn:codepoint-equal|fn:ceiling|fn:boolean|fn:base-uri|fn:avg|fn:adjust-time-to-timezone|fn:adjust-dateTime-to-timezone|fn:adjust-date-to-timezone|fn:abs|feed:unsubscribe|feed:subscription|feed:subscribe|feed:request|feed:item|feed:description|excel:clean|entity:enrich|dom:set-pipelines|dom:set-permissions|dom:set-name|dom:set-evaluation-context|dom:set-domain-scope|dom:set-description|dom:remove-pipeline|dom:remove-permissions|dom:remove|dom:get|dom:evaluation-context|dom:domains|dom:domain-scope|dom:create|dom:configuration-set-restart-user|dom:configuration-set-permissions|dom:configuration-set-evaluation-context|dom:configuration-set-default-domain|dom:configuration-get|dom:configuration-create|dom:collection|dom:add-pipeline|dom:add-permissions|dls:retention-rules|dls:retention-rule-remove|dls:retention-rule-insert|dls:retention-rule|dls:purge|dls:node-expand|dls:link-references|dls:link-expand|dls:documents-query|dls:document-versions-query|dls:document-version-uri|dls:document-version-query|dls:document-version-delete|dls:document-version-as-of|dls:document-version|dls:document-update|dls:document-unmanage|dls:document-set-quality|dls:document-set-property|dls:document-set-properties|dls:document-set-permissions|dls:document-set-collections|dls:document-retention-rules|dls:document-remove-properties|dls:document-remove-permissions|dls:document-remove-collections|dls:document-purge|dls:document-manage|dls:document-is-managed|dls:document-insert-and-manage|dls:document-include-query|dls:document-history|dls:document-get-permissions|dls:document-extract-part|dls:document-delete|dls:document-checkout-status|dls:document-checkout|dls:document-checkin|dls:document-add-properties|dls:document-add-permissions|dls:document-add-collections|dls:break-checkout|dls:author-query|dls:as-of-query|dbk:convert|dbg:wait|dbg:value|dbg:stopped|dbg:stop|dbg:step|dbg:status|dbg:stack|dbg:out|dbg:next|dbg:line|dbg:invoke|dbg:function|dbg:finish|dbg:expr|dbg:eval|dbg:disconnect|dbg:detach|dbg:continue|dbg:connect|dbg:clear|dbg:breakpoints|dbg:break|dbg:attached|dbg:attach|cvt:save-converted-documents|cvt:part-uri|cvt:destination-uri|cvt:basepath|cvt:basename|cts:words|cts:word-query-weight|cts:word-query-text|cts:word-query-options|cts:word-query|cts:word-match|cts:walk|cts:uris|cts:uri-match|cts:train|cts:tokenize|cts:thresholds|cts:stem|cts:similar-query-weight|cts:similar-query-nodes|cts:similar-query|cts:shortest-distance|cts:search|cts:score|cts:reverse-query-weight|cts:reverse-query-nodes|cts:reverse-query|cts:remainder|cts:registered-query-weight|cts:registered-query-options|cts:registered-query-ids|cts:registered-query|cts:register|cts:query|cts:quality|cts:properties-query-query|cts:properties-query|cts:polygon-vertices|cts:polygon|cts:point-longitude|cts:point-latitude|cts:point|cts:or-query-queries|cts:or-query|cts:not-query-weight|cts:not-query-query|cts:not-query|cts:near-query-weight|cts:near-query-queries|cts:near-query-options|cts:near-query-distance|cts:near-query|cts:highlight|cts:geospatial-co-occurrences|cts:frequency|cts:fitness|cts:field-words|cts:field-word-query-weight|cts:field-word-query-text|cts:field-word-query-options|cts:field-word-query-field-name|cts:field-word-query|cts:field-word-match|cts:entity-highlight|cts:element-words|cts:element-word-query-weight|cts:element-word-query-text|cts:element-word-query-options|cts:element-word-query-element-name|cts:element-word-query|cts:element-word-match|cts:element-values|cts:element-value-ranges|cts:element-value-query-weight|cts:element-value-query-text|cts:element-value-query-options|cts:element-value-query-element-name|cts:element-value-query|cts:element-value-match|cts:element-value-geospatial-co-occurrences|cts:element-value-co-occurrences|cts:element-range-query-weight|cts:element-range-query-value|cts:element-range-query-options|cts:element-range-query-operator|cts:element-range-query-element-name|cts:element-range-query|cts:element-query-query|cts:element-query-element-name|cts:element-query|cts:element-pair-geospatial-values|cts:element-pair-geospatial-value-match|cts:element-pair-geospatial-query-weight|cts:element-pair-geospatial-query-region|cts:element-pair-geospatial-query-options|cts:element-pair-geospatial-query-longitude-name|cts:element-pair-geospatial-query-latitude-name|cts:element-pair-geospatial-query-element-name|cts:element-pair-geospatial-query|cts:element-pair-geospatial-boxes|cts:element-geospatial-values|cts:element-geospatial-value-match|cts:element-geospatial-query-weight|cts:element-geospatial-query-region|cts:element-geospatial-query-options|cts:element-geospatial-query-element-name|cts:element-geospatial-query|cts:element-geospatial-boxes|cts:element-child-geospatial-values|cts:element-child-geospatial-value-match|cts:element-child-geospatial-query-weight|cts:element-child-geospatial-query-region|cts:element-child-geospatial-query-options|cts:element-child-geospatial-query-element-name|cts:element-child-geospatial-query-child-name|cts:element-child-geospatial-query|cts:element-child-geospatial-boxes|cts:element-attribute-words|cts:element-attribute-word-query-weight|cts:element-attribute-word-query-text|cts:element-attribute-word-query-options|cts:element-attribute-word-query-element-name|cts:element-attribute-word-query-attribute-name|cts:element-attribute-word-query|cts:element-attribute-word-match|cts:element-attribute-values|cts:element-attribute-value-ranges|cts:element-attribute-value-query-weight|cts:element-attribute-value-query-text|cts:element-attribute-value-query-options|cts:element-attribute-value-query-element-name|cts:element-attribute-value-query-attribute-name|cts:element-attribute-value-query|cts:element-attribute-value-match|cts:element-attribute-value-geospatial-co-occurrences|cts:element-attribute-value-co-occurrences|cts:element-attribute-range-query-weight|cts:element-attribute-range-query-value|cts:element-attribute-range-query-options|cts:element-attribute-range-query-operator|cts:element-attribute-range-query-element-name|cts:element-attribute-range-query-attribute-name|cts:element-attribute-range-query|cts:element-attribute-pair-geospatial-values|cts:element-attribute-pair-geospatial-value-match|cts:element-attribute-pair-geospatial-query-weight|cts:element-attribute-pair-geospatial-query-region|cts:element-attribute-pair-geospatial-query-options|cts:element-attribute-pair-geospatial-query-longitude-name|cts:element-attribute-pair-geospatial-query-latitude-name|cts:element-attribute-pair-geospatial-query-element-name|cts:element-attribute-pair-geospatial-query|cts:element-attribute-pair-geospatial-boxes|cts:document-query-uris|cts:document-query|cts:distance|cts:directory-query-uris|cts:directory-query-depth|cts:directory-query|cts:destination|cts:deregister|cts:contains|cts:confidence|cts:collections|cts:collection-query-uris|cts:collection-query|cts:collection-match|cts:classify|cts:circle-radius|cts:circle-center|cts:circle|cts:box-west|cts:box-south|cts:box-north|cts:box-east|cts:box|cts:bearing|cts:arc-intersection|cts:and-query-queries|cts:and-query-options|cts:and-query|cts:and-not-query-positive-query|cts:and-not-query-negative-query|cts:and-not-query|css:get|css:convert|cpf:success|cpf:failure|cpf:document-set-state|cpf:document-set-processing-status|cpf:document-set-last-updated|cpf:document-set-error|cpf:document-get-state|cpf:document-get-processing-status|cpf:document-get-last-updated|cpf:document-get-error|cpf:check-transition|alert:spawn-matching-actions|alert:rule-user-id-query|alert:rule-set-user-id|alert:rule-set-query|alert:rule-set-options|alert:rule-set-name|alert:rule-set-description|alert:rule-set-action|alert:rule-remove|alert:rule-name-query|alert:rule-insert|alert:rule-id-query|alert:rule-get-user-id|alert:rule-get-query|alert:rule-get-options|alert:rule-get-name|alert:rule-get-id|alert:rule-get-description|alert:rule-get-action|alert:rule-action-query|alert:remove-triggers|alert:make-rule|alert:make-log-action|alert:make-config|alert:make-action|alert:invoke-matching-actions|alert:get-my-rules|alert:get-all-rules|alert:get-actions|alert:find-matching-rules|alert:create-triggers|alert:config-set-uri|alert:config-set-trigger-ids|alert:config-set-options|alert:config-set-name|alert:config-set-description|alert:config-set-cpf-domain-names|alert:config-set-cpf-domain-ids|alert:config-insert|alert:config-get-uri|alert:config-get-trigger-ids|alert:config-get-options|alert:config-get-name|alert:config-get-id|alert:config-get-description|alert:config-get-cpf-domain-names|alert:config-get-cpf-domain-ids|alert:config-get|alert:config-delete|alert:action-set-options|alert:action-set-name|alert:action-set-module-root|alert:action-set-module-db|alert:action-set-module|alert:action-set-description|alert:action-remove|alert:action-insert|alert:action-get-options|alert:action-get-name|alert:action-get-module-root|alert:action-get-module-db|alert:action-get-module|alert:action-get-description|zero-or-one|years-from-duration|year-from-dateTime|year-from-date|upper-case|unordered|true|translate|trace|tokenize|timezone-from-time|timezone-from-dateTime|timezone-from-date|sum|subtract-dateTimes-yielding-yearMonthDuration|subtract-dateTimes-yielding-dayTimeDuration|substring-before|substring-after|substring|subsequence|string-to-codepoints|string-pad|string-length|string-join|string|static-base-uri|starts-with|seconds-from-time|seconds-from-duration|seconds-from-dateTime|round-half-to-even|round|root|reverse|resolve-uri|resolve-QName|replace|remove|QName|prefix-from-QName|position|one-or-more|number|not|normalize-unicode|normalize-space|node-name|node-kind|nilled|namespace-uri-from-QName|namespace-uri-for-prefix|namespace-uri|name|months-from-duration|month-from-dateTime|month-from-date|minutes-from-time|minutes-from-duration|minutes-from-dateTime|min|max|matches|lower-case|local-name-from-QName|local-name|last|lang|iri-to-uri|insert-before|index-of|in-scope-prefixes|implicit-timezone|idref|id|hours-from-time|hours-from-duration|hours-from-dateTime|floor|false|expanded-QName|exists|exactly-one|escape-uri|escape-html-uri|error|ends-with|encode-for-uri|empty|document-uri|doc-available|doc|distinct-values|distinct-nodes|default-collation|deep-equal|days-from-duration|day-from-dateTime|day-from-date|data|current-time|current-dateTime|current-date|count|contains|concat|compare|collection|codepoints-to-string|codepoint-equal|ceiling|boolean|base-uri|avg|adjust-time-to-timezone|adjust-dateTime-to-timezone|adjust-date-to-timezone|abs)\b/],[PR.PR_PLAIN,/^[A-Za-z0-9_\-\:]+/],[PR.PR_PLAIN,/^[\t\n\r \xA0]+/]]),["xq","xquery"]),PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PUNCTUATION,/^[:|>?]+/,null,":|>?"],[PR.PR_DECLARATION,/^%(?:YAML|TAG)[^#\r\n]+/,null,"%"],[PR.PR_TYPE,/^[&]\S+/,null,"&"],[PR.PR_TYPE,/^!\S*/,null,"!"],[PR.PR_STRING,/^"(?:[^\\"]|\\.)*(?:"|$)/,null,'"'],[PR.PR_STRING,/^'(?:[^']|'')*(?:'|$)/,null,"'"],[PR.PR_COMMENT,/^#[^\r\n]*/,null,"#"],[PR.PR_PLAIN,/^\s+/,null," 	\r\n"]],[[PR.PR_DECLARATION,/^(?:---|\.\.\.)(?:[\r\n]|$)/],[PR.PR_PUNCTUATION,/^-/],[PR.PR_KEYWORD,/^\w+:[ \r\n]/],[PR.PR_PLAIN,/^\w+/]]),["yaml","yml"]),/*!
 * jQuery UI Widget 1.10.4+amd
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */
function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){var n=0,r=Array.prototype.slice,o=t.cleanData;t.cleanData=function(e){for(var n,r=0;null!=(n=e[r]);r++)try{t(n).triggerHandler("remove")}catch(i){}o(e)},t.widget=function(e,n,r){var o,i,s,a,l={},u=e.split(".")[0];e=e.split(".")[1],o=u+"-"+e,r||(r=n,n=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[u]=t[u]||{},i=t[u][e],s=t[u][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new s(t,e)},t.extend(s,i,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),a=new n,a.options=t.widget.extend({},a.options),t.each(r,function(e,r){return t.isFunction(r)?(l[e]=function(){var t=function(){return n.prototype[e].apply(this,arguments)},o=function(t){return n.prototype[e].apply(this,t)};return function(){var e,n=this._super,i=this._superApply;return this._super=t,this._superApply=o,e=r.apply(this,arguments),this._super=n,this._superApply=i,e}}(),void 0):(l[e]=r,void 0)
}),s.prototype=t.widget.extend(a,{widgetEventPrefix:i?a.widgetEventPrefix||e:e},l,{constructor:s,namespace:u,widgetName:e,widgetFullName:o}),i?(t.each(i._childConstructors,function(e,n){var r=n.prototype;t.widget(r.namespace+"."+r.widgetName,s,n._proto)}),delete i._childConstructors):n._childConstructors.push(s),t.widget.bridge(e,s)},t.widget.extend=function(n){for(var o,i,s=r.call(arguments,1),a=0,l=s.length;l>a;a++)for(o in s[a])i=s[a][o],s[a].hasOwnProperty(o)&&i!==e&&(n[o]=t.isPlainObject(i)?t.isPlainObject(n[o])?t.widget.extend({},n[o],i):t.widget.extend({},i):i);return n},t.widget.bridge=function(n,o){var i=o.prototype.widgetFullName||n;t.fn[n]=function(s){var a="string"==typeof s,l=r.call(arguments,1),u=this;return s=!a&&l.length?t.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var r,o=t.data(this,i);return o?t.isFunction(o[s])&&"_"!==s.charAt(0)?(r=o[s].apply(o,l),r!==o&&r!==e?(u=r&&r.jquery?u.pushStack(r.get()):r,!1):void 0):t.error("no such method '"+s+"' for "+n+" widget instance"):t.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+s+"'")
}):this.each(function(){var e=t.data(this,i);e?e.option(s||{})._init():t.data(this,i,new o(s,this))}),u}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,r){r=t(r||this.defaultElement||this)[0],this.element=t(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),r!==this&&(t.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===r&&this.destroy()}}),this.document=t(r.style?r.ownerDocument:r.document||r),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")
},_destroy:t.noop,widget:function(){return this.element},option:function(n,r){var o,i,s,a=n;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof n)if(a={},o=n.split("."),n=o.shift(),o.length){for(i=a[n]=t.widget.extend({},this.options[n]),s=0;s<o.length-1;s++)i[o[s]]=i[o[s]]||{},i=i[o[s]];if(n=o.pop(),1===arguments.length)return i[n]===e?null:i[n];i[n]=r}else{if(1===arguments.length)return this.options[n]===e?null:this.options[n];a[n]=r}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,n,r){var o,i=this;"boolean"!=typeof e&&(r=n,n=e,e=!1),r?(n=o=t(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,o=this.widget()),t.each(r,function(r,s){function a(){return e||i.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?i[s]:s).apply(i,arguments):void 0
}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var l=r.match(/^(\w+)\s*(.*)$/),u=l[1]+i.eventNamespace,c=l[2];c?o.delegate(c,u,a):n.bind(u,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function n(){return("string"==typeof t?r[t]:t).apply(r,arguments)}var r=this;return setTimeout(n,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,n,r){var o,i,s=this.options[e];if(r=r||{},n=t.Event(n),n.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],i=n.originalEvent)for(o in i)o in n||(n[o]=i[o]);
return this.element.trigger(n,r),!(t.isFunction(s)&&s.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,n){t.Widget.prototype["_"+e]=function(r,o,i){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?n:o.effect||n:e;o=o||{},"number"==typeof o&&(o={duration:o}),s=!t.isEmptyObject(o),o.complete=i,o.delay&&r.delay(o.delay),s&&t.effects&&t.effects.effect[a]?r[e](o):a!==e&&r[a]?r[a](o.duration,o.easing,i):r.queue(function(n){t(this)[e](),i&&i.call(r[0]),n()})}})}),/*
 * jQuery Iframe Transport Plugin 1.8.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e=0;t.ajaxTransport("iframe",function(n){if(n.async){var r,o,i,s=n.initialIframeSrc||"javascript:false;";return{send:function(a,l){r=t('<form style="display:none;"></form>'),r.attr("accept-charset",n.formAcceptCharset),i=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+i+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+i+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+i+"_method=PATCH",n.type="POST"),e+=1,o=t('<iframe src="'+s+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,i=t.isArray(n.paramName)?n.paramName:[n.paramName];o.unbind("load").bind("load",function(){var e;try{if(e=o.contents(),!e.length||!e[0].firstChild)throw new Error}catch(n){e=void 0}l(200,"success",{iframe:e}),t('<iframe src="'+s+'"></iframe>').appendTo(r),window.setTimeout(function(){r.remove()},0)}),r.prop("target",o.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&t.each(n.formData,function(e,n){t('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(r)
}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(e=n.fileInput.clone(),n.fileInput.after(function(t){return e[t]}),n.paramName&&n.fileInput.each(function(e){t(this).prop("name",i[e]||n.paramName)}),r.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),r.submit(),e&&e.length&&n.fileInput.each(function(n,r){var o=t(e[n]);t(r).prop("name",o.prop("name")).attr("form",o.attr("form")),o.replaceWith(r)})}),r.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src",s),r&&r.remove()}}}}),t.ajaxSetup({converters:{"iframe text":function(e){return e&&t(e[0].body).text()},"iframe json":function(e){return e&&t.parseJSON(t(e[0].body).text())},"iframe html":function(e){return e&&t(e[0].body).html()},"iframe xml":function(e){var n=e&&e[0];return n&&t.isXMLDoc(n)?n:t.parseXML(n.XMLDocument&&n.XMLDocument.xml||t(n.body).html())},"iframe script":function(e){return e&&t.globalEval(t(e[0].body).text())}}})}),/*
 * jQuery File Upload Plugin 5.40.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function(t){"use strict";t.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||t('<input type="file">').prop("disabled")),t.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.widget("blueimp.fileupload",{options:{dropZone:t(document),pasteZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,n){return e=this.messages[e]||e.toString(),n&&t.each(n,function(t,n){e=e.replace("{"+t+"}",n)
}),e},formData:function(t){return t.serializeArray()},add:function(e,n){return e.isDefaultPrevented()?!1:((n.autoUpload||n.autoUpload!==!1&&t(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()}),void 0)},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:t.support.blobSlice&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,n){var r=t-this.timestamp;return(!this.bitrate||!n||r>n)&&(this.bitrate=(e-this.loaded)*(1e3/r)*8,this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var n;return"function"===t.type(e.formData)?e.formData(e.form):t.isArray(e.formData)?e.formData:"object"===t.type(e.formData)?(n=[],t.each(e.formData,function(t,e){n.push({name:t,value:e})
}),n):[]},_getTotal:function(e){var n=0;return t.each(e,function(t,e){n+=e.size||1}),n},_initProgressObject:function(e){var n={loaded:0,total:0,bitrate:0};e._progress?t.extend(e._progress,n):e._progress=n},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(e,n){if(e.lengthComputable){var r,o=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&o-n._time<n.progressInterval&&e.loaded!==e.total)return;n._time=o,r=Math.floor(e.loaded/e.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=r-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(o,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=r,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(o,r,n.bitrateInterval),this._trigger("progress",t.Event("progress",{delegatedEvent:e}),n),this._trigger("progressall",t.Event("progressall",{delegatedEvent:e}),this._progress)
}},_initProgressListener:function(e){var n=this,r=e.xhr?e.xhr():t.ajaxSettings.xhr();r.upload&&(t(r.upload).bind("progress",function(t){var r=t.originalEvent;t.lengthComputable=r.lengthComputable,t.loaded=r.loaded,t.total=r.total,n._onProgress(t,e)}),e.xhr=function(){return r})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(e){var n,r=this,o=e.files[0],i=e.multipart||!t.support.xhrFileUpload,s="array"===t.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=t.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),i&&!e.blob&&this._isInstanceOf("File",o)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),i?t.support.xhrFormDataFileUpload&&(e.postMessage?(n=this._getFormData(e),e.blob?n.push({name:s,value:e.blob}):t.each(e.files,function(r,o){n.push({name:"array"===t.type(e.paramName)&&e.paramName[r]||s,value:o})})):(r._isInstanceOf("FormData",e.formData)?n=e.formData:(n=new FormData,t.each(this._getFormData(e),function(t,e){n.append(e.name,e.value)
})),e.blob?n.append(s,e.blob,o.name):t.each(e.files,function(o,i){(r._isInstanceOf("File",i)||r._isInstanceOf("Blob",i))&&n.append("array"===t.type(e.paramName)&&e.paramName[o]||s,i,i.uploadName||i.name)})),e.data=n):(e.contentType=o.type||"application/octet-stream",e.data=e.blob||o),e.blob=null},_initIframeSettings:function(e){var n=t("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&n&&n!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(e){var n=t(e.fileInput),r=e.paramName;return r?t.isArray(r)||(r=[r]):(r=[],n.each(function(){for(var e=t(this),n=e.prop("name")||"files[]",o=(e.prop("files")||[1]).length;o;)r.push(n),o-=1}),r.length||(r=[n.prop("name")||"files[]"])),r
},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===t.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var n=t.extend({},this.options,e);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,n,r){var o=t.Deferred(),i=o.promise();return n=n||this.options.context||i,e===!0?o.resolveWith(n,r):e===!1&&o.rejectWith(n,r),i.abort=o.promise,this._enhancePromise(i)},_addConvenienceMethods:function(e,n){var r=this,o=function(e){return t.Deferred().resolveWith(r,e).promise()
};n.process=function(e,i){return(e||i)&&(n._processQueue=this._processQueue=(this._processQueue||o([this])).pipe(function(){return n.errorThrown?t.Deferred().rejectWith(r,[n]).promise():o(arguments)}).pipe(e,i)),this._processQueue||o([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=r._trigger("submit",t.Event("submit",{delegatedEvent:e}),this)!==!1&&r._onSend(e,this)),this.jqXHR||r._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},n.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===r._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),n=e&&e.split("-"),r=n&&n.length>1&&parseInt(n[1],10);
return r&&r+1},_chunkedUpload:function(e,n){e.uploadedBytes=e.uploadedBytes||0;var r,o,i=this,s=e.files[0],a=s.size,l=e.uploadedBytes,u=e.maxChunkSize||a,c=this._blobSlice,p=t.Deferred(),h=p.promise();return this._isXHRUpload(e)&&c&&(l||a>u)&&!e.data?n?!0:l>=a?(s.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",s.error])):(o=function(){var n=t.extend({},e),h=n._progress.loaded;n.blob=c.call(s,l,l+u,s.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+a,i._initXHRData(n),i._initProgressListener(n),r=(i._trigger("chunksend",null,n)!==!1&&t.ajax(n)||i._getXHRPromise(!1,n.context)).done(function(r,s,u){l=i._getUploadedBytes(u)||l+n.chunkSize,h+n.chunkSize-n._progress.loaded&&i._onProgress(t.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),e.uploadedBytes=n.uploadedBytes=l,n.result=r,n.textStatus=s,n.jqXHR=u,i._trigger("chunkdone",null,n),i._trigger("chunkalways",null,n),a>l?o():p.resolveWith(n.context,[r,s,u])}).fail(function(t,e,r){n.jqXHR=t,n.textStatus=e,n.errorThrown=r,i._trigger("chunkfail",null,n),i._trigger("chunkalways",null,n),p.rejectWith(n.context,[t,e,r])
})},this._enhancePromise(h),h.abort=function(){return r.abort()},o(),h):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(e,n,r,o){var i=o._progress.total,s=o._response;o._progress.loaded<i&&this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:i,total:i}),o),s.result=o.result=e,s.textStatus=o.textStatus=n,s.jqXHR=o.jqXHR=r,this._trigger("done",null,o)},_onFail:function(t,e,n,r){var o=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),o.jqXHR=r.jqXHR=t,o.textStatus=r.textStatus=e,o.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)
},_onAlways:function(t,e,n,r){this._trigger("always",null,r)},_onSend:function(e,n){n.submit||this._addConvenienceMethods(e,n);var r,o,i,s,a=this,l=a._getAJAXSettings(n),u=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,r=r||((o||a._trigger("send",t.Event("send",{delegatedEvent:e}),l)===!1)&&a._getXHRPromise(!1,l.context,o)||a._chunkedUpload(l)||t.ajax(l)).done(function(t,e,n){a._onDone(t,e,n,l)}).fail(function(t,e,n){a._onFail(t,e,n,l)}).always(function(t,e,n){if(a._onAlways(t,e,n,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var r=a._slots.shift();r;){if("pending"===a._getDeferredState(r)){r.resolve();break}r=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(i=t.Deferred(),this._slots.push(i),s=i.pipe(u)):(this._sequence=this._sequence.pipe(u,u),s=this._sequence),s.abort=function(){return o=[void 0,"abort","abort"],r?r.abort():(i&&i.rejectWith(l.context,o),u())
},this._enhancePromise(s)):u()},_onAdd:function(e,n){var r,o,i,s,a=this,l=!0,u=t.extend({},this.options,n),c=n.files,p=c.length,h=u.limitMultiFileUploads,d=u.limitMultiFileUploadSize,f=u.limitMultiFileUploadSizeOverhead,m=0,g=this._getParamName(u),y=0;if(!d||p&&void 0!==c[0].size||(d=void 0),(u.singleFileUploads||h||d)&&this._isXHRUpload(u))if(u.singleFileUploads||d||!h)if(!u.singleFileUploads&&d)for(i=[],r=[],s=0;p>s;s+=1)m+=c[s].size+f,(s+1===p||m+c[s+1].size+f>d||h&&s+1-y>=h)&&(i.push(c.slice(y,s+1)),o=g.slice(y,s+1),o.length||(o=g),r.push(o),y=s+1,m=0);else r=g;else for(i=[],r=[],s=0;p>s;s+=h)i.push(c.slice(s,s+h)),o=g.slice(s,s+h),o.length||(o=g),r.push(o);else i=[c],r=[g];return n.originalFiles=c,t.each(i||c,function(o,s){var u=t.extend({},n);return u.files=i?s:[s],u.paramName=r[o],a._initResponseObject(u),a._initProgressObject(u),a._addConvenienceMethods(e,u),l=a._trigger("add",t.Event("add",{delegatedEvent:e}),u)}),l},_replaceFileInput:function(e){var n=e.clone(!0);t("<form></form>").append(n)[0].reset(),e.after(n).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,r){return r===e[0]?n[0]:r
}),e[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(e,n){var r,o=this,i=t.Deferred(),s=function(t){t&&!t.entry&&(t.entry=e),i.resolve([t])};return n=n||"",e.isFile?e._file?(e._file.relativePath=n,i.resolve(e._file)):e.file(function(t){t.relativePath=n,i.resolve(t)},s):e.isDirectory?(r=e.createReader(),r.readEntries(function(t){o._handleFileTreeEntries(t,n+e.name+"/").done(function(t){i.resolve(t)}).fail(s)},s)):i.resolve([]),i.promise()},_handleFileTreeEntries:function(e,n){var r=this;return t.when.apply(t,t.map(e,function(t){return r._handleFileTreeEntry(t,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var n=e.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(t.map(n,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var n,r,o=e.prop("webkitEntries")||e.prop("entries");
if(o&&o.length)return this._handleFileTreeEntries(o);if(n=t.makeArray(e.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&t.each(n,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(r=e.prop("value"),!r)return t.Deferred().resolve([]).promise();n=[{name:r.replace(/^.*\\/,"")}]}return t.Deferred().resolve(n).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var n=this,r={fileInput:t(e.target),form:t(e.target.form)};this._getFileInputFiles(r.fileInput).always(function(o){r.files=o,n.options.replaceFileInput&&n._replaceFileInput(r.fileInput),n._trigger("change",t.Event("change",{delegatedEvent:e}),r)!==!1&&n._onAdd(e,r)})},_onPaste:function(e){var n=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,r={files:[]};n&&n.length&&(t.each(n,function(t,e){var n=e.getAsFile&&e.getAsFile();
n&&r.files.push(n)}),this._trigger("paste",t.Event("paste",{delegatedEvent:e}),r)!==!1&&this._onAdd(e,r))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var n=this,r=e.dataTransfer,o={};r&&r.files&&r.files.length&&(e.preventDefault(),this._getDroppedFiles(r).always(function(r){o.files=r,n._trigger("drop",t.Event("drop",{delegatedEvent:e}),o)!==!1&&n._onAdd(e,o)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var n=e.dataTransfer;n&&-1!==t.inArray("Files",n.types)&&this._trigger("dragover",t.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),n.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),t.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")
},_setOption:function(e,n){var r=-1!==t.inArray(e,this._specialOptions);r&&this._destroyEventHandlers(),this._super(e,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_getRegExp:function(t){var e=t.split("/"),n=e.pop();return e.shift(),new RegExp(e.join("/"),n)},_isRegExpOption:function(e,n){return"url"!==e&&"string"===t.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var e=this,n=this.options,r=t(this.element[0].cloneNode(!1));t.each(r.data(),function(t,o){var i="data-"+t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();r.attr(i)&&(e._isRegExpOption(t,o)&&(o=e._getRegExp(o)),n[t]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()
},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var n=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,n._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var n,r,o=this,i=t.Deferred(),s=i.promise();return s.abort=function(){return r=!0,n?n.abort():(i.reject(null,"abort","abort"),s)},this._getFileInputFiles(e.fileInput).always(function(t){if(!r){if(!t.length)return i.reject(),void 0;e.files=t,n=o._onSend(null,e).then(function(t,e,n){i.resolve(t,e,n)},function(t,e,n){i.reject(t,e,n)})}}),this._enhancePromise(s)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),/*
 * jQuery Hotkeys Plugin
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Based upon the plugin by Tzury Bar Yochay:
 * http://github.com/tzuryby/hotkeys
 *
 * Original idea by:
 * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/
*/
function(t){function e(e){if("string"==typeof e.data){var n=e.handler,r=e.data.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type){var o="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],i=String.fromCharCode(e.which).toLowerCase(),s="",a={};e.altKey&&"alt"!==o&&(s+="alt+"),e.ctrlKey&&"ctrl"!==o&&(s+="ctrl+"),e.metaKey&&!e.ctrlKey&&"meta"!==o&&(s+="meta+"),e.shiftKey&&"shift"!==o&&(s+="shift+"),o?a[s+o]=!0:(a[s+i]=!0,a[s+t.hotkeys.shiftNums[i]]=!0,"shift+"===s&&(a[t.hotkeys.shiftNums[i]]=!0));for(var l=0,u=r.length;u>l;l++)if(a[r[l]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}
})}(jQuery),function(t){function e(t,e){return"function"==typeof t?t.call(e):t}function n(t){for(;t=t.parentNode;)if(t==document)return!0;return!1}function r(e,n){this.$element=t(e),this.options=n,this.enabled=!0,this.fixTitle()}r.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var r=this.tip();r.find(".tipsy-inner")[this.options.html?"html":"text"](n),r[0].className="tipsy",r.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var o,i=t.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),s=r[0].offsetWidth,a=r[0].offsetHeight,l=e(this.options.gravity,this.$element[0]);switch(l.charAt(0)){case"n":o={top:i.top+i.height+this.options.offset,left:i.left+i.width/2-s/2};break;case"s":o={top:i.top-a-this.options.offset,left:i.left+i.width/2-s/2};break;case"e":o={top:i.top+i.height/2-a/2,left:i.left-s-this.options.offset};break;case"w":o={top:i.top+i.height/2-a/2,left:i.left+i.width+this.options.offset}}2==l.length&&(o.left="w"==l.charAt(1)?i.left+i.width/2-15:i.left+i.width/2-s+15),r.css(o).addClass("tipsy-"+l),r.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+l.charAt(0),this.options.className&&r.addClass(e(this.options.className,this.$element[0])),this.options.fade?r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):r.css({visibility:"visible",opacity:this.options.opacity})
}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){t(this).remove()}):this.tip().remove()},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("original-title"))&&t.attr("original-title",t.attr("title")||"").removeAttr("title")},getTitle:function(){var t,e=this.$element,n=this.options;this.fixTitle();var t,n=this.options;return"string"==typeof n.title?t=e.attr("title"==n.title?"original-title":n.title):"function"==typeof n.title&&(t=n.title.call(e[0])),t=(""+t).replace(/(^\s*|\s*$)/,""),t||n.fallback},tip:function(){return this.$tip||(this.$tip=t('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},t.fn.tipsy=function(e){function n(n){var o=t.data(n,"tipsy");
return o||(o=new r(n,t.fn.tipsy.elementOptions(n,e)),t.data(n,"tipsy",o)),o}function o(){var t=n(this);t.hoverState="in",0==e.delayIn?t.show():(t.fixTitle(),setTimeout(function(){"in"==t.hoverState&&s(t.$element)&&t.show()},e.delayIn))}function i(){var t=n(this);t.hoverState="out",0==e.delayOut?t.hide():setTimeout(function(){"out"==t.hoverState&&t.hide()},e.delayOut)}function s(t){return t.closest("body").length>0}if(e===!0)return this.data("tipsy");if("string"==typeof e){var a=this.data("tipsy");return a&&a[e](),this}if(e=t.extend({},t.fn.tipsy.defaults,e),e.live||this.each(function(){n(this)}),"manual"!=e.trigger){var l=e.live?t(this.context):this,u=e.live?this.selector:null,c="hover"==e.trigger?"mouseenter":"focus",p="hover"==e.trigger?"mouseleave":"blur";l.on(c,u,o).on(p,u,i)}return this},t.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},t.fn.tipsy.revalidate=function(){t(".tipsy").each(function(){var e=t.data(this,"tipsy-pointee");
e&&n(e)||t(this).remove()})},t.fn.tipsy.elementOptions=function(e,n){return t.metadata?t.extend({},n,t(e).metadata()):n},t.fn.tipsy.autoNS=function(){return t(this).offset().top>t(document).scrollTop()+t(window).height()/2?"s":"n"},t.fn.tipsy.autoWE=function(){return t(this).offset().left>t(document).scrollLeft()+t(window).width()/2?"e":"w"},t.fn.tipsy.autoBounds=function(e,n){return function(){var r={ns:n[0],ew:n.length>1?n[1]:!1},o=t(document).scrollTop()+e,i=t(document).scrollLeft()+e,s=t(this);return s.offset().top<o&&(r.ns="n"),s.offset().left<i&&(r.ew="w"),t(window).width()+t(document).scrollLeft()-s.offset().left<e&&(r.ew="e"),t(window).height()+t(document).scrollTop()-s.offset().top<e&&(r.ns="s"),r.ns+(r.ew?r.ew:"")}}}(jQuery),function(){window.Flowdock=window.Flowdock||{},window.Views={},window.Models={},window.Collections={},window.Helpers={},window.Presenters={}}.call(this),function(){var t,e,n;_.extend(Helpers,{autoLink:function(t,e){return Helpers.autoLinkEmails(Helpers.autoLinkUrls(Helpers.autoLinkMentions(Helpers.autoLinkHashtags(t,e),e)),e)
},autoLinkEmails:function(n,r){var o,i,s;return o=$("<div>").html(n)[0],s=function(t){return $("<a>").attr({href:"mailto:"+t}).text(t).addClass(r.emailClass||"")[0]},i=t(FlowdockText.extractEmailsWithIndices,s,"email"),e(o,i).innerHTML},autoLinkUrls:function(n,r){var o,i,s;return null==r&&(r={}),o=$("<div>").html(n)[0],s=function(t){var e;return e=/^https?:\/\//.test(t)?"":"http://",$("<a>").attr("href",""+e+t).text(t).addClass("external")[0]},i=t(FlowdockText.extractUrlsWithIndices,s,"url"),e(o,i).innerHTML},autoLinkMentions:function(t,r){var o,i,s,a;return null==r&&(r={}),o=$("<div>").html(t)[0],i=function(t){return FlowdockText.extractMentionsWithIndices(t,r.userTags)},a=function(t){return $("<a>").attr({href:""+r.hashtagUrlBase+t,title:"Search "+t}).text(""+t).addClass(r.hashtagClass)[0]},s=n(i,a),e(o,s).innerHTML},autoLinkHashtags:function(t,r){var o,i,s;return null==r&&(r={}),o=$("<div>").html(t)[0],s=function(t){return $("<a>").attr({href:""+r.hashtagUrlBase+t,title:"#"+t}).text("#"+t).addClass(r.hashtagClass)[0]
},i=n(FlowdockText.extractHashtagsWithIndices,s),e(o,i).innerHTML}}),t=function(t,e,n){return function(r){var o,i,s,a,l,u,c;for(s=r.textContent||r.data,o=t(s),u=o.reverse(),c=[],a=0,l=u.length;l>a;a++)i=u[a],c.push(function(t){var o,i;return i=r.splitText(t.indices[0]),i.splitText(t[n].length),o=e(t[n]),r.parentNode.replaceChild(o,i)}(i));return c}},n=function(t,e){return function(n){var r,o,i,s,a,l,u;for(i=n.textContent||n.data,o=t(i),l=o.reverse(),u=[],s=0,a=l.length;a>s;s++)r=l[s],u.push(function(t){var r,o;return r=n.splitText(t.indices[0]),r.splitText(t.indices[1]-t.indices[0]),o=e(t.tag),n.parentNode.replaceChild(o,r)}(r));return u}},e=function(t,n){var r,o;for(o=0;o<t.childNodes.length;)r=t.childNodes[o],3===r.nodeType?n(r):r.hasChildNodes()&&"A"!==r.nodeName&&e(r,n),o++;return t}}.call(this),function(){var t;t=function(){var t,e,n;return e=["green","red","blue","yellow","purple","teal","orange"],t={},n=function(){var t;return t=e.pop(),e.unshift(t),t},function(e){return t[e]||(t[e]=n())}},Helpers.CommentHelper={flows:{},color:function(e,n){var r,o;
return(r=(o=this.flows)[e]||(o[e]=t(e)))(n)}}}.call(this),function(){Helpers.FileHelper={parseAttachment:function(t){var e;return e={file:{type:this.iconType(t.content_type),path:Helpers.apiUrl(this.escapePath(t.path),!0),size:Helpers.format.bytes(t.file_size),name:t.file_name}},t.thumbnail&&(e.file.type="thumbnailed-image",e.image={width:t.image.width,height:t.image.height},e.thumbnail={path:Helpers.apiUrl(this.escapePath(t.thumbnail.path),!0),width:t.thumbnail.width,height:t.thumbnail.height}),t.rotated&&(e.rotated={path:Helpers.apiUrl(this.escapePath(t.rotated.path),!0)}),e},iconType:function(t){var e,n,r,o,i;return r=function(t,e){var n,r;for(n in e)if(r=e[n],-1!==n.split(",").indexOf(t))return r},e={audio:function(){return"audio"},video:function(){return"video"},image:function(){return"image"},text:function(t){return r(t,{html:"html",css:"css",plain:"text"})},application:function(t){return r(t,{pdf:"pdf",msword:"word",powerpoint:"powerpoint","excel,vnd.ms-excel":"excel","shockwave-flash":"flash","octet-stream":"binary","zip,x-zip,x-tar,x-gzip,x-stuffit":"zip"})
}},i=t.split("/"),o=i[0],n=i[1],("function"==typeof e[o]?e[o](n):void 0)||"document"},escapePath:function(t){var e;return e=_.map(t.split("/"),function(t){return encodeURIComponent(t)}),e.join("/")}}}.call(this),function(){var t=[].slice;_.extend(Helpers,{format:{number:function(e,n){var r,o;return null==n&&(n=2),r=function(e){var r,o,i,s;for(s=e.split("."),o=s[0],n=2<=s.length?t.call(s,1):[],n=function(){var t,e,o;for(o=[],t=0,e=n.length;e>t;t++)r=n[t],o.push("."+r);return o}().join(),i=/(\d+)(\d{3})/;i.test(o);)o=o.replace(i,"$1,$2");return""+o+n},o=Math.pow(10,n),r(String(Math.round(e*o)/o))},pad:function(t,e,n){var r;return null==n&&(n="0"),r=String(t),r.length<e?Helpers.format.pad(n+r,e,n):r},toSentence:function(t){switch(null==t&&(t=[]),t.length){case 0:return"";case 1:return t[0];case 2:return t.join(" and ");default:return t.slice(0,+(t.length-2)+1||9e9).join(", ")+(" and "+_.last(t))}},bytes:function(t){return t>=1e3*Math.pow(2,20)?Helpers.format.number(t/Math.pow(2,30))+" GB":t>=1e3*Math.pow(2,10)?Helpers.format.number(t/Math.pow(2,20))+" MB":Helpers.format.number(t/Math.pow(2,10))+" kB"
}},absoluteUrlFor:function(t){return""+window.location.protocol+"//"+window.location.host+Helpers.urlFor(t)},urlFor:function(t){return""+window.Router.root+Helpers.pathFor(t)},pathFor:function(t){var e,n;return null==t&&(t={}),t.flow?(e=t.flow.path?t.flow.path():t.flow,t.message?""+e+"/inbox/"+(t.message.id||t.message):t.filter&&t.filter.url(t.flow)&&"inbox"!==t.filter.url(t.flow)?""+e+"/filter/"+t.filter.url(t.flow):t.settings?""+e+"/settings/"+t.settings.active:t.renameFlow?""+e+"/rename":e):t["private"]?n=t["private"].id?"private/"+t["private"].id:"private/"+t["private"]:t.createFlow?t.organization?"create-flow/"+t.organization:"create-flow":t.createOrganization?"create-organization":t.showNewTab?"new-tab":t.newPrivateDialog?"new-1-to-1":t.feedback?"feedback":t.preferences?"preferences/"+t.preferences.active:t.iframe?"iframe/"+t.iframe:t.renameFlow?"":""},assetPath:function(t){return Flowdock.assetHost+("/"===t[0]?t:"/"+t)},apiUrl:function(t){var e;return e=Helpers.url.stripHost(t),0===e.indexOf("/rest")?e:"/rest"+e
},url:{stripHost:function(t){var e,n;return e=document.createElement("a"),e.href=t,n=0===e.pathname.indexOf("/")?"":"/",n+e.pathname+e.search+e.hash}},generateQuery:function(t){var e,n,r;n="";for(e in t)r=t[e],n.length>0&&(n+="&"),null!=e&&(n+=""+Helpers.urlEncode(e)+"="+Helpers.encodeValue(r));return n.length>0?"?"+n:""},encodeValue:function(t){return Helpers.urlEncode(t).replace(/%40/g,"@").replace(/%2C/g,",")},parseQuery:function(t){var e;return 0===t.length?{}:(e={},"?"===t[0]&&(t=t.slice(1)),_.each(t.split("&"),function(t){var n,r,o;return o=t.split("=",2),n=o[0],r=o[1],null!=n&&null!=r?e[Helpers.urlDecode(n)]=Helpers.urlDecode(r):void 0}),e)},animationend:function(){var t;return t={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",MsAnimation:"MSAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"},t[Modernizr.prefixed("animation")]},transitionend:function(){var t;return t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MsTransition:"MSTransitionEnd",OTransition:"oTransitionEnd",transition:"transitionend"},t[Modernizr.prefixed("transition")]
},unsafeLink:function(t,e){return t=$("<div/>").text(t).html(),'<a class="external" href="'+e+'">'+t+"</a>"},textSelected:function(){var t;return t=window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:void 0,(null!=t?t.length:void 0)>0},urlDecode:function(t){return null==t?null:decodeURIComponent(t.replace(/\+/g," "))},urlEncode:function(t){return null==t?"":encodeURIComponent(t).replace(/#{" "}/g,"+")},capitalize:function(t){return t.split(" ").map(function(t){return Helpers.capitalizeFirst(t)}).join(" ")},capitalizeFirst:function(t){var e;return t||(t=""),""+((null!=(e=t[0])?e.toUpperCase():void 0)||"")+t.slice(1)},buttonConfirm:function(t,e,n){var r,o;return r=t.html(),o=function(){return t.one(Helpers.transitionend(),function(){return t.hasClass("danger-button")?t.one("click",n):void 0}),t.one("mouseout",function(){return t.removeClass("danger-button").html(r),t.off("click",n),t.one("click",o)}),t.addClass("danger-button").text(e)},t.one("click",o)},selectText:function(t){var e,n;
return e=document.createRange(),e.selectNodeContents(t),n=window.getSelection(),n.removeAllRanges(),n.addRange(e)},clickWithin:function(t,e){var n;return n=$(t.target),n.hasClass(e)||n.parents(e).length>0},confirmDelete:function(){return confirm("Do you want to permanently delete this message?\nWhen deleted, no one will be able to see the message anymore.")}})}.call(this),function(){var t,e;e=/(^|\n)((?:[ ]{4}|\t).*\n?)+/g,t=/(^|\n)(?:[ ]{4}|\t)/g,Helpers.IndentationHelper={indented:function(e){return e.search(t)>=0},formatIndented:function(n){var r;try{return n.replace(e,function(e){var n;return e=e.replace(/^\n/,"").replace(t,function(t,e){return"\n"===e?e:""}),n=SourceDetector.detect(e)?(e=prettyPrintOne(e)," code"):"",0===$.trim(e).length?"":"<pre class='formatted"+n+"' data-no-text-emoji><code>"+e+"</code></pre>"}).replace(/\n/g,"<br />").replace(/[ ]{2}/g," &nbsp;")}catch(o){return r=o,n}},parseEmojies:function(t){var e,n;return n=function(){var n,r,o,i;for(o=t.split("\n"),i=[],n=0,r=o.length;r>n;n++)e=o[n],Helpers.IndentationHelper.indented(e)?i.push(e):i.push(emojimoji(e));
return i}(),n.join("\n")}}}.call(this),function(){Helpers.MailHelper={mailtoUrl:function(t,e,n){var r,o,i,s,a,l,u,c,p,h,d,f;return i="%0A> ",l=encodeURIComponent(t.subject),a=moment(n).format("MMMM D, YYYY (LT)")+", ",s="%0A%0AOn "+a+" "+encodeURIComponent((null!=t?null!=(c=t.from[0])?c.name:void 0:void 0)||(null!=(p=t.from[0])?p.address:void 0))+" wrote:"+i,o=_.isArray(t.content)?t.content[0]:t.content,_.isString(o)?(o=o.replace(/<img /g,"<img src "),r=$("<div />").html(o.replace(/(<br \/>|<br>)/g,"\n")).text(),r=r.replace(/(\r\n|\r|\n|\u0085|\u000C|\u2028|\u2029)/g,i),r=r.replace(new RegExp("^("+i+"\\s*)+"),""),r=r.replace(new RegExp("("+i+"\\s*)+$"),""),r=r.replace(new RegExp("("+i+"\\s*){2,}","g"),i+i),r=encodeURIComponent(r.replace(/\&amp;/g,"&"))):r="",u="reply"===e?(null!=(h=t.replyTo)?null!=(d=h[0])?d.address:void 0:void 0)||(null!=(f=t.from[0])?f.address:void 0):"",l="reply"===e?"Re: "+l:"Fwd: "+l,"mailto:"+u+"?subject="+l+"&body="+s+r.replace(/%250A/g,"%0A")}}}.call(this),function(){Helpers.TagHelper={},Helpers.TagHelper.parseTags=function(t,e){var n,r,o,i,s,a,l,u,c;
return u=function(t){return t.get("nick")&&t.get("nick").length>0&&0!==t.get("id")&&!t.get("disabled")},c=function(t){return t.get("id")===e.me().get("id")},a=[],s=e.me().toJSON(),n=FlowdockText.extractAll(t),l=n.urls,i=n.hashtags,o=n.mentions,i.forEach(function(t){return _.contains(a,t.toLowerCase())?void 0:a.push(t)}),l.length>0&&a.push(":url"),r=FlowdockText.mentionsAll(o),r&&a.push(":user:everyone"),e.users.filter(u).forEach(function(e){var n;return n=!1,e.id!==s.id&&t.match(FlowdockText.regexen.highlightRegex(e.nick()))&&(a.push(":highlight:"+e.id),n=!0),FlowdockText.mentionsUser(o,e.nick())&&(a.push(":user:"+e.id),n=!0),!c(e)&&(n||r&&e.get("in_flow"))?a.push(":unread:"+e.id):void 0}),a.filter(function(t){return"@"!==t[0]})},Helpers.TagHelper.textualize=function(t){return _.compact(t.tags().map(function(t){return t.humanize()})).join(", ")},Helpers.TagHelper.textualizeChange=function(t,e,n){var r,o,i,s;return e||(e=t.previousTags()),o=function(t){return t.filter(function(t){return t.humanize()})},r=o(e.add),s=o(e.remove),i=function(t,e,n){return n.length>0?""+e+" "+n.map(function(t){return t.humanize()
}).join(", "):void 0},r.length>0||s.length>0?_.compact([n.get("nick"),i("add","added",r),i("remove","removed",s)]).join(" "):void 0}}.call(this),function(){var t,e,n;e=function(t){var e,n;return n=moment(t.attr("datetime")),e=n.fromNow(),t.text()!==e?t.text(e):void 0},t=function(t){var e,n;return n=moment(t.attr("datetime")),e=n.format(Helpers.TimeHelper.detailedTimestampOptions(n).textFormat),t.text()!==e?t.text(e):void 0},n=function(t){var e,n;return n=moment(t.attr("datetime")),e=n.format("LLL"),t.text()!==e?t.text(e):void 0},Helpers.TimeHelper={timestamp:function(t,e){return null==e&&(e={}),function(){return Helpers.TimeHelper.render(t,e)}},detailedTimestamp:function(t,e){return null==e&&(e={}),function(){return e=Helpers.TimeHelper.detailedTimestampOptions(t,e),Helpers.TimeHelper.render(t,e)}},detailedTimestampOptions:function(t,e){return null==e&&(e={}),e.classes||(e.classes="timestamp detailed"),e.textFormat=moment().startOf("day").diff(t)>0?"MMM D, YYYY LT":"LT",e},editTime:function(t,e){return t?Helpers.TimeHelper.detailedTimestamp(t,{classes:e?"detailed delete-time":"detailed edit-time"}):void 0
},render:function(t,e){var n,r,o;return null==e&&(e={}),r={classes:"timestamp",relative:!1,textFormat:"LT",datetimeFormat:"YYYY-MM-DDTHH:mm:ss",timestampFormat:"LLL",before:"",after:""},e=_.extend(r,e),moment.isMoment(t)||(t=moment(t)),e.relative&&(e.classes+=" autoupdate"),n=$("<time>").attr({datetime:t.format(e.datetimeFormat),title:t.format(e.timestampFormat),"class":e.classes}).text(function(){var n;return n=e.relative?t.fromNow():t.format(e.textFormat),[e.before,n,e.after].join(" ")}),null!=e.link&&(o=$("<a>").attr(e.link).addClass("timestamp-link"),n=o.append(n)),n[0].outerHTML},updateAllTimestamps:function(){return $("time.autoupdate").each(function(){return e($(this))})},updateDetailedTimestamps:function(){return $("time.detailed").each(function(){return t($(this))})},updateGlobalLocale:function(r){return moment.lang(r),$("time[datetime]").each(function(){var r;return r=$(this),r.attr({title:moment(r.attr("datetime")).format("LLL")}),r.is(".autoupdate")?e(r):r.is(".detailed")?t(r):n(r)})}}}.call(this),function(){Helpers.setWindowTitle=function(t,e,n){var r;
return r="",(e||n)&&(r+="("+(n>0?""+n:"*")+") "),t&&t.get("name")&&(r+=""+t.get("name"),t.get("organization")&&(r+=" ("+t.get("organization").name+")"),r+=" - "),r+="Flowdock",window.document.title=r}}.call(this),function(){Helpers.TwitterHelper={tweetIdFromTweetUrl:function(t){return t.match(/status\/([0-9]+)/)[1]},tweetApiUrl:function(t){return"https://api.twitter.com/1/statuses/show/"+t+".json?callback=?&include_entities=true"},profileImageApiUrl:function(t,e){return null==e&&(e="normal"),"https://api.twitter.com/1/users/profile_image/"+t+"?size="+e},userTimelineApiUrl:function(t,e){return"https://api.twitter.com/1/statuses/user_timeline/"+t+".json"+("?messageCount="+e+"&suppress_response_codes=1&include_rts=true&callback=?")},searchApiUrl:function(t,e){var n;return n=e?"&"+$.param(e):"","https://search.twitter.com/search.json?q="+t+n+"&callback=?"},intentReplyUrl:function(t){return"https://twitter.com/intent/tweet?in_reply_to="+t},intentRetweetUrl:function(t){return"https://twitter.com/intent/retweet/?tweet_id="+t
},intentFavoriteUrl:function(t){return"https://twitter.com/intent/favorite/?tweet_id="+t}}}.call(this),function(){var t,e=[].slice;Backbone.Model.prototype.asProperty=function(e){return e?t(this,"change:"+e).map(function(t){return t.get(e)}).toProperty(this.get(e)):t(this,"change").map(function(t){return t.toJSON()}).toProperty(this.toJSON())},Backbone.Collection.prototype.asEventStream=function(e,n){return null==n&&(n=_.identity),t(this,e,n)},Backbone.Model.prototype.asEventStream=function(e,n){return null==n&&(n=_.identity),t(this,e,n)},Backbone.View.prototype.asEventStream=function(e,n){return null==n&&(n=_.identity),t(this,e,n)},Backbone.Bacon={asEventStream:function(e,n){return null==n&&(n=_.identity),t(this,e,n)}},t=function(t,n,r){return null==r&&(r=_.identity),new Bacon.EventStream(function(o){var i,s;return i=function(){var t,n;return t=1<=arguments.length?e.call(arguments,0):[],n=o(new Bacon.Next(r.apply(null,t))),n===Bacon.noMore?s():void 0},s=function(){return t.off(n,i)},t.on(n,i),s})}}.call(this),function(){var t;
Backbone.Model.prototype.saveWithRetry=function(t){var e,n,r;return null==t&&(t={}),r=null!=t.retries?t.retries:3,e={success:function(e,n){return _.isFunction(t.success)?t.success(e,n):void 0},error:function(e,n){return 0>=r?_.isFunction(t.error)?t.error(e,n):void 0:setTimeout(function(){return e.saveWithRetry(_.extend({},t,{retries:r-1}))},1e4)}},n=_.extend({},t),n.retries=void 0,this.save({},_.extend(n,e))},t={update:"put",destroy:"delete",create:"post",read:"get"},Backbone.Model.prototype.can=function(e,n,r){var o,i,s;return e=t[e]||e,o=function(t){return function(){var r,o;return!!((null!=(r=t.get("_links"))?null!=(o=r[n])?o.methods.indexOf(e.toUpperCase()):void 0:void 0)>=0)}}(this),null!=r?(r=_.flatten([r]),o()&&0===_.difference(r,null!=(i=this.get("_links"))?null!=(s=i[n])?s.fields:void 0:void 0).length):o()},Backbone.Model.prototype.resourceUrl=function(t){var e,n;return"self"===t?this.get("url")||(_.isFunction(this.url)?this.url():this.url):null!=(e=this.get("_links"))?null!=(n=e[t])?n.href:void 0:void 0
}}.call(this),function(){var t;t=function(t){return _.extend(t,{user:Flowdock.app.user.id})},Flowdock.socketIoSync=function(e,n,r){return"create"===e?Flowdock.app.connection.messages.push(t(n.toJSON())):"tag-change"===e?Flowdock.app.connection.messages.push(t(_.extend(n.flowKey(),{event:"tag-change",content:_.extend({message:n.get("id")},r.tagChanges)}))):Backbone.sync(e,n,r)}}.call(this),function(){Bacon.throttledStream=function(t,e,n){return new Bacon.EventStream(function(r){var o,i,s;return s=!1,i=function(s){var a;return t.removeEventListener(e,i,!1),a=r(new Bacon.Next(s)),a!==Bacon.noMore?setTimeout(o,n):void 0},o=function(){return s?void 0:t.addEventListener(e,i,!1)},o(),function(){return s=!0,t.removeEventListener(e,i,!1)}})}}.call(this),/*!
 * Emojie
 *
 * Copyright (C) 2011 by Ville Lautanala
 * Licensed under the MIT license
 */
function(t){function e(t,e,n){if(null!=t)for(var r,o,i,s=[t];s.length>0;)if(i=s.pop(),3==i.nodeType)n(i);else if(null==i.getAttribute(e.ignoreAttribute||"data-no-emojie"))for(r=i.childNodes.length,o=r-1;o>=0;--o)s.push(i.childNodes[o])}function n(t,e){var n=document.createElement(e.elementName||"img");null!=e.content&&(n.textContent=e.content);for(attr in e)"content"!=attr&&"elementName"!=attr&&n.setAttribute(attr,e[attr]);return n}function r(t){return function e(r){var o,i,s=r.data,a=0,l="";for(a=0;a<s.length;a++)if(l+=s[a],!(t[l]===!0||t[l]&&t[l+s[a+1]])){if(t[l])return o=r.splitText(a-l.length+1),o.length>l.length&&(i=o.splitText(l.length)),r.parentNode.replaceChild(n(o,t[l]),o),i?e(i):void 0;l=""}}}function o(t){function n(n){var i=r(o);return 3==n.nodeType?i(n):e(n,t||{},i),n}var o={};return n._emojis=o,n.register=function(t,e){var r,i;for(r=1;r<t.length;r++)i=t.slice(0,r),i in o||(o[i]=!0);return o[t]=e,n},n.merge=function(t){function e(t,e){return t&&e?1==t?e:1==e?t:t:t||e}var r;for(r in t._emojis)t._emojis.hasOwnProperty(r)&&(o[r]=e(t._emojis[r],o[r]));
return n},n}o.canRender=function(t){function e(t,e){var n,r=t.getImageData(0,0,e,e).data;for(n=0;n<r.length;n+=4)if(r[n]!=r[n+1]&&r[n]!=r[n+2])return!0;return!1}try{var n=document.createElement("canvas").getContext("2d");return n.fillText(t,0,0),e(n,10)}catch(r){return!1}},t.Emojie=o}(window),function(){var t,e,n,r,o,i,s,a,l,u,c,p,h,d;for(window.emojie=Emojie(),window.emojimoji=function(t){return t.replace(/:([\w-+]+):/gm,function(t,e){var n;return n=i[e.toLowerCase()],n?_.last(n):":"+e+":"})},window.remojimoji=function(t){var e,n,r,o;for(e in i)if(r=i[e])for(o=r.length-1;o>=0;o+=-1)n=r[o],t=t.replace(new RegExp(n,"gm"),function(t){return Emojie.canRender(t)?t:":"+e+":"});return t},i={"+1":["\ud83d\udc4d"],"-1":["\ud83d\udc4e"],100:["\ud83d\udcaf"],1234:["\ud83d\udd22"],"8ball":["\ud83c\udfb1"],a:["\ud83c\udd70"],ab:["\ud83c\udd8e"],abc:["\ud83d\udd24"],abcd:["\ud83d\udd21"],accept:["\ud83c\ude51"],aerial_tramway:["\ud83d\udea1"],airplane:["\u2708","\u2708\ufe0f"],alarm_clock:["\u23f0"],alien:["\ud83d\udc7d"],ambulance:["\ud83d\ude91"],anchor:["\u2693","\u2693\ufe0f"],angel:["\ud83d\udc7c"],anger:["\ud83d\udca2"],angry:["\ud83d\ude20"],anguished:["\ud83d\ude27"],ant:["\ud83d\udc1c"],apple:["\ud83c\udf4e"],aquarius:["\u2652","\u2652\ufe0f"],aries:["\u2648","\u2648\ufe0f"],arrow_backward:["\u25c0","\u25c0\ufe0f"],arrow_double_down:["\u23ec"],arrow_double_up:["\u23eb"],arrow_down:["\u2b07","\u2b07\ufe0f"],arrow_down_small:["\ud83d\udd3d"],arrow_forward:["\u25b6","\u25b6\ufe0f"],arrow_heading_down:["\u2935","\u2935\ufe0f"],arrow_heading_up:["\u2934","\u2934\ufe0f"],arrow_left:["\u2b05","\u2b05\ufe0f"],arrow_lower_left:["\u2199","\u2199\ufe0f"],arrow_lower_right:["\u2198","\u2198\ufe0f"],arrow_right:["\u27a1","\u27a1\ufe0f"],arrow_right_hook:["\u21aa","\u21aa\ufe0f"],arrow_up:["\u2b06","\u2b06\ufe0f"],arrow_up_down:["\u2195","\u2195\ufe0f"],arrow_up_small:["\ud83d\udd3c"],arrow_upper_left:["\u2196","\u2196\ufe0f"],arrow_upper_right:["\u2197","\u2197\ufe0f"],arrows_clockwise:["\ud83d\udd03"],arrows_counterclockwise:["\ud83d\udd04"],art:["\ud83c\udfa8"],articulated_lorry:["\ud83d\ude9b"],astonished:["\ud83d\ude32"],athletic_shoe:["\ud83d\udc5f"],atm:["\ud83c\udfe7"],b:["\ud83c\udd71"],baby:["\ud83d\udc76"],baby_bottle:["\ud83c\udf7c"],baby_chick:["\ud83d\udc24"],baby_symbol:["\ud83d\udebc"],back:["\ud83d\udd19"],baggage_claim:["\ud83d\udec4"],balloon:["\ud83c\udf88"],ballot_box_with_check:["\u2611","\u2611\ufe0f"],bamboo:["\ud83c\udf8d"],banana:["\ud83c\udf4c"],bangbang:["\u203c","\u203c\ufe0f"],bank:["\ud83c\udfe6"],bar_chart:["\ud83d\udcca"],barber:["\ud83d\udc88"],baseball:["\u26be","\u26be\ufe0f"],basketball:["\ud83c\udfc0"],bath:["\ud83d\udec0"],bathtub:["\ud83d\udec1"],battery:["\ud83d\udd0b"],bear:["\ud83d\udc3b"],bee:["\ud83d\udc1d"],beer:["\ud83c\udf7a"],beers:["\ud83c\udf7b"],beetle:["\ud83d\udc1e"],beginner:["\ud83d\udd30"],bell:["\ud83d\udd14"],bento:["\ud83c\udf71"],bicyclist:["\ud83d\udeb4"],bike:["\ud83d\udeb2"],bikini:["\ud83d\udc59"],bird:["\ud83d\udc26"],birthday:["\ud83c\udf82"],black_circle:["\u26ab","\u26ab\ufe0f"],black_joker:["\ud83c\udccf"],black_large_square:["\u2b1b","\u2b1b\ufe0f"],black_medium_small_square:["\u25fe","\u25fe\ufe0f"],black_medium_square:["\u25fc","\u25fc\ufe0f"],black_nib:["\u2712","\u2712\ufe0f"],black_small_square:["\u25aa","\u25aa\ufe0f"],black_square_button:["\ud83d\udd32"],blossom:["\ud83c\udf3c"],blowfish:["\ud83d\udc21"],blue_book:["\ud83d\udcd8"],blue_car:["\ud83d\ude99"],blue_heart:["\ud83d\udc99"],blush:["\ud83d\ude0a"],boar:["\ud83d\udc17"],boat:["\u26f5","\u26f5\ufe0f"],bomb:["\ud83d\udca3"],book:["\ud83d\udcd6"],bookmark:["\ud83d\udd16"],bookmark_tabs:["\ud83d\udcd1"],books:["\ud83d\udcda"],boom:["\ud83d\udca5"],boot:["\ud83d\udc62"],bouquet:["\ud83d\udc90"],bow:["\ud83d\ude47"],bowling:["\ud83c\udfb3"],bowtie:null,boy:["\ud83d\udc66"],bread:["\ud83c\udf5e"],bride_with_veil:["\ud83d\udc70"],bridge_at_night:["\ud83c\udf09"],briefcase:["\ud83d\udcbc"],broken_heart:["\ud83d\udc94"],bug:["\ud83d\udc1b"],bulb:["\ud83d\udca1"],bullettrain_front:["\ud83d\ude85"],bullettrain_side:["\ud83d\ude84"],bus:["\ud83d\ude8c"],busstop:["\ud83d\ude8f"],bust_in_silhouette:["\ud83d\udc64"],busts_in_silhouette:["\ud83d\udc65"],cactus:["\ud83c\udf35"],cake:["\ud83c\udf70"],calendar:["\ud83d\udcc6"],calling:["\ud83d\udcf2"],camel:["\ud83d\udc2b"],camera:["\ud83d\udcf7"],cancer:["\u264b","\u264b\ufe0f"],candy:["\ud83c\udf6c"],capital_abcd:["\ud83d\udd20"],capricorn:["\u2651","\u2651\ufe0f"],car:["\ud83d\ude97"],card_index:["\ud83d\udcc7"],carousel_horse:["\ud83c\udfa0"],cat:["\ud83d\udc31"],cat2:["\ud83d\udc08"],cd:["\ud83d\udcbf"],chart:["\ud83d\udcb9"],chart_with_downwards_trend:["\ud83d\udcc9"],chart_with_upwards_trend:["\ud83d\udcc8"],checkered_flag:["\ud83c\udfc1"],cherries:["\ud83c\udf52"],cherry_blossom:["\ud83c\udf38"],chestnut:["\ud83c\udf30"],chicken:["\ud83d\udc14"],children_crossing:["\ud83d\udeb8"],chocolate_bar:["\ud83c\udf6b"],christmas_tree:["\ud83c\udf84"],church:["\u26ea","\u26ea\ufe0f"],cinema:["\ud83c\udfa6"],circus_tent:["\ud83c\udfaa"],city_sunrise:["\ud83c\udf07"],city_sunset:["\ud83c\udf06"],cl:["\ud83c\udd91"],clap:["\ud83d\udc4f"],clapper:["\ud83c\udfac"],clipboard:["\ud83d\udccb"],clock1:["\ud83d\udd50"],clock10:["\ud83d\udd59"],clock1030:["\ud83d\udd65"],clock11:["\ud83d\udd5a"],clock1130:["\ud83d\udd66"],clock12:["\ud83d\udd5b"],clock1230:["\ud83d\udd67"],clock130:["\ud83d\udd5c"],clock2:["\ud83d\udd51"],clock230:["\ud83d\udd5d"],clock3:["\ud83d\udd52"],clock330:["\ud83d\udd5e"],clock4:["\ud83d\udd53"],clock430:["\ud83d\udd5f"],clock5:["\ud83d\udd54"],clock530:["\ud83d\udd60"],clock6:["\ud83d\udd55"],clock630:["\ud83d\udd61"],clock7:["\ud83d\udd56"],clock730:["\ud83d\udd62"],clock8:["\ud83d\udd57"],clock830:["\ud83d\udd63"],clock9:["\ud83d\udd58"],clock930:["\ud83d\udd64"],closed_book:["\ud83d\udcd5"],closed_lock_with_key:["\ud83d\udd10"],closed_umbrella:["\ud83c\udf02"],cloud:["\u2601","\u2601\ufe0f"],clubs:["\u2663","\u2663\ufe0f"],cn:["\ud83c\udde8\ud83c\uddf3"],cocktail:["\ud83c\udf78"],coffee:["\u2615","\u2615\ufe0f"],cold_sweat:["\ud83d\ude30"],collision:["\ud83d\udca5"],computer:["\ud83d\udcbb"],confetti_ball:["\ud83c\udf8a"],confounded:["\ud83d\ude16"],confused:["\ud83d\ude15"],congratulations:["\u3297","\u3297\ufe0f"],construction:["\ud83d\udea7"],construction_worker:["\ud83d\udc77"],convenience_store:["\ud83c\udfea"],cookie:["\ud83c\udf6a"],cool:["\ud83c\udd92"],cop:["\ud83d\udc6e"],copyright:["\xa9"],corn:["\ud83c\udf3d"],couple:["\ud83d\udc6b"],couple_with_heart:["\ud83d\udc91"],couplekiss:["\ud83d\udc8f"],cow:["\ud83d\udc2e"],cow2:["\ud83d\udc04"],credit_card:["\ud83d\udcb3"],crescent_moon:["\ud83c\udf19"],crocodile:["\ud83d\udc0a"],crossed_flags:["\ud83c\udf8c"],crown:["\ud83d\udc51"],cry:["\ud83d\ude22"],crying_cat_face:["\ud83d\ude3f"],crystal_ball:["\ud83d\udd2e"],cupid:["\ud83d\udc98"],curly_loop:["\u27b0"],currency_exchange:["\ud83d\udcb1"],curry:["\ud83c\udf5b"],custard:["\ud83c\udf6e"],customs:["\ud83d\udec3"],cyclone:["\ud83c\udf00"],dancer:["\ud83d\udc83"],dancers:["\ud83d\udc6f"],dango:["\ud83c\udf61"],dart:["\ud83c\udfaf"],dash:["\ud83d\udca8"],date:["\ud83d\udcc5"],de:["\ud83c\udde9\ud83c\uddea"],deciduous_tree:["\ud83c\udf33"],department_store:["\ud83c\udfec"],diamond_shape_with_a_dot_inside:["\ud83d\udca0"],diamonds:["\u2666","\u2666\ufe0f"],disappointed:["\ud83d\ude1e"],disappointed_relieved:["\ud83d\ude25"],dizzy:["\ud83d\udcab"],dizzy_face:["\ud83d\ude35"],do_not_litter:["\ud83d\udeaf"],dog:["\ud83d\udc36"],dog2:["\ud83d\udc15"],dollar:["\ud83d\udcb5"],dolls:["\ud83c\udf8e"],dolphin:["\ud83d\udc2c"],door:["\ud83d\udeaa"],doughnut:["\ud83c\udf69"],dragon:["\ud83d\udc09"],dragon_face:["\ud83d\udc32"],dress:["\ud83d\udc57"],dromedary_camel:["\ud83d\udc2a"],droplet:["\ud83d\udca7"],dvd:["\ud83d\udcc0"],"e-mail":["\ud83d\udce7"],ear:["\ud83d\udc42"],ear_of_rice:["\ud83c\udf3e"],earth_africa:["\ud83c\udf0d"],earth_americas:["\ud83c\udf0e"],earth_asia:["\ud83c\udf0f"],egg:["\ud83c\udf73"],eggplant:["\ud83c\udf46"],eight:["8\u20e3","8\ufe0f\u20e3"],eight_pointed_black_star:["\u2734","\u2734\ufe0f"],eight_spoked_asterisk:["\u2733","\u2733\ufe0f"],electric_plug:["\ud83d\udd0c"],elephant:["\ud83d\udc18"],email:["\u2709","\u2709\ufe0f"],end:["\ud83d\udd1a"],envelope:["\u2709","\u2709\ufe0f"],envelope_with_arrow:["\ud83d\udce9"],es:["\ud83c\uddea\ud83c\uddf8"],euro:["\ud83d\udcb6"],european_castle:["\ud83c\udff0"],european_post_office:["\ud83c\udfe4"],evergreen_tree:["\ud83c\udf32"],exclamation:["\u2757","\u2757\ufe0f"],expressionless:["\ud83d\ude11"],eyeglasses:["\ud83d\udc53"],eyes:["\ud83d\udc40"],facepunch:["\ud83d\udc4a"],factory:["\ud83c\udfed"],fallen_leaf:["\ud83c\udf42"],family:["\ud83d\udc6a"],fast_forward:["\u23e9"],fax:["\ud83d\udce0"],fearful:["\ud83d\ude28"],feelsgood:null,feet:["\ud83d\udc3e"],ferris_wheel:["\ud83c\udfa1"],file_folder:["\ud83d\udcc1"],finnadie:null,fire:["\ud83d\udd25"],fire_engine:["\ud83d\ude92"],fireworks:["\ud83c\udf86"],first_quarter_moon:["\ud83c\udf13"],first_quarter_moon_with_face:["\ud83c\udf1b"],fish:["\ud83d\udc1f"],fish_cake:["\ud83c\udf65"],fishing_pole_and_fish:["\ud83c\udfa3"],fist:["\u270a"],five:["5\u20e3","5\ufe0f\u20e3"],flags:["\ud83c\udf8f"],flashlight:["\ud83d\udd26"],flipper:["\ud83d\udc2c"],floppy_disk:["\ud83d\udcbe"],flower_playing_cards:["\ud83c\udfb4"],flushed:["\ud83d\ude33"],foggy:["\ud83c\udf01"],football:["\ud83c\udfc8"],footprints:["\ud83d\udc63"],fork_and_knife:["\ud83c\udf74"],fountain:["\u26f2","\u26f2\ufe0f"],four:["4\u20e3","4\ufe0f\u20e3"],four_leaf_clover:["\ud83c\udf40"],fr:["\ud83c\uddeb\ud83c\uddf7"],free:["\ud83c\udd93"],fried_shrimp:["\ud83c\udf64"],fries:["\ud83c\udf5f"],frog:["\ud83d\udc38"],frowning:["\ud83d\ude26"],fu:null,fuelpump:["\u26fd","\u26fd\ufe0f"],full_moon:["\ud83c\udf15"],full_moon_with_face:["\ud83c\udf1d"],game_die:["\ud83c\udfb2"],gb:["\ud83c\uddec\ud83c\udde7"],gem:["\ud83d\udc8e"],gemini:["\u264a","\u264a\ufe0f"],ghost:["\ud83d\udc7b"],gift:["\ud83c\udf81"],gift_heart:["\ud83d\udc9d"],girl:["\ud83d\udc67"],globe_with_meridians:["\ud83c\udf10"],goat:["\ud83d\udc10"],goberserk:null,godmode:null,golf:["\u26f3","\u26f3\ufe0f"],grapes:["\ud83c\udf47"],green_apple:["\ud83c\udf4f"],green_book:["\ud83d\udcd7"],green_heart:["\ud83d\udc9a"],grey_exclamation:["\u2755"],grey_question:["\u2754"],grimacing:["\ud83d\ude2c"],grin:["\ud83d\ude01"],grinning:["\ud83d\ude00"],guardsman:["\ud83d\udc82"],guitar:["\ud83c\udfb8"],gun:["\ud83d\udd2b"],haircut:["\ud83d\udc87"],hamburger:["\ud83c\udf54"],hammer:["\ud83d\udd28"],hamster:["\ud83d\udc39"],hand:["\u270b"],handbag:["\ud83d\udc5c"],hankey:["\ud83d\udca9"],hash:["#\u20e3","#\ufe0f\u20e3"],hatched_chick:["\ud83d\udc25"],hatching_chick:["\ud83d\udc23"],headphones:["\ud83c\udfa7"],hear_no_evil:["\ud83d\ude49"],heart:["\u2764","\u2764\ufe0f"],heart_decoration:["\ud83d\udc9f"],heart_eyes:["\ud83d\ude0d"],heart_eyes_cat:["\ud83d\ude3b"],heartbeat:["\ud83d\udc93"],heartpulse:["\ud83d\udc97"],hearts:["\u2665","\u2665\ufe0f"],heavy_check_mark:["\u2714","\u2714\ufe0f"],heavy_division_sign:["\u2797"],heavy_dollar_sign:["\ud83d\udcb2"],heavy_exclamation_mark:["\u2757","\u2757\ufe0f"],heavy_minus_sign:["\u2796"],heavy_multiplication_x:["\u2716","\u2716\ufe0f"],heavy_plus_sign:["\u2795"],helicopter:["\ud83d\ude81"],herb:["\ud83c\udf3f"],hibiscus:["\ud83c\udf3a"],high_brightness:["\ud83d\udd06"],high_heel:["\ud83d\udc60"],hocho:["\ud83d\udd2a"],honey_pot:["\ud83c\udf6f"],honeybee:["\ud83d\udc1d"],horse:["\ud83d\udc34"],horse_racing:["\ud83c\udfc7"],hospital:["\ud83c\udfe5"],hotel:["\ud83c\udfe8"],hotsprings:["\u2668","\u2668\ufe0f"],hourglass:["\u231b","\u231b\ufe0f"],hourglass_flowing_sand:["\u23f3"],house:["\ud83c\udfe0"],house_with_garden:["\ud83c\udfe1"],hurtrealbad:null,hushed:["\ud83d\ude2f"],ice_cream:["\ud83c\udf68"],icecream:["\ud83c\udf66"],id:["\ud83c\udd94"],ideograph_advantage:["\ud83c\ude50"],imp:["\ud83d\udc7f"],inbox_tray:["\ud83d\udce5"],incoming_envelope:["\ud83d\udce8"],information_desk_person:["\ud83d\udc81"],information_source:["\u2139","\u2139\ufe0f"],innocent:["\ud83d\ude07"],interrobang:["\u2049","\u2049\ufe0f"],iphone:["\ud83d\udcf1"],it:["\ud83c\uddee\ud83c\uddf9"],izakaya_lantern:["\ud83c\udfee"],jack_o_lantern:["\ud83c\udf83"],japan:["\ud83d\uddfe"],japanese_castle:["\ud83c\udfef"],japanese_goblin:["\ud83d\udc7a"],japanese_ogre:["\ud83d\udc79"],jeans:["\ud83d\udc56"],joy:["\ud83d\ude02"],joy_cat:["\ud83d\ude39"],jp:["\ud83c\uddef\ud83c\uddf5"],key:["\ud83d\udd11"],keycap_ten:["\ud83d\udd1f"],kimono:["\ud83d\udc58"],kiss:["\ud83d\udc8b"],kissing:["\ud83d\ude17"],kissing_cat:["\ud83d\ude3d"],kissing_closed_eyes:["\ud83d\ude1a"],kissing_heart:["\ud83d\ude18"],kissing_smiling_eyes:["\ud83d\ude19"],koala:["\ud83d\udc28"],koko:["\ud83c\ude01"],kr:["\ud83c\uddf0\ud83c\uddf7"],lantern:["\ud83c\udfee"],large_blue_circle:["\ud83d\udd35"],large_blue_diamond:["\ud83d\udd37"],large_orange_diamond:["\ud83d\udd36"],last_quarter_moon:["\ud83c\udf17"],last_quarter_moon_with_face:["\ud83c\udf1c"],laughing:["\ud83d\ude06"],leaves:["\ud83c\udf43"],ledger:["\ud83d\udcd2"],left_luggage:["\ud83d\udec5"],left_right_arrow:["\u2194","\u2194\ufe0f"],leftwards_arrow_with_hook:["\u21a9","\u21a9\ufe0f"],lemon:["\ud83c\udf4b"],leo:["\u264c","\u264c\ufe0f"],leopard:["\ud83d\udc06"],libra:["\u264e","\u264e\ufe0f"],light_rail:["\ud83d\ude88"],link:["\ud83d\udd17"],lips:["\ud83d\udc44"],lipstick:["\ud83d\udc84"],lock:["\ud83d\udd12"],lock_with_ink_pen:["\ud83d\udd0f"],lollipop:["\ud83c\udf6d"],loop:["\u27bf"],loud_sound:["\ud83d\udd0a"],loudspeaker:["\ud83d\udce2"],love_hotel:["\ud83c\udfe9"],love_letter:["\ud83d\udc8c"],low_brightness:["\ud83d\udd05"],m:["\u24c2","\u24c2\ufe0f"],mag:["\ud83d\udd0d"],mag_right:["\ud83d\udd0e"],mahjong:["\ud83c\udc04","\ud83c\udc04\ufe0f"],mailbox:["\ud83d\udceb"],mailbox_closed:["\ud83d\udcea"],mailbox_with_mail:["\ud83d\udcec"],mailbox_with_no_mail:["\ud83d\udced"],man:["\ud83d\udc68"],man_with_gua_pi_mao:["\ud83d\udc72"],man_with_turban:["\ud83d\udc73"],mans_shoe:["\ud83d\udc5e"],maple_leaf:["\ud83c\udf41"],mask:["\ud83d\ude37"],massage:["\ud83d\udc86"],meat_on_bone:["\ud83c\udf56"],mega:["\ud83d\udce3"],melon:["\ud83c\udf48"],memo:["\ud83d\udcdd"],mens:["\ud83d\udeb9"],metal:null,metro:["\ud83d\ude87"],microphone:["\ud83c\udfa4"],microscope:["\ud83d\udd2c"],milky_way:["\ud83c\udf0c"],minibus:["\ud83d\ude90"],minidisc:["\ud83d\udcbd"],mobile_phone_off:["\ud83d\udcf4"],money_with_wings:["\ud83d\udcb8"],moneybag:["\ud83d\udcb0"],monkey:["\ud83d\udc12"],monkey_face:["\ud83d\udc35"],monorail:["\ud83d\ude9d"],moon:["\ud83c\udf14"],mortar_board:["\ud83c\udf93"],mount_fuji:["\ud83d\uddfb"],mountain_bicyclist:["\ud83d\udeb5"],mountain_cableway:["\ud83d\udea0"],mountain_railway:["\ud83d\ude9e"],mouse:["\ud83d\udc2d"],mouse2:["\ud83d\udc01"],movie_camera:["\ud83c\udfa5"],moyai:["\ud83d\uddff"],muscle:["\ud83d\udcaa"],mushroom:["\ud83c\udf44"],musical_keyboard:["\ud83c\udfb9"],musical_note:["\ud83c\udfb5"],musical_score:["\ud83c\udfbc"],mute:["\ud83d\udd07"],nail_care:["\ud83d\udc85"],name_badge:["\ud83d\udcdb"],neckbeard:null,necktie:["\ud83d\udc54"],negative_squared_cross_mark:["\u274e"],neutral_face:["\ud83d\ude10"],"new":["\ud83c\udd95"],new_moon:["\ud83c\udf11"],new_moon_with_face:["\ud83c\udf1a"],newspaper:["\ud83d\udcf0"],ng:["\ud83c\udd96"],night_with_stars:["\ud83c\udf03"],nine:["9\u20e3","9\ufe0f\u20e3"],no_bell:["\ud83d\udd15"],no_bicycles:["\ud83d\udeb3"],no_entry:["\u26d4","\u26d4\ufe0f"],no_entry_sign:["\ud83d\udeab"],no_good:["\ud83d\ude45"],no_mobile_phones:["\ud83d\udcf5"],no_mouth:["\ud83d\ude36"],no_pedestrians:["\ud83d\udeb7"],no_smoking:["\ud83d\udead"],"non-potable_water":["\ud83d\udeb1"],nose:["\ud83d\udc43"],notebook:["\ud83d\udcd3"],notebook_with_decorative_cover:["\ud83d\udcd4"],notes:["\ud83c\udfb6"],nut_and_bolt:["\ud83d\udd29"],o:["\u2b55","\u2b55\ufe0f"],o2:["\ud83c\udd7e"],ocean:["\ud83c\udf0a"],octocat:null,octopus:["\ud83d\udc19"],oden:["\ud83c\udf62"],office:["\ud83c\udfe2"],ok:["\ud83c\udd97"],ok_hand:["\ud83d\udc4c"],ok_woman:["\ud83d\ude46"],older_man:["\ud83d\udc74"],older_woman:["\ud83d\udc75"],on:["\ud83d\udd1b"],oncoming_automobile:["\ud83d\ude98"],oncoming_bus:["\ud83d\ude8d"],oncoming_police_car:["\ud83d\ude94"],oncoming_taxi:["\ud83d\ude96"],one:["1\u20e3","1\ufe0f\u20e3"],open_book:["\ud83d\udcd6"],open_file_folder:["\ud83d\udcc2"],open_hands:["\ud83d\udc50"],open_mouth:["\ud83d\ude2e"],ophiuchus:["\u26ce"],orange_book:["\ud83d\udcd9"],outbox_tray:["\ud83d\udce4"],ox:["\ud83d\udc02"],"package":["\ud83d\udce6"],page_facing_up:["\ud83d\udcc4"],page_with_curl:["\ud83d\udcc3"],pager:["\ud83d\udcdf"],palm_tree:["\ud83c\udf34"],panda_face:["\ud83d\udc3c"],paperclip:["\ud83d\udcce"],parking:["\ud83c\udd7f","\ud83c\udd7f\ufe0f"],part_alternation_mark:["\u303d","\u303d\ufe0f"],partly_sunny:["\u26c5","\u26c5\ufe0f"],passport_control:["\ud83d\udec2"],paw_prints:["\ud83d\udc3e"],peach:["\ud83c\udf51"],pear:["\ud83c\udf50"],pencil:["\ud83d\udcdd"],pencil2:["\u270f","\u270f\ufe0f"],penguin:["\ud83d\udc27"],pensive:["\ud83d\ude14"],performing_arts:["\ud83c\udfad"],persevere:["\ud83d\ude23"],person_frowning:["\ud83d\ude4d"],person_with_blond_hair:["\ud83d\udc71"],person_with_pouting_face:["\ud83d\ude4e"],phone:["\u260e","\u260e\ufe0f"],pig:["\ud83d\udc37"],pig2:["\ud83d\udc16"],pig_nose:["\ud83d\udc3d"],pill:["\ud83d\udc8a"],pineapple:["\ud83c\udf4d"],pisces:["\u2653","\u2653\ufe0f"],pizza:["\ud83c\udf55"],point_down:["\ud83d\udc47"],point_left:["\ud83d\udc48"],point_right:["\ud83d\udc49"],point_up:["\u261d","\u261d\ufe0f"],point_up_2:["\ud83d\udc46"],police_car:["\ud83d\ude93"],poodle:["\ud83d\udc29"],poop:["\ud83d\udca9"],post_office:["\ud83c\udfe3"],postal_horn:["\ud83d\udcef"],postbox:["\ud83d\udcee"],potable_water:["\ud83d\udeb0"],pouch:["\ud83d\udc5d"],poultry_leg:["\ud83c\udf57"],pound:["\ud83d\udcb7"],pouting_cat:["\ud83d\ude3e"],pray:["\ud83d\ude4f"],princess:["\ud83d\udc78"],punch:["\ud83d\udc4a"],purple_heart:["\ud83d\udc9c"],purse:["\ud83d\udc5b"],pushpin:["\ud83d\udccc"],put_litter_in_its_place:["\ud83d\udeae"],question:["\u2753"],rabbit:["\ud83d\udc30"],rabbit2:["\ud83d\udc07"],racehorse:["\ud83d\udc0e"],radio:["\ud83d\udcfb"],radio_button:["\ud83d\udd18"],rage:["\ud83d\ude21"],rage1:null,rage2:null,rage3:null,rage4:null,railway_car:["\ud83d\ude83"],rainbow:["\ud83c\udf08"],raised_hand:["\u270b"],raised_hands:["\ud83d\ude4c"],raising_hand:["\ud83d\ude4b"],ram:["\ud83d\udc0f"],ramen:["\ud83c\udf5c"],rat:["\ud83d\udc00"],recycle:["\u267b","\u267b\ufe0f"],red_car:["\ud83d\ude97"],red_circle:["\ud83d\udd34"],registered:["\xae"],relaxed:["\u263a","\u263a\ufe0f"],relieved:["\ud83d\ude0c"],repeat:["\ud83d\udd01"],repeat_one:["\ud83d\udd02"],restroom:["\ud83d\udebb"],revolving_hearts:["\ud83d\udc9e"],rewind:["\u23ea"],ribbon:["\ud83c\udf80"],rice:["\ud83c\udf5a"],rice_ball:["\ud83c\udf59"],rice_cracker:["\ud83c\udf58"],rice_scene:["\ud83c\udf91"],ring:["\ud83d\udc8d"],rocket:["\ud83d\ude80"],roller_coaster:["\ud83c\udfa2"],rooster:["\ud83d\udc13"],rose:["\ud83c\udf39"],rotating_light:["\ud83d\udea8"],round_pushpin:["\ud83d\udccd"],rowboat:["\ud83d\udea3"],ru:["\ud83c\uddf7\ud83c\uddfa"],rugby_football:["\ud83c\udfc9"],runner:["\ud83c\udfc3"],running:["\ud83c\udfc3"],running_shirt_with_sash:["\ud83c\udfbd"],sa:["\ud83c\ude02"],sagittarius:["\u2650","\u2650\ufe0f"],sailboat:["\u26f5","\u26f5\ufe0f"],sake:["\ud83c\udf76"],sandal:["\ud83d\udc61"],santa:["\ud83c\udf85"],satellite:["\ud83d\udce1"],satisfied:["\ud83d\ude06"],saxophone:["\ud83c\udfb7"],school:["\ud83c\udfeb"],school_satchel:["\ud83c\udf92"],scissors:["\u2702","\u2702\ufe0f"],scorpius:["\u264f","\u264f\ufe0f"],scream:["\ud83d\ude31"],scream_cat:["\ud83d\ude40"],scroll:["\ud83d\udcdc"],seat:["\ud83d\udcba"],secret:["\u3299","\u3299\ufe0f"],see_no_evil:["\ud83d\ude48"],seedling:["\ud83c\udf31"],seven:["7\u20e3","7\ufe0f\u20e3"],shaved_ice:["\ud83c\udf67"],sheep:["\ud83d\udc11"],shell:["\ud83d\udc1a"],ship:["\ud83d\udea2"],shipit:null,shirt:["\ud83d\udc55"],shit:["\ud83d\udca9"],shoe:["\ud83d\udc5e"],shower:["\ud83d\udebf"],signal_strength:["\ud83d\udcf6"],six:["6\u20e3","6\ufe0f\u20e3"],six_pointed_star:["\ud83d\udd2f"],ski:["\ud83c\udfbf"],skull:["\ud83d\udc80"],sleeping:["\ud83d\ude34"],sleepy:["\ud83d\ude2a"],slot_machine:["\ud83c\udfb0"],small_blue_diamond:["\ud83d\udd39"],small_orange_diamond:["\ud83d\udd38"],small_red_triangle:["\ud83d\udd3a"],small_red_triangle_down:["\ud83d\udd3b"],smile:["\ud83d\ude04"],smile_cat:["\ud83d\ude38"],smiley:["\ud83d\ude03"],smiley_cat:["\ud83d\ude3a"],smiling_imp:["\ud83d\ude08"],smirk:["\ud83d\ude0f"],smirk_cat:["\ud83d\ude3c"],smoking:["\ud83d\udeac"],snail:["\ud83d\udc0c"],snake:["\ud83d\udc0d"],snowboarder:["\ud83c\udfc2"],snowflake:["\u2744","\u2744\ufe0f"],snowman:["\u26c4","\u26c4\ufe0f"],sob:["\ud83d\ude2d"],soccer:["\u26bd","\u26bd\ufe0f"],soon:["\ud83d\udd1c"],sos:["\ud83c\udd98"],sound:["\ud83d\udd09"],space_invader:["\ud83d\udc7e"],spades:["\u2660","\u2660\ufe0f"],spaghetti:["\ud83c\udf5d"],sparkle:["\u2747","\u2747\ufe0f"],sparkler:["\ud83c\udf87"],sparkles:["\u2728"],sparkling_heart:["\ud83d\udc96"],speak_no_evil:["\ud83d\ude4a"],speaker:["\ud83d\udd08"],speech_balloon:["\ud83d\udcac"],speedboat:["\ud83d\udea4"],squirrel:null,star:["\u2b50","\u2b50\ufe0f"],star2:["\ud83c\udf1f"],stars:["\ud83c\udf20"],station:["\ud83d\ude89"],statue_of_liberty:["\ud83d\uddfd"],steam_locomotive:["\ud83d\ude82"],stew:["\ud83c\udf72"],straight_ruler:["\ud83d\udccf"],strawberry:["\ud83c\udf53"],stuck_out_tongue:["\ud83d\ude1b"],stuck_out_tongue_closed_eyes:["\ud83d\ude1d"],stuck_out_tongue_winking_eye:["\ud83d\ude1c"],sun_with_face:["\ud83c\udf1e"],sunflower:["\ud83c\udf3b"],sunglasses:["\ud83d\ude0e"],sunny:["\u2600","\u2600\ufe0f"],sunrise:["\ud83c\udf05"],sunrise_over_mountains:["\ud83c\udf04"],surfer:["\ud83c\udfc4"],sushi:["\ud83c\udf63"],suspect:null,suspension_railway:["\ud83d\ude9f"],sweat:["\ud83d\ude13"],sweat_drops:["\ud83d\udca6"],sweat_smile:["\ud83d\ude05"],sweet_potato:["\ud83c\udf60"],swimmer:["\ud83c\udfca"],symbols:["\ud83d\udd23"],syringe:["\ud83d\udc89"],tada:["\ud83c\udf89"],tanabata_tree:["\ud83c\udf8b"],tangerine:["\ud83c\udf4a"],taurus:["\u2649","\u2649\ufe0f"],taxi:["\ud83d\ude95"],tea:["\ud83c\udf75"],telephone:["\u260e","\u260e\ufe0f"],telephone_receiver:["\ud83d\udcde"],telescope:["\ud83d\udd2d"],tennis:["\ud83c\udfbe"],tent:["\u26fa","\u26fa\ufe0f"],thought_balloon:["\ud83d\udcad"],three:["3\u20e3","3\ufe0f\u20e3"],thumbsdown:["\ud83d\udc4e"],thumbsup:["\ud83d\udc4d"],ticket:["\ud83c\udfab"],tiger:["\ud83d\udc2f"],tiger2:["\ud83d\udc05"],tired_face:["\ud83d\ude2b"],tm:["\u2122"],toilet:["\ud83d\udebd"],tokyo_tower:["\ud83d\uddfc"],tomato:["\ud83c\udf45"],tongue:["\ud83d\udc45"],top:["\ud83d\udd1d"],tophat:["\ud83c\udfa9"],tractor:["\ud83d\ude9c"],traffic_light:["\ud83d\udea5"],train:["\ud83d\ude8b"],train2:["\ud83d\ude86"],tram:["\ud83d\ude8a"],triangular_flag_on_post:["\ud83d\udea9"],triangular_ruler:["\ud83d\udcd0"],trident:["\ud83d\udd31"],triumph:["\ud83d\ude24"],trolleybus:["\ud83d\ude8e"],trollface:null,trophy:["\ud83c\udfc6"],tropical_drink:["\ud83c\udf79"],tropical_fish:["\ud83d\udc20"],truck:["\ud83d\ude9a"],trumpet:["\ud83c\udfba"],tshirt:["\ud83d\udc55"],tulip:["\ud83c\udf37"],turtle:["\ud83d\udc22"],tv:["\ud83d\udcfa"],twisted_rightwards_arrows:["\ud83d\udd00"],two:["2\u20e3","2\ufe0f\u20e3"],two_hearts:["\ud83d\udc95"],two_men_holding_hands:["\ud83d\udc6c"],two_women_holding_hands:["\ud83d\udc6d"],u5272:["\ud83c\ude39"],u5408:["\ud83c\ude34"],u55b6:["\ud83c\ude3a"],u6307:["\ud83c\ude2f","\ud83c\ude2f\ufe0f"],u6708:["\ud83c\ude37"],u6709:["\ud83c\ude36"],u6e80:["\ud83c\ude35"],u7121:["\ud83c\ude1a","\ud83c\ude1a\ufe0f"],u7533:["\ud83c\ude38"],u7981:["\ud83c\ude32"],u7a7a:["\ud83c\ude33"],uk:["\ud83c\uddec\ud83c\udde7"],umbrella:["\u2614","\u2614\ufe0f"],unamused:["\ud83d\ude12"],underage:["\ud83d\udd1e"],unlock:["\ud83d\udd13"],up:["\ud83c\udd99"],us:["\ud83c\uddfa\ud83c\uddf8"],v:["\u270c","\u270c\ufe0f"],vertical_traffic_light:["\ud83d\udea6"],vhs:["\ud83d\udcfc"],vibration_mode:["\ud83d\udcf3"],video_camera:["\ud83d\udcf9"],video_game:["\ud83c\udfae"],violin:["\ud83c\udfbb"],virgo:["\u264d","\u264d\ufe0f"],volcano:["\ud83c\udf0b"],vs:["\ud83c\udd9a"],walking:["\ud83d\udeb6"],waning_crescent_moon:["\ud83c\udf18"],waning_gibbous_moon:["\ud83c\udf16"],warning:["\u26a0","\u26a0\ufe0f"],watch:["\u231a","\u231a\ufe0f"],water_buffalo:["\ud83d\udc03"],watermelon:["\ud83c\udf49"],wave:["\ud83d\udc4b"],wavy_dash:["\u3030"],waxing_crescent_moon:["\ud83c\udf12"],waxing_gibbous_moon:["\ud83c\udf14"],wc:["\ud83d\udebe"],weary:["\ud83d\ude29"],wedding:["\ud83d\udc92"],whale:["\ud83d\udc33"],whale2:["\ud83d\udc0b"],wheelchair:["\u267f","\u267f\ufe0f"],white_check_mark:["\u2705"],white_circle:["\u26aa","\u26aa\ufe0f"],white_flower:["\ud83d\udcae"],white_large_square:["\u2b1c","\u2b1c\ufe0f"],white_medium_small_square:["\u25fd","\u25fd\ufe0f"],white_medium_square:["\u25fb","\u25fb\ufe0f"],white_small_square:["\u25ab","\u25ab\ufe0f"],white_square_button:["\ud83d\udd33"],wind_chime:["\ud83c\udf90"],wine_glass:["\ud83c\udf77"],wink:["\ud83d\ude09"],wolf:["\ud83d\udc3a"],woman:["\ud83d\udc69"],womans_clothes:["\ud83d\udc5a"],womans_hat:["\ud83d\udc52"],womens:["\ud83d\udeba"],worried:["\ud83d\ude1f"],wrench:["\ud83d\udd27"],x:["\u274c"],yellow_heart:["\ud83d\udc9b"],yen:["\ud83d\udcb4"],yum:["\ud83d\ude0b"],zap:["\u26a1","\u26a1\ufe0f"],zero:["0\u20e3","0\ufe0f\u20e3"],zzz:["\ud83d\udca4"]},t=function(t,e){var n,r;
return n=t.charCodeAt(e),r=t.charCodeAt(e+1),n>=55296&&56319>=n&&r>=56320&&57343>=r?1024*(n-55296)+(r-56320)+65536:n},e=function(e){var n,r,o,i,s;for(r=e.length>2?[t(e,0),t(e,2)]:[t(e,0)],s=[],o=0,i=r.length;i>o;o++)n=r[o],s.push(n.toString(16));return s},a=function(t){return"https://d2ph5hv9wbwvla.cloudfront.net/emoji/2/"+encodeURIComponent(t)+".png"},o=Emojie.canRender("\ud83c\udc04")?function(t,e){return{elementName:"span",content:e,title:":"+t+":","class":"emojie"}}:function(t){return{src:a(t),title:":"+t+":","class":"emojie"}},h=_.keys(i).reverse(),l=0,c=h.length;c>l;l++)if(r=h[l],i[r])for(d=i[r],u=0,p=d.length;p>u;u++)s=d[u],emojie.register(s,o(r,s));window.emojie.custom=Emojie();for(r in i)s=i[r],s||window.emojie.custom.register(":"+r+":",{title:":"+r+":",src:a(r),"class":"emojie"});window.emojimoji.autocomplete=function(){var t;t=[];for(n in i)s=i[n],t.push(":"+n+":");return t}()}.call(this),function(){Flowdock.ActivityHeartbeats=function(){function t(t,e,n,r){this.connection=e,this.flows=r,this.lastFlowActivity={},this.activities=n.sampledBy(t.merge(n.changes()).delay(0),function(t,e){return{flow:t,flowChange:t===e}
})}return t.ACTIVITY_HEARTBEAT_INTERVAL=6e4,t.prototype.start=function(){return this.stopped=!1,this.setupEmitters()},t.prototype.stop=function(){return this.stopped=!0},t.prototype.userBecameActive=function(t){var e;return e=(new Date).getTime(),null==this.lastFlowActivity[t.id]||e-this.lastFlowActivity[t.id]>Flowdock.ActivityHeartbeats.ACTIVITY_HEARTBEAT_INTERVAL},t.prototype.setupEmitters=function(){return this.activities.onValue(function(t){return function(e){var n,r;return t.stopped?Bacon.noMore:(null!=e?e.flow:void 0)?(n=e.flow,r=(new Date).getTime(),e.flowChange||t.userBecameActive(n)?(t.sendHeartbeat(n,r),t.lastFlowActivity[n.id]=r):void 0):Bacon.more}}(this)),Bacon.interval(Flowdock.ActivityHeartbeats.ACTIVITY_HEARTBEAT_INTERVAL).onValue(function(t){return function(){return t.stopped?Bacon.noMore:t.flows.each(function(e){return e.get("open")?t.sendHeartbeat(e,t.lastFlowActivity[e.id]):void 0})}}(this))},t.prototype.sendHeartbeat=function(t,e){var n,r,o;if(null!=t&&((o=t.constructor)===Models.PrivateConversation||o===Models.Flow))return n=t.isPrivate()?{to:""+t.id}:{flow:t.id},r=null!=e?{last_activity:e}:{},this.connection.messages.push(_.extend(n,{event:"activity.user",content:{last_activity:e},persist:!1,tags:[]}))
},t}()}.call(this),function(){Flowdock.AudioNotifications=function(){function t(t,e,n){this.format=t,this.activeFlow=e,this.user=n,this._subscriptions=[],this.muted=!1}return t.create=function(t,e){var n;return n=this.format(),n?new Flowdock.AudioNotifications(n,t,e):void 0},t.format=function(){var t;return t=function(t){return _.find(["mp3","wav"],function(e){return Modernizr.audio[e]===t})},t("probably")||t("maybe")},t.prototype.consume=function(t){var e,n;return e=Models.Message.ignoreByFlow(t,Flowdock.appFocus.and(this.activeFlow)).filter(function(t){return function(e){return e.user!==t.user.id&&_.include(Models.Filter.Chat.prototype.event,e.event||new Models.Message(e).highlights(t.user))}}(this)),n=e.map(function(t){return function(e){var n;return n=new Models.Message(e),t.isMention(n)?"mention":"chat"}}(this)),this._subscriptions.push(n.onValue(function(t){return function(e){var n;return t.muted?void 0:null!=(n=t[e])?n.play():void 0}}(this)))},t.prototype.isMention=function(t){return t.get("to")?Number(t.get("to"))===this.user.id&&_.include(Models.Filter.Chat.prototype.event,t.get("event")):t.highlights(this.user)
},t.prototype.fromCurrentFlow=function(t){return this.activeFlow.sampledBy(t,function(t,e){return(null!=t?t.isFlow():void 0)&&(null!=t?t.id:void 0)===e.flow?e:(null!=t?t.isPrivate():void 0)&&null!=e.to&&t.isBetweenUsers([e.user,e.to])?e:!1}).filter(function(t){return t})},t.prototype.load=function(t,e){var n,r;return n={chat_or_mentions:["chat","mention"],mentions:["mention"],none:[]},r=Bacon.combineAsArray(t,e),this._subscriptions.push(r.onValues(function(t){return function(e,r){var o,i,s,a,l,u,c,p;for(u=["chat","mention"],i=0,a=u.length;a>i;i++)o=u[i],delete t[o];for(c=n[e],p=[],s=0,l=c.length;l>s;s++)o=c[s],p.push(t.loadSound(o,r));return p}}(this)))},t.prototype.loadSound=function(t,e){return this[t]=new Audio(""),this[t].src=Flowdock.audios[this.format][t],this[t].volume=e,$(this[t]).on("ended",function(e){return function(){return e[t].load()}}(this))},t.prototype.mute=function(t){return this.muted=t},t.prototype.cleanup=function(){var t,e,n,r,o;for(r=this._subscriptions,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t());
return o},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Flowdock.Collection=function(t){function n(t,e){(null!=e?e.flow:void 0)&&(this.flow=e.flow),this._unsubscribers=[],n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.addStream=function(t){return this._unsubscribers.push(t),t},n.prototype.consume=function(t){this.stream=t},n.prototype.unconsume=function(){var t,e,n,r;for(r=this._unsubscribers,e=0,n=r.length;n>e;e++)(t=r[e])();return this._unsubscribers=[],delete this.stream,this},n.prototype.cleanup=function(){return this.trigger("cleanup"),this.stopListening(),this.unconsume(),this.reset(),null!=this.flow&&(this.flow=null),this},n}(Backbone.Collection)}.call(this),function(){Flowdock.commit="166cd70009752d3440c097fa178c5a101480a6a2",Flowdock.assetHost="https://d2cxspbh1aoie1.cloudfront.net",Flowdock.icons={notification:"https://d2cxspbh1aoie1.cloudfront.net/images/flowdock-notification-icon.png",pivotaltracker:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/tracker-120-107756da758f8830e962164fc0fc6504.png",zendesk:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/zendesk_45-6122f93c019cea1f4da3778a5d5092a6.png",uservoice:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/uservoice_45-31e709f76cd7a02c5c991e036bee5291.png",jira:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/jira_45-e89e823794091d138bd99490032cf2e9.png",confluence:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/confluence_45-a314b9973542023722362e45bb2e7d62.png",git:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/git_45-3b981935eadca86c1cf53142963b0c8c.png",svn:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/subversion_45-b8831904ca93a4c4f008e3d668fdc3d1.png",mercurial:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/hg_45-ab4a7012021fdb1a299e350a75fa311e.png",kiln:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/kiln_45-83ac499289a15497180fa5ffd9b3034e.png",agilezen:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/agilezen_45-f60907b2cc333a2bf42959da94abf53b.png",scout:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/scout_45-38372ff0d40ac8e91c73e511029ce4db.png",twitter:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/twitter_48-54d8b2533e18869a19e8a10a03a98802.png",mail:"https://d2cxspbh1aoie1.cloudfront.net/images/function_icons/mail_48.png",rss:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/rss-120-274d9a9f62cc3fef56a3548bd10b1101.png",newrelic:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/newrelic_45-887e73141a4ebb00eb32227767233a18.png",defaultAvatar:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/owl/avatars/anonymous-120-a6d07830d52e06f8faa76f8086b65e67.png"},Flowdock.audios={wav:{chat:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/chat-f5c96abffbb559e251b965e057886181.wav",mention:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/mention-51ccdbcb7c7538f360c694f69d3294b0.wav"},mp3:{chat:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/chat-a3ebdb3515356edef60b69b41434b7c5.mp3",mention:"https://d2cxspbh1aoie1.cloudfront.net/owl-assets/mention-08f67e1c302ccaf1b1ce2cdaa3ac93df.mp3"}}
}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};t=function(t,e){var n,r,o;return r="view:"+t.toLowerCase()+":before",n="view:"+t.toLowerCase()+":after",o="on"+t,function(){var t,i,s,a;for(this.trigger(r),a=this.subviews,i=0,s=a.length;s>i;i++)t=a[i],_.isFunction(t[e])&&t[e]();return _.isFunction(this[o])&&this[o](),_.defer(function(t){return function(){return t.trigger(n)}}(this))}},Flowdock.HierarchicalView=function(e){function r(t){var e,n,o,i,s;if(this.subviews=[],(null!=t?t.flow:void 0)&&(this.flow=t.flow),r.__super__.constructor.apply(this,arguments),null!=this.model&&null!=this.modelEvents){o=this.modelEvents;for(e in o)n=o[e],_.isFunction(this[n])&&this.listenTo(this.model,e,this[n])}if(null!=this.collection&&null!=this.collectionEvents){i=this.collectionEvents;for(e in i)n=i[e],_.isFunction(this[n])&&this.listenTo(this.collection,e,this[n])
}if(null!=this.flow&&null!=this.flowEvents){s=this.flowEvents;for(e in s)n=s[e],_.isFunction(this[n])&&this.listenTo(this.flow,e,this[n])}}return n(r,e),r.prototype.modelEvents=void 0,r.prototype.collectionEvents=void 0,r.prototype.flowEvents=void 0,r.prototype.addStream=function(t){return this._unsubscribers||(this._unsubscribers=[]),this._unsubscribers.push(t),t},r.prototype.subview=function(t){if(!(t instanceof Flowdock.HierarchicalView))throw console.error("View is not an instance of HierarchicalView",t),new Error("View is not an instance of HierarchicalView");return this.subviews.indexOf(t)>=0||this.subviews.push(t),t},r.prototype.removeSubview=function(t,e){var n,r,o,i,s,a;for(null==e&&(e={}),r=this.findSubviews(t),i=0,s=r.length;s>i;i++)o=r[i],e.destroy!==!1&&o.destructor(e),this.stopListening(o),n=this.subviews.indexOf(o),n>-1&&([].splice.apply(this.subviews,[n,n-n+1].concat(a=[])),a);return r},r.prototype.findSubviews=function(t){var e,n,r,o,i,s;if(null==t)return[];if(this.subviews.indexOf(t)>=0)return[t];
for(o=this.subviews,s=[],n=0,r=o.length;r>n;n++)e=o[n],(e.model===t||null!=t.id===(null!=(i=e.model)?i.id:void 0))&&s.push(e);return s},r.prototype.destructor=function(t){var e,n,r,o,i,s,a,l;for(null==t&&(t={}),a=this.subviews.slice(0),r=0,i=a.length;i>r;r++)n=a[r],this.removeSubview(n,{removeDomElement:!1});if(this.subviews=[],this.trigger("destructor",t),null!=this._unsubscribers){for(l=this._unsubscribers,o=0,s=l.length;s>o;o++)(e=l[o])();this._unsubscribers=null}return this.undelegateEvents(),t.removeDomElement===!1?this.stopListening():this.remove(),this.flow&&(this.flow=null),this.model&&(this.model=null),this.collection?this.collection=null:void 0},r.prototype.triggerAttach=t("Attach","triggerAttach"),r.prototype.triggerDetach=t("Detach","triggerDetach"),r}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Flowdock.HierarchicalShortcutView=function(t){function n(){n.__super__.constructor.apply(this,arguments),null!=this.keyboardEvents&&this.listenToOnce(this,"view:attach:after",function(){var t;
return t=null!=this.keyboardEventFilter?Flowdock.app.shortcutStream.filter(this.keyboardEventFilter):Flowdock.app.shortcutStream,null!=t?this.addStream(t.filter(function(t){return function(e){return null!=t.keyboardEvents[e.action]}}(this)).onValue(function(t){return function(e){var n;return n=t.keyboardEvents[e.action],_.isFunction(n)||(n=t[t.keyboardEvents[e.action]]),null!=n?n.call(t,e):void 0}}(this))):void 0})}return e(n,t),n}(Flowdock.HierarchicalView)}.call(this),function(){String.capitalize=function(t){return t?t.replace(/^\w/,function(t){return t.toUpperCase()}):null}}.call(this),function(){var t,e,n=[].slice,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t={backspace:8,tab:9,enter:13,esc:27,spacebar:32,pagedown:33,pageup:34,home:35,end:36,left:37,up:38,right:39,down:40,"delete":46,forwardSlash:[47,191],numeric:[48,49,50,51,52,53,54,55,56,57],"?":63,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,comma:188},e={ctrl:"ctrlKey",alt:"altKey",meta:"metaKey",cmd:"metaKey",shift:"shiftKey"},t.cursor=[t.left,t.up,t.right,t.down],window.KeyEvent={keymap:t,modifierDown:function(t){return t.ctrlKey||t.altKey||t.metaKey
},is:function(){var o,i,s;return s=1<=arguments.length?n.call(arguments,0):[],o=_.flatten(s.map(function(t){return t.split(":")})),i=[],_.each(o,function(n){var r;return r={modifiers:[],keyCodes:[]},_.each(n.split("+"),function(n){var o,i;return(o=t[n])?r.keyCodes.push(o):(i=e[n])?r.modifiers.push(i):void 0}),r.keyCodes=_.flatten(r.keyCodes),i.push(r)}),function(t){var e;return"keypress"===t.type?(e=String.fromCharCode(t.which),r.call(o,e)>=0):null!=_.find(i,function(e){var n,o,i,s,a,l;for(o=[],a=["ctrlKey","altKey","metaKey","shiftKey"],i=0,s=a.length;s>i;i++)n=a[i],t[n]===!0&&o.push(n);return _.isEqual(o.sort(),e.modifiers.sort())?(l=t.which,r.call(e.keyCodes,l)>=0?!0:void 0):!1})}},not:function(){var e,o,i;return i=1<=arguments.length?n.call(arguments,0):[],e=_.flatten(function(){var e,n,r;for(r=[],e=0,n=i.length;n>e;e++)o=i[e],r.push(t[o]);return r}()),function(t){var n;return n=t.which,!(r.call(e,n)>=0)}}}}.call(this),function(){Flowdock.shortcutMap={web:{esc:function(){return document.activeElement.blur()
},"esc w":"closeTab","esc u":"toggleUserList","esc comma":"openPreferences","esc numeric":"navigateToNthTab","esc d":"quickMute","esc left":"previousTab","esc right":"nextTab","esc n":"newTab","esc t":"newTab","c:i":"focusChat",t:"openTagEditor",r:"focusComment","f:forwardSlash:/":"focusSearch",p:"pageUp",n:"pageDown",G:"scrollToBottom",g:"scrollToTop",t:"editItemTagEditor","j:down":function(t){return t.preventDefault(),"nextItem"},"k:up":function(t){return t.preventDefault(),"previousItem"},"enter:right:o":"selectItem",t:"openItemTagEditor","e:left":"editItem",tab:function(){var t;return t=window.lastFocusedInput.replace(/^[A-z]{1}/,function(t){return t.toUpperCase()}),"focus"+t},h:function(){return this.state.activeSide="inbox","onActivate"},l:function(){return this.state.activeSide="chat","onActivate"}},alwaysAvailable:{"?":"openHelp"},macGap:{"cmd+numeric":"navigateToNthTab","ctrl+tab":"nextTab","ctrl+shift+tab":"previousTab"}},Flowdock.KeyboardShortcuts=function(){function t(t,e){this.keydowns=t,this.shortcuts=e,this.state={}
}return t.build=function(t){return new this(keydownsNotInInput,t)},t.bind=function(e,n,r){var o,i;return null==r&&(r=[]),i=0===r.length?e.filter(KeyEvent.is(n[0])):(o=Bacon.later(1e3,!0),e.take(1).filter(KeyEvent.is(n[0])).takeUntil(o)),i.flatMap(function(o){return 1===n.length?Bacon.once(o):t.bind(e,n.slice(1),r.concat(o)).take(1)})},t._isNotInput=function(t){var e;return e=t.target||t.srcElement,!("INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName||e.contentEditable&&("true"===e.contentEditable||"plaintext-only"===e.contentEditable))},t.keyStream=function(){return Bacon.mergeAll([$(document).asEventStream("keydown").filter(function(t){return!(t.altKey||t.shiftKey)}),$(document).asEventStream("keypress").filter(function(t){return t.altKey||t.shiftKey})])},t.prototype.when=function(e){var n;return n=e.flatMapLatest(function(t){return function(e){return e?t.keydowns:Bacon.never()}}(this)),new t(n,this.shortcuts)},t.prototype.toStream=function(e){var n,r,o,i;return null==e&&(e=Bacon.constant(!0)),r=this.keydowns.filter(function(t){return 27===t.which||Flowdock.KeyboardShortcuts._isNotInput(t)
}),r=r.merge(e.flatMapLatest(function(t){return function(e){return e?t.keydowns.filter(function(t){return KeyEvent.modifierDown(t)}):Bacon.never()}}(this))),i=function(){var e,i;e=this.shortcuts,i=[];for(o in e)n=e[o],i.push(function(e){return function(n){return t.bind(r,o.split(" ")).map(function(t){var r;return r=_.isFunction(n)?n.call(e,t):n,new $.Event(t,_.extend({action:r},e.state))})}}(this)(n));return i}.call(this),Bacon.mergeAll(i).throttle(50)},t}(),Flowdock.KeyboardShortcuts.forMacGap=function(){return Bacon.mergeAll([new Flowdock.KeyboardShortcuts($(document).asEventStream("keydown"),Flowdock.shortcutMap.macGap).toStream(),$(document).asEventStream("macgapNextTab").map(function(t){return t.action="nextTab",t}),$(document).asEventStream("macgapPreviousTab").map(function(t){return t.action="previousTab",t}),$(document).asEventStream("macgapOpenTab").map(function(t){return t.action="newTab",t}),$(document).asEventStream("macgapCloseTab").map(function(t){return t.action="closeTab",t}),$(document).asEventStream("macgapOpenKeyboardHelp").map(function(t){return t.action="openHelp",t
}),$(document).asEventStream("macgapOpenChatCommandHelp").map(function(t){return t.action="openChatCommandHelp",t})])}}.call(this),function(){var t;t={titleFor:function(t){var e,n,r;return e=t.flow(),n=t.user(),e.isPrivate()?n.get("nick")||(null!=(r=Flowdock.app.users.get(n.id))?r.get("nick"):void 0)||"":n?""+n.get("nick")+" - "+e.fullName():e.fullName()},messageFilter:function(e,n,r){return Models.Message.ignoreByFlow(Models.Message.fromOpenFlows(e,n),t.ignoredFlow(r,Flowdock.appFocus)).filter(function(t){return String(t.user)!==String(Flowdock.app.user.id)}).filter(function(t){return t.id}).map(function(t){return new Models.Message(t)})},format:function(e){var n,r,o;try{return{title:t.titleFor(e),body:null!=(r=e.presenter())?r.summary():void 0,icon:null!=(o=e.user())?o.avatar(30):void 0}}catch(i){return n=i,console.error(n),console.error("Could not render notification for ",e)}},display:function(e,n){var r,o,i,s,a;return r=t.format(n),(null!=r?r.body:void 0)?(o=n.flow(),i="influx"===n.get("app")?function(){return Flowdock.app.router.navigateTo({message:n,flow:o})
}:n.parent()?function(){return Flowdock.app.router.navigateTo({message:n.parent(),flow:o})}:function(){var t;return null!=(t=Flowdock.app.router)?t.navigateBackToFlow(o):void 0},a="influx"===n.get("app")?n.id:n.parent()?n.parent():null,s=null!=o.path?o.path():o.isPrivate()?"private/"+o.id:void 0,e.closingNotification(r.title,{body:r.body,icon:r.icon,payload:JSON.stringify({flowPath:s,message:a}),onclick:function(){return i(),window.focus()}})):void 0},ignoredFlow:function(t,e){return t.map(function(t){return t||!1}).combine(e,function(t,e){return e?t:!1})}},Flowdock.messageDesktopNotifications=function(e,n,r,o){return t.messageFilter(n,r,o).onValue(function(n){return t.display(e,n)})},_.extend(Flowdock.messageDesktopNotifications,t)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Flowdock.NotificationCenter=function(){function e(e,n){var r;this.Notification=e,this.throttled=null!=n?n:!0,this.muteEnded=t(this.muteEnded,this),this.hasPermission=t(this.hasPermission,this),this.queueNotification=t(this.queueNotification,this),this.dispatchNotification=t(this.dispatchNotification,this),this.subscriptions=[],this.notifications=[],r=Flowdock.app.preferences.mute(),this.mutedQueue=[],this.noteBus=new Bacon.Bus,r.diff(!1,function(t,e){return t&&!e
}).filter(function(t){return t}).onValue(this.muteEnded),this.noteBus.filter(r).onValue(this.queueNotification),this.addStream(this.noteBus.filter(r.not()).filter(this.hasPermission).filter(function(t){return function(){return!t.throttlingRequired()}}(this)).onValue(this.dispatchNotification))}return e.prototype.notificationLimit=3,e.prototype.addStream=function(t){return this.subscriptions.push(t)},e.prototype.closingNotification=function(t,e){return null==e&&(e={}),this.noteBus.push({title:t,options:e})},e.prototype.dispatchNotification=function(t){var e,n,r,o,i,s;return n=(null!=(s=t.options)?s.onclick:void 0)||function(){},o=this.createNotification(t.title,_.omit(t.options,"onclick")),e=function(){return clearTimeout(i),setTimeout(function(){return o.close()},5e3)},i=setTimeout(function(){return o.close()},3e4),n&&o.addEventListener("click",n),o.addEventListener("show",e),o.addEventListener("close",r=function(t){return function(){return t.notifications=_.reject(t.notifications,function(t){return t===o}),setTimeout(function(){return n&&o.removeEventListener("click",n),o.removeEventListener("show",e),o.removeEventListener("close",r)
},0)}}(this)),this.notifications.push(o),o},e.prototype.createNotification=function(t,e){return new this.Notification(t,e)},e.prototype.queueNotification=function(t,e){return this.mutedQueue.push({title:t,options:e})},e.prototype.throttlingRequired=function(){return this.throttled&&this.notifications.length>=this.notificationLimit},e.prototype.hasPermission=function(){return"granted"===this.permissionLevel()},e.prototype.requestPermission=function(t){return null==this.Notification?(t&&t("denied"),void 0):this.Notification.requestPermission(function(e){return function(){return t(e.permissionLevel())}}(this))},e.prototype.permissionLevel=function(){var t,e;return null!=(null!=(t=this.Notification)?t.permission:void 0)?this.Notification.permission:(null!=(e=this.Notification)?e.permissionLevel:void 0)?this.Notification.permissionLevel():"denied"},e.prototype.muteEnded=function(){var t,e,n,r;if(this.mutedQueue.length<5)for(r=this.mutedQueue,e=0,n=r.length;n>e;e++)t=r[e],this.dispatchNotification(t.title,t.options);
else this.dispatchNotification({title:""+this.mutedQueue.length+" new messages",options:{body:"Sent while you were in Do Not Disturb mode.",onclick:function(){}}});return this.mutedQueue=[]},e.prototype.destructor=function(){var t,e,n,r;for(r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return this.mutedQueue=this.notifications=null},e.prototype.close=function(){var t,e,n,r;for(r=this.notifications,e=0,n=r.length;n>e;e++)t=r[e],t.close();return this.notifications=[]},e.create=function(t){var e;return e=new Flowdock.NotificationCenter(NotificationPolyfill.bestAlternative()),$(t).bind("beforeunload",function(){return e.close()}),e},e}()}.call(this),function(){var t,e;e=$(window).asEventStream("resize"),Flowdock.resize=t={window:{move:e,end:e.debounce(500)},splitter:{move:$(document).asEventStream("split-resize"),end:$(document).asEventStream("split-resize-end").debounce(10)}},_.extend(Flowdock.resize,{moves:Bacon.mergeAll([t.window.move,t.splitter.move]),ends:Bacon.mergeAll([t.window.end,t.splitter.end])})
}.call(this),function(){Flowdock.TitleManager=function(){function t(t,e,n){this.activityProperty=t,this.activeFlow=e,this.user=n.id||n}return t.prototype.start=function(){return Bacon.combineAsArray(this.activeFlow,this.activityProperty,Flowdock.app.preferences.mute()).flatMapLatest(function(t){var e,n,r,o;return n=t[0],e=t[1],r=t[2],r?Bacon.once([n,{chat:!1,mentions:0}]):(o=n?n.asProperty("name").changes().map([n,e]):Bacon.never(),Bacon.once([n,e]).merge(o))}).onValue(this.update)},t.prototype.update=function(e){var n,r;return r=e[0],n=e[1],Helpers.setWindowTitle(r,n.chat,n.mentions),t.setDockBadge(n.chat,n.mentions)},t.setDockBadge=function(t,e){return null!=window.macgap?macgap.dock.badge=e?""+e:t?"\u22ef":null:void 0},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Flowdock.Tutorial=function(){function n(e){this.cleanUpHelps=t(this.cleanUpHelps,this),this.tasks=e.tasks.filter(function(t){return null===t.completed_at
}),this.flow_id=e.flow,this.cleanups=[]}return n.prototype.isNew=function(){return this.tasks.some(function(t){return"chat"===t.name})},n.prototype.consume=function(t){var e,n,r,o,i;for(this._subscriptions=[],this._stream=t.filter(function(t){return function(e){return e.flow===t.flow_id&&e.id}}(this)),o=this.tasks,i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(this._subscriptions.push(this.whenTaskCompleted(e.name).take(1).onValue(function(t){return function(e){return t.onCompleted(e)}}(this))));return i},n.prototype.onCompleted=function(t){return $.post("/owl/tutorial",{completed:t,flow:this.flow_id,_method:"PUT"})},n.prototype.whenTaskCompleted=function(t){var e,n,r;return e={chat:this.chatTaskFilter,comment:this.commentTaskFilter,influx:this.inboxTaskFilter,invite:this.inviteTaskFilter},r={avatarupload:{event:"change:avatar",filter:this.avatarTaskFilter}},null!=e[t]?this._stream.filter(e[t]).map(function(){return t}):(n=r[t],Flowdock.app.user.asEventStream(n.event).filter(n.filter).map(function(){return t}))},n.prototype.cleanup=function(){var t,e,n,r;
for(r=this._subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return this._subscriptions=[],this.cleanUpHelps()},n.prototype.chatTaskFilter=function(t){var n;return!Flowdock.Tutorial.prototype.inviteTaskFilter(t)&&(n=t.event,e.call(Models.Filter.Chat.prototype.event,n)>=0)&&t.user===Flowdock.app.user.id},n.prototype.commentTaskFilter=function(t){return"comment"===t.event&&t.user===Flowdock.app.user.id},n.prototype.inboxTaskFilter=function(t){var e,n,r;return"mail"===t.event&&!(null!=(n=t.content.from)?null!=(r=n[0])?"function"==typeof(e=r.address).match?e.match(/.+@flowdock.com$/):void 0:void 0:void 0)},n.prototype.inviteTaskFilter=function(t){return"open-invitation-enable"===t.event||"action"===t.event&&"invite"===t.content.type||"backend.join.user"===t.event},n.prototype.avatarTaskFilter=function(t){return null!=t.avatar().match(/local/)},n.prototype.start=function(t){return this.flow=t,this.isNew()?("function"==typeof ga&&ga("send","event","tutorial","start"),this.viewInboxHelp(this.flow.inbox),this.viewUserBarHelp(this.flow.chat.users)):void 0
},n.prototype.viewInboxHelp=function(t){var e;return e=function(e){return function(){var n,r,o;return n=t.toolbar.$("button#inbox-settings").tipsy({gravity:"e",trigger:"manual",fallback:"Click here to set up integrations!"}),o="show",r=$(HoganTemplates["owl/templates/tutorial/inbox"].render()),t.messageList.$el.prepend(r.on("mouseenter mouseleave",function(){return n.tipsy(o),o="show"===o?"hide":"show"})),null!=n&&n.one("click",e.cleanUpHelps),e.cleanups.push(function(){return r.remove(),null!=n?n.off("click",e.cleanUpHelps):void 0})}}(this),t.messageList.on("render",e),this.cleanups.push(function(){return t.messageList.off("render",e)})},n.prototype.viewUserBarHelp=function(t){var e,n,r,o,i;return n=t.$("button#user-settings"),n.tipsy({gravity:"ne",trigger:"manual",fallback:"Click here to invite your team!"}),i="show",r=function(){var t,e;for(e=[],o=t=0;4>=t;o=++t)e.push($("<li>").addClass("dummy").append($("<div>").addClass("user-avatar").on("mouseenter mouseleave",function(){return n.toggleClass("hover").tipsy(i),i="show"===i?"hide":"show"
})));return e}(),e=function(){return t.$(".userbar.online").append(r)},t.on("render",e),n.one("click",this.cleanUpHelps),this.cleanups.push(function(o){return function(){return r=null,t.off("render",e),n.off("click",o.cleanUpHelps),t.$(".userbar.online .dummy").remove()}}(this))},n.prototype.cleanUpHelps=function(){return this.cleanups.forEach(function(t){return t()})},n.slides=[{name:"welcome",template:HoganTemplates["owl/templates/tutorial/slides/welcome"]},{name:"chat",template:HoganTemplates["owl/templates/tutorial/slides/chat"]},{name:"inbox",template:HoganTemplates["owl/templates/tutorial/slides/inbox"]}],n}()}.call(this),function(){var t;t=function(){function t(t){this.typing=t}return t.prototype.toStream=function(t){var e;return e=function(t,e){return t===e||void 0===t&&e===!1},this.typing.skipDuplicates(e).flatMapLatest(function(e){return e?Bacon.interval(t,e).merge(Bacon.once(e)):null!=e?Bacon.once(!1):Bacon.never()})},t.prototype.toMessages=function(t,e){var n;return n=this.toStream(e),t.flatMapLatest(function(t){return n.map(function(e){var n;
return n={event:"activity.user",content:{typing:e},persist:!1,tags:[]},t.isPrivate()?_.extend(n,{to:""+t.id}):_.extend(n,{flow:t.id})})})},t.prototype.when=function(e){var n;return n=e.flatMapLatest(function(t){return function(e){return e?t.typing:Bacon.constant(void 0)}}(this)),new t(n,this.interval)},t.build=function(e,n,r){return new t(this.asProperty(e,n,r))},t.asProperty=function(t,e,n){var r,o;return o=t.asEventStream("keyup",e).map(function(t){var e,n;return e=$(t.target),n=e.val(),n.length>0&&0!==n.indexOf("/")?e.attr("data-input-id"):!1}),r=t.asEventStream("reset",e).map(void 0),o.merge(r).flatMapLatest(function(t){var e;return e=Bacon.once(t),t?e.merge(Bacon.later(n,!1)):e}).toProperty()},t}(),Flowdock.TypingActivity=t}.call(this),function(){var t,e,n;Flowdock.UserActivity=t={IDLE_THRESHOLD:12e4,MOUSEMOVE_INTERVAL:5e3,KEYDOWN_INTERVAL:3e3},_.extend(t,{mousemoves:Bacon.throttledStream(document,"mousemove",t.MOUSEMOVE_INTERVAL),focuses:$(window).asEventStream("focus"),blurs:$(window).asEventStream("blur"),keydowns:Bacon.throttledStream(document,"keydown",t.KEYDOWN_INTERVAL)}),t.visibility=(n=Modernizr.prefixed("hidden",document,!1))?(e=n.replace(/[Hh]idden/,""),$(document).asEventStream(""+e+"visibilitychange").map(function(){return!document[n]
})):Bacon.never(),Flowdock.userActivity=Bacon.mergeAll([t.mousemoves,t.focuses,t.keydowns]),Flowdock.appFocus=Bacon.mergeAll([Flowdock.userActivity.flatMapLatest(function(){return Bacon.once(!0).merge(Bacon.later(t.IDLE_THRESHOLD,!1))}),t.visibility,t.blurs.map(function(){return!1})]).toProperty(!0).skipDuplicates(),Flowdock.windowFocus=Bacon.mergeAll([t.blurs.map(function(){return!1}),t.focuses.map(function(){return!0}),t.visibility]).toProperty(!0).skipDuplicates()}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=[].slice,o=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=540,e=720,Flowdock.WhiteSpaceControl=function(){function i(t,e){this.preference=t,this.resize=e,this.setClass=n(this.setClass,this),this.panelWidths=n(this.panelWidths,this),this.lowestWidth=n(this.lowestWidth,this),this.panelWidthToWhiteSpaceClass=n(this.panelWidthToWhiteSpaceClass,this),_.extend(this,Backbone.Events)}return i.prototype.klasses={body:"compact normal cozy",inbox:"compact-inbox normal-inbox cozy-inbox",chat:"compact-chat normal-chat cozy-chat"},i.prototype.start=function(){var t,e;
return Bacon.combineWith(this.pickLowest,this.resize.map(function(t){return function(){return t.panelWidthToWhiteSpaceClass(t.lowestWidth())}}(this)).toProperty(this.panelWidthToWhiteSpaceClass(this.lowestWidth())),this.preference).skipDuplicates().onValue(this.setClass),e=this.panelClassProperty(function(t){return function(){return t.panelWidthToWhiteSpaceClass(t.inboxWidth())}}(this)),t=this.panelClassProperty(function(t){return function(){return t.panelWidthToWhiteSpaceClass(t.chatWidth())}}(this)),e.onValue(function(t){return function(e){return t.setClass(e,"inbox")}}(this)),t.onValue(function(t){return function(e){return t.setClass(e,"chat")}}(this))},i.prototype.panelWidthToWhiteSpaceClass=function(n){return t>n?"compact":e>n?"normal":"cozy"},i.prototype.panelClassProperty=function(t){return this.resize.map(t).toProperty(t()).skipDuplicates()},i.prototype.lowestWidth=function(){return Math.min.apply(Math,this.panelWidths().filter(function(t){return t}))},i.prototype.panelWidths=function(){return[this.chatWidth(),this.inboxWidth()]
},i.prototype.chatWidth=function(){return $("#chat").width()},i.prototype.inboxWidth=function(){return $(".inbox-panel").width()},i.prototype.element=function(){return $("body")},i.prototype.pickLowest=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],o.call(t,"compact")>=0?"compact":o.call(t,"normal")>=0?"normal":"cozy"},i.prototype.setClass=function(t,e){var n,r,o;return e?(o=""+t+"-"+e,r="change-"+e):(o=t,r="change"),n=this.element(),this.trigger("before-"+r,t),n.removeClass(this.klasses[e||"body"]).addClass(o),this.trigger("after-"+r,t)},i}()}.call(this),function(t){function e(t){var e=t.toLowerCase();return e=e.replace(new RegExp("[\xe0\xe1\xe2\xe4\xe5]","g"),"a"),e=e.replace(new RegExp("\xe6","g"),"ae"),e=e.replace(new RegExp("\xe7","g"),"c"),e=e.replace(new RegExp("[\xe8\xe9\xea\xeb]","g"),"e"),e=e.replace(new RegExp("[\xec\xed\xee\xef]","g"),"i"),e=e.replace(new RegExp("\xf1","g"),"n"),e=e.replace(new RegExp("[\xf2\xf3\xf4\xf5\xf6]","g"),"o"),e=e.replace(new RegExp("\u0153","g"),"oe"),e=e.replace(new RegExp("[\xf9\xfa\xfb\xfc]","g"),"u"),e=e.replace(new RegExp("[\xfd\xff]","g"),"y")
}t.fn.autoComplete=function(n){if(window.addEventListener){var r={sort:!0};return t.extend(r,n),r.source instanceof Array?r.words=function(){return r.source}:"function"==typeof r.source&&(r.words=r.source),this.each(function(){function n(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var n=t.createTextRange(),r=n.duplicate();n.moveToBookmark(e.getBookmark()),r.setEndPoint("EndToStart",n);for(var o=0,i=0;i<r.text.length;i++)"\r\n"==r.text.substr(i,2)&&(o+=2,i++);return r.text.length+o}return 0}function o(t,e){for(var n=[],r=0,o=t.length,i=e.length,s=0;o>=s;s++)n[s]=[],n[s][0]=s;for(var a=0;i>=a;a++)n[0][a]=a;for(s=1;o>=s;s++)for(a=1;i>=a;a++){r=t[s]==e[a]?0:1;var l=n[s-1][a]+1,u=n[s][a-1]+1,c=n[s-1][a-1]+r;l>u&&(l=u),l>c&&(l=c),n[s][a]=l,s>1&&a>1&&t[s]===e[a-1]&&t[s-1]===e[a]&&(n[s][a]=Math.min(n[s][a],n[s-2][a-2]+r))}return n[o][i]}function s(){var s=n(x),l=x.value.substr(0,s).match(/\s?([^\s]+)$/);if(l&&(f=e(l[1])),!l||f.length<1||x.value.charAt(s)&&!x.value.charAt(s).match(/\s/))return[];
var u,c=f.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");u=a()?"^"+c+".*":".*"+c.split("").reduce(function(t,e){return"\\"===t.slice(-1)?t+e:f[0]===t?t+".*"+e:t+".{0,2}"+e})+".*";var p=RegExp(u,"i"),h=function(t){var e=(t||{}).aliases||[];return _.reduce(e.concat(t.word),function(t,e){return t||p.test(e)},!1)},d=_.pluck(jQuery.grep(r.cachedWords,h),"word");if(t.isFunction(r.sort)?d.sort(r.sort):r.sort===!0?d.sort():d.length<25&&d.sort(function(t,e){return o(f,t)>o(f,e)?1:-1}),1!=r.sort&&d.length<100){var m,g=[],y=[],v=f.toLowerCase();for(i=0;i<d.length;i++)m=d[i].toLowerCase(),m==v?g.unshift(d[i]):0==m.indexOf(v)?g.push(d[i]):y.push(d[i]);d=g.concat(y)}return d.slice(0,6)}function a(){if(r.hiddenComplete)if(r.hiddenCompleteLimiter instanceof Array){if(-1==r.hiddenCompleteLimiter.indexOf(f.charAt(0)))return!0}else if(f.charAt(0)==r.hiddenCompleteLimiter)return!0;return!1}function l(e){null!=selected&&selected.removeClass("selected"),selected=t(e).addClass("selected"),selectedWord=selected.text();for(var n=0;n<tagFields.length;n++)tagFields[n].text()==selectedWord&&(m=n)
}function u(){if(v=s(),T.empty(),tagFields=[],v.length>0){if(1==v.length&&v[0]==f)return;k=a(),k?(void 0!=r.excludeHidden&&(v=v.filter(function(t){return-1===r.excludeHidden.indexOf(t)})),selectedWord=v[m],c()):(v.forEach(function(e){field=t("<li class='tag-selector unselectable'>"),"function"==typeof r.displayHtml?field.append(r.displayHtml(e)):field.text(e),field.mouseover(function(){l(this)}),field.click(function(e){e.preventDefault(),p(),t(x).focus()}),T.prepend(field),tagFields.push(field)}),"function"!=typeof r.autoSelect||r.autoSelect(v[0])?(selected=tagFields[0].addClass("selected"),selectedWord=selected.text(),m=0):selected=selectedWord=m=void 0,r.el?T.appendTo(r.el).show():T.appendTo("body").show().css({bottom:t(window).height()-t(x).offset().top,left:t(x).offset().left,width:t(x).width()}),b=!0,g=void 0)}}function c(){w=y=m=g=selected=selectedWord=tagFields=void 0,T.hide(),b=!1}function p(){if(k&&m+1<v.length?m+=1:k&&(m=0),void 0==g&&(g=n(x)),void 0==w&&(w=x.value.substr(g)),void 0!=v[m]){if(r.completionHook)var t=g-f.length,e=r.completionHook(v[m],t);
else var e=v[m];var o=e.substr(f.length);if(x.value=x.value.substr(0,g-f.length)+e+w,y=g+o.length,x.focus(),x.selectionStart)x.setSelectionRange(y,y);else if(x.createTextRange){var i=x.createTextRange();i.collapse(!0),i.moveEnd("character",y),i.moveStart("character",y),i.select()}k?1==v.length&&(v=[]):c()}}function h(t){t.preventDefault(),t.stopImmediatePropagation()}function d(t){return t.altKey||t.ctrlKey||t.shiftKey}var f,m,g,y,v,w,b,k,x=this,T=t('<ul id="autocomplete" class="autocompleter"></ul>');t(x).bind("keydown","Return",function(t){b&&null!=selected&&(p(),h(t))}),t(x).bind("keydown","Tab",function(t){(b||k)&&t.preventDefault()}),t(x).bind("keyup",function(t){!b||38!=t.which&&40!=t.which?9!=t.which||d(t)||!b&&!k?39==t.which&&b?(h(t),c()):(b=!1,T.hide(),u()):(h(t),p()):t.preventDefault()}),t(x).bind("keydown","Up",function(t){b&&(t.preventDefault(),null==selected?(selected=T.children("li").last().addClass("selected"),selectedWord=selected.text(),m=0):selected.prev("li").length>0?(selected=selected.removeClass("selected").prev("li").addClass("selected"),selectedWord=selected.text(),m++):(null!=selected&&selected.removeClass("selected"),selected=selectedWord=m=void 0))
}),t(x).bind("keydown","Down",function(t){b&&(t.preventDefault(),null==selected?(selected=T.children("li").first().addClass("selected"),selectedWord=selected.text(),m=T.children("li").length-1):selected.next("li").length>0?(selected=selected.removeClass("selected").next("li").addClass("selected"),selectedWord=selected.text(),m--):(null!=selected&&selected.removeClass("selected"),selected=selectedWord=m=void 0))}),t(x).bind("blur",function(){setTimeout(function(){b&&c()},150)}),t(x).bind("focus",function(){r.cachedWords=r.words(),r.sanitizedCachedWords=r.cachedWords.map(function(t){return e((t||{}).word)}),u()})})}}}(jQuery),function(){jQuery.fn.delayedHover=function(t,e){return null==t&&(t="hover"),this.asEventStream("mouseenter",e).flatMap(function(t){var e,n,r,o;return r=$(t.currentTarget).asEventStream("mouseenter").map(!0),o=$(t.currentTarget).asEventStream("mouseleave").map(!1),e=r.merge(o).flatMapLatest(function(e){var n;return e?Bacon.never():(n=$(t.currentTarget).data("close-delay"),Bacon.later(n||0,{target:$(t.currentTarget),action:"close"}))
}),n=$(t.currentTarget).data("hover-delay"),Bacon.later(n||0,{target:$(t.currentTarget),action:"open"}).takeUntil(e).merge(e)}).skipDuplicates(function(t,e){return t.action===e.action}).onValue(function(e){return e.target.toggleClass(t,"open"===e.action),e.target.triggerHandler("hover-delay-"+e.action)}),this}}.call(this),function(){!function(t){var e,n,r,o;return r="filedragndrop",o="filedragndrop-intercept-overlay",e=function(e){var n,i;if(!this.data(""+r+".initialized"))return n=!1,i=t("<div id='"+o+"'></div>").addClass(e.overlayClass).on("dragleave."+r,function(t){i.detach(),e.dragleave(t),n=!1}).on("drop."+r,function(t){i.detach(),e.drop(t),n=!1}).data(""+r+".overlay-initialized",!0),this.on("dragenter."+r,function(){return function(r){n||(n=!0,r.originalEvent.dataTransfer&&_.any(r.originalEvent.dataTransfer.types,function(t){return"Files"===t})&&(r.preventDefault(),t(e.target).append(i),e.dragenter(r)))}}(this)),this.data(""+r+".initialized",!0)},n=function(){return this.data(""+r+".initialized",!1),this.off("."+r)
},t.fn.dragNDropFileEvents=function(r){var o;return null==r&&(r={}),"destroy"===r?(this.each(function(){return n.call(t(this))}),this):(o={dragenter:function(){},dragleave:function(){},drop:function(){},overlayClass:"overlay"},r=t.extend(o,r),this.each(function(){return e.call(t(this),r)}),this)}}(jQuery)}.call(this),function(){jQuery.fn.emojie=function(){return this.each(function(){var t;try{return emojie(this)}catch(e){t=e}})}}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};!function(e){var n,r,o,i,s,a,l,u,c,p,h,d;return r=9,n=8,h="    ",s=function(){return e(this).on("paste",function(t){return function(){return u.call(t)}}(this)),e(this).on("keydown",function(t){return function(e){return l.call(t,e)}}(this))},l=function(t){var e,s;switch(t.which){case r:if(t.ctrlKey||t.metaKey)return;if(t.preventDefault(),t.shiftKey)return o.call(this,this.selectionStart,this.selectionEnd);if(this.selectionStart!==this.selectionEnd)return i.call(this,this.selectionStart,this.selectionEnd);
if(this.selectionStart===this.selectionEnd&&(/\s/.test(this.value.slice(0,+(this.selectionStart-1)+1||9e9).slice(-1)[0])||0===this.selectionStart))return s=this.selectionStart+4,e=this.value.split(""),e.splice(this.selectionStart,0,"    "),this.value=e.join(""),this.setSelectionRange(s,s);break;case n:if(!(t.metaKey||t.ctrlKey||t.altKey||t.shiftKey)&&p.call(this))return t.preventDefault(),o.call(this,this.selectionStart,this.selectionEnd)}},p=function(){var t;return t=this.value.slice(0,+(this.selectionStart-1)+1||9e9).split("\n").slice(-1)[0],this.selectionStart===this.selectionEnd&&/(^|\n)[\s]{4}$/.test(t)},u=function(){var t;return t=this.selectionStart,setTimeout(function(e){return function(){return a.call(e,t)}}(this),0)},a=function(t){var e,n,r;return n=this.selectionStart,e=this.value.slice(t,n),e.match(/\n/g)?(r=this.value.slice(0,t)+e,"\n"!==r.slice(-1)&&(r+="\n"),this.value=r+this.value.slice(n,this.value.length),i.call(this,t,n),this.setSelectionRange(this.selectionEnd+1,this.selectionEnd+1)):void 0
},d=function(t){return"\n"===t[0]&&(t=t.substr(1,t.length-1)),"\n"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t},c=function(t,e){return t.setSelectionRange(e,e)},i=function(t,e){var n,r,o,i,s;return i=this,s=i.value.split("\n"),r=i.value.substr(0,t).split("").filter(function(t){return"\n"===t}).length,o=i.value.substr(0,e).split("").filter(function(t){return"\n"===t}).length,0===s[o].length&&(o-=1),n=_.map(s.slice(r,+o+1||9e9),function(t){return"    "+t}),[].splice.apply(s,[r,o-r+1].concat(n)),n,i.value=s.join("\n"),i.setSelectionRange(t+4,e+4*n.length)},o=function(e,n){var r,o,i,s,a,l,u,c,p,h,d;return i=this,a=i.value.split("\n"),l=function(){var t,e,n;for(n=[],t=0,e=a.length;e>t;t++)s=a[t],n.push(s);return n}(),r=i.value.substr(0,e).split("").filter(function(t){return"\n"===t}).length,o=i.value.substr(0,n).split("").filter(function(t){return"\n"===t}).length,p=0,h=a.slice(r,+o+1||9e9).map(function(t){return"    "===t.slice(0,4)?(p++,t.substr(4)):t}),[].splice.apply(a,[r,o-r+1].concat(h)),h,i.value=a.join("\n"),p?(d=h[0],c=t.call(l,d)>=0?e:e-4,u=o===r?n-4:n-4*p,i.setSelectionRange(c,u)):void 0
},e.fn.indentPaste=function(){return this.each(function(){return s.call(this)})}}(jQuery)}.call(this),function(){var t,e,n,r,o,i,s,a,l,u,c,p,h,d;t=function(t,e){return function(){return t.apply(e,arguments)}},u="reorderable",n=""+u+".data",o=function(t){return t.data(n)},c=function(t,e){return t.data(n,e)},d=function(){var t;return t=o(this),this.data?(c(this,null),this.off("."+u)):void 0},e=function(e){var n;return(n=o(this))?void 0:(n={},this.addClass(e.namespace).addClass(e.className),n.options=e,c(this,n),this.on("mousedown."+u,t(i,this)),this.on("mouseup."+u,t(a,this)),this.on("mousemove."+u,t(s,this)),this.on("dragstart."+u,function(t){return t.preventDefault(),!1}))},i=function(t){var e;if(2!==t.button)return e=o(this),e.mousePressed=!0,e.initialMouseCoordinates={pageX:t.pageX,pageY:t.pageY},e.timer=setTimeout(function(t){return function(){return p.call(t)}}(this),e.options.dragstartTimeout),e.offsetTriggered=!1},a=function(){return h.call(this)},s=function(t){var e,n;return e=o(this),e.mousePressed?(n=e.offsetTriggered,n||(n=Math.abs(t.pageX-e.initialMouseCoordinates.pageX)>=e.options.dragstartOffset,e.offsetTriggered=n),n?p.call(this):void 0):void 0
},p=function(){var e,n,i;return e=o(this),e&&!e.dragging?(e.dragging=!0,"static"===this.parent().css("position")&&this.parent().css({position:"relative"}),i=$("<div></div>"),i.css({position:"absolute",top:0,left:0,width:"100%",height:"100%","z-index":2001}),i.on("mousemove",t(l,this)),i.on("mouseup",t(r,this)),i.addClass(e.options.dragOverlayClass),n=this.clone(),n.css({width:this.width()+"px",height:this.height()+"px",left:this.position().left+"px",top:this.position().top+"px",position:"absolute"}),n.addClass(e.options.draggableClass),this.css({visibility:"hidden"}),e.overlay=i,e.draggable=n,e.initialElementCoordinates=this.position(),$("body").append(i),this.parent().append(n)):void 0},h=function(){var t,e,n,r,i;return t=o(this),null!=(n=t.overlay)&&n.off(),null!=(r=t.overlay)&&r.remove(),null!=(i=t.draggable)&&i.remove(),clearTimeout(t.timer),e=t.options,t={options:e},c(this,t),this.css({visibility:"visible"})},l=function(t){var e,n,r,i,s,a,l,u,c,p,h;return n=o(this),p=n.options,r=t.pageX-n.initialMouseCoordinates.pageX,c=n.initialElementCoordinates.left+r,n.draggable.css({left:c+"px"}),i=n.draggable.width(),e=this.parent().children("."+p.className).index(this),l=e<this.parent().children("."+p.className).length-2,a=e>0,u=this.next("."+p.className),h=this.prev("."+p.className),s=this.parent().children("."+p.className).first().offset().left,l&&c+i/2>u.offset().left-s?u.after(this):a&&c+i/2<h.offset().left+h.width()-s&&h.before(this),this
},r=function(){var t;return t=o(this).options,t.drop(this.parent().children("."+t.namespace).index(this)),h.call(this)},$.fn.reorderable=function(t){var n;return"destroy"===t?this.each(function(){return d.call($(this))}):(n={className:"tabs-reorderable",namespace:"reorderable",dragstartTimeout:500,dragstartOffset:20,draggableClass:"dragging",dragOverlayClass:"dragging-overlay",drop:function(){}},t=$.extend(n,t),this.each(function(){return e.call($(this),t)})),this}}.call(this),function(){var t;t=null,$.fn.scrollableInview=function(e,n){return null==e&&(e={}),"destroy"===e?this.each(function(){var t;return null!=(t=$(this).data("inview"))?t.unsubscribe():void 0}):"remove"===e?this.each(function(){var t,e,r,o;if(t=$(this),e=t.data("inview")){for(;(r=e.callbacks.indexOf(n))>=0;)[].splice.apply(e.callbacks,[r,r-r+1].concat(o=[])),o;return 0===e.callbacks.length?e.unsubscribe():void 0}}):this.each(function(){var n,r,o,i,s,a,l;return n=$(this),i=n.data("inview"),null!=i?(i.callbacks.push(e.onInview),void 0):(i={callbacks:[e.onInview]},r=$(e.scrollParent),0===r.length&&(r=n.parent()),l=function(){var t,e,n,r;
for(r=i.callbacks,e=0,n=r.length;n>e;e++)(t=r[e])();return i.unsubscribe()},o=function(){var t,o,i,s,a,u,c,p,h;if($.contains($("body")[0],n[0])&&r.is(":visible")){if(u=r.height(),p=r[0].scrollHeight,u>=p)return l();if(c=r.offset().top,a=n.offset().top,s=n.height(),e.fully){if(o=a>=c,t=u+c>=a+s,o&&t)return l()}else if(i=c>a+s,h=a>u+c,!i&&!h)return l()}},t||(t=Bacon.fromPoll(1e3,function(){return new Bacon.Next})),s=r.data("inview-scroll-stream"),s||(s=r.asEventStream("scroll").debounce(50).merge(t)),r.data("inview-scroll-stream",s),a=s.onValue(o),_.defer(o),i.unsubscribe=function(){return a(),n.data("inview",null)},n.data("inview",i))}),this}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n=[].slice;!function(r){var o,i;return o=function(){function e(e,n,o){this.left=e,this.right=n,this.normalizeSplitter=t(this.normalizeSplitter,this),this.setPosition=t(this.setPosition,this),this.options=r.extend({},this.defaults,o),this.dragEvents=this.options.touch?{end:["touchend","touchcancel"],start:"touchstart",move:"touchmove"}:{end:["mouseup","mouseout"],start:"mousedown",move:"mousemove"},this.dragEvents.end.push("split-resize-cancel"),this.splitter=r("<div>").addClass("split-resizer").css({position:"fixed",top:0,bottom:0}),this.splitter.insertAfter(this.right),r(function(t){return function(){return t.splitterWidth=t.splitter.width(),t.restoreAndPersistPosition()
}}(this)),this.behavior=[this.preventTextSelection(),this.dragToResize()]}var n;return e.prototype.defaults={container:r(window.document),key:null,touch:!!(null!=(n=window.Modernizr)?n.touch:void 0)},e["public"]=["destroy","cancel","storePosition"],e.prototype.destroy=function(){var t,e,n,r;for(r=this.behavior,e=0,n=r.length;n>e;e++)(t=r[e])();return this.splitter.remove(),this.left.off("split-resize-end"),this.left.off("split-resize"),this.right.off("split-resize-end"),this.right.off("split-resize")},e.prototype.cancel=function(){return this.splitter.trigger("split-resize-cancel"),this.resetPosition(this.originalSplitterPosition)},e.prototype.storePosition=function(t){return t||(t=this.toPercentage(this.left.width())),window.localStorage.setItem(this.options.key,JSON.stringify(t))},e.prototype.resetPosition=function(t,e){return null==e&&(e={}),_.defaults(e,{trigger:!1,neutralize:!0}),e.neutralize&&(t=Math.min(Math.max(t,25),75)),this.setPosition(t,{trigger:e.trigger}),this.normalizeSplitter(t,e)},e.prototype.restoreAndPersistPosition=function(){var t;
return t=!(!window.localStorage||!this.options.key),_.defer(function(e){return function(){var n;return n=e.toPercentage(e.left.width()),t&&(n=JSON.parse(window.localStorage.getItem(e.options.key))||n),e.resetPosition(n,{neutralize:!1,trigger:!0}),e.resetPosition(n,{neutralize:!0,trigger:!1})}}(this)),t?this.left.on("split-resize-end",function(t){return function(e,n){return t.storePosition(n)}}(this)):void 0},e.prototype.preventTextSelection=function(){return this.splitter.asEventStream(this.dragEvents.start).onValue(function(t){return t.preventDefault()})},e.prototype.dragToResize=function(){var t,e;return t=this.splitter.asEventStream(this.dragEvents.end.concat(this.dragEvents.start).join(" ")).map(function(t){return function(e){return e.type===t.dragEvents.start&&2!==e.button}}(this)).skipDuplicates(),e=null,t.onValue(function(t){return function(n){var r;return n?(t.spreadSplitter(),t.originalSplitterPosition=t.toPercentage(t.left.width()),e=t.splitter.asEventStream(t.dragEvents.move).map(function(e){var n,r,o;
return t.toPercentage(e.pageX||(null!=(n=e.originalEvent)?null!=(r=n.touches)?null!=(o=r[0])?o.pageX:void 0:void 0:void 0))}).skipDuplicates().onValue(t.setPosition)):e?(r=t.toPercentage(t.left.width()),t.normalizeSplitter(r,{trigger:!0}),e(),e=null):void 0}}(this))},e.prototype.setPosition=function(t,e){return null==e&&(e={trigger:!0}),t?(this.left.css("width",""+t+"%"),this.right.css("width",""+(100-t)+"%"),e.trigger?(this.left.trigger("split-resize",t),this.right.trigger("split-resize",100-t)):void 0):void 0},e.prototype.normalizeSplitter=function(t,e){return t||(t=this.toPercentage(this.left.width())),t?(this.splitter.css({width:"",left:""+t+"%","z-index":""}),this.splitter.css("margin-left",-this.splitterWidth/2),(null!=e?e.trigger:void 0)?(this.left.trigger("split-resize-end",t),this.right.trigger("split-resize-end",100-t)):void 0):void 0},e.prototype.spreadSplitter=function(){return this.splitter.css({width:"100%",left:0,"margin-left":0,"z-index":99999})},e.prototype.toPercentage=function(t){return(100*t/this.options.container.width()).toFixed(1)
},e}(),i=[],r.fn.splitResize=function(t){var r;if(this.length>1)throw new Error("Only one left-side element can be given at a time");return r=_.find(i,function(t){return function(e){return e.left===t}}(this)),r&&e.call(o["public"],t)>=0?(r[t](),"destroy"===t&&i.splice(i.indexOf(r),1)):t instanceof jQuery?i.push(function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(o,[this].concat(n.call(arguments)),function(){})):console.error("splitResize plugin called with invalid parameters. It was called for",this,"with params",arguments,"which yielded an existing object",r),this}}(jQuery)}.call(this),function(){var t,e,n,r;t=jQuery,t.fn.userAgentClass=r=function(t){var e;return null==t&&(t=window.navigator.userAgent),e=r.uaMatch(t),this.addClass(""+e.browser+" "+e.os),this},n=function(t){return/(ipad|iphone|ipad)/.exec(t)&&"ios"||/(android)/.exec(t)&&"android"||/(mac os x)/.exec(t)&&"macosx"||/(windows)/.exec(t)&&"windows"||/(linux)/.exec(t)&&"linux"||"other"},e=function(t){return(/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(t)||[]).slice(1)
},r.uaMatch=function(t){var r,o,i;return t=t.toLowerCase(),i=e(t),r=i[0],o=i[1],{browser:r||"",version:o||"0",os:n(t)}}}.call(this),function(){moment.lang("en-12h",{longDateFormat:{LT:"h:mm A",L:"MMM D",LL:"MMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D YYYY LT"}}),moment.lang("en-24h",{longDateFormat:{LT:"H:mm",L:"MMM D",LL:"MMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D YYYY LT"}}),moment.lang(window.locale||"en-24h")}.call(this),function(){var t,e,n,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};e=function(){function t(){this._listeners={}}return t.prototype.addEventListener=function(t,e){var n;return(n=this._listeners)[t]||(n[t]=[]),this._listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){var n;if(this._listeners[t])return this._listeners[t]=function(){var r,o,i,s;for(i=this._listeners[t],s=[],r=0,o=i.length;o>r;r++)n=i[r],n!==e&&s.push(n);return s
}.call(this)},t.prototype.dispatchEvent=function(t){var e,n,r,o,i;if(t.type&&("function"==typeof this["on"+t.type]&&this["on"+t.type](t),this._listeners[t.type])){for(o=this._listeners[t.type],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(e(t));return i}},t.prototype._event=function(t){var e;return e=document.createEvent("Event"),e.initEvent(t),e},t}(),t=function(t){function e(t,n){var r,o,i,s,a,l,u,c,p;for(null==n&&(n={}),e.__super__.constructor.apply(this,arguments),this.underlying=window.webkitNotifications.createNotification(n.icon,t,n.body),c=e.events,s=0,l=c.length;l>s;s++)o=c[s],this["on"+o]=n["on"+o];for(i=function(){var t,n,i,s;for(i=e.events,s=[],t=0,n=i.length;n>t;t++)o=i[t],s.push(this.removeEventListener(name,r));return s},r=function(t){return function(e){return t.dispatchEvent(e),"close"===e.type?i():void 0}}(this),p=e.events,a=0,u=p.length;u>a;a++)o=p[a],this.underlying.addEventListener(o,r);this.underlying.show()}var n;return o(e,t),e.events=["show","close","error","click"],e.available=null!=window.webkitNotifications&&!(null!=(null!=(n=window.Notification)?n.permission:void 0)),e.requestPermission=function(t){var e;
return null!=(e=window.webkitNotifications)?e.requestPermission(t):void 0},e.permissionLevel=function(){var t,e;return t=null!=(e=window.webkitNotifications)?e.checkPermission():void 0,0===t?"granted":2===t?"denied":"default"},e.prototype.close=function(){return this.underlying.close()},e}(e),n=function(t){function e(t,n){null==n&&(n={}),e.__super__.constructor.call(this),this.onclose=n.onclose,this.onerror=n.onerror,this.onshow=n.onshow,this._show({title:t,content:n.body,payload:n.payload})}var n;return o(e,t),e.available=null!=("undefined"!=typeof macgap&&null!==macgap?null!=(n=macgap.growl)?n.notify:void 0:void 0),e.permissionLevel=function(){return"granted"},e.requestPermission=function(t){return"function"==typeof t?t(this.permissionLevel):void 0},e.prototype._show=function(t){var e,n;return null!=("undefined"!=typeof macgap&&null!==macgap?null!=(n=macgap.growl)?n.notify:void 0:void 0)?(macgap.growl.notify(t),this.dispatchEvent(this._event("show")),setTimeout(function(t){return function(){return t.dispatchEvent(t._event("close"))
}}(this),5e3)):(e=this._event("error"),e.message("MacGap notifications not available"),this.dispatchEvent(e))},e.prototype.close=function(){},e}(e),window.NotificationPolyfill={polyfills:[n,t],bestAlternative:function(){var t,e;return t=function(){var t,n,r,o;for(r=NotificationPolyfill.polyfills,o=[],t=0,n=r.length;n>t;t++)e=r[t],e.available&&o.push(e);return o}(),t.length>0?t[0]:window.Notification},replace:function(){return window.Notification=NotificationPolyfill.bestAlternative()}}}.call(this),function(){var t,e,n,r,o;for(t=0,n=["ms","moz","webkit","o"],r=0,o=n.length;o>r;r++)e=n[r],window.requestAnimationFrame||(window.requestAnimationFrame=window[""+e+"RequestAnimationFrame"],window.cancelAnimationFrame=window[""+e+"CancelAnimationFrame"]||window[""+e+"CancelRequestAnimationFrame"]);window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n,r,o;return n=(new Date).getTime(),o=Math.max(0,16-(n-t)),r=setTimeout(function(){return e(n+o)},o),t=n+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){return clearTimeout(t)
}),Bacon.fromAnimationFramePoll=function(t,e){return new EventStream(function(n){var r,o,i;return o=void 0,r=function(){return window.requestAnimationFrame(function(){var t,r;return r=e(),t=n(r),t===Bacon.noMore||r.isEnd()?i():void 0})},i=function(){return clearInterval(o)},o=setInterval(r,t),i})}}.call(this),function(){var t,e;e=function(t,e){return t?t.length*e:0},t={punctuation:function(t){return e(t.match(/[\[\]\.\(\);=`]/g),1)},methodCalls:function(t){return e(t.match(/\w\.(?:[a-z][A-z]+)/g),10)},camelCase:function(t){return e(t.match(/(?:\b[A-Z]?[a-z]+[A-Z][a-z]+\b)/g),2)+e(t.match(/(?:\b[A-Z]?(?:[a-z]+)(?:[A-Z][a-z]+){2,}\b)/g),10)},snakeCase:function(t){return e(t.match(/(?:\b(?:[a-z]+_[a-z])+)/g),5)},indentation:function(t){return e(t.match(/^(  |\t)+[^\s\d-#\*]/gm),20)},score:function(e){return t.punctuation(e)+t.indentation(e)+t.snakeCase(e)+t.camelCase(e)+t.methodCalls(e)},detect:function(e){return e.length>8096?!1:t.score(e)/e.length>.1}},window.SourceDetector=t}.call(this),function(){var t;t=function(){function t(t){null==t&&(t={}),this.root=t
}return t.prototype.set=function(e,n){return t.set(this.root,e,n)},t.prototype.prefixed=function(e){return new t(t.prefixed(this.root,e))},t.prototype.values=function(){return t.values(this.root)},t.set=function(e,n,r){var o;return 0===n.length?e.end=r:(o=n[0],e[o]||(e[o]={}),t.set(e[o],n.slice(1),r))},t.prefixed=function(e,n){return 0===n.length?e:e[n[0]]?t.prefixed(e[n[0]],n.slice(1)):{}},t.values=function(e,n){var r,o;null==n&&(n=[]);for(r in e)o=e[r],"end"===r?n.push(o):t.values(o,n);return n},t}(),window.Trie=t}.call(this),function(){var t,e,n;n=function(t){return function(e){return t===e}},e=function(){return(new Date).getTime()},Models.Connection=function(){function r(){var t,r;this.outgoing={},this.flows=[],this.messages=new Bacon.Bus,this.states=new Bacon.Bus,this.connectionAlive=this.messages.filter(function(t){return t.id}).map(e).toProperty(e()),this.state=this.states.toProperty(Models.Connection.CONNECTING).skipDuplicates(),t=this.state.changes().errors().mapError(function(t){return t}).filter(function(t){return 11===(null!=t?t.code:void 0)
}),this.reconnectLoops=this.state.filter(n(Models.Connection.CLOSED)).map(e).slidingWindow(2).filter(function(t){return 2===t.length&&t[0]>e()-2e4}).map("Reconnect loop").changes(),this.forcedReconnects=t.merge(this.reconnectLoops),this.resetSocket(),this.state.onValue(function(t){return console.log("Connection state",t)}),r=this.state.filter(n(Models.Connection.OPEN)).changes().skip(1),this.ids=this.messages.scan({},function(t,e){return!e.id||"activity.user"===e.event&&t[e.flow]||(t[e.flow]=e.id),t}),Bacon.combineAsArray(this.ids,this.connectionAlive).onValue(function(){}),Bacon.combineAsArray(this.ids,this.connectionAlive).sampledBy(r).onValue(function(t){return function(n){var r,o,i,s;return i=n[0],r=n[1],r+Models.Connection.INACTIVITY_THRESHOLD>e()?(s=_.clone(t.outgoing),t.sync(i,function(e){return e?void 0:t.checkOutgoing(s)})):(console.log(new Date,"all flows invalid"),o=t.flows,t.flows=[],t.messages.error({error:"flow sync failed",flows:o}))}}(this)),this.state.filter(n(Models.Connection.CLOSED)).onValue(function(t){return function(){return t.messages.error("stream closed")
}}(this)),this.messages.filter(function(t){return!t.id}).onValue(function(t){return function(e){var n;return n=function(){return delete t.outgoing[e.uuid],t.messages.error(e)},e.uuid&&(t.outgoing[e.uuid]=n),t.socket.emit("message",e)}}(this)),this.messages.filter(function(t){return t.id}).onValue(function(t){return function(e){return delete t.outgoing[e.uuid]}}(this)),this.forcedReconnects.onValue(function(t){return function(e){return console.error(new Date,e),t.reconnect()}}(this))}return r.INACTIVITY_THRESHOLD=18e5,r.CONNECTING=0,r.OPEN=1,r.CLOSED=2,r.RECONNECTING=3,r.prototype.resetSocket=function(){var t;return this.socket=this.userSocket=null,t=this.connect(),this.socket=t.flows,this.userSocket=t.user,this.stateStream(this.socket),this.messagesStream(this.socket),this.messagesStream(this.userSocket)},r.prototype.checkOutgoing=function(t){var e,n,r,o;r=this.outgoing,o=[];for(n in r)e=r[n],t[n]?o.push(e()):o.push(void 0);return o},r.prototype.formatIncomingMessage=function(t){return t.user&&"string"==typeof t.user&&(t.user=parseInt(t.user,10)),t
},r.prototype.messagesStream=function(e){var n;return n=t(e,"message").map(function(t){return t[1]||t[0]}).map(this.formatIncomingMessage),this.messages.plug(n.takeUntil(this.forcedReconnects))},r.prototype.stateStream=function(t){var e,n,r,o,i,s;return n=Bacon.fromEventTarget(t,"connecting").map(function(){return Models.Connection.CONNECTING}),e=Bacon.fromEventTarget(t,"connect").map(function(){return Models.Connection.OPEN}),r=Bacon.fromEventTarget(t,"disconnect").map(function(){return Models.Connection.CLOSED}),i=Bacon.fromEventTarget(t,"reconnecting").map(function(){return Models.Connection.RECONNECTING}),o=Bacon.fromEventTarget(t,"reconnect").map(function(){return Models.Connection.OPEN}),Bacon.fromEventTarget(t,"error").onValue(function(t){return function(e){return t.messages.error(e)}}(this)),Bacon.fromEventTarget(t,"connect_failed").onValue(function(t){return function(e){return t.messages.error(e)}}(this)),s=Bacon.mergeAll([e,n,r,o,i,this.messages.errors()]).skipDuplicates().takeUntil(this.forcedReconnects),this.states.plug(s)
},r.prototype.subscribe=function(t,e){return this.flows.push(t),this.socket.emit("subscribe",t,!0,e)},r.prototype.unsubscribe=function(t,e){var n;return this.flows=function(){var e,r,o,i;for(o=this.flows,i=[],e=0,r=o.length;r>e;e++)n=o[e],n!==t&&i.push(n);return i}.call(this),this.socket.emit("unsubscribe",t,function(t){return t&&e?e():void 0})},r.prototype.sync=function(t,e){var n,r,o,i,s;for(n={},console.log(new Date,"sync",n),s=this.flows,o=0,i=s.length;i>o;o++)r=s[o],n[r]=t[r]||0;return this.socket.emit("resubscribe",n,function(t){return function(n,o){var i,s;if(n){if(o=t.flows,t.flows=[],t.messages.error({error:"flow sync failed",reason:n,flows:o}),"function"==typeof e)return e("sync failed: "+n)}else{i=[];for(r in o)s=o[r],s===!1&&i.push(r);if(t.flows=_.difference(t.flows,i),console.log("sync failed!",i),i.length>0&&t.messages.error({error:"flow sync failed",flows:i}),"function"==typeof e)return e()}}}(this))},r.prototype.disconnect=function(){var t,e,n;return e=this.socket.socket,e.options.reconnect=!1,n=this.userSocket,t=this.socket,this.socket.removeAllListeners(),this.userSocket.removeAllListeners(),e.removeAllListeners(),_.defer(function(){return e.disconnect(),t.disconnect(),n.disconnect()
}),io.sockets={}},r.prototype.reconnect=function(){return console.log("resetting connection"),this.disconnect(),setTimeout(function(t){return function(){return t.resetSocket(),t.states.push(Models.Connection.RECONNECTING)}}(this),1e3)},r.prototype.connect=function(){var t,e,n,r,o;return console.log("connecting"),(null!=(r=this.socket)?null!=(o=r.socket)?o.open:void 0:void 0)?void 0:(n="mobile"===window.platform&&"websocket"===io.transports[0]?io.transports.slice(1):io.transports,t={"max reconnection attempts":1/0,"reconnection limit":16e3,transports:n,resource:window.japiplexResource,"force new connection":!1},e={flows:io.connect(""+window.location.protocol+"//"+window.location.host+"/flow",t),user:io.connect(""+window.location.protocol+"//"+window.location.host+"/user",t)})},r}(),t=function(t,e){return new Bacon.EventStream(function(n){var r,o;return r=function(){var t;return t=n(new Bacon.Next(arguments)),t===Bacon.noMore?o():void 0},t.addEventListener?(o=function(){return t.removeEventListener(e,r,!1)},t.addEventListener(e,r,!1)):(o=function(){return t.removeListener(e,r)
},t.addListener(e,r)),o})}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.Emoji=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.colonized=function(){return":"+this.id+":"},n}(Backbone.Model)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Models.Filter=function(){function n(t){var e,n,r;null==t&&(t={}),(e=t.label)&&(this.label=e),null==this.event&&(this.event=[]),null==this.tags&&(this.tags=[]),_.isArray(t.event)?this.event=_.uniq(this.event.concat(t.event)):t.event&&(this.event=_.uniq(this.event.concat(t.event.split(",")))),_.isArray(t.tags)?this.tags=_.uniq(this.tags.concat(_.map(t.tags,function(t){return(null!=t?t.id:void 0)||t
}))):t.tags&&(this.tags=_.uniq(this.tags.concat(t.tags.split(",")))),("and"===(n=null!=(r=t.tagMode)?r.toLowerCase():void 0)||"or"===n)&&(this.tagMode=t.tagMode)}return n.prototype.tagMode="and",n.build=function(t){var e;return null==t&&(t={}),t.query?new Models.Filter.Search(t):t.slug&&Models.Filter.filterMap()[t.slug]?new(e=Models.Filter.filterMap()[t.slug])(t):new Models.Filter(t)},n.fromQuery=function(t,e){var n;return null==t&&(t=""),null==e&&(e={}),n=_.extend(e,{slug:t}),Models.Filter.build(n)},n.filterMap=function(){return{all:Models.Filter.All,inbox:Models.Filter.Inbox,chat:Models.Filter.Chat,files:Models.Filter.Files,links:Models.Filter.Links,threads:Models.Filter.Threads}},n.labelMap=function(){return{rss:"RSS",pivotaltracker:"Pivotal",mail:"Mail",twitter:"Twitter",vcs:"Git",jira:"JIRA",zendesk:"Zendesk",mercurial:"Bitbucket",hg:"Mercurial",svn:"Subversion",kiln:"Kiln",confluence:"Confluence",uservoice:"Uservoice",agilezen:"AgileZen",scout:"Scout",trello:"Trello",rally:"Rally",newrelic:"New Relic"}},n.prototype.className=function(){return this.slug?"all"===this.slug?this.slug:this.slug+"-only":1===this.event.length?this.event[0]:void 0
},n.prototype.subsetOf=function(t){return this.isAll()&&!t.isAll()?!1:this.query===t.query&&0===_.difference(t.tags,this.tags).length&&0===_.difference(this.event,t.event).length},n.prototype.isEqual=function(t){return t.subsetOf(this)&&this.subsetOf(t)},n.prototype.notEqual=function(t){return!this.isEqual(t)},n.prototype.isAll=function(){return 0===this.event.length&&0===this.tags.length&&!this.query},n.prototype.matchesTo=function(t){var e,n;return e=function(t){return function(e){return _.isArray(t.event)&&t.event.length>0?_.include(t.event,e.event):!0}}(this),n=function(t){return function(e){var n,r,o,i;if(_.isArray(t.tags)&&t.tags.length>0){if("or"===t.tagMode){for(i=t.tags,r=0,o=i.length;o>r;r++)if(n=i[r],_.include(e.tags,n))return!0;return!1}return 0===_.difference(t.tags,e.tags).length}return!0}}(this),!this.query&&e(t)&&n(t)},n.prototype.normalize=function(t){return this.tags=this.tags.map(function(e){return t.tags.getByHumanized(e).id})},n.prototype.merge=function(t){return Models.Filter.build({slug:t.slug||this.slug,event:this.event.concat(t.event),tags:this.tags.concat(t.tags),query:t.query||this.query})
},n.prototype.url=function(t){return""+(this.slug||"")+Helpers.generateQuery(this.asVisibleParams(t))},n.prototype.asVisibleParams=function(n){return e({event:this.slug?_.difference(this.event,this.constructor.prototype.event):this.event,tags:t(this.slug?_.difference(this.tags,this.constructor.prototype.tags):this.tags,n),query:this.query})},n.prototype.asParams=function(){var t;return e({event:this.event,tags:this.tags,search:this.query,tag_mode:(null!=(t=this.tags)?t.length:void 0)?this.tagMode:void 0})},n.prototype.inboxFilter=function(){return"inbox"===this.slug||this.event.length>0&&_.all(this.event,function(t){return _.include(Models.Filter.Inbox.prototype.event,t)})},n.prototype.getLabel=function(){var t;return this.label?this.label:1===this.event.length&&(t=Models.Filter.labelMap()[this.event[0]])?t:""+this.event.length+" Events"},n}(),Models.Filter.Inbox=function(n){function o(t){var e;null==t&&(t={}),o.__super__.constructor.apply(this,arguments),(null!=(e=t.event)?e.length:void 0)&&(this.event=_.isArray(t.event)?t.event:t.event.split(","))
}return r(o,n),o.prototype.slug="inbox",o.prototype.label="Inbox",o.prototype.event=["mail","twitter","rss","vcs","pivotaltracker","jira","zendesk","mercurial","hg","svn","kiln","agilezen","confluence","uservoice","scout","trello","rally","newrelic"],o.prototype.className=function(){return 1===this.event.length?this.event[0]:"inbox-only"},o.prototype.getLabel=function(){return 1===this.event.length?Models.Filter.labelMap()[this.event[0]]:this.label},o.prototype.inboxFilter=function(){return!0},o.prototype.asVisibleParams=function(n){return e({event:this.event.length>1?_.difference(this.event,this.constructor.prototype.event):this.event,tags:t(this.tags,n)})},o}(Models.Filter),Models.Filter.Chat=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.slug="chat",e.prototype.label="Chat",e.prototype.event=["message","comment","file","action","status","user-edit","line"],e}(Models.Filter),Models.Filter.All=function(t){function e(){return e.__super__.constructor.apply(this,arguments)
}return r(e,t),e.prototype.slug="all",e.prototype.label="All",e.prototype.event=Models.Filter.Chat.prototype.event.concat(Models.Filter.Inbox.prototype.event),e}(Models.Filter),Models.Filter.Files=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.slug="files",e.prototype.label="Files",e.prototype.event=["file"],e}(Models.Filter),Models.Filter.Links=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.slug="links",e.prototype.label="Links",e.prototype.tags=[":url"],e}(Models.Filter),Models.Filter.Threads=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.slug="threads",e.prototype.label="Threads",e.prototype.tags=[":thread"],e}(Models.Filter),Models.Filter.Comments=function(t){function e(t,n){this.parent=t,null==n&&(n={}),e.__super__.constructor.call(this,n)}return r(e,t),e.prototype.subsetOf=function(){return!1},e.prototype.matchesTo=function(t){return this.parent.id&&_.include(t.tags,"influx:"+this.parent.id)&&e.__super__.matchesTo.call(this,t)
},e.prototype.asParams=function(){var t,n;return t=e.__super__.asParams.apply(this,arguments),null!=this.parent.id&&(n="influx:"+this.parent.id,null!=t.tags?t.tags+=","+n:t.tags=n),t},e}(Models.Filter),Models.Filter.Search=function(t){function e(t){null==t&&(t={}),this.query=t.query,this.tags=[]}return r(e,t),e.prototype.slug="search",e.prototype.label="Search",e.prototype.event=Models.Filter.All.prototype.event,e}(Models.Filter),e=function(t){return _.reduce(t,function(t,e,n){return n&&(null!=e?e.length:void 0)&&(t[n]=_.isArray(e)?e.join(","):e),t},{})},t=function(t,e){return t.map(function(t){return t=e.tags.getOrAdd(t).humanize(),"#"===t[0]?t.slice(1):t})}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Models.Flow=function(e){function r(e){null==e&&(e={}),this.eventStreamFilter=t(this.eventStreamFilter,this),this.tags=new Collections.Tags([],{flow:this}),this.users=new Collections.Users([],{flow:this}),this.invitations=new Collections.Invitations([],{flow:this}),this.sources=new Collections.Sources([],{flow:this}),this.emoji=new Collections.Emoji([],{flow:this}),this.fullyLoaded=new $.Deferred,r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.isFlow=function(){return!0},r.prototype.isPrivate=function(){return!1},r.prototype.url=function(){return Helpers.apiUrl(this.get("url")||Helpers.apiUrl("/flows/"+this.path()))},r.prototype.email=function(){return this.get("email")},r.prototype.initialize=function(t){return this.options=t,this.stream=new Bacon.Bus,this.subscriptions=[],this.subscriptions.push(this.stream.onValue(function(t){return function(e){return"activity.user"!==e.event?console.log("Flow "+t.path()+" received",e.id?"":"a new ",e.event,"message",e.id?e.id:""):void 0}}(this))),this.subscriptions.push(this.stream.filter(function(t){return 0===t.event.indexOf("open-invitation-")}).onValue(function(t){return function(e){return"open-invitation-enable"===e.event?t.set("join_url",e.content.url):"open-invitation-disable"===e.event?t.unset("join_url"):void 0}}(this))),this.tags.consume(this.stream),this.users.consume(this.stream),this.invitations.consume(this.stream),this.sources.consume(this.stream),this.emoji.consume(this.stream)
},r.prototype.me=function(){return this.users.get(Flowdock.app.user.id)},r.prototype.path=function(){return this.get("url")?this.get("url").split("/").slice(-2).join("/"):this.get("organization_subdomain")},r.prototype.fullName=function(){return""+this.get("name")+" ("+this.get("organization").name+")"},r.prototype.organization=function(){return this.get("organization").id},r.prototype.consume=function(t){return this.stream.plug(t.filter(this.eventStreamFilter)),this},r.prototype.subscribe=function(t){return t.subscribe(this.id,function(t){return function(e,n){return console.log("Subscribed to flow",t.path(),e,n),e?t.trigger("subscribe-failed",t):(t.set(t.parse(_.extend(n,{open:!0}))),t.trigger("flow-fully-loaded")),e?(console.log("Rejecting promise"),t.fullyLoaded.reject()):(console.log("Resolving promise"),t.fullyLoaded.resolve())}}(this)),this.fullyLoaded.promise()},r.prototype.unsubscribe=function(t){return t.unsubscribe(this.id),this.reset()},r.prototype.buildMessage=function(t,e){return null==e&&(e=Models.Message),new e(_.extend({flow:this.id},t))
},r.prototype.cleanup=function(){var t,e,n,r,o,i,s,a,l;for(r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return null!=(o=this.tags)&&o.cleanup(),null!=(i=this.users)&&i.cleanup(),null!=(s=this.invitations)&&s.cleanup(),null!=(a=this.sources)&&a.cleanup(),null!=(l=this.emoji)&&l.cleanup(),this.tags=null,this.users=null,this.invitations=null,this.sources=null,this.emoji=null,this.subscriptions=[]},r.prototype.reset=function(){return"pending"===this.fullyLoaded.state()&&this.fullyLoaded.reject(),this.fullyLoaded=new $.Deferred,this.tags.reset(),this.users.reset(),this.invitations.reset(),this.sources.reset(),this.emoji.reset(),this.trigger("flow-unloaded",this)},r.prototype.set=function(t,e){var n,o,i,s,a,l,u,c,p;if(null==e&&(e={}),t.users&&this.users.reset(t.users),t.tags&&this.tags.reset(function(){var e,r;e=t.tags,r=[];for(a in e)n=e[a],r.push({id:a,count:n});return r}()),t.invitations&&this.invitations.reset(t.invitations),t.sources&&this.sources.reset(t.sources),t.emoji&&this.emoji.reset(t.emoji),delete t.tags,delete t.users,delete t.invitations,delete t.sources,delete t.emoji,(null!=t?null!=(u=t.url)?u.match(/https?:\/\/api\./):void 0:void 0)&&(l=t.url.replace("api.","www."),s=null!=(c=l.match(/https?:\/\/[\w\.]+(?=\/)/))?c[0]:void 0,null!=s&&(t.url=l.replace(s,""+s+"/rest"))),null!=(null!=t?t.url:void 0)&&t.url!==this.get("url")&&null!=this.get("_links")&&null==t._links){p=this.get("_links");
for(o in p)i=p[o],null!=i.href&&(i.href=i.href.replace(this.get("url"),t.url))}return r.__super__.set.apply(this,arguments)},r.prototype.eventStreamFilter=function(t){return t.flow===this.id},r.prototype.typingUsers=function(t){return this.users.typing.map(function(e){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r],n.id===t&&i.push(n.user);return i})},r.prototype.enableJoinUrl=function(){return this.can("post","join_url")?$.ajax(this.resourceUrl("join_url"),{dataType:"json",type:"POST",success:function(t){return function(e){return t.set("join_url",e.join_url)}}(this)}):(new $.Deferred).reject()},r.prototype.disableJoinUrl=function(){return this.can("delete","join_url")?this.fullyLoaded.then(function(t){return function(){var e;return e=t.get("join_url"),t.unset("join_url"),$.ajax(t.resourceUrl("join_url"),{type:"POST",data:{_method:"delete"},error:function(){return t.set({join_url:e})}})}}(this)):(new $.Deferred).reject()},r.prototype.combinedAccessMode=function(){return""+this.get("access_mode")+";"+(this.has("join_url")?"link":"no-link")
},r.prototype.resetToken=function(){return $.post(this.resourceUrl("api_token")).done(function(t){return function(e){return t.set("api_token",e.api_token)}}(this))},r.prototype.renameUrl=function(){return this.get("url")+"/rename"},r.prototype.rename=function(t,e){var n;return null==e&&(e=!1),n={flow:{name:t}},e&&(n.flow.parameterized_name=e),$.ajax({url:this.renameUrl(),type:"put",data:n,dataType:"json"})},r.prototype.emojiKeys=function(){return this.emoji.keys()},r}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Models.FlowActivity=function(e){function r(){return this.flowActivated=t(this.flowActivated,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.defaults={chat:!1,mentions:0,inbox:!1,active:!1},r.prototype.initialize=function(t,e){return this.flow=e.flow,this.userId=e.userId,this.inbox=new Collections.InboxMessages([],{flow:this.flow}),this.chat=new Collections.ChatMessages([],{flow:this.flow}),this.mentions=new Collections.UnreadMentionsMessages([],{flow:this.flow,userId:this.userId}),this.lastMessage=null,this.subscriptions=[],r.__super__.initialize.apply(this,arguments),this._setupEvents()
},r.prototype.consume=function(t,e){var n,r,o,i,s,a;for(n=e.map(function(t){return function(e){return(null!=e?e.id:void 0)===t.flow.id}}(this)).skipDuplicates().toProperty(),this.subscriptions.push(n.onValue(function(t){return function(e){t.active=e}}(this))),this.subscriptions.push(n.filter(function(t){return t}).onValue(this.flowActivated)),o=Models.Message.ignoreByFlow(t,e,this.userId).filter(function(t){return function(e){return t.userId!==(null!=e?e.user:void 0)}}(this)),a=["inbox","chat"],i=0,s=a.length;s>i;i++)r=a[i],this[r].consume(o);return this.mentions.consume(t)},r.prototype.unconsume=function(){var t,e,n,r;for(r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return this.subscriptions=[]},r.prototype.cleanup=function(){var t,e,n,r;for(this.unconsume(),this.stopListening(),r=[this.inbox,this.chat,this.mentions],e=0,n=r.length;n>e;e++)t=r[e],t.cleanup();return this.inbox=this.chat=this.mentions=this.flow=this.active=null},r.prototype._setupEvents=function(){return this.listenTo(this.inbox,"add",this.newInboxMessage),this.listenTo(this.chat,"add",this.newChatMessage),this.listenTo(this.mentions,"add",this.updateMentions),this.listenTo(this.mentions,"change",this.updateMentions),this.listenTo(this.mentions,"historyAdd",this.updateMentions)
},r.prototype.newInboxMessage=function(){return this.set({inbox:!0}),this.inbox.reset()},r.prototype.newChatMessage=function(t){return this.chat.reset(),null!=this.lastMessage&&t.id&&this.lastMessage>t.id||(this.lastMessage=t.id,this.ignoredChatMessage(t))?void 0:this.set({chat:!0})},r.prototype.updateMentions=function(){return this.set({mentions:this.mentions.unread().length})},r.prototype.flowActivated=function(){return this.set({inbox:!1,chat:!1}),this.updateMentions()},r.prototype.set=function(t){return this.active&&(t.inbox=!1,t.chat=!1),r.__super__.set.apply(this,arguments)},r.prototype.ignoredChatMessage=function(t){return"user-edit"===t.get("event")||"action"===t.get("event")&&"join"===t.get("content").type},r}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.Invitation=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.url=function(){return this.get("url")?Helpers.apiUrl(this.get("url")):n.__super__.url.apply(this,arguments)},n.prototype.resend=function(t){return $.post(this.collection.url(),{email:this.get("email")},function(e){return(null!=t?t.success:void 0)?t.success(e):void 0}).error(function(e){return(null!=t?t.error:void 0)?t.error(e):void 0})},n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Models.Message=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.defaults={event:"message",content:"",tags:[]},r.prototype.sync=Flowdock.socketIoSync,r.prototype.initialize=function(t,e){return null==t&&(t={}),null==e&&(e={}),t.uuid||this.set("uuid",this.generateUuid()),e.flow&&(this._flow=e.flow,this.set({flow:e.flow.id})),e["private"]&&(this._private=e["private"],this.set({to:e["private"].id})),this.comments=new Collections.CommentMessages([],{flow:this.flow(),message:this,fresh:e.fresh})
},r.fromOpenFlows=function(t,e){return t.filter(function(t){var n;return t.to||(null!=(n=e.get(t.flow))?n.get("open"):void 0)})},r.ignoreByFlow=function(t,e){return e.map(function(t){return t||!1}).sampledBy(t,function(t,e){return t?t.isFlow()&&null!=e.flow&&e.flow===t.id?!1:t.isPrivate()&&null!=e.to&&t.isBetweenUsers([e.user,e.to])?!1:e:e}).filter(function(t){return t})},r.highlightStream=function(t,e){return t.filter(function(t){return new Models.Message(t).highlights(e)})},r.prototype.url=function(){return""+this.flow().url()+"/messages/"+this.id},r.prototype.flow=function(){return this._flow?this._flow:this.collection?this.collection.flow:null==Flowdock.app?null:this.get("to")?Flowdock.app.privates.get(this.get("to"))||Flowdock.app.privates.get(this.get("user")):Flowdock.app.flows.get(this.get("flow"))},r.prototype.tags=function(){var t,e,n,r,o;for(r=this.get("tags"),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.flow().tags.getOrAdd(t));return o},r.prototype.humanTags=function(){return _.filter(this.tags(),function(t){return t.humanize()
})},r.prototype.generateUuid=function(){var t,e;return t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz-_",function(){var n,r;for(r=[],e=n=0;16>n;e=++n)r.push(t.charAt(Math.floor(Math.random()*t.length)));return r}().join("")},r.prototype.myMessage=function(){var t,e,n,r,o;return e=null!=(n=this.user())?n.id:void 0,t=null!=(r=this.flow())?null!=(o=r.me())?o.id:void 0:void 0,e&&t&&e===t},r.prototype.editable=function(){var t;return"message"===(t=this.get("event"))||"comment"===t},r.prototype.getContent=function(){return"comment"===this.get("event")?this.get("content").text:"message"===this.get("event")?this.get("content"):void 0},r.prototype.searchReplaceContent=function(t,e){var n,r;if(this.editable())return r=function(t,e,n){var r;return r=t.replace(RegExp(e,"gi"),n),r!==t?r:void 0},"comment"===this.get("event")?n=r(this.get("content").text,t,e):"message"===this.get("event")&&(n=r(this.get("content"),t,e)),this.updateContent(n)},r.prototype.updateContent=function(t,e){return _.isString(t)?("comment"===this.get("event")?this.set({content:_.extend(this.get("content"),{text:t})}):"message"===this.get("event")&&this.set("content",t),this.saveWithRetry(e)):void 0
},r.prototype.removable=function(){return"influx"===this.get("app")?!0:"file"===this.get("event")&&this.myMessage()},r.prototype.user=function(){var t,e;return this.has("external_user_name")?new Models.ExternalUser({nick:this.get("external_user_name")}):0===(t=this.get("user"))||"0"===t||null===t?new Models.DefaultUser:this.flow()?(e=this.get("event"),n.call(Models.Filter.Chat.prototype.event,e)>=0?this.flow().users.getOrAdd(this.get("user")):this.flow().users.get(this.get("user"))):void 0},r.prototype.isValid=function(){var t;return this.attributes.flow||this.attributes.to?("message"===(t=this.attributes.event)||"line"===t)&&this.attributes.content.trim().length<=0?!1:!0:!1},r.prototype.presenter=function(t){var e,n,r,o,i;return r=null!=(i=this.user())?i.toJSON():void 0,e="function"==typeof(o=this.flow()).path?o.path():void 0,n={user:r,users:this.flow().users.toJSON(),flowPath:e,sent:this.get("sent")},Presenters.createPresenter(this.get("event"),this.get("content"),_.extend(n,t))},r.prototype.appendedAttachments=function(){return(this.get("attachments")||[]).filter(function(t){return!t.content_disposition||!t.content_disposition.match(/^inline/)
})},r.prototype.previousTags=function(t){var e,n,r,o,i,s;return null==t&&(t=!1),o=this.previousAttributes().tags,n=this.get("tags"),e=_.difference(n,o),i=_.difference(o,n),r=function(t){return function(e){return t.collection?t.collection.flow.tags.getOrAdd(e):new Models.Tag({id:e})}}(this),t?{add:e,remove:i}:{add:function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)s=e[t],o.push(r(s));return o}(),remove:function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)s=i[t],n.push(r(s));return n}()}},r.prototype.modifyTags=function(t){var e,n,r,o,i,s;return null==t&&(t={}),e=function(){var e,n,r,o;for(r=t.add||[],o=[],e=0,n=r.length;n>e;e++)i=r[e],o.push(i.toLowerCase());return o}(),o=function(){var e,n,r,o;for(r=t.remove||[],o=[],e=0,n=r.length;n>e;e++)i=r[e],o.push(i.toLowerCase());return o}(),r=this.get("tags"),n=_.union(_.difference(r,o),e),this.set("tags",n,{user:t.user||(null!=(s=window.user)?s.id:void 0)}),this.trigger("tag-change",{add:e,remove:o}),t.remote!==!0&&t.sync!==!1&&this.sync("tag-change",this,{tagChanges:{add:e,remove:o}}),this
},r.prototype.addTags=function(t,e){return null==e&&(e={}),this.modifyTags(_.extend({},e,{add:t}))},r.prototype.removeTags=function(t,e){return null==e&&(e={}),this.modifyTags(_.extend({},e,{remove:t}))},r.prototype.markAsRead=function(t){return t?this.unread(t)?this.removeTags([":unread:"+t.id]):void 0:void 0},r.prototype.parent=function(){var t;return null!=(t=_.find(this.get("tags"),Models.Tag.inboxTag))?t.split(":").pop():void 0},r.prototype.hasComments=function(){var t;return t=Models.Tag.special.thread,n.call(this.get("tags")||[],t)>=0},r.prototype.hasTag=function(t){var e;return e=t.id||t,_.any(this.get("tags")||[],function(t){return t===e})},r.prototype.highlights=function(t,e){var r,o;return null==e&&(e={}),t&&-1!==Models.Filter.All.prototype.event.indexOf(this.get("event"))?(o=("function"==typeof t.get?t.get("id"):void 0)||Number(t),e["private"]&&null!=this.get("to")&&Number(this.get("to"))===o?!0:(r=[":user:everyone",":user:"+o,":highlight:"+o],_.any(this.get("tags"),function(t){return n.call(r,t)>=0
}))):!1},r.prototype.usersReadMessage=function(){var t;return t=this.flow().isPrivate(),this.flow().users.enabled().filter(function(e){return function(n){return e.highlights(n,{"private":t})&&!e.unread(n)}}(this))},r.prototype.unread=function(t){return t?_.include(this.get("tags"),":unread:"+t.get("id")):!1},r.prototype.commentable=function(){return!this.isComment()},r.prototype.isComment=function(){return null!=_.find(this.get("tags"),Models.Tag.inboxTag)},r.prototype.consume=function(t){var e;return this.subscriptions=[],e=t.filter(function(t){return function(e){return e.flow===t.get("flow")}}(this)),this.subscriptions.push(e.filter(function(t){return function(e){return"tag-change"===e.event&&e.content.message===t.id}}(this)).onValue(function(t){return function(e){return t.modifyTags({add:e.content.add,remove:e.content.remove,remote:!0,user:e.user})}}(this))),this.subscriptions.push(e.filter(function(t){return function(e){return"message-delete"===e.event&&e.content.message===t.id}}(this)).onValue(function(t){return function(){return t.trigger("message-deleted")
}}(this))),this},r.prototype.unconsume=function(){var t,e,n,r;if(null!=this.subscriptions)for(r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return delete this.subscriptions,this},r.prototype.cleanup=function(){return this._preventCleanup?(console.log("not cleaning up locked model"),void 0):(this.unconsume(),this.comments?(this.comments.cleanup(),this.comments=void 0):void 0)},r.prototype.flowKey=function(){return this.get("to")?{to:this.flow().id.toString()}:{flow:this.get("flow")}},r.prototype.commentsFetched=function(){return this.comments.historyComplete.backward===!0},r.prototype.lockCleanup=function(){return this._preventCleanup=!0,this},r.prototype.unlockCleanup=function(){return this._preventCleanup=!1,this},r}(Backbone.Model),Models.ChatMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.defaults={app:"chat",event:"message",content:"",tags:[]},n}(Models.Message),Models.CommentMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.defaults={app:"chat",event:"comment",content:"",tags:[]},n}(Models.ChatMessage),Models.FileMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.defaults={app:"chat",event:"file",tags:[]},n}(Models.ChatMessage),Models.InboxMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.defaults={app:"influx",content:"",tags:[]},n}(Models.Message)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.Organization=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.url=Helpers.apiUrl("/organizations"),n.prototype.link=function(t){var e;return null!=(e=this.get("_links")[t])?e.href:void 0},n.prototype.userLimit=function(){return Bacon.combineAsArray([this.asEventStream("change:user_count").map(function(t){return function(){return t.get("user_count")
}}(this)).toProperty(this.get("user_count")),this.asEventStream("change:user_limit").map(function(t){return function(){return t.get("user_limit")}}(this)).toProperty(this.get("user_limit"))])},n.prototype.updateIfStale=function(){return(null==this.updated||this.updated<(new Date).getTime()-3e5)&&!this.fetching?this.fetch():void 0},n.prototype.consume=function(t){return this._bacon=t.filter(function(t){return function(e){var n,r;return 0===(null!=(n=e.flow)?n.indexOf(t.get("id")):void 0)&&"action"===e.event&&("invite"===(r=e.content.type)||"uninvite"===r)}}(this)).onValue(function(t){return function(){return delete t.updated,t.trigger("needsUpdate",t)}}(this))},n.prototype.cleanup=function(){return"function"==typeof this._bacon?this._bacon():void 0},n.prototype.fetch=function(){var t;return this.fetching=!0,t=n.__super__.fetch.apply(this,arguments),t.always(function(t){return function(){return t.fetching=!1,t.updated=(new Date).getTime()}}(this)),t},n.prototype.validate=function(t){var e,n,r,o,i;return e={},e.name=[],e.subdomain=[],t.name||e.name.push("must be specified"),t.subdomain||e.subdomain.push("must be specified"),(null!=(n=t.name)?n.length:void 0)>65&&e.name.push("is too long (max length 65)"),(null!=(r=t.name)?r.length:void 0)<3&&e.name.push("is too short (min length 3)"),(null!=(o=t.subdomain)?o.length:void 0)>65&&e.subdomain.push("is too long (max length is 65)"),(null!=(i=t.subdomain)?i.length:void 0)<3&&e.subdomain.push("is too short (min length is 3)"),/^[a-z0-9]{1}[a-z0-9-]*$/.test(t.subdomain)||e.subdomain.push("has invalid format. Only alphanumeric characters and hyphens (-) allowed. May not begin with a hyphen."),e.name.length>0||e.subdomain.length>0?{message:"Validation error",errors:e}:void 0
},n}(Backbone.Model)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Models.Preferences=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.url=Helpers.apiUrl("/preferences"),r.prototype.defaults={locale:"en-24h",link_previews:!0,desktop_notifications:"all",audio_notifications:"mentions",audio_volume:"0.9",whitespace:"cozy",typing_activity:!0,push_email:!0,keyboard_shortcuts:!1,muted:"0",emphasize_own_nick:!0,enter_sends_message:!0},r.prototype.initialize=function(t,e){return null==e&&(e={}),this.user=e.user},r.prototype.parse=function(t){var e,n;for(e in t)n=t[e],t[e]=function(){switch(n){case"true":return!0;case"false":return!1;default:return n}}();return t},r.prototype.toJSON=function(){var t,e,n;t=_.clone(this.attributes);for(e in t)n=t[e],t[e]=String(n);return{preferences:t}},r.prototype.linkPreviews=function(){return this.get("link_previews")
},r.prototype.use12HourClock=function(){return"en-12h"===this.get("locale")},r.prototype.desktopNotifications=function(){return this.get("desktop_notifications")},r.prototype.typingActivity=function(){return this.asProperty("typing_activity")},r.prototype.notificationAllowed=function(e,n){var r;return r=this.get(""+e+"_notifications"),t[r](n,this.user)},r.prototype.filterMessages=function(t,e){return t.filter(function(t){return t.id}).filter(function(t){return function(n){var r;return r=new Models.Message(n),t.notificationAllowed(e,r)&&n.user!==t.user.get("id")}}(this))},r.prototype.keyboardShortcuts=function(){return this.get("keyboard_shortcuts")},r.prototype.mute=function(){var t;return t=function(t){return parseInt(t)>Date.now()},this.asProperty("muted").flatMapLatest(function(e){return t(e)?Bacon.later(parseInt(e)-Date.now(),!1).merge(Bacon.once(!0)):Bacon.once(!1)}).skipDuplicates().toProperty(!1)},r.prototype.enterSendsMessage=function(){return this.get("enter_sends_message")},r.prototype.isNew=function(){return!1
},r}(Backbone.Model),t={all:function(t){return-1!==Models.Filter.All.prototype.event.indexOf(t.get("event"))},chat_or_mentions:function(t,e){return-1!==Models.Filter.Chat.prototype.event.indexOf(t.get("event"))||t.highlights(e,{"private":!0})},mentions:function(t,e){return t.highlights(e,{"private":!0})},none:function(){return!1}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Models.PrivateConversation=function(e){function r(e){null==e&&(e={}),this.eventStreamFilter=t(this.eventStreamFilter,this),this.users=new Collections.Users(e.users||[],{flow:this}),this.tags=new Collections.Tags([],{flow:this}),this.emoji=new Collections.Emoji([],{flow:this}),this.subscriptions=[],r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isFlow=function(){return!1},r.prototype.isPrivate=function(){return!0
},r.prototype.defaults=function(){return{open:!0}},r.prototype.path=function(){return"private/"+this.id},r.prototype.url=function(){return this.get("url")?Helpers.apiUrl(this.get("url")):Helpers.apiUrl("/private/"+this.id)},r.prototype.initialize=function(t){return null==t&&(t={}),this.consumed=!1,this.stream=new Bacon.Bus,this.fullyLoaded=$.Deferred(),this.listenTo(this.users,"change:nick",this._onNickChange)},r.prototype.consume=function(t){return this.consumed=!0,this.users.consume(t.filter(function(t){var e;return"activity.user"===(e=t.event)||"message"===e||"user-edit"===e})),this.stream.plug(t.filter(this.eventStreamFilter)),this.subscriptions.push(this.stream.filter(function(t){var e;return!("tag-change"===(e=null!=t?t.event:void 0)||"activity.user"===e)}).onValue(function(t){return function(){return t.get("open")?void 0:t.save({open:!0},{wait:!0})}}(this))),this.emoji.consume(t),this},r.prototype._onNickChange=function(t,e){return this.otherParty().id===Number(t.get("id"))?this.set("name","@"+e):void 0
},r.prototype.parse=function(t){var e,n;return e=function(t,e){var n,r;return _.extend({},t,{last_activity:null!=(n=e.get(t.id))?n.get("last_activity"):void 0,last_ping:null!=(r=e.get(t.id))?r.get("last_ping"):void 0})},this.users.reset(function(){var r,o,i,s;for(i=t.users,s=[],r=0,o=i.length;o>r;r++)n=i[r],s.push(e(n,this.users));return s}.call(this)),t},r.prototype.buildMessage=function(t,e){return null==e&&(e=Models.Message),new e(_.extend({to:""+this.id},t,{tags:_.uniq((t.tags||[]).concat([":unread:"+this.id]))}))},r.prototype.eventStreamFilter=function(t){var e;return t.to&&((e=String(this.id))===String(t.user)||e===String(t.to))},r.prototype.otherParty=function(){return this.users.find(function(t){return function(e){return String(e.id)!==String(t.collection.user.id)}}(this))},r.prototype.me=function(){return this.collection.user||Flowdock.app.user},r.prototype.cleanup=function(){var t,e,n,r;for(r=this.subscriptions,e=0,n=r.length;n>e;e++)(t=r[e])();return delete this.subscriptions,this.users.cleanup(),this.tags.cleanup(),this.emoji.cleanup(),delete this.users,delete this.tags,delete this.emoji
},r.prototype.isBetweenUsers=function(t){var e,n,r;for(n=0,r=t.length;r>n;n++)if(e=t[n],!this.users.get(parseInt(e,10)))return!1;return!0},r.prototype.typingUsers=function(t){return this.users.typing.map(function(e){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r],n.id===t&&i.push(n.user);return i})},r.prototype.emojiKeys=function(){return this.emoji.keys()},r.prototype.set=function(t,e){return null==e&&(e={}),t.emoji&&this.emoji.reset(t.emoji),r.__super__.set.apply(this,arguments)},r}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.Source=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t,e){return null==t&&(t={}),null==e&&(e={}),this.flow=e.flow,n.__super__.initialize.apply(this,arguments)},n.prototype.url=function(){var t;return this.get("url")?Helpers.apiUrl(this.get("url")):""+(null!=(t=this.flow)?t.url():void 0)+"/sources"
},n.prototype.setConfig=function(t,e){var n,r;return n=this.get("config"),r={},r[t]=e,this.get("config").set(_.extend({},this.get("config"),r))},n.prototype.getConfig=function(t){return this.get("config")[t]},n.prototype.displayName=function(){switch(this.get("type")){case"feed":return this.getConfig("title");case"twitter_user":return this.getConfig("name");case"twitter_keyword":return this.getConfig("param")}},n}(Backbone.Model)}.call(this),/**
 * Fuse - Lightweight fuzzy-search
 *
 * Copyright (c) 2012 Kirollos Risk <kirollos@gmail.com>.
 * All Rights Reserved. Apache Software License 2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){function t(t,e){function n(t,e){var n=t/s,i=Math.abs(r-e);return o?n+i/o:i?1:n}e=e||{};var r=e.location||0,o=e.distance||100,i=e.threshold||.6,t=e.caseSensitive?t:t.toLowerCase(),s=t.length;if(s>32)throw new Error("Pattern length is too long");var a=1<<s-1,l=function(){var e={},n=0;for(n=0;s>n;n++)e[t.charAt(n)]=0;for(n=0;s>n;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e}();this.search=function(o){if(o=e.caseSensitive?o:o.toLowerCase(),t===o)return{isMatch:!0,score:0};var u,c,p,h,d,f,m,g,y,v=o.length,w=i,_=o.indexOf(t,r),b=s+v,k=1,x=[];for(-1!=_&&(w=Math.min(n(0,_),w),_=o.lastIndexOf(t,r+s),-1!=_&&(w=Math.min(n(0,_),w))),_=-1,u=0;s>u;u++){for(p=0,h=b;h>p;)n(u,r+h)<=w?p=h:b=h,h=Math.floor((b-p)/2+p);for(b=h,f=Math.max(1,r-h+1),m=Math.min(r+h,v)+s,g=Array(m+2),g[m+1]=(1<<u)-1,c=m;c>=f;c--)if(y=l[o.charAt(c-1)],g[c]=0===u?(g[c+1]<<1|1)&y:(g[c+1]<<1|1)&y|((d[c+1]|d[c])<<1|1)|d[c+1],g[c]&a&&(k=n(u,c-1),w>=k)){if(w=k,_=c-1,x.push(_),!(_>r))break;f=Math.max(1,2*r-_)}if(n(u+1,r)>w)break;d=g}return{isMatch:_>=0,score:k}
}}function e(e,n){n=n||{};var r=n.keys;this.search=function(o){function i(t,e,n){void 0!==t&&null!==t&&"string"==typeof t&&(u=h.search(t),u.isMatch&&(p=m[n],p?p.score=Math.min(p.score,u.score):(m[n]={item:e,score:u.score},f.push(m[n]))))}var s,a,l,u,c,p,h=new t(o,n),d=e.length,f=[],m={},g=[];if("string"==typeof e[0])for(s=0;d>s;s++)i(e[s],s,s);else for(s=0;d>s;s++)for(l=e[s],a=0;a<r.length;a++)i(l[r[a]],l,s);for(f.sort(function(t,e){return t.score-e.score}),c=f.length,s=0;c>s;s++)g.push(n.id?f[s].item[n.id]:f[s].item);return g}}"undefined"!=typeof module&&"undefined"!=typeof module.exports?"function"==typeof module.setExports?module.setExports(e):module.exports=e:window.Fuse=e}(),function(){Models.TabSearch=function(){function t(t){this.collection=t,this.loading=this._buildLoading(t)}return t.prototype.fetch=function(t){return this.collection.fetch(t)},t.prototype.filter=function(t,e){var n,r;return null==e&&(e=[]),r=function(t){return function(n){var r,o,i,s,a,l;if(0===n.length)return t.collection.models;for(r=new Fuse(t.collection.toJSON(),{keys:e,id:"id",threshold:.2}),a=r.search(n),l=[],i=0,s=a.length;s>i;i++)o=a[i],l.push(t.collection.get(o));
return l}}(this),n=Bacon.mergeAll(this.collection.asEventStream("add"),this.collection.asEventStream("remove"),this.collection.asEventStream("change")).takeUntil(this.collection.asEventStream("cleanup")),t.toEventStream().merge(t.sampledBy(n)).map(r).toProperty()},t.prototype._buildLoading=function(t){var e,n,r;return e=t.asEventStream("request",function(t,e){return e}),r=t.asEventStream("sync"),n=function(t){var e;return e=r.filter(function(){return 4===t.readyState}).take(1),Bacon.once(!0).merge(e.map(!1))},e.flatMapLatest(n).toProperty(!1)},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.Tag=function(t){function n(t,e){(null!=t?t.id:void 0)&&(t.id=t.id.toLowerCase()),n.__super__.constructor.call(this,t,e)}return e(n,t),n.regularTag=function(t){return-1===t.indexOf(":")},n.userTag=function(t){return 0===t.indexOf(":user:")},n.inboxTag=function(t){return 0===t.indexOf("influx:")
},n.hiddenTag=function(t){return!Models.Tag.userTag(t)&&!Models.Tag.regularTag(t)},n.userTagFor=function(t){return":user:"+t},n.stripHashes=function(t){return t.replace(/^#+/,"")},n.special={thread:":thread"},n.prototype.defaults={count:0},n.prototype.flow=function(){var t;return this.get("flow")||(null!=(t=this.collection)?t.flow:void 0)},n.prototype.type=function(){return Models.Tag.regularTag(this.id)?"tag":this.id.split(":")[1]},n.prototype.increment=function(t){var e;return null==t&&(t=1),e=this.get("count")+t,this.set({count:e}),e},n.prototype.decrement=function(t){return null==t&&(t=1),this.increment(-t)},n.prototype.humanize=function(){var t,e,n,r,o,i,s;if(r=this.id,r===Models.Tag.userTagFor("everyone"))return"@everyone";if(Models.Tag.userTag(r)){if(i=r.split(":"),t=i[0],n=i[1],e=i[2],o=null!=(s=this.flow())?s.users.get(e):void 0,null!=o)return"@"+o.get("nick")}else if(Models.Tag.regularTag(r))return"#"+r},n.prototype.toString=function(){return this.humanize()},n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Models.User=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return this.set("presence",this.presence())},n.prototype.url=function(){return Helpers.apiUrl("/users/"+this.id)},n.prototype.cleanup=function(){return this.unsubscribe?this.unsubscribe():void 0},n.prototype.consume=function(t){return this.cleanup(),this.unsubscribe=t.filter(function(t){return"user-edit"===t.event}).filter(function(t){return function(e){return e.content.user.id===t.id}}(this)).onValue(function(t){return function(e){return t.set(e.content.user)}}(this))},n.prototype.inFlow=function(t){return this.set("in_flow",t),this.set("presence",this.presence())},n.prototype.presence=function(){var t;return t=(new Date).getTime()-this.get("last_activity"),this.get("in_flow")===!1?"absent":null==t||null==this.get("last_ping")?"offline":null!=this.get("last_ping")&&(new Date).getTime()-this.get("last_ping")>=18e4?"offline":t>=18e4?"idle":"active"
},n.prototype.nick=function(){return this.get("nick")},n.prototype.canChatWith=function(t){return t.external()?!1:t.id.toString()===this.id.toString()?!1:!0},n.prototype.avatar=function(t){return null==t&&(t=80),this.get("avatar")+t},n.prototype.external=function(){return"0"===this.id},n.prototype.block=function(t){return null==t&&(t={}),t.flow?this.updateFlowUser({disabled:!0},t):void 0},n.prototype.updateFlowUser=function(t,e){return $.ajax({url:e.flow.url()+"/users/"+this.id,type:"PUT",data:t,success:function(t){return e.success?e.success(t):void 0},error:function(t){return e.error?e.error(t):void 0}})},n}(Backbone.Model),Models.ExternalUser=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.defaults={id:"0",nick:"Flowdock",avatar:Helpers.assetPath("/avatars/default/")},n.prototype.presence=function(){return"offline"},n.prototype.external=function(){return!0},n.prototype.canChatWith=function(){return!1},n.prototype.consume=function(){},n}(Models.User),Models.DefaultUser=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.defaults={id:"0",name:"Team Flowdock",nick:"Flowdock",status_message:null,email:"support@flowdock.com",avatar:Helpers.assetPath("/avatars/9e6f7168611d249b28bbd84dc60cb194/"),disabled:!0},n.prototype.canChatWith=function(){return!1},n}(Models.ExternalUser)}.call(this),function(){var t=[].slice;Collections.Combined=function(){function e(){var e,n,r,o,i;for(n=1<=arguments.length?t.call(arguments,0):[],this.collections=n,_.extend(this,Backbone.Events),i=this.collections,r=0,o=i.length;o>r;r++)e=i[r],this.listenTo(e,"all",function(){return this.trigger.apply(this,arguments)}),this.listenTo(e,"add remove reset",this._updateLength);this._updateLength()}return e.prototype._updateLength=function(){var t,e,n,r,o;for(this.length=0,r=this.collections,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.length+=t.length);return o},e.prototype.each=function(){var t,e,n,r,o;for(r=this.collections,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t.each.apply(t,arguments));return o},e.prototype.indexOf=function(){var t,e,n,r,o;
for(o=this.collections,n=0,r=o.length;r>n;n++)if(t=o[n],e=t.indexOf.apply(t,arguments),e>=0)return e;return-1},e.prototype.where=function(){var t,e,n,r,o;for(e=[],o=this.collections,n=0,r=o.length;r>n;n++)t=o[n],e=e.concat(t.where.apply(t,arguments));return e},e.prototype.remove=function(){var t,e,n,r,o;for(r=this.collections,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t.remove.apply(t,arguments));return o},e.prototype.add=function(t){var e,n,r,o,i;for(o=this.collections,i=[],n=0,r=o.length;r>n;n++)e=o[n],t instanceof e.model&&i.push(e.add.apply(e,arguments));return i},e.prototype.cleanup=function(){return this.stopListening(),this.collections=[]},e.prototype.get=function(){var t,e,n,r,o;for(o=this.collections,n=0,r=o.length;r>n;n++)if(t=o[n],e=t.get.apply(t,arguments))return e},e.prototype.find=function(){var t,e,n,r,o;for(o=this.collections,n=0,r=o.length;r>n;n++)if(t=o[n],e=t.find.apply(t,arguments))return e},e.prototype.first=function(){var t,e,n,r,o;for(o=this.collections,n=0,r=o.length;r>n;n++)if(t=o[n],e=t.first.apply(t,arguments))return e
},e.prototype.getCollectionFor=function(t){var e,n,r,o;for(o=this.collections,n=0,r=o.length;r>n;n++)if(e=o[n],t instanceof e.model)return e},e.prototype.getCollectionOfType=function(t){var e,n,r,o;for(o=this.collections,n=0,r=o.length;r>n;n++)if(e=o[n],e instanceof t)return e},e.prototype.toArray=function(){var t,e,n,r,o;for(e=[],o=this.collections,n=0,r=o.length;r>n;n++)t=o[n],e=e.concat(t.toArray());return e},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Emoji=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.populateEmojie()}return e(n,t),n.prototype.model=Models.Emoji,n.prototype.populateEmojie=function(){return this.emojie=Emojie({ignoreAttribute:"data-no-text-emoji"}),this.each(this.registerEmoji,this),this.emojie.merge(window.emojie.custom)},n.prototype.registerEmoji=function(t){var e;return e=t.colonized(),this.emojie.register(e,{title:e,src:t.get("image_url"),"class":"emojie"})
},n.prototype.consume=function(t){return this.addStream(t.filter(function(t){return"emoji-add"===t.event}).onValue(function(t){return function(e){var n;return t.add(n=new Models.Emoji(e.content)),t.registerEmoji(n)}}(this)))},n.prototype.reset=function(){return n.__super__.reset.apply(this,arguments),this.populateEmojie()},n.prototype.emojie=function(t){return this.emojie(t)},n.prototype.keys=function(){var t,e,n,r,o;for(r=this.pluck("id"),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(":"+t+":");return o},n}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.FlowActivities=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.FlowActivity,n.prototype.initialize=function(t,e){var n,r,o,i;for(this.ready=!1,this.flows=e.flows,this.activeFlowProperty=e.activeFlowProperty,this.user=e.user,this.activity=new Backbone.Model({chat:!1,inbox:!1,mentions:0}),this.activityProperty=this.activity.asProperty(),this.addStream(this.activityProperty.onValue(function(){})),this.listenTo(this,"change:chat",this.updateChatActivity),this.listenTo(this,"change:inbox",this.updateInboxActivity),this.listenTo(this,"change:mentions",this.updateMentions),this.listenTo(this.flows,"change:open",this.flowChanged),this.listenTo(this.flows,"add",this.flowAdded),this.listenTo(this.flows,"remove",this.flowRemoved),this.listenTo(this.flows,"change:activity",this.flowActivityChanged),i=this.flows.where({open:!0}),r=0,o=i.length;o>r;r++)n=i[r],this.flowChanged(n,!0);
return this.ready=!0,this.updateAll()},n.prototype.flowChanged=function(t,e){var n,r;return e?(r=new this.model(_.extend({},t.get("activity"),{id:t.id}),{flow:t,userId:this.user.id}),r.consume(t.stream,this.activeFlowProperty),this.add(r)):(n=this.get(t.id),this.remove(n),null!=n&&n.cleanup()),this.ready?this.updateAll():void 0},n.prototype.flowAdded=function(t){return t.get("open")?this.flowChanged(t,!0):void 0},n.prototype.flowRemoved=function(t){return t.get("open")?this.flowChanged(t,!1):void 0},n.prototype.flowActivityChanged=function(t){var e;return null!=(e=this.get(t.id))?e.set(t.get("activity")):void 0},n.prototype.updateAll=function(){return this.updateChatActivity(),this.updateInboxActivity(),this.updateMentions()},n.prototype.updateChatActivity=function(){var t;return t=this.any(function(t){return t.get("chat")}),this.activity.get("chat")!==t?this.activity.set({chat:t}):void 0},n.prototype.updateInboxActivity=function(){var t;return t=this.any(function(t){return t.get("inbox")}),this.activity.get("inbox")!==t?this.activity.set({inbox:t}):void 0
},n.prototype.updateMentions=function(){var t;return t=_.reduce(this.map(function(t){return t.get("mentions")}),function(t,e){return t+e},0),this.activity.get("mentions")!==t?this.activity.set({mentions:t}):void 0},n.prototype.cleanup=function(){return n.__super__.cleanup.apply(this,arguments),this.activity=this.flows=this.activeFlowProperty=this.user=this.activityProperty=null},n.prototype.asyncGet=function(t,e){var n,r;return r=this.get(t),null!=r?e(r):(n=function(r){return function(o){return o.id===t?(r.stopListening(r,"add",n),e(o)):void 0}}(this),this.listenTo(this,"add",n))},n}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Flows=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.Flow,n.prototype.initialize=function(t,e){return null==e&&(e={}),this._url=e.url,this.listenTo(this,"add",function(t){return this.stream?t.consume(this.stream):void 0
}),this.listenTo(this,"change:parameterized_name",this._onFlowRename),this.listenTo(this,"change:disabled",this._removeDisabled)},n.prototype.firstOpen=function(){return this.find(function(t){return t.get("open")&&t.get("joined")})},n.prototype.uniqueName=function(t){var e;return e=this.find(function(){return function(e){return t!==e&&e.get("open")&&e.get("name")===t.get("name")}}(this)),e?t.fullName():t.get("name")},n.prototype.consume=function(t){return this.stream=t,this.each(function(t){return function(e){return e.consume(t.stream)}}(this)),this.addStream(this.stream.filter(function(){return function(t){var e;return"flow-add"===(e=t.event)||"flow-change"===e}}(this)).onValue(function(t){return function(e){var n;return(n=t.get(e.content.id))?(n.get("open")&&e.content.open===!1&&t.trigger("external-close",n),n.set(e.content)):(n=new Models.Flow(e.content),t.add(n))}}(this))),this.addStream(this.stream.filter(function(){return function(t){return"flow-remove"===t.event}}(this)).onValue(function(t){return function(e){var n;
return n=t.get(e.content.id),null!=n?(t.remove(n),_.defer(function(){return n.cleanup()})):void 0}}(this)))},n.prototype.url=function(){return this._url||Helpers.apiUrl("/flows")},n.prototype.cleanup=function(){return this.stopListening(),this.each(function(t){return t.cleanup()}),n.__super__.cleanup.apply(this,arguments)},n.prototype._onFlowRename=function(t){return t.fetch({success:function(){return t.trigger("flow-unloaded",t)}})},n.prototype._removeDisabled=function(t,e){return e?this.remove(t):void 0},n}(Flowdock.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Collections.Users=function(e){function r(){return this.handleMessage=t(this.handleMessage,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.TYPING_TIMEOUT=3e4,r.prototype.model=Models.User,r.prototype.url=function(){return this.flow?""+this.flow.url()+"/users":Helpers.apiUrl("/users")
},r.prototype.initialize=function(){var t,e;return t=function(t,e,n){return[t,e,n]},e=this.asEventStream("typing",t).scan({},function(t,e){var n,r,o,i;return i=e[0],o=e[1],r=e[2],r===!1?_.omit(t,String(i.id)):(n={},n[i.id]={user:i,time:o,id:r},_.extend({},t,n))}),this.typing=e.combine(e.delay(r.TYPING_TIMEOUT),function(t,e){var n,r,o,i;i=[];for(r in t)n=t[r],n.time>((null!=(o=e[r])?o.time:void 0)||0)&&i.push(n);return i}).skipDuplicates(_.isEqual).changes().toProperty([])},r.prototype.consume=function(t){if(this.stream)throw new Error("Users collection is already subscribed to a stream");return this.stream=t,this.addStream(this.stream.onValue(this.handleMessage)),this.addStream(this.updateOpenState(this.stream.filter(function(t){return"user-change"===t.event}))),this.addStream(this.updatePresence(this.stream.filter(function(t){return"activity.user"===t.event})))},r.prototype.updateOpenState=function(t){return t.filter(function(t){return function(e){return t.get(e.user)}}(this)).onValue(function(t){return function(e){return t.get(e.user).inFlow(e.content.in_flow)
}}(this))},r.prototype.updatePresence=function(t){return t.delay(10).merge(t.delay(19e4)).map(function(t){return function(e){return t.get(e.user)}}(this)).filter(function(t){return t}).onValue(function(t){return t.set("presence",t.presence())})},r.prototype.handleMessage=function(t){var e,n;return"function"==typeof(e=Collections.Users.messageHandlers)[n=t.event]?e[n](this,t):void 0},r.unsetTyping=function(t,e){var n;return n=t.get(e.user),null!=n?n.trigger("typing",n,e.sent,!1):void 0},r.messageHandlers={"activity.user":function(t,e){var n,o,i,s,a;if(e.user&&(a=t.get(e.user),null!=a))return n=r.currentTimestamp(),s=n-e.sent,o=e.content,i={last_ping:n},null!=o.last_activity&&(i.last_activity=o.last_activity+s),a.set(i),null!=o.typing&&a.id!==Flowdock.app.user.id?a.trigger("typing",a,n,o.typing):void 0},"backend.rejoin.user":function(t,e){var n,r;return n=e.content.user.id,null!=(r=t.get(n))&&r.set({disabled:!1}),t.trigger("rejoin")},"backend.join.user":function(t,e){return t.add(new Models.User(e.content.user))
},"backend.user.block":function(t,e){var n,r;return n=Number(e.content),null!=(r=t.get(n))?r.set({disabled:!0}):void 0},"user-edit":function(t,e){var n,r;return n=e.content.user.id,null!=(r=t.get(n))?r.set(e.content.user):void 0},message:r.unsetTyping,comment:r.unsetTyping,status:function(t,e){var n,r;return n=Number(e.user),null!=(r=t.get(n))?r.set({status:e.content}):void 0}},r.prototype.enabled=function(){return this.filter(function(t){return!t.get("disabled")})},r.prototype.active=function(){return this.filter(function(t){return"active"===t.presence()})},r.prototype.getOrAdd=function(t){var e;return e=this.get(t),null==e&&(e=new Models.User({id:t}),this.add(e),this.singleFetch()),e},r.prototype.singleFetch=function(){var t;return null!=this._fetching?this._fetching.promise():(this._fetching=new $.Deferred,t=function(t){return function(){return t._fetching.resolve(),delete t._fetching}}(this),this.fetch({success:t,error:t}),this._fetching.promise())},r.prototype.comparator=function(t){var e;return null!=(e=t.nick())?"function"==typeof e.toLowerCase?e.toLowerCase():void 0:void 0
},r.currentTimestamp=function(){return(new Date).getTime()},r}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.GlobalUsers=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this,"reset",this._buildTrie)},n.prototype.cleanup=function(){return n.__super__.cleanup.apply(this,arguments),delete this.trie},n.prototype.startingWith=function(t){return t?this._userMatches(t.toLowerCase()):[]},n.prototype._buildTrie=function(){return this.trie=new Trie,this.each(function(t){return function(e){var n,r,o,i;for(i=e.get("name").split(" "),r=0,o=i.length;o>r;r++)n=i[r],n.length&&t.trie.set(n.toLowerCase(),e);return t.trie.set(e.get("email"),e),e.has("nick")?t.trie.set(e.get("nick").toLowerCase(),e):void 0
}}(this))},n.prototype._userMatches=function(t){var e;return e=""===t?this.models.slice(0):this.trie.prefixed(t).values(),_.sortBy(_.uniq(e),function(t){return t.get("name")})},n}(Collections.Users)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Invitations=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.Invitation,n.prototype.url=function(){return Helpers.apiUrl(this.flow.get("_links").invitations.href)},n.prototype.initialize=function(){return this.subscriptions=[]},n.prototype.consume=function(t){if(this.stream)throw new Error("Invitations collection is already subscribed to a stream");return this.stream=t.filter(function(t){return function(e){return"action"===e.event&&e.flow===t.flow.id}}(this)),this.addStream(this.stream.filter(function(t){return"invite"===t.content.type
}).onValue(function(t){return function(e){return t.addInvite(e)}}(this))),this.addStream(this.stream.filter(function(t){return"uninvite"===t.content.type}).onValue(function(t){return function(e){return t.removeInvite(e)}}(this)))},n.prototype.addInvite=function(){return this.fetch({update:!0})},n.prototype.removeInvite=function(t){return this.remove(this.where({email:t.content.recipient_email}))},n.prototype["import"]=function(t){return $.post(""+this.url()+"/import",t)},n}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Messages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.Message,n.prototype.messageFilter=Models.Filter,n.prototype.limit=30,n.prototype.sync=Flowdock.socketIoSync,n.prototype.initialize=function(t,e){return this.startAt=e.startAt,this.messageFilter=e.filter||new this.messageFilter,this.historyComplete={forward:null==this.startAt,backward:e.fresh===!0}
},n.prototype.url=function(){return this.flow.url()+"/messages"},n.prototype.findByUuid=function(t){return null==t||0===t.length?null:this.where({uuid:t})[0]},n.prototype.lastMessageOf=function(t){return _.last(_.filter(this.where({user:t.id}),function(t){var e;return"message"===(e=t.get("event"))||"comment"===e}))},n.prototype.consume=function(t){if(this.stream)throw new Error("Message collection is already subscribed to a stream");return this.stream=t.filter(this.flow.eventStreamFilter),this.addStream(this.stream.filter(function(t){return"tag-change"===t.event}).onValue(function(t){return function(e){return t._tagChange(e)}}(this))),this.addStream(this.stream.filter(function(t){return"message-delete"===t.event}).onValue(function(t){return function(e){return t._messageDelete(e)}}(this))),this.addStream(this.stream.filter(function(t){return"message-edit"===t.event}).onValue(function(t){return function(e){return t._messageEdit(e)}}(this))),this.addStream(this.stream.filter(function(t){return function(e){return t.messageFilter.matchesTo(e)
}}(this)).onValue(function(t){return function(e){var n;return n=t.findByUuid(e.uuid),e.id&&n&&!n.id?(n.set(e),n.trigger("sync")):e.id&&t.get(e.id)||t.add(e,{fresh:!0}),Bacon.more}}(this))),this.addStream(this.stream.onError(function(t){return function(e){var n;if(e)return n=t.findByUuid(e.uuid),n&&!n.get("id")?n.trigger("unsent"):void 0}}(this)))},n.prototype.cleanup=function(){return this.each(function(t){return t.cleanup()}),n.__super__.cleanup.apply(this,arguments),this.messageFilter=null,this},n.prototype.purgeOlderMessages=function(t){var e,n,r,o;if(!(this.length<=t)&&this.historyComplete.backward!==!0){for(n=this.length-t,console.log("Saving memory by purging "+n+" messages."),o=[],e=r=1;n>=1?n>=r:r>=n;e=n>=1?++r:--r)o.push(this.shift());return o}},n.prototype._messageEdit=function(t){var e;return e=this.get(t.content.message),null!=e?e.set({content:t.content.updated_content,edited:t.sent}):void 0},n.prototype._messageDelete=function(t){var e;return e=this.get(t.content.message),null!=e?this.remove(e):void 0
},n.prototype._tagChange=function(t){var e;return e=this.get(t.content.message),null!=e?e.modifyTags({add:t.content.add,remove:t.content.remove,remote:!0,user:t.user}):void 0},n.prototype.fetchHistory=function(t){var e,n;return null==t&&(t={}),t=_.extend({direction:"backward",data:{}},t),"forward"===t.direction&&(0!==this.length&&null!=this.last().id&&((e=t.data).since_id||(e.since_id=this.last().id)),0===this.length&&null!=this.startAt&&(t.data.since_id=this.startAt),t.data.sort="asc"),"backward"===t.direction&&(0!==this.length&&null!=this.first().id&&((n=t.data).until_id||(n.until_id=this.first().id)),0===this.length&&null!=this.startAt&&(t.data.until_id=this.startAt+1),t.insertAt||(t.insertAt=0),t.skip_until_id&&delete t.data.until_id),0!==this.length||"backward"!==t.direction||t.data.until_id||(this.historyComplete.forward=!0,this.trigger("historyComplete","forward")),this.fetchMessages(t,!0,function(e){return function(n){return n.length<(t.limit||e.limit)&&(e.historyComplete[t.direction]=!0),e.trigger("historyAdd",n,t.direction),e.historyComplete[t.direction]?e.trigger("historyComplete",t.direction):void 0
}}(this))},n.prototype.fetchMessages=function(t,e,n){var r,o,i,s;return null==t&&(t={}),null==e&&(e=!1),i=function(t,e){var n,r,o,i;if(e){for(i=[],r=0,o=e.length;o>r;r++)n=e[r],t.get(n.id)||i.push(n);return i}return[]},r=_.extend(this.messageFilter.asParams(),{sort:"desc",limit:t.limit||this.limit},t.data),o={cache:!1,update:e,remove:!1,at:t.insertAt,silent:!0,data:r,add:!1,success:function(e,r){var s,a,l;return l=i(e,r),e.set(r,_.extend({},o,{add:!0})),_.isFunction(t.success)&&t.success(e,r),a=function(){var t,n,r;for(r=[],t=0,n=l.length;n>t;t++)s=l[t],r.push(e.get(s.id));return r}(),"function"==typeof n&&n(a),e.trigger("messagesAdded",a)},error:t.error},s=this.fetch(o),Bacon.fromPromise(s,!0).takeUntil(this.asEventStream("cleanup")).onValue(function(){}),s},n}(Flowdock.Collection),Collections.ThreadedMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.consume=function(){return n.__super__.consume.apply(this,arguments),this.each(function(t){return function(e){var n;
return null!=(n=e.comments)?n.consume(t.stream):void 0}}(this))},n.prototype.addCommentsToMessages=function(t){return _.each(t.slice(0).reverse(),function(t){return function(e){return _.each(e.tags,function(n){var r;if(0===n.indexOf("influx:")){if(r=t.get(parseInt(n.replace("influx:",""),10)),!r)return;return r.comments.unshift(e)}})}}(this))},n.prototype.fetchComments=function(t,e){var n,r,o;return o=function(){var e,r,o;for(o=[],e=0,r=t.length;r>e;e++)n=t[e],n.id&&n.commentable()&&o.push("influx:"+n.id);return o}(),_.isEmpty(o)?void 0:(r=$.ajax({url:this.url(),dataType:"json",data:{tags:o.join(","),tag_mode:"or",event:"comment,file",limit:100,until_id:e},success:function(e){return function(r){var o,i,s;if(e.addCommentsToMessages(r),100===r.length)return e.fetchComments(t,r[0].id);for(s=[],o=0,i=t.length;i>o;o++)n=t[o],s.push(n.comments.historyComplete.backward=!0);return s}}(this),error:function(){return console.error("could not sync comments on inbox messages",o)}}),Bacon.fromPromise(r,!0).takeUntil(this.asEventStream("cleanup")).onValue(function(){}),r)
},n.prototype._prepareModel=function(t,e){var r;return t=n.__super__._prepareModel.call(this,t,e),this.stream&&null!=(r=t.comments)&&r.consume(this.stream),t},n.prototype._removeReference=function(t){return t.cleanup(),n.__super__._removeReference.call(this,t)},n}(Collections.Messages),Collections.ChatMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.messageFilter=Models.Filter.Chat,n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this,"messagesAdded",function(t){var e,n;return n=function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],e.hasComments()&&o.push(e);return o}(),this.fetchComments(n)})},n}(Collections.ThreadedMessages),Collections.InboxMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.messageFilter=Models.Filter.Inbox,n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.listenTo(this,"messagesAdded",function(t){return this.fetchComments(t)
})},n}(Collections.ThreadedMessages),Collections.CommentMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t,e){var r;return this.message=e.message,r=new Models.Filter.Comments(this.message),n.__super__.initialize.call(this,t,_.extend({filter:r},e))},n.prototype.cleanup=function(){return n.__super__.cleanup.apply(this,arguments),this.message=null},n}(Collections.Messages),Collections.UnreadMentionsMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.messageFilter=Models.Filter.All,n.prototype.limit=10,n.prototype.unreadTag=function(){return":unread:"+this.userId},n.prototype.initialize=function(t,e){return n.__super__.initialize.apply(this,arguments),this.userId=e.userId,this.messageFilter.tags=[this.unreadTag()]},n.prototype.unread=function(){return this.filter(function(t){return function(e){return _.include(e.get("tags"),t.unreadTag())}}(this))},n.prototype.markAllRead=function(){return _.each(this.unread(),function(t){return function(e){return e.removeTags([t.unreadTag()])
}}(this))},n}(Collections.Messages)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Organizations=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.Organization,n.prototype.url=function(){return Helpers.apiUrl("/organizations")},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ready=new $.Deferred,this.listenTo(this,"add",function(t){return t.updated=(new Date).getTime(),this.stream?t.consume(this.stream):void 0}),this.listenTo(this,"remove",function(t){return t.cleanup()})},n.prototype.fetch=function(t){return n.__super__.fetch.call(this,t).done(function(t){return function(){return t.ready.resolve()}}(this)).fail(function(t){return function(){return t.ready.reject()}}(this))},n.prototype.active=function(){return this.where({active:!0})
},n.prototype.users=function(){var t,e;return e=[],this.each(function(t){var n,r,o,i,s;for(i=t.get("users"),s=[],r=0,o=i.length;o>r;r++)n=i[r],s.push(e.push(n));return s}),t=new Collections.GlobalUsers(e),t._buildTrie(),t},n.prototype.consume=function(t){return this.stream=t,this.each(function(t){return function(e){return e.consume(t.stream)}}(this))},n.prototype.cleanup=function(){return this.each(function(t){return t.cleanup()}),n.__super__.cleanup.apply(this,arguments)},n}(Flowdock.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Collections.PrivateConversations=function(e){function r(){return this._onNewPrivateConversation=t(this._onNewPrivateConversation,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.model=Models.PrivateConversation,r.prototype.initialize=function(t,e){return this.user=e.user
},r.prototype.url=function(){return Helpers.apiUrl("/private")},r.prototype.uniqueName=function(t){var e;return e=this.find(function(e){return t!==e&&e.get("open")&&e.get("name")===t.get("name")}),e?"@"+t.otherParty().get("name"):t.get("name")},r.prototype.consume=function(t){return this.stream=t,this.each(function(t){return t.consume(this.stream)},this),this.addStream(this.stream.filter(function(t){return function(e){var n;return e.to&&!("tag-change"===(n=e.event)||"activity.user"===n)&&!t.get(t._otherUserId([e.user,e.to]))}}(this)).onValue(this._onNewPrivateConversation))},r.prototype.withUser=function(t){return t instanceof Models.User||(t=Flowdock.app.users.get(t)||new Models.User({id:t})),this.get(t.id)||this._build(t)},r.prototype._onNewPrivateConversation=function(t){var e;return e=new Models.User({id:this._otherUserId([t.user,t.to])}),this._build(e,t)},r.prototype._build=function(t,e){var n;if(null==e&&(e=null),0/0===t.id||null==t.id||t.id===this.user.id)throw new Error("Invalid user");return n=this.push(new Models.PrivateConversation({id:t.id,name:"@"+(t.get("nick")||"\u2026"),users:[t,this.user],open:!0})),n.save({},{success:function(){return n.fullyLoaded.resolve(),n.trigger("flow-fully-loaded")
},error:function(t,e){return n.fullyLoaded.reject(404===e.status?"private-not-found":void 0)}}),null!=this.stream&&n.consume(this._withInitialMessage(this.stream,e)),n},r.prototype._withInitialMessage=function(t,e){return null!=e?Bacon.later(0,e).merge(t):t},r.prototype._otherUserId=function(t){var e;return function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],null!=e&&String(e)!==String(this.user.id)&&o.push(Number(e));return o}.call(this)[0]},r.prototype.cleanup=function(){return this.each(function(t){return t.cleanup()}),r.__super__.cleanup.apply(this,arguments),delete this.user},r.prototype.fetch=function(t){var e;return null==t&&(t={}),e=t.success,r.__super__.fetch.call(this,_.extend(t,{success:function(t){return function(n,r){var o,i,s,a,l;for(i=function(){var t,e,o;for(o=[],t=0,e=r.length;e>t;t++)s=r[t],o.push(n.get(s.id));return o}(),a=0,l=i.length;l>a;a++)o=i[a],o.consumed||(o.consume(t.stream),o.fullyLoaded.resolve());return _.isFunction(e)?e(n,r):void 0}}(this)}))},r}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Sources=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=Models.Source,n.names={airbrake:"Airbrake",assembla:"Assembla",aws_cloudwatch:"AWS Cloudwatch",bamboo:"Bamboo",basecamp:"BaseCamp",beanstalkapp:"Beanstalk",bitbucket:"Bitbucket",blossom:"Blossom",capistrano:"Capistrano",circleci:"CircleCI",confluence:"Confluence",cruisecontrol:"CruiseControl",deployhq:"DeployHQ",deskcom:"Desk.com",deveo:"Deveo",facebook_page:"Facebook Page",floodio:"Flood.io",fogbugz:"FogBugz",vcs:"Git",gemini:"Gemini",gitlab:"GitLab",google_apps:"Google Apps",google_calendar:"Google Calendar",heroku:"Heroku",honeybadger:"Honeybadger",hudson_jenkins:"Jenkins",jira:"Jira",kiln:"Kiln",librato:"Librato",mercurial:"Mercurial",mina:"Mina",nagios:"Nagios",newrelic:"New Relic",pingdom:"Pingdom",pivotaltracker:"Pivotal Tracker",redmine:"Redmine",rollbar:"Rollbar",scout:"Scout",scrumdesk:"ScrumDesk",scrumdo:"ScrumDo",semaphore:"Semaphore",sentry:"Sentry",sprintly:"Sprint.ly",supportbee:"SupportBee",svn:"Subversion",trac:"Trac","travis-ci":"Travis CI",uservoice:"UserVoice",usetrace:"Usetrace",zendesk:"Zendesk",integrations_other:"Others"},n.helpPages={pivotaltracker:"/help/pivotal_tracker",svn:"/help/subversion",vcs:"/help/git_other"},n.helpPath=function(t){return Collections.Sources.helpPages[t]||"/help/"+t
},n.prototype.nameFor=function(t){return Collections.Sources.names[t]},n.prototype.sourceFor=function(t){var e;return e={twitter_user_search:"twitter_user",twitter_keyword_search:"twitter_keyword",feed:"feed",trello:"trello",github:"github"},e[t]||null},n.prototype.initialize=function(){return this.ready=new $.Deferred},n.prototype.url=function(){return""+this.flow.url()+"/sources"},n.prototype.fetch=function(){var t;return t=n.__super__.fetch.apply(this,arguments),t.done(function(t){return function(){return t.ready.resolve()}}(this)).fail(function(t){return function(){return t.ready.reject()}}(this)),t},n.prototype.onAdd=function(t){var e;return e=new this.model(this.normalize(t),{flow:this.flow}),e.fetch({success:function(t){return function(){return t.add(e)}}(this)})},n.prototype.onRemove=function(t){var e,n;return e=t.content.original_message,n=this.sourceFor(e.type),this.remove(this.where({id:""+n+"-"+e.id}))},n.prototype.consume=function(t){if(this.stream)throw new Error("Sources collection is already subscribed to a stream");
return this.stream=t.filter(function(t){return"action"===t.event}).filter(function(t){return function(e){var n;return null!=t.sourceFor(null!=(n=e.content.original_message)?n.type:void 0)}}(this)),this.addStream(this.stream.filter(function(t){return 0===t.content.type.indexOf("add_")}).onValue(function(t){return function(e){return t.onAdd(e)}}(this))),this.addStream(this.stream.filter(function(t){return 0===t.content.type.indexOf("remove_")}).onValue(function(t){return function(e){return t.onRemove(e)}}(this)))},n.prototype.cleanup=function(){return n.__super__.cleanup.apply(this,arguments),delete this.ready},n.prototype.findWithConfig=function(t,e,n){var r;return null==n&&(n=null),r=n?this.where({type:n}):this.models,_.find(r,function(n){var r;return(null!=(r=n.getConfig(t))?r.toLowerCase():void 0)===(null!=e?e.toLowerCase():void 0)})},n.prototype.normalize=function(t){var e,n,r,o;return r=t.content.original_message,o=this.sourceFor(r.type),n=""+o+"-"+r.id,delete r.id,e={id:n,url:""+this.url()+"/"+n,config:r}
},n}(Flowdock.Collection)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Collections.Tags=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.everyoneTags=["@all","@anybody","@anyone","@everybody","@everyone"],n.prototype.model=Models.Tag,n.prototype.consume=function(t){var e,n,r,o,i;return e=t.filter(function(t){return t.id}),i=e.filter(function(t){return t.tags.length>0}).map(function(t){return t.tags}),r=e.filter(function(t){return"tag-change"===t.event}),n=r.filter(function(t){return t.content.add.length>0}).map(function(t){return t.content.add}),o=r.filter(function(t){return t.content.remove.length>0}).map(function(t){return t.content.remove}),this.addStream(n.merge(i).onValue(function(t){return function(e){var n,r,o,i,s;for(s=[],o=0,i=e.length;i>o;o++)r=e[o],n=t.getOrAdd(r),n?s.push(n.increment()):s.push(void 0);
return s}}(this))),this.addStream(o.onValue(function(t){return function(e){var n,r,o,i,s,a;for(a=[],i=0,s=e.length;s>i;i++)o=e[i],r=t.get(o),r?(n=r.decrement(),0>=n?a.push(t.remove(r)):a.push(void 0)):a.push(void 0);return a}}(this)))},n.prototype.cleanup=function(){return n.__super__.cleanup.apply(this,arguments),delete this.trie},n.prototype.initialize=function(){return this._buildTrie(),this.listenTo(this,"add",function(t){return this.trie.set(t.id,t)})},n.prototype.getOrAdd=function(t,e){var n;return null==e&&(e=Models.Tag.prototype.defaults.count),n=t.toLowerCase(),Models.Tag.regularTag(n)?this.get(n)||this.push({id:n,count:e}):new Models.Tag({id:n,flow:this.flow})},n.prototype.getByHumanized=function(t){return this.getOrAdd(this.dehumanize(t))},n.prototype.everyone=function(){return new Models.Tag({id:Models.Tag.userTagFor("everyone")})},n.prototype.startingWith=function(t){var e,n,r;return t?(n=t[0],("#"===(r=t[0])||"@"===r)&&(t=t.slice(1)),t=t.toLowerCase(),e=[],"#"!==n&&(this._matchesEveryone(t)&&e.push(this.everyone()),e=e.concat(this._userMatches(t))),"@"!==n&&(e=e.concat(this._tagMatches(t))),e.sort(function(e,n){var r,o;
return r=t.length>0&&e.humanize().slice(1).toLowerCase()===t,o=t.length>0&&n.humanize().slice(1).toLowerCase()===t,r!==o?o-r:n.get("count")-e.get("count")})):[]},n.prototype.dehumanize=function(t){var e;if(null!=t)return this.everyoneTags.indexOf(t.toLowerCase())>=0?Models.Tag.userTagFor("everyone"):"@"!==t[0]?"#"===t[0]?t.slice(1):t:(e=this.flow.users.find(function(e){return e.get("nick").toLowerCase()===t.slice(1).toLowerCase()}),null!=e?Models.Tag.userTagFor(e.get("id")):void 0)},n.prototype.reset=function(t,e){return null==t&&(t=[]),null==e&&(e={}),n.__super__.reset.apply(this,arguments),this._buildTrie()},n.prototype._buildTrie=function(){return this.trie=new Trie,this.each(function(t){return function(e){return t.trie.set(e.id,e)}}(this))},n.prototype._matchesEveryone=function(t){return _.any(this.everyoneTags,function(e){return 0===e.indexOf("@"+t)})},n.prototype._userMatches=function(t){return this.flow.users.reduce(function(e){return function(n,r){return r.get("disabled")||0!==r.get("nick").toLowerCase().indexOf(t)||n.push(new Models.Tag({flow:e.flow,id:Models.Tag.userTagFor(r.id)})),n
}}(this),[])},n.prototype._tagMatches=function(t){return""===t?this.models.slice(0):this.trie.prefixed(t).values()},n.prototype.get=function(t){return null!=t?_.isNumber(t)||_.isString(t)?this._byId[t]:this._byId[t.id]||this._byId[t.cid]:void 0},n}(Flowdock.Collection)}.call(this),function(){Views.Shared||(Views.Shared={})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.Attachment=function(e){function r(){return this.onLinkPreviewChange=t(this.onLinkPreviewChange,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="attachment",r.prototype.initialize=function(t){var e;return e={showFileProperties:!0,renderIfPreviewsHidden:!0},t=_.extend(e,t),this.file=new Presenters.Attachment(t.attachment),this.parent=t.parent,this.showFileProperties=t.showFileProperties,this.renderIfPreviewsHidden=t.renderIfPreviewsHidden,this.addStream(Flowdock.app.preferences.asEventStream("change:link_previews").onValue(this.onLinkPreviewChange))
},r.prototype.render=function(){var t,e;return this.showPreview()||this.renderIfPreviewsHidden?this.$el.html(HoganTemplates["owl/templates/shared/attachment"].render({file:this.file,dimensions:this.file.dimensions(),meta:this.file.meta()})):this.$el.html(""),this.$el.addClass(this.model.get("event")),t=this.file.dimensions()?Views.Embed.Image:Views.Embed.match(this.file.path()),this.parent&&null!=t&&this.showPreview()&&(e=this.$el.find("a").first().wrap("<div class='embed file-preview'>").parent(),this.preview(t,e)),this},r.prototype.preview=function(t,e){var n;return n={url:this.file.path(),rotatedUrl:this.file.rotatedPath(),el:e,parent:this.parent,skipTimeout:"file"===this.model.get("event"),hideable:this.renderIfPreviewsHidden},this.previewer=this.subview(new t(n).render())},r.prototype.load=function(){var t;return null!=(t=this.previewer)?t.load():void 0},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.file=this.parent=this.previewer=null},r.prototype.onLinkPreviewChange=function(){return null!=this.previewer&&(this.removeSubview(this.previewer),delete this.previewer),this.render()
},r.prototype.showPreview=function(){return Flowdock.app.preferences.linkPreviews()},r}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Shared.Autocompleter=function(e){function o(){return this.addableToken=t(this.addableToken,this),this.render=t(this.render,this),o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.tagName="ul",o.prototype.className="autocompleter",o.prototype.events={"click li.option":"chooseTarget","mouseover li.option":"selectTarget"},o.prototype.initialize=function(t){return null==t&&(t={}),this.maxOptions=t.maxOptions||10,this.query="",this.hide()},o.prototype.refreshQuery=function(t){return null==t&&(t=""),this.query=t.trim(),this.render()
},o.prototype.render=function(){var t,e;return this.empty(),e=this.filterModels(),this.$el.append(function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(this.renderOption(t));return o}.call(this)),this.$el.children().length?(this.show(),this.select(this.$el.children().first())):"@"===this.query[0]?this.renderError("No user found"):this.hashTagBody()&&!this.validToken()?this.renderError():(this.select(null),this.hide()),this},o.prototype.destroy=function(){return this.off(),this.undelegateEvents(),this.remove()},o.prototype.select=function(t){var e;return e=null===t||$(t).is("li")?t:$(t).parent()[0],this.$("li").removeClass("selected"),this.selection=$(e).addClass("selected")},o.prototype.selectNext=function(){return this.selection.next().length?this.select(this.selection.next()):this.select(this.$("li").first())},o.prototype.selectPrev=function(){return this.selection.prev().length?this.select(this.selection.prev()):this.select(this.$("li").last())},o.prototype.completionKey=function(t){return t.preventDefault()
},o.prototype.choose=function(){return this.chooseSelection()||this.chooseQuery()},o.prototype.chooseSelection=function(){return this.selection.length?(this.trigger("chosen",this.selection.data("token")),this.refreshQuery("")):void 0},o.prototype.chooseQuery=function(){var t;return this.validToken()&&this.addableToken(this.query)?(t=Models.Tag.stripHashes(this.query),this.trigger("chosen",this.collection.getOrAdd(t,0)),this.refreshQuery("")):void 0},o.prototype.onTab=function(t){return t.preventDefault(),this.chooseSelection()},o.prototype.onSpacebar=function(t){return t.preventDefault(),this.chooseQuery()},o.prototype.onReturn=function(t){return t.preventDefault(),this.choose()},o.prototype.empty=function(){return this.$el.empty()},o.prototype.show=function(){return this.$el.removeClass("hidden")},o.prototype.hide=function(){return this.$el.addClass("hidden")},o.prototype.addableToken=function(t){return r.call(this.excludeTokens(),t)<0},o.prototype.excludeTokens=function(){return[]},o.prototype.validToken=function(){return FlowdockText.regexen.singleValidHashTag.test(this.hashTagBody())
},o.prototype.hashTagBody=function(){return this.query.replace(/^#+/,"")},o.prototype.filterModels=function(){var t;return t=this.excludeTokens(),this.collection.startingWith(this.query).slice(0,this.maxOptions+t.length).filter(function(){return function(e){var n;return 0===e.id.indexOf(":")||e.get("count")?(n=e.id,r.call(t,n)<0):!1}}(this)).slice(0,this.maxOptions)},o.prototype.renderOption=function(t){var e;return e=$("<li>").addClass("option "+t.type()+"-choice").data("token",t),e.html(HoganTemplates["owl/templates/inbox/autocompleter_option"].render({tag:t,count:"function"==typeof t.get?t.get("count"):void 0}))},o.prototype.renderError=function(t){var e;return null==t&&(t="Invalid tag"),e=$("<li>").addClass("option error").text(t),this.$el.append(e),this.select(null),this.show()},o.prototype.chooseTarget=function(t){return t.preventDefault(),this.select(t.target),this.choose()},o.prototype.selectTarget=function(t){return this.select(t.target)},o}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)
}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.Avatar=function(e){function r(){return this.toggleUserCard=t(this.toggleUserCard,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="avatar",r.prototype.events={dblclick:"openPrivateChat"},r.prototype.initialize=function(t){var e;return e=this.model.asProperty("avatar").takeUntil(this.asEventStream("destructor")),e.map(function(){return function(e){return"url("+e+t.size+")"}}(this)).assign(this.$el,"css","background-image"),t.avatarOnly?this.$el.click(this.toggleUserCard):void 0},r.prototype.openPrivateChat=function(){return this.model.canChatWith(this.model.collection.flow.me())&&(Flowdock.app.router.navigateTo({"private":this.model}),this.userCardOpen())?this.userCard.destructor():void 0},r.prototype.userCardOpen=function(){return null!=this.userCard},r.prototype.toggleUserCard=function(){var t;
if(!this.userCardOpen()&&!Flowdock.mobile)return t=this.getPosition(),this.userCard=new Views.Chat.UserCard({model:this.model,me:this.model.collection.flow.me()}),this.userCard.once("destructor",function(t){return function(){return t.userCard=void 0}}(this)),$("body").append(this.userCard.render({alignTop:!1}).$el.css({top:t.top+25+"px",left:t.left-20+"px"}))},r.prototype.getPosition=function(){return this.$el.offset()},r}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.ExpandingInput=function(e){function r(){return this._setCaretAtEnd=t(this._setCaretAtEnd,this),this.setMaxHeight=t(this.setMaxHeight,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="expanding-input",r.prototype.events={"input textarea":"mirrorText"},r.prototype.initialize=function(t){return null==t&&(t={}),this.autofocus=t.autofocus||!1,this.placeholder=t.placeholder||"",this.persistId=t.persistId,$(window).asEventStream("unload").merge(this.asEventStream("destructor")).take(1).onValue(function(t){return function(){return null!=t.textarea?t.saveText():void 0
}}(this))},r.prototype.focus=function(){var t;return null!=(t=this.textarea)?t.focus():void 0},r.prototype.focused=function(){var t;return null!=(t=this.textarea)?t.is(":focus"):void 0},r.prototype.mirrorText=function(){var t,e;return t=this.$el.height(),e=this.textarea.val(),this.span.text(e),this.$el.height()!==t?this.trigger("scale"):void 0},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/shared/expanding_input"].render({placeholder:this.placeholder})),this._restoreText(),this.textarea=this.$("textarea").indentPaste(),this.span=this.$("span.copy"),this.mirrorText(),this.textarea.attr("data-input-id",""+this.persistId),this.autofocus&&_.defer(function(t){return function(){return t.focus()}}(this)),this},r.prototype.reset=function(){return this.textarea.val(""),this.textarea.trigger("reset"),this.mirrorText()},r.prototype.setMaxHeight=function(){return this.$el.css("max-height",""+.4*$(window).height()+"px"),this.trigger("scale")},r.prototype.setPlaceholder=function(t){var e;return null!=(e=this.textarea)?e.attr("placeholder",t):void 0
},r.prototype.saveText=function(){var t;return t=this.value(),null!=this.persistId?t?localStorage.setItem(this.persistId,t):localStorage.removeItem(this.persistId):void 0},r.prototype.setText=function(t){return this.textarea.val(t),this.mirrorText()},r.prototype.value=function(){var t;return null!=(t=this.textarea)?t.val():void 0},r.prototype._restoreText=function(){var t;if(null!=this.persistId)return t=localStorage.getItem(this.persistId),null!=t?this.$("textarea").val(t).one("focus",this._setCaretAtEnd):void 0},r.prototype._setCaretAtEnd=function(){var t,e;return t=this.$("textarea"),t?(e=t.val(),t.focus().val("").val(e)):void 0},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.Feedback=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.template=HoganTemplates["owl/templates/shared/feedback"],n.prototype.className="form-feedback",n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.message=t.message,this.error=t.error
},n.prototype.serializeData=function(){return{message:this.message,error:this.error}},n.prototype.render=function(){return this.hide=setTimeout(this.remove.bind(this),5e3),this.$el.html(this.template.render(this.serializeData())),this.error&&this.$el.addClass("error"),this},n.prototype.remove=function(){return this.hide&&clearTimeout(this.hide),n.__super__.remove.apply(this,arguments)},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.FileUploader=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="form",n.prototype.className="upload",n.prototype.events={fileuploadadd:"onFileAdd",fileuploadprogress:"onFileProgress"},n.prototype.initialize=function(t){return this.uploading={},this.parent=t.parent,this.target=t.target,this.targetName=t.targetName||null,this.listenToOnce(this,"view:attach:after",function(){return this.setupFileUpload(),this.setupDragNDrop()
})},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.uploading=this.$overlay=null},n.prototype.showOverlay=function(){return this.$overlay||(this.$overlay=new Views.Overlays.Upload({target:$(this.target),targetName:this.targetName,removeOnHide:!1})),this.$overlay.attach()},n.prototype.onFileAdd=function(t,e){var n,r,o,i,s,a;return n=e.files[0].name||e.files[0].fileName,a=Models.Message.prototype.generateUuid(),o={uuid:a,user:this.model.me().id},o[this.model.isFlow()?"flow":"to"]=this.model.get("id"),this.parent&&(o.tags=["inbox:"+this.parent.id]),r=new Models.FileMessage(o),r.upload=new Backbone.Model({state:"starting",uploaded:0,fileName:n}),s=function(){return r.upload.off(),r.off(null,null,r),delete r.upload},r.on("change:content",s,r),this.uploading[n]=r,this.$el.find("input[name=uuid]").val(a),this.$el.find("input[name=event]").val("file"),this.parent&&this.$el.find("input[name=tags]").val("influx:"+this.parent.id),e.formData={uuid:a,event:"file"},this.parent&&(e.formData.tags="influx:"+this.parent.id),i=e.submit().done(function(){var t;
return null!=(t=r.upload)?t.set({state:"finished"}):void 0}).fail(function(){var t;return null!=(t=r.upload)?t.set({state:"failed"}):void 0}).always(function(t){return function(){return t.uploading[n]=null}}(this)),this.trigger("new_upload",r)},n.prototype.onFileProgress=function(t,e){var n,r;return n=e.files[0].name||e.files[0].fileName,r=this.uploading[n],null!=(null!=r?r.upload:void 0)?("starting"===r.upload.get("state")&&r.upload.set({state:"uploading"}),r.upload.set({uploaded:parseInt(e.loaded/e.total*100,10)})):void 0},n.prototype.setupDragNDrop=function(){return $(this.target).dragNDropFileEvents({target:this.target,overlayClass:"fileupload-dnd-overlay",drop:function(t){return function(){return t.$overlay.close()}}(this),dragenter:function(t){return function(){return t.showOverlay()}}(this),dragleave:function(t){return function(){return t.$overlay.close()}}(this)})},n.prototype.setupFileUpload=function(){return this.$el.fileupload({dataType:"json",url:""+this.model.url()+"/messages",dropZone:$(this.target),pasteZone:$(this.target)})
},n.prototype.onDetach=function(){var t;return null!=(t=this.$overlay)?t.close():void 0},n.prototype.prompt=function(){return this.$("input[type=file]").click()},n.prototype.render=function(){return this.$el.empty().append(HoganTemplates["owl/templates/shared/fileuploader"].render()),this.$el.attr({enctype:"multipart/form-data"}),this},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.List=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="ul",n.prototype.collectionEvents={reset:"render",add:"addItem",remove:"removeItem","change:disabled":"editItem"},n.prototype.initialize=function(t){return null==t&&(t={}),this.filter=t.filter,this.modelView=t.modelView},n.prototype.destructor=function(){return this.modelView=void 0,n.__super__.destructor.apply(this,arguments)
},n.prototype.render=function(){var t,e,n,r;for(e=this.filter?this.collection.filter(this.filter):this.collection.models,this.$el.empty(),n=0,r=e.length;r>n;n++)t=e[n],this.removeSubview(t),this.$el.append(this.subview(new this.modelView({model:t})).render().el);return this},n.prototype.addItem=function(t){var e;return e=this.subview(new this.modelView({model:t})),this.$el.append(this.expand(e.render()).el),this.trigger("addItem")},n.prototype.removeItem=function(t){var e,n,r,o;for(o=this.removeSubview(t),n=0,r=o.length;r>n;n++)e=o[n],this.collapse(e);return this.trigger("removeItem")},n.prototype.expand=function(t){var e;return e=t.$el,e.on(Helpers.animationend(),function(){return e.off(Helpers.animationend()),e.removeClass("expanding")}),e.addClass("expanding"),t},n.prototype.collapse=function(t){var e;return e=t.$el.addClass("collapsing"),e.on(Helpers.animationend(),function(){return t.remove()})},n.prototype.editItem=function(t,e){return e===!1?this.addItem(t):this.removeItem(t)},n}(Flowdock.HierarchicalView)
}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.Message=function(e){function r(){return this.markAsRead=t(this.markAsRead,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.modelEvents={"change:tags":"onTagChange","change:content":"onContentChange","change:edited":"onContentChange","change:id":"onIdChange","tag-change":"checkUnread"},r.prototype.contentClass="content",r.prototype.initialize=function(t){return null==t&&(t={}),r.__super__.initialize.apply(this,arguments),t.disableEyeTracking&&(this.disableEyeTracking=!0),t.tags===!1?this.disableTagRendering=!0:void 0},r.prototype.renderTags=function(){var t,e,n;return t=this.model.humanTags(),e=null!=(n=this.model.flow())?n.me():void 0,this.$(".edit-tags").toggleClass("filled",t.length>0),this.$el.toggleClass("highlight",this.model.highlights(e)),this.$el.toggleClass("unread",this.model.unread(e)),this.updateTagList(t)
},r.prototype.updateTagList=function(t){var e,n,r,o,i,s,a;for(i=this.$("ul.tags").html(""),e=this.$("."+this.contentClass+" .tag").addClass("removed"),s=0,a=t.length;a>s;s++)o=t[s],this.disableTagRendering||(r=$(_.filter(e,function(t){return function(e){var n;return n=$(e).attr("title").toLowerCase().split(" ").pop(),o.humanize().toLowerCase()===n||t.model.flow().tags.dehumanize(n).match(o.id)}}(this))),r.length>0?r.removeClass("removed"):(n=$("<a>").attr("href",Helpers.urlFor({flow:this.model.flow(),filter:new Models.Filter.All({tags:[o]})})).text(o),i.append($("<li class='tag'>").html(n))));return i.toggleClass("empty",0===t.length)},r.prototype.eyeTracking=function(){return"function"==typeof this.windowFocusUnsubscribe&&this.windowFocusUnsubscribe(),this.windowFocusUnsubscribe=Flowdock.appFocus.onValue(function(t){return function(e){var n;return t.$el.scrollableInview("remove",t.markAsRead),n=t.needsEyeTracking(),e&&n&&_.defer(function(){return t.$el.scrollableInview({onInview:t.markAsRead,scrollParent:t.$el.closest("ul"),fully:!0})
}),n?void 0:("function"==typeof t.windowFocusUnsubscribe&&t.windowFocusUnsubscribe(),delete t.windowFocusUnsubscribe)}}(this))},r.prototype.needsEyeTracking=function(){var t,e;try{return!this.disableEyeTracking&&this.model.unread(null!=(e=this.model.flow())?e.me():void 0)}catch(n){return t=n,console.log("eyeTracking error",t.stack)}},r.prototype.render=function(){return this.renderContent(),this.renderTags(),this.eyeTracking(),this.renderEmoji(this.$el),this},r.prototype.renderEmoji=function(t){return t.emojie&&t.emojie(),null!=this.model.flow().emoji&&this.model.flow().emoji.emojie(t[0]),t},r.prototype.onTagChange=function(t){return this.preserveScrolling(function(e){return function(){return e.renderTags(t.previousTags()),e.eyeTracking()}}(this))},r.prototype.onContentChange=function(){return this.preserveScrolling(function(t){return function(){return t.render()}}(this))},r.prototype.checkUnread=function(t){return _.include(t.remove,":unread:"+Flowdock.app.user.id)?(this.$el.addClass("remove-unread"),setTimeout(function(t){return function(){return t.$el.removeClass("remove-unread")
}}(this),2e3)):void 0},r.prototype.markAsRead=function(){var t;return"function"==typeof this.windowFocusUnsubscribe&&this.windowFocusUnsubscribe(),delete this.windowFocusUnsubscribe,this.model.markAsRead(null!=(t=this.model.flow())?t.me():void 0)},r.prototype.preserveScrolling=function(t){var e,n,r,o,i,s,a,l,u;return s=this.$el.parents(".chat-message-list, .inbox-message-list, .single-view-content").first(),a=s[0],o=function(){return(null!=a?a.scrollHeight:void 0)||0},u=function(){return(null!=a?a.scrollTop:void 0)||0},i=u(),l=this.$el.position().top/this.$el.parent().height(),e=a?a.scrollHeight-a.scrollTop-s.height()<=50:!1,n=o(),t(),r=i-u(),(0>l||e&&1>l&&o()>n)&&(a.scrollTop+=o()-n,r>0&&(a.scrollTop+=r)),o()!==n&&s.trigger("scroll"),this},r.prototype.openTagInput=function(t){var e;if(!this.disableTagRendering)return e=$(t.target),t.preventDefault(),t.stopPropagation(),this.cancelOpen?(this.cancelOpen=!1,void 0):(e.one("mousedown",function(t){return function(){return t.tagInput?t.cancelOpen=!0:void 0}}(this)),this.$el.addClass("open"),e.addClass("active"),this.tagInput=this.subview(this.newTagInput()),this.$el.append(this.tagInput.$el),this.tagInput.render(),this.listenTo(this.tagInput.tokenist,"tokenist-blur",function(){return e.removeClass("active"),this.tagInput=void 0,this.$el.removeClass("open")
}))},r.prototype.newTagInput=function(){return this.disableTagRendering?void 0:new Views.Shared.TagInput({model:this.model})},r.prototype.destructor=function(){return"function"==typeof this.windowFocusUnsubscribe&&this.windowFocusUnsubscribe(),this.$el.scrollableInview("destroy"),r.__super__.destructor.apply(this,arguments),this.tagInput=null},r.prototype.iconType=function(){var t;return t=this.model.get("event"),"action"===t||"file"===t||"line"===t||"status"===t||"message"===t?"comment":t},r.prototype.messageTimestamp=function(){return Helpers.TimeHelper.detailedTimestamp(this.model.get("sent"),{link:this.timestampLink()})},r.prototype.timestampLink=function(t){return(null!=t?"function"==typeof t.timestampLink?t.timestampLink():void 0:void 0)?{href:"function"==typeof t.timestampLink?t.timestampLink():void 0,target:"_blank"}:{href:Helpers.absoluteUrlFor({flow:this.model.flow(),message:this.model}),title:"Permalink"}},r.prototype.onIdChange=function(){return this.$("a.timestamp-link").attr("href",Helpers.absoluteUrlFor({flow:this.model.flow(),message:this.model}))
},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.MessageAutocompleter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.collection=this.model.flow().tags,this.model.on("change:tags",this.render)},n.prototype.destroy=function(){return n.__super__.destroy.apply(this,arguments),this.model.off("change:tags",this.render)},n.prototype.completionKey=function(t){var e,n;return t.preventDefault(),32===(e=t.which)||188===e?this.chooseQuery():9===(n=t.which)||13===n?this.choose():void 0},n.prototype.excludeTokens=function(){return this.model.get("tags")},n}(Views.Shared.Autocompleter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.MessageError=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="error-message",n.prototype.events={"click .report-link":"reportError","click a.delete":"delete","click .dropdown-toggle":"toggleMenu","click .dropdown a":"preventOpen","click .dropdown-wrapper":"preventOpen",mouseleave:"hideMenu"},n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.app=t.app,this.error=t.error},n.prototype.toggleMenu=function(t){return t.stopPropagation(),$(t.target).closest(".dropdown").toggleClass("open")},n.prototype.hideMenu=function(){return this.$(".dropdown").removeClass("open")},n.prototype.preventOpen=function(t){return t.stopPropagation()},n.prototype["delete"]=function(t){return t.stopPropagation(),Helpers.confirmDelete()?this.model.destroy():void 0},n.prototype.reportError=function(t){return this.feedbackFormWithError(this.report()),t.preventDefault(),!1
},n.prototype.feedbackFormWithError=function(t){var e;return e=new Views.Navigation.FeedbackForm({model:Flowdock.app.manager.currentFlow,removeOnHide:!0,target:$("body"),errorData:t}),e.attach()},n.prototype.report=function(){return"Couldn't render an "+this.app+" item:\n"+this.error+"\n\n"+("Message:\n"+JSON.stringify(this.model.toJSON())+"\n\n")+("Stacktrace:\n"+this.error.stack+"\n\n")+("URL:\n"+window.location+"\n\n")},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/"+this.app+"/error"].render({removable:this.model.removable()})),this},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.app=this.error=null},n}(Flowdock.HierarchicalView)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;
return-1};t="\ud83c\udf7a",e="\ud83c\udf7b",Views.Shared.MessageInput=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.tagName="form",i.prototype.className="message-form",i.prototype.slashCommands=[{command:"query",message:!1,validateParams:function(t){return t.match(/\w+/)},action:function(t){return!!this.openPrivate(t.replace(/@/,""))}},{command:"hangout",message:!1,validateParams:function(){return!0},action:function(){return this.openHangout(),!0}},{command:["status","away"],message:!0,validateParams:function(){return!0},action:function(t){return{event:"status",content:t||""}}},{command:"me",message:!0,validateParams:function(t){return t.match(/[^\s]+/)},action:function(t){return{event:"line",content:t}}},{command:"slap",message:!0,validateParams:function(t){return t.match(/\w+/)},action:function(t){var e;return e=$.trim(t),{event:"line",content:"slaps "+e+" around a bit with a large trout"}}},{command:"help",message:!1,validateParams:function(){return!0
},action:function(){return this.showSlashCommandHelp(),!0}},{command:"",message:!0,validateParams:function(){return!0},action:function(t){return{event:"message",content:t}}},{command:"beers",message:!0,validateParams:function(t){return parseInt(t,10)>0},action:function(e){return{event:"message",content:Array(parseInt(e,10)+1).join(t)}}},{command:"doublebeers",message:!0,validateParams:function(t){return parseInt(t,10)>0},action:function(t){return{event:"message",content:Array(parseInt(t,10)+1).join(e)}}},{command:"pack",message:!0,validateParams:function(t){var e;return 6===(e=parseInt(t,10))||12===e||18===e||24===e},action:function(e){var n,r,o,i,s,a;return n=parseInt(e,10),a=function(){switch(n){case 6:return[2,3];case 12:return[2,6];case 18:return[3,6];case 24:return[4,6]}}(),s=a[0],r=a[1],i=Array(r+1).join(t),{event:"message",content:function(){var t,e;for(e=[],o=t=0;s>=0?s>t:t>s;o=s>=0?++t:--t)e.push(i);return e}().join("\n")}}},{command:"capslock",message:!1,validateParams:function(){return!0},action:function(){var t,e;
return e=function(){return 0!==$("style#capslock").length},e()?$("#capslock").remove():(t="<style id='capslock'>* {text-transform: uppercase !important}</style>",$("head").append(t))}}],i.prototype.openHangout=function(){var t,e;return t=$("<form></form>").attr({action:"/hangouts/new",method:"post",target:"_blank"}).css({display:"none"}).appendTo($("body")),e=$("<input>").attr({type:"hidden",value:this.model.id}),e.attr("name",this.model.isFlow()?"flow":"private"),t.append(e).trigger("submit").remove()},i.prototype.openPrivate=function(t){var e;return t=$.trim(t).toLowerCase(),(e=_.find(this.flow().users.enabled(),function(e){return e.get("nick").toLowerCase()===t}))?(Flowdock.app.router.navigateToPrivate(e.id),!0):this.userNotFound(t)},i.prototype.focus=function(t){return null!=t&&t.preventDefault(),this.textarea.focus()},i.prototype.flow=function(){return this.model},i.prototype.matchCommand=function(t){var e,n,r,o;for(o=this.slashCommands,n=0,r=o.length;r>n;n++)if(e=o[n],_.flatten([e.command]).indexOf(t)>=0)return e
},i.prototype.invalidCommand=function(t,e,n){var r,o;return o=_.once(function(t){return function(e){return t.$("textarea").off("keypress focus",o),"keypress"===e.type?e.preventDefault():void 0}}(this)),this.$("textarea").on("keypress focus",o),r=n?"/"+t+" requires a valid parameter.":"/"+t+" is not a recognized /command.",alert(""+r+"\n\n"+("If you want to start a chat message with /"+t+", use ")+(' "/ /'+t+'". To see all available commands, type /help.'))},i.prototype.showSlashCommandHelp=function(){var t;return t=new Views.SlashCommands({target:$("body")}).attach(),t.once("close",function(t){return function(){return t.focus()}}(this))},i.prototype.isSlashCommand=function(t){return 0===t.indexOf("/")},i.prototype.triggerUpload=function(t){return t.preventDefault(),this.trigger("upload")},i.prototype.editLastMessage=function(){return this.trigger("edit-last-message")},i.prototype.userNotFound=function(t){return _.defer(function(){return alert(""+t+" - no such user found.")}),!1},i.prototype.value=function(){return this.textarea.value()
},i.prototype.parse=function(t){var e;return e=t.event||"message",null!=t.content&&(t=t.content),{event:e,content:Helpers.IndentationHelper.parseEmojies(t),tags:this.parseTags(t)}},i.prototype.parseTags=function(t){return Helpers.TagHelper.parseTags(t,this.flow())},i.prototype.getCommand=function(t){return t.match(/^\/([^\s]*)/)[1]},i.prototype.commandNotAvailable=function(t){return _.defer(function(){return alert("The "+t+" command is not available in this input.")})},i.prototype.sendMessage=function(t){var e,n,r,i,s;return null!=t&&t.preventDefault(),s=this.value(),this.isSlashCommand(s)?(e=this.getCommand(s),null!=this.disabledCommands&&o.call(this.disabledCommands,e)>=0?(this.commandNotAvailable(e),!1):(r=s.substring(("/"+e+" ").length),i=this.matchCommand(e,r),null==i&&e.split("/").length>=2?this.createMessage(this.parse(s)):null!=i&&i.validateParams.call(this,r)?i.message?this.createMessage(this.parse(i.action.call(this,r))):i.action.call(this,r)?(this.textarea.reset(),this.focus()):void 0:(this.invalidCommand(e,r,null!=i),!1))):(n=s.match(/^s\/([^\/]+)\/([^\/]*)/))?(this.trigger("edit-last-message",n[1],n[2]),this.textarea.reset(),this.focus()):this.createMessage(this.parse(s))
},i.prototype.onKeydown=function(t){return 13!==t.which||0!==$.trim(this.value()).length||t.shiftKey?13===t.which?this.enter(t):KeyEvent.is("up")(t)&&""===$(t.target).val()?this.editLastMessage(t):KeyEvent.is("esc")(t)?this.textarea.$("textarea").blur():void 0:(t.preventDefault(),t.stopImmediatePropagation())},i.prototype.enter=function(t){return!t.shiftKey&&!t.altKey||Flowdock.app.preferences.enterSendsMessage()?t.shiftKey||t.altKey||!Flowdock.app.preferences.enterSendsMessage()?void 0:(t.preventDefault(),t.stopImmediatePropagation(),this.submit(t)):(t.preventDefault(),t.stopImmediatePropagation(),this.submit(t))},i}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.MessageList=function(e){function r(){return this.canPurgeMessages=t(this.canPurgeMessages,this),this.keyboardEventFilter=t(this.keyboardEventFilter,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.tagName="ul",r.prototype.className="message-list",r.prototype.scrollThreshold=25,r.prototype.collectionEvents={historyAdd:"onHistoryAdd",add:"onAdd",remove:"onRemove"},r.prototype.removeTimeout=null,r.prototype.scrollAnimationDuration=100,r.prototype.keyboardEvents={pageUp:"pageUp",pageDown:"pageDown",scrollToTop:"firstItem",scrollToBottom:"lastItem",nextItem:"nextItem",previousItem:"previousItem",selectItem:"selectItem",openItemTagEditor:"openItemTagEditor",onActivate:"onActivate"},r.prototype.keyboardEventFilter=function(t){return t.activeSide===this.listName},r.prototype.initialize=function(t){var e;return this.options=t,this.state={renderMessages:this.options.renderMessages},this.startAt=this.options.startAt,this.backwardLoader=new Views.Shared.MessageLoader({collection:this.collection,direction:"backward"}),this.startAt&&(this.forwardLoader=new Views.Shared.MessageLoader({collection:this.collection,direction:"forward"})),this.backwardLoader.blockSuccessRenderingChange=!this.state.renderMessages,null!=(e=this.forwardLoader)&&(e.blockSuccessRenderingChange=!this.state.renderMessages),null!=this.forwardLoader&&$.when(this.backwardLoader.firstLoad,this.forwardLoader.firstLoad).done(function(t){return function(){return _.defer(function(){return t.jumpToMessage(t.startAt)
})}}(this)),this.listenTo(this,"view:attach:before",function(){return this.scrollLocation(this.state.scrollLocation||0),this.attached=!0}),this.listenTo(this,"view:detach:before",function(){return this.setScrollLocation(),this.attached=!1}),this.scrollState=this.$el.asEventStream("scroll").debounceImmediate(100).flatMapLatest(function(){return Bacon.once(!0).merge(Bacon.once(!1).delay(150))}).skipDuplicates().toProperty(!1),r.__super__.initialize.apply(this,arguments)},r.prototype.setupMessagePurging=function(t,e){var n,r,o;return this.isDetached=this.asEventStream("view:attach:after").map(!1).merge(this.asEventStream("view:detach:after").map(!0)).toProperty(),n=$(window).asEventStream("blur"),o=$(window).asEventStream("focus"),r=Bacon.mergeAll([n.skipWhile(this.isDetached),this.asEventStream("view:detach:after")]).filter(this.canPurgeMessages),r.flatMapLatest(function(e){return function(){return Bacon.later(t,!0).takeUntil(e.asEventStream("view:attach:after").merge(o))}}(this)).takeUntil(this.asEventStream("destructor")).onValue(function(t){return function(){var n;
return null!=(n=t.collection)?n.purgeOlderMessages(e):void 0}}(this))},r.prototype.canPurgeMessages=function(){return this.state.scrollLocation<this.scrollThreshold},r.prototype.renderMessages=function(){var t;return this.backwardLoader.blockSuccessRenderingChange=!1,null!=(t=this.forwardLoader)&&(t.blockSuccessRenderingChange=!1),this.state.renderMessages=!0,this.$el.children().length>0&&this.render(),this.trigger("renderMessages"),!0},r.prototype.preserveScrolling=function(t,e){var n,r,o;return null==t&&(t={}),o=this.scrollLocation(),r=this.el.scrollHeight,e(),this.attached&&"forward"!==t.direction?(n=this.el.scrollHeight-r,n>o||t.history?o>this.scrollThreshold?this.scrollLocation(o):this.scrollLocation(0):this.scrollLocation(o+n),this.setScrollLocation()):void 0},r.prototype.setScrollLocation=function(){return $.contains($("body")[0],this.el)?this.state.scrollLocation=this.scrollLocation():void 0},r.prototype.onHistoryAdd=function(t,e){return this.state.renderMessages?this.preserveScrolling({history:!0,direction:e},function(n){return function(){return n.renderGroup(t,{history:!0,direction:e})
}}(this)):void 0},r.prototype.onAdd=function(t){if(!this.collection.historyComplete.forward)return this.collection.remove(t),void 0;if(this.state.renderMessages)return this.preserveScrolling({history:!1},function(e){return function(){return e.insert(e.renderOne(t))}}(this))},r.prototype.scrollLocation=function(t){return null!=t&&(this.el.scrollTop=t),this.el.scrollTop},r.prototype.onRemove=function(t){var e,n,r,o,i;for(o=this.removeSubview(t),i=[],n=0,r=o.length;r>n;n++)e=o[n],e.remove(),i.push(e.destructor());return i},r.prototype.renderGroup=function(t,e){var n,r,o,i,s;return null==e&&(e={}),e.direction||(e.direction="backward"),r="backward"===e.direction?this.backwardLoader:this.forwardLoader,r.detach(),i=function(t){return function(){var n;return t.insert([r.render().el],"backward"===e.direction),n="backward"===e.direction?t.lastElement(t.$el.children("li"),5):t.firstElement(t.$el.children("li"),5),r.inView(n,t.$el)}}(this),n=function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],r.push(this.renderOne(o));
return r}.call(this),e.reverse||n.reverse(),this.insert(_.flatten(n,!0),e.history&&"backward"===e.direction),this.collection.historyComplete[e.direction]?(r.remove(),"forward"===e.direction&&(this.$el.removeClass("in-history"),this.$(".history-highlight").removeClass("history-highlight"),null!=(s=this.$jumpToCurrent)&&s.remove())):i(),this},r.prototype.buildMoreMessagesIndicator=function(t){var e;return this.moreMessages?(this.moreMessages.increment(),void 0):(e={direction:"below",scrollable:this.$el,removeWhen:function(t){return function(){return t.collection.historyComplete.forward&&t.scrollLocation()<t.scrollThreshold}}(this),onRemoved:function(t){return function(){return t.collection.historyComplete.forward?t.scrollLocation(0):t.jumpToCurrent(),t.removeSubview(t.moreMessages),t.moreMessages=null}}(this)},this.moreMessages=this.subview(new Views.Shared.MoreMessages(_.extend(e,t))),this.trigger("indication",this.moreMessages.render().$el))},r.prototype.buildJumpToCurrentIndicator=function(){return this.$jumpToCurrent?void 0:(this.$jumpToCurrent=$(HoganTemplates["owl/templates/shared/jump_to_current"].render()),this.trigger("indication",this.$jumpToCurrent))
},r.prototype.lastElement=function(t,e){return null==e&&(e=0),t.slice(-1-e).first()},r.prototype.firstElement=function(t,e){return null==e&&(e=0),t.slice(0,e+1).last()},r.prototype.insert=function(t,e){var n,r,o;return null==e&&(e=!1),r=e?"append":"prepend",n=function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],o instanceof Element?r.push(o):(this.subview(o),r.push(o.el));return r}.call(this),this.$el[r](n)},r.prototype.empty=function(){var t,e,n,r,o;for(this.backwardLoader.detach(),null!=(r=this.forwardLoader)&&r.detach(),this.$el.empty(),o=this.subviews,e=0,n=o.length;n>e;e++)t=o[e],t!==this.backwardLoader&&t!==this.forwardLoader&&this.removeSubview(t);return this},r.prototype.render=function(){var t;return this.empty(),t=this.state.renderMessages?this.collection.models:[],this.renderGroup(t),null!=this.forwardLoader&&(this.$el.addClass("in-history"),this.$el.append(this.forwardLoader.render().el),this.forwardLoader.inView(null,this.$el),this.buildJumpToCurrentIndicator()),this.trigger("render"),this.scrollLocation(0),this
},r.prototype.hasMessage=function(t){return!!this.collection.get(Number(t))},r.prototype.lastMessageOf=function(t){return this.collection.lastMessageOf(t)},r.prototype.jumpToMessage=function(t){var e,n,r,o,i;return o=this.collection.get(Number(t)),o&&(i=this.findSubviews(o).pop())?(this.$(".history-highlight").removeClass("history-highlight"),n=i.el.offsetTop,e=i.$el.height(),r=this.$el.height(),this.el.scrollTop=n-.5*r+.5*e,this.setScrollLocation(),i.$el.addClass("history-highlight")):void 0},r.prototype.jumpToCurrent=function(){var t;return null!=(t=Flowdock.app.manager.currentView)?t.chat.jumpToCurrent():void 0},r.prototype.destructor=function(){var t,e;return r.__super__.destructor.apply(this,arguments),null!=(t=this.$jumpToCurrent)&&t.remove(),null!=(e=this.moreMessages)&&e.destructor(),this.empty(),this.forwardLoader=this.backwardLoader=this.moreMessages=this.$jumpToCurrent=null},r.prototype.pageUp=function(){var t;return t=this.$el.height()-50,this.$el.stop().animate({scrollTop:this.$el.scrollTop()-t},this.scrollAnimationDuration)
},r.prototype.pageDown=function(){var t;return t=this.$el.height()-50,this.$el.stop().animate({scrollTop:this.$el.scrollTop()+t},this.scrollAnimationDuration)},r.prototype.onActivate=function(){return this.$el.is(":visible")?(this.$el.one(Helpers.transitionend(),function(t){return function(){return t.$el.removeClass("activate")}}(this)),this.$el.addClass("activate")):void 0},r.prototype.openItemTagEditor=function(t){return null!=t&&t.preventDefault(),this.$(".current-item menu button.edit-tags").click()},r.prototype.$currentItem=function(){return this.$(".current-item")},r}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.MessageLoader=function(e){function r(){return this.inView=t(this.inView,this),this.onInview=t(this.onInview,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.tagName="a",r.prototype.className="notification",r.prototype.events={click:"onClick"},r.prototype.initialize=function(t){return null==t&&(t={}),this.direction=t.direction||"backward",this.current="more",this.noInview=t.noInview,this.firstLoad=new $.Deferred},r.prototype.onInview=function(){return"error"===this.current||this.noInview?void 0:this.more()},r.prototype.template=function(t){return HoganTemplates["owl/templates/chat/notifications/"+t].render({},{spinner:HoganTemplates["owl/templates/spinner"]})},r.prototype.onClick=function(t){var e;return("error"===(e=this.current)||"more"===e)&&this.more(),t.preventDefault()},r.prototype.state=function(t){return this.current=t,"more"===t&&this.blockSuccessRenderingChange?void 0:this.render()},r.prototype.inView=function(t,e){var n;return null!=(n=this.triggerElement)&&n.scrollableInview("destroy"),this.triggerElement=null,null!=t&&0!==t.length?(this.triggerElement=$(t),this.bindElement(this.triggerElement,e)):void 0},r.prototype.more=function(t){var e;
if("loading"!==this.current)return this.state("loading"),e={direction:this.direction,error:function(t){return function(){return t.state("error"),t.firstLoad.reject()}}(this),success:function(t){return function(){return t.state("more"),t.firstLoad.resolve()}}(this),finish:function(){return"function"==typeof t?t():void 0}},this.collection.fetchHistory(e)},r.prototype.bindElement=function(t,e){return t.scrollableInview("remove",this.onInview),t.scrollableInview({onInview:this.onInview,scrollParent:e,fully:!1})},r.prototype.detach=function(){return this.$el.detach()},r.prototype.render=function(){return this.$el.empty(),this.$el.attr("href","#").html(this.template(this.current)),this.$el.removeClass("loading more error").addClass(this.current),_.defer(function(t){return function(){var e;return e=t.$el.closest("ul"),0===e.length&&(e=t.$el.closest("article")),t.bindElement(t.$el,e)}}(this)),this},r}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.MoreMessages=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="more-messages",n.prototype.events={click:"dismiss"},n.prototype.initialize=function(t){return this.counter=new Bacon.Bus,this.direction=t.direction,this.list=t.scrollable,this.predicate=t.removeWhen||function(t){return 0===t.target.scrollTop},this.onRemoved=t.onRemoved||function(){},this.addStream(this.scrollHandling()),this.addStream(this.countHandling())},n.prototype.render=function(t){var e;return e={below:"icon-arrow-down-4",above:"icon-arrow-up-3"},this.$el.html(HoganTemplates["owl/templates/shared/more_messages"].render({direction:this.direction,iconClass:e[this.direction],count:t})),this.$el.addClass(this.direction),this},n.prototype.countHandling=function(){return this.counter.scan(1,function(t,e){return t+e}).skip(1).onValue(function(t){return function(e){return t.render(e)}}(this))},n.prototype.scrollHandling=function(){return this.list.asEventStream("scroll").filter(this.predicate).onValue(function(t){return function(){return t.dismiss()
}}(this))},n.prototype.increment=function(){return this.counter.push(1)},n.prototype.decrement=function(){return this.counter.push(-1)},n.prototype.dismiss=function(t){return null!=t&&t.preventDefault(),this.onRemoved(),this.destructor()},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.Overlay=function(e){function r(){return this.keyHandler=t(this.keyHandler,this),this.clickHandler=t(this.clickHandler,this),this.close=t(this.close,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.tagName="article",r.prototype.className="stripe",r.prototype.initialize=function(t){return null==t&&(t={}),this.attached=!1,this.target=t.target,this.removeOnHide=null!=t.removeOnHide?t.removeOnHide:!0,t.loader&&(this.loader=new Views.Shared.Progress),this.error=$("<div>").addClass("inline-error"),this.closeButton=$("<button>").addClass("close-overlay i-button icon-cross").attr("title","Close this view"),null!=t.type?(this.className=t.type,this.$el.attr("class",this.className)):void 0
},r.prototype.destructor=function(){return this.target&&this.unbind(),r.__super__.destructor.apply(this,arguments),this.loader=this.target=this.closeButton=void 0},r.prototype.attach=function(){return this.target&&!this.attached?(this.$el.is(":empty")&&this._render(),this.target.append(this.mask),this.bind(),this.attached=!0,this):void 0},r.prototype.detach=function(){return this.attached?(this.unbind(),this.mask.detach(),this.attached=!1):void 0},r.prototype.close=function(t){return null!=t&&t.preventDefault(),$(".tipsy").remove(),this.removeOnHide?(this.destructor(),this.attached&&this.mask.remove()):this.detach(),this.trigger("close")},r.prototype.enableDialogDismissal=function(){return this.cannotClose=!1,this.$(".close").removeClass("hidden").show(),this.closeButton.show()},r.prototype.disableDialogDismissal=function(){return this.cannotClose=!0,this.$(".close").addClass("hidden").hide(),this.closeButton.hide()},r.prototype.clickHandler=function(t){return this.cannotClose?void 0:$(t.target).parent().is(".overlay-mask")?this.close():void 0
},r.prototype.keyHandler=function(t){return this.cannotClose?void 0:27===t.which?this.close():void 0},r.prototype.bind=function(){return this.target.on("keyup",this.keyHandler),this.target.on("click",this.clickHandler),this.$el.on("click",".close",this.close)},r.prototype.unbind=function(){return this.target.off("keyup",this.keyHandler),this.target.off("click",this.clickHandler),this.$el.off("click",".close",this.close)},r.prototype.navigateToFlow=function(){var t;return t=Flowdock.app.manager.currentFlow,null!=t?Flowdock.app.router.navigateBackToFlow(t,{trigger:!1}):Flowdock.app.router.activateFirst()},r.prototype.showError=function(t){var e;return this.error.html(t),this.error.show().addClass("pushin"),e=function(t){return function(){return t.error.hide().removeClass("pushin")}}(this),setTimeout(e,3e3)},r.prototype._render=function(){var t;return this.mask=$("<div>").addClass("overlay-mask"),t=$("<div>").addClass("overlay-container"),this.loader&&t.append(this.loader.render().el),this.mask.append(this.closeButton,t.append(this.render().el)),this.$el.append(this.error.hide())
},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.Progress=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="progress spinner",n.prototype.initialize=function(t){return null==t&&(t={}),this.color=t.color||"green"},n.prototype.show=function(t){return null==t&&(t=!0),this.$el.toggleClass("hidden",!t)},n.prototype.hide=function(t){return null==t&&(t=!0),this.show(!t)},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/loaders/arc"].render()),this.$el.addClass(this.color),this},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.ScrollingAutocompleter=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.maxOptions=Number.MAX_VALUE},n.prototype.selectNext=function(){return n.__super__.selectNext.apply(this,arguments),this.scrollToSelection()},n.prototype.selectPrev=function(){return n.__super__.selectPrev.apply(this,arguments),this.scrollToSelection()},n.prototype.inScrollTop=function(t){return t[0].offsetTop<this.$el.scrollTop()},n.prototype.inScrollBottom=function(t){return t[0].offsetTop+t.outerHeight()>this.$el.height()+this.$el.scrollTop()},n.prototype.scrollToSelection=function(){return this.inScrollTop(this.selection)?this.$el.scrollTop(this.selection[0].offsetTop-this.selection.outerHeight()):this.inScrollBottom(this.selection)?this.$el[0].scrollTop+=this.selection[0].offsetTop-(this.$el.height()+this.$el.scrollTop())+this.selection.outerHeight():void 0},n}(Views.Shared.Autocompleter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.TabbedOverlay=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="modal tabbed",n.prototype.events={"click .overlay-tab":"activateClickedTab"},n.prototype.initialize=function(t){return this.tabs=t.tabs||[],n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){return this.$el.empty(),this.$el.append($("<ul>").addClass("clean overlay-tabs clearfix").append(this.tabs.map(function(t){return function(e){return t.renderTab(e)}}(this)))),this.$el.append(this.tabs.map(function(t){return function(e){return t.renderTabContent(e)}}(this))),this.activateTab(this.initialTab),this},n.prototype.renderTab=function(t){return HoganTemplates["owl/templates/shared/overlay_tab"].render({iconClassName:t.iconClassName||t.options.iconClassName,title:t.title||t.options.title,rel:t.attributes.rel})},n.prototype.renderTabContent=function(t){return t.render().$el},n.prototype.activateClickedTab=function(t){return this.activateTab($(t.target).attr("rel"))
},n.prototype.activateTab=function(t){var e,n,r,o;if(null!=t){for(this.$(".overlay-tab").removeClass("current"),this.$(".overlay-tab[rel='"+t+"']").addClass("current"),o=this.tabs,n=0,r=o.length;r>n;n++)e=o[n],e.$el.toggleClass("hidden",e.$el.attr("rel")!==t);return this.route(t),this}},n.prototype.route=function(){},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.TagInput=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="div",n.prototype.className="tag-input",n.prototype.initialize=function(t){return this.options=_.extend({},t)},n.prototype.destructor=function(){return this.clear(),n.__super__.destructor.apply(this,arguments)},n.prototype.focus=function(){return this.tokenist.focus()},n.prototype.render=function(){return this.clear(),this.autocompleter=new Views.MessageAutocompleter({model:this.model,maxTags:5}),this.tokenist=new Views.Shared.Tokenist({autocompleter:this.autocompleter,tokens:this.model.tags().filter(function(t){return t.humanize()
})}),this.listenTo(this.tokenist,"tokenist-blur",function(){return this.destructor()}),this.listenTo(this.tokenist,"token-add",function(t){return null!=(null!=t?t.id:void 0)?this.model.addTags([t.id],{user:Flowdock.app.user.id}):void 0}),this.listenTo(this.tokenist,"token-remove",function(t){return null!=(null!=t?t.id:void 0)?this.model.removeTags([t.id],{user:Flowdock.app.user.id}):void 0}),this.$el.append(this.tokenist.render().el),this.fitsAbove()?(this.$el.prepend(this.autocompleter.render().el),this.$el.addClass(this.options.direction||"n")):(this.$el.append(this.autocompleter.render().el),this.$el.addClass(this.options.direction||this.options.optionalDirection||"s")),this.$el.append($("<div class='caret'></div>")),this.focus(),this.$el.on("click",function(t){return t.stopPropagation()}),this},n.prototype.fitsAbove=function(){var t,e;return e=function(t){var n,r;return n=t.offsetParent(),n.is("body")||n.is("html")||"hidden"===(r=n.css("overflow"))||"scroll"===r?n:e(n)},t=e(this.$el),this.$el.offset().top-t.offset().top>280
},n.prototype.clear=function(){var t,e;return null!=(t=this.tokenist)&&t.destroy(),null!=(e=this.autocompleter)&&e.destroy(),this.tokenist=this.autocompleter=void 0,this.$el.empty()},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Shared.TextareaAutocompleter=function(e){function r(){return this.displayHtmlFor=t(this.displayHtmlFor,this),this.populate=t(this.populate,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="textarea-autocompleter-area",r.prototype.initialize=function(t){return this.input=t.input},r.prototype.render=function(){var t;return this.input.autoComplete({source:this.populate,displayHtml:this.displayHtmlFor,autoSelect:this.autoSelect,el:this.$el,completionHook:this.onComplete,hiddenComplete:!0,excludeHidden:[null!=(t=Flowdock.app.user)?t.get("nick"):void 0],sort:!1,hiddenCompleteLimiter:["#","@",":"]}),this
},r.prototype.populate=function(){var t,e,n,r,o,i,s,a;return this.model.isFlow()?(i=this.model.tags.models.sort(function(t,e){return e.get("count")-t.get("count")}),i=i.concat(this.model.tags.everyone()).map(function(t){return{word:t.humanize()}}),r=this.model.users.enabled(),o=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)s=r[t],s.get("nick")&&n.push({word:s.get("nick"),aliases:[s.get("name")]});return n}(),t=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)s=r[t],s.get("nick")&&n.push({word:"@"+s.get("nick"),aliases:["@"+s.get("name")]});return n}(),o=_.sortBy(o,"word"),t=_.sortBy(t,"word")):(i=[],o=[],t=[]),n=null!=(a=window.emojimoji)?a.autocomplete:void 0,this.model.emojiKeys&&(n=n.concat(this.model.emojiKeys())),n=function(){var t,r,o;for(o=[],t=0,r=n.length;r>t;t++)e=n[t],o.push({word:e});return o}(),i.concat(o,t,n)},r.prototype.onComplete=function(t,e){return 0===e&&"#"!==t[0]&&":"!==t[0]||1===e&&"@"===this.input.text()[0]?t+", ":t+" "},r.prototype.displayHtmlFor=function(t){var e,n,r;return 0===t.indexOf("#")?(n=this.model.tags.find(function(e){return e.id===t.slice(1)
}),$("<div>").html(HoganTemplates["owl/templates/inbox/autocompleter_option"].render({count:n.get("count"),tag:n}))):0===t.indexOf("@")&&(r=this.model.users.findWhere({nick:t.slice(1)}))?$("<div>").text(""+t+" ("+r.get("name")+")").html():0!==t.indexOf(":")?$("<div>").text(t).html():(e=$("<span>").addClass("tokenist-emoji").text(emojimoji(t)),null!=this.model.emoji&&this.model.emoji.emojie(e[0]),"function"==typeof e.emojie&&e.emojie(),$("<div>").append(e,$("<span>").addClass("tokenist-emoji-code").text(t)).html())},r.prototype.autoSelect=function(t){return 0!==t.indexOf(":")},r}(Backbone.View)}.call(this),function(){var t,e,n,r,o,i,s,a,l,u,c,p,h,d,f,m,g,y,v,w,b,k,x,T,C,P,S=function(t,e){return function(){return t.apply(e,arguments)}},E={}.hasOwnProperty,F=function(t,e){function n(){this.constructor=t}for(var r in e)E.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},R=[].slice,N=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;
return-1};for(Views.Shared.Tokenist=function(n){function c(){return this.stopAndAdd=S(this.stopAndAdd,this),this.delegateKeys=S(this.delegateKeys,this),this.onFocus=S(this.onFocus,this),this.onBlur=S(this.onBlur,this),this.onDelete=S(this.onDelete,this),this.onBackspace=S(this.onBackspace,this),this.onRightArrow=S(this.onRightArrow,this),this.onLeftArrow=S(this.onLeftArrow,this),this.onTextSelect=S(this.onTextSelect,this),this.onCaretMove=S(this.onCaretMove,this),this.onRangeChange=S(this.onRangeChange,this),c.__super__.constructor.apply(this,arguments)}return F(c,n),c.prototype.className="tokenist",c.prototype.events={"click .tokenist-token-remove":"tokenRemove","click .tokenist-token":"focusClicked",focus:"onFocus"},c.prototype.initialize=function(n){var c,y,w,b;return null==n&&(n={}),this.autocompleter=n.autocompleter,this.tokens=n.tokens||[],this.enable(),c=this.$el.asEventStream("focus").delay(0),b=this.$el.asEventStream("mouseup keyup paste").merge(this.$el.asEventStream("keydown").delay(0)).merge(c).map(function(t){return function(){return t.getRange()
}}(this)).skipDuplicates(),w=this.$el.asEventStream("keydown"),y=this.$el.asEventStream("blur").delay(50).filter(function(t){return function(){return!t.focused()}}(this)),this.editorKey=new Bacon.Bus,this.tokenistKey=new Bacon.Bus,this.autocompleter.on("chosen",this.stopAndAdd),this.autocompleter.$el.on("mousedown",function(t){return function(){return _.defer(function(){return t.$el.focus()})}}(this)),this.behavior=[w.filter(v(p,h,l,i,s,g,o,a)).onValue(function(t){return t.preventDefault()}),w.onValue(this.delegateKeys),this.tokenistKey.filter(v(f)).onValue(function(t){return t.preventDefault()}),this.tokenistKey.filter(v(u)).onValue(this.onLeftArrow),this.tokenistKey.filter(v(d)).onValue(this.onRightArrow),this.tokenistKey.filter(v(t)).onValue(this.onBackspace),this.tokenistKey.filter(v(r)).onValue(this.onDelete),this.tokenistKey.filter(v(a)).onValue(function(t){return function(){return t.$el.blur()}}(this)),this.editorKey.filter(v(o)).onValue(function(t){return function(){return t.autocompleter.selectNext()}
}(this)),this.editorKey.filter(v(g)).onValue(function(t){return function(){return t.autocompleter.selectPrev()}}(this)),this.editorKey.filter(v(s,m,f,e)).onValue(function(t){return function(e){return t.autocompleter.completionKey(e)}}(this)),y.onValue(this.onBlur),b.onValue(function(t){return function(e){return t.onRangeChange(e)}}(this))]},c.prototype.render=function(){var t,e,n,r;for(this.$el.empty(),r=this.tokens,e=0,n=r.length;n>e;e++)t=r[e],this.$el.append(this.renderToken(t));return this.setPlaceholder(),this.$el.append(this.renderSpace()),this.normalizeSpaces(),this},c.prototype.disable=function(){return this.$el.attr("contenteditable","false"),this.$el.addClass("disabled")},c.prototype.enable=function(){var t;try{this.el.contentEditable="plaintext-only"}catch(e){t=e,this.el.contentEditable=!0}return this.$el.removeClass("disabled")},c.prototype.reset=function(t){return this.tokens=t,this.render()},c.prototype.focus=function(){return this.focused()?void 0:(this.$el.focus(),setTimeout(function(t){return function(){return t.setCaretAt(t.el.lastChild.textContent.length-1,t.el.lastChild)
}}(this),0))},c.prototype.focused=function(){return document.activeElement===this.el},c.prototype.destroy=function(){var t,e,n,r;for(r=this.behavior,e=0,n=r.length;n>e;e++)(t=r[e])();return this.off(),this.remove()},c.prototype.getRange=function(){var t;return t=window.getSelection(),t.rangeCount?t.getRangeAt(0):null},c.prototype.setCaretAt=function(t,e,n,r){var o,i;if(e&&this.focused())return e=e.firstChild||e,0>t&&(t=0),o=document.createRange(),i=window.getSelection(),o.setStart(e,t),r?(r=r.firstChild||r,o.setEnd(r,n)):o.collapse(!0),e=(null!=r?r.parentNode:void 0)||e.parentNode,null!=e.parentNode&&!e.parentNode.scrollWidth>e.parentNode.offsetWidth&&"function"==typeof e.scrollIntoView&&e.scrollIntoView(),i.removeAllRanges(),i.addRange(o)},c.prototype.resetActiveToken=function(){return this.$el.contents().removeClass(y.active)},c.prototype.setActiveToken=function(t){return this.resetActiveToken(),t?(t=$(t),t.addClass(y.active)):void 0},c.prototype.getActiveToken=function(){return this.$el.find(k.active)[0]},c.prototype.startEditor=function(t){var e;
if($(t).is(k.space))return this.$el.removeClass(y.placeholder),this.editorNode=t,this.resetActiveToken(),$(this.editorNode).addClass(y.editing),this.editorNode.addEventListener("DOMCharacterDataModified",function(t){return function(){var e,n;return n=function(){var t,n,r,o;for(r=this.editorNode.childNodes,o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(e.textContent);return o}.call(t).join(" "),(n[0]!==b||n[n.length-1]!==b)&&(t.editorNode.textContent=""+b+n.replace(b,"")+b),t.autocompleter.refreshQuery(n.trim())}}(this)),this.autocompleter.refreshQuery(function(){var t,n,r,o;for(r=this.editorNode.childNodes,o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(e.textContent);return o}.call(this).join(" ").trim())},c.prototype.stopEditor=function(t){var e;return null==t&&(t=function(){}),this.editorNode?(e=this.renderSpace(),$(this.editorNode).replaceWith(e),this.editorNode=void 0,t(e),this.normalizeSpaces(),this.setPlaceholder(),this.setCaretAt(1,e[0])):null},c.prototype.addToken=function(t,e){var n;return null==e&&(e=null),n=this.renderToken(t),e?($(e).before(n),this.tokens.splice(this.$(k.token).index(n.last()),0,t)):(this.$el.append(n),this.tokens.push(t)),this.trigger("token-add",t)
},c.prototype.removeToken=function(t){return t&&-1!==this.tokens.indexOf(t)?(this.tokens.splice(this.tokens.indexOf(t),1),this.trigger("token-remove",t),this.removeTokenElement(this.getTokenElement(t)),this.setPlaceholder()):void 0},c.prototype.setPlaceholder=function(){return this.$el.toggleClass(y.placeholder,!this.editorNode&&!this.tokens.length)},c.prototype.renderSpace=function(){return $("<span/>").addClass(y.space).text(""+b+b)},c.prototype.renderToken=function(t){var e;return e=$("<div>").addClass(y.token).attr("contenteditable","false").data("token",t).append($("<span/>").addClass("token").text(t),$("<span>").addClass("tokenist-token-remove mini-icon icon-cross")),$(this.renderSpace().toArray().concat(e.toArray()))},c.prototype.removeTokenElement=function(t){var e,n,r,o,i;return t=$(t),n=t.next(),r=t.prev(),e=null!=(i=this.getRange())?i.endContainer:void 0,n.is(k.editing)?(e===r[0].firstChild&&this.setCaretAt(1,n[0]),r.remove()):(e===n[0].firstChild&&this.setCaretAt(1,r[0]),n.remove()),t.remove(),o=this.getRange(),o?this.onCaretMove(o):void 0
},c.prototype.getTokenElement=function(t){return _.find(this.$el.find(k.token).get(),function(e){return t===$(e).data("token")?e:void 0})},c.prototype.normalizeSpaces=function(){return _.each(this.$(k.space),function(t){return t.firstChild.replaceData(0,t.firstChild.length,""+b+b)})},c.prototype.inputStarted=function(){var t,e;return t=null!=(e=this.getRange())?e.endContainer:void 0,t?$(t.parentNode).is(k.space)&&!t.parentNode.textContent.match(/^\s{1,2}$/):!1},c.prototype.tokenRemove=function(t){return t.stopPropagation(),this.removeToken($(t.target.parentNode).data("token"))},c.prototype.onRangeChange=function(t){var e;return(e=null!=t?t.endContainer:void 0)?t.startContainer!==e||t.startOffset!==t.endOffset?this.onTextSelect(t):this.onCaretMove(t):void 0},c.prototype.onCaretMove=function(t){var e,n,r,o;if(o=t.endContainer,n=o.parentNode,e=$(n),this.editorNode){if(this.editorNode!==n?this.setCaretAt(this.editorNode.textContent.length-1,this.editorNode):0===t.startOffset?this.setCaretAt(1,this.editorNode):t.endOffset===o.textContent.length&&this.setCaretAt(n.textContent.length-1,this.editorNode),!this.inputStarted())return this.stopEditor()
}else if(e.is(k.space)){if(this.inputStarted())return this.startEditor(n);if(1!==t.endOffset)return this.setCaretAt(1,o)}else if(r=e.closest(k.token).next()[0]||this.$(k.space).last()[0])return this.setCaretAt(1,r)},c.prototype.onTextSelect=function(t){var e,n,r,o,i,s,a;return this.editorNode?(s=t.startContainer,n=t.endContainer,r=this.editorNode.textContent.length-1,i=s.parentElement===this.editorNode?t.startOffset||1:1,o=n.parentElement===this.editorNode?Math.min(t.endOffset,r)||1:r,e=i===t.startOffset&&o===t.endOffset&&s.parentElement===(a=n.parentElement)&&a===this.editorNode,e?void 0:this.setCaretAt(i,this.editorNode,o,this.editorNode)):(this.setCaretAt(1,t.endContainer),this.onCaretMove(t),void 0)},c.prototype.onLeftArrow=function(t){var e;return t.preventDefault(),(e=this.getRange().endContainer.parentNode.previousSibling)?(this.resetActiveToken(),this.setCaretAt(1,e.previousSibling)):void 0},c.prototype.onRightArrow=function(t){var e,n;return t.preventDefault(),e=this.getRange().endContainer.parentNode,(n=e.nextSibling)?this.setCaretAt(1,n.nextSibling):void 0
},c.prototype.onBackspace=function(t){var e;return e=$(this.getRange().endContainer.parentNode),e.is(k.editing)?void 0:(t.preventDefault(),this.removeToken(e.prev().data("token")))},c.prototype.onDelete=function(t){var e;return e=$(this.getRange().endContainer.parentNode),e.is(k.editing)?void 0:(t.preventDefault(),this.removeToken(e.next().data("token")))},c.prototype.onBlur=function(t){return this.trigger("tokenist-blur",t),this.$el.removeClass("focused"),this.autocompleter.hide(),this.setPlaceholder()},c.prototype.onFocus=function(){return this.$el.addClass("focused")},c.prototype.focusClicked=function(t){var e,n,r;return this.focused()||this.$el.focus(),e=null!=(n=t.currentTarget)?null!=(r=n.nextSibling)?r.firstChild:void 0:void 0,e?this.setCaretAt(1,e):void 0},c.prototype.delegateKeys=function(t){var e,n,r;return e=$(null!=(n=this.getRange())?null!=(r=n.endContainer)?r.parentNode:void 0:void 0),e.is(k.editing)?this.editorKey.push(t):e.is(k.space)?this.tokenistKey.push(t):void 0},c.prototype.stopAndAdd=function(t){return _.isArray(t)||(t=[t]),this.stopEditor(function(e){return function(n){var r,o,i,s;
for(s=[],o=0,i=t.length;i>o;o++)r=t[o],s.push(e.addToken(r,n));return s}}(this))},c}(Backbone.View),f=32,s=13,t=8,m=9,r=46,u=37,g=38,d=39,o=40,p=33,h=34,l=35,i=36,a=27,e=188,c=8194,n=[u,g,d,o],b=String.fromCharCode(c),x="tokenist",y={},k={},P=["space","token","editing","active","placeholder"],T=0,C=P.length;C>T;T++)w=P[T],y[w]=x+"-"+w,k[w]="."+y[w];v=function(){var t;return t=1<=arguments.length?R.call(arguments,0):[],function(e){var n;return n=e.which,N.call(t,n)>=0}}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.TypingUsers=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="typing-users",n.prototype.initialize=function(t){return this._users=t.users},n.prototype.render=function(){return this.users().onValue(function(t){return function(e){return t.$el.text(n.formatUsers(e))
}}(this)),this},n.prototype.users=function(){return Flowdock.app.preferences.typingActivity().flatMapLatest(function(t){return function(e){return e?t._users:Bacon.once([])}}(this)).takeUntil(this.asEventStream("destructor"))},n.formatUsers=function(t){return t.length>2?""+t[0].nick()+" and "+(t.length-1)+" others are typing\u2026":2===t.length?""+t[0].nick()+" and "+t[1].nick()+" are typing\u2026":1===t.length?""+t[0].nick()+" is typing\u2026":""},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Shared.UserList=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="ul",n.prototype.className="user-list",n.prototype.collectionEvents={add:"renderUser",remove:"destroyUser",reset:"render","change:nick":"moveUser"},n.prototype.initialize=function(t){this.opts=null!=t?t:{avatarOnly:!1}
},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments)},n.prototype.render=function(){var t,e,n,r;for(r=this.subviews.slice(0),e=0,n=r.length;n>e;e++)t=r[e],this.removeSubview(t,{removeDomElement:!1});return this.$el.empty().append(this.collection.map(function(t){return function(e){return t.subview(new Views.Chat.User({model:e,avatarOnly:t.opts.avatarOnly})).render().el}}(this))),this},n.prototype.renderUser=function(t){var e,n;return e=this.collection.indexOf(t),n=this.subview(new Views.Chat.User({model:t,avatarOnly:this.opts.avatarOnly})),e>=this.collection.length-1?this.$el.append(n.render().$el):e>0?this.$(".user").eq(e-1).after(n.render().$el):this.$el.prepend(n.render().$el)},n.prototype.destroyUser=function(t){return this.removeSubview(t)},n.prototype.onChange=function(t){var e;return e=_.keys(t.changedAttributes()),_.all(e,function(t){return-1!==Views.Chat.User.ACTIVITY_EVENTS.indexOf(t)})?this.updateUser(t):_.all(e,function(t){return"disabled"===t})?this.onDisabledChange(t):void 0
},n.prototype.moveUser=function(t){var e;return e=this.removeSubview(t,{removeDomElement:!1}),this.collection.sort(),this.renderUser(t),e[0].remove()},n}(Flowdock.HierarchicalView)}.call(this),function(){}.call(this),function(){Views.Errors={get:function(t,e){var n;return n=_.find(Views.Errors,function(n){return n.prototype.errorName===t&&n.prototype.errorType===e}),n||(n=Views.Errors.Modal),n}}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Error=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="error",n.prototype.className="error",n.prototype.tagName="div",n.prototype.errorType="global",n.prototype.events={"click .reload":"reload","click .continue":"triggerDetach","click .back":"navigateBack"},n.prototype.render=function(){return this.$el.empty().append(HoganTemplates["owl/templates/errors/"+this.errorName.replace(/\-/g,"_")].render(this.model)),this.animateEllipsis(),this.$el.addClass(this.errorType),this
},n.prototype.onDetach=function(){return this.destructor()},n.prototype.triggerDetach=function(t){return null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),n.__super__.triggerDetach.apply(this,arguments)},n.prototype.navigateBack=function(t){return null!=t&&t.preventDefault(),window.history.back()},n.prototype.destructor=function(){return this.ellipsisAnimation=clearInterval(this.ellipsisAnimation),n.__super__.destructor.apply(this,arguments)},n.prototype.animateEllipsis=function(){var t,e;return t=this.$el.find(".animate-ellipsis"),0!==t.length?(e="...",this.ellipsisAnimation=setInterval(function(){return"..."===e?e="":e+=".",t.text(e)},1e3)):void 0},n.prototype.reload=function(t){return null!=t&&t.preventDefault(),window.location.reload()},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Inline=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.className="toast-error",n.prototype.errorType="inline",n.prototype.remove=function(){return this.$el.on(Helpers.animationend(),function(t){return function(){return t.$el.off(),t.$el.remove()}}(this)),this.$el.addClass("hide"),this.ellipsisAnimation=clearInterval(this.ellipsisAnimation),this.stopListening()},n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Modal=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="overlay-mask error",n.prototype.errorType="modal",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Flow=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.errorType="flow",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Alert=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="alert",n}(Views.Errors.Inline)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.ConnectionClosed=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="connection-closed",n}(Views.Errors.Inline)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Errors.FlowNotFound=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="flow-not-found",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.FlowSubscribeFailed=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="flow-subscribe-failed",n}(Views.Errors.Flow)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.HandshakeFailed=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="handshake-failed",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.RoutingError=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="routing-error",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.PrivateNotFound=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="private-not-found",n}(Views.Errors.Error)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.FlowSubscribeFailed=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="private-subscribe-failed",n
}(Views.Errors.Flow)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.Update=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="update",n}(Views.Errors.Inline)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Errors.UseMacApp=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.errorName="use-mac-app",n}(Views.Errors.Inline)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;
return-1};Views.Chat=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.id="chat",r.prototype.events={"split-resize":"resize","click .jump-to-current":"jumpToCurrent"},r.prototype.initialize=function(t){var e;return this.options=_.extend({},t),this.input=this.subview(new Views.Chat.Input(this.options)),this.$indicators=$("<div>").addClass("indicators"),e=this.model.typingUsers(this.input.key()),this.typing=this.subview(new Views.Shared.TypingUsers({users:e})),this.messageList=this.buildMessageList(this.model,this.options),this.users=this.subview(new Views.Chat.Toolbar({collection:this.model.users,flow:this.model,expandable:this.options.expandable,settings:this.options.settings})),this.listenTo(this.input.textarea,"scale",function(){return this.messageList.resize(this.input.$el.outerHeight()),this.$indicators.css("bottom",this.input.$el.outerHeight()),this.typing.$el.css("bottom",this.input.$el.outerHeight())}),this.listenTo(this.input,"edit-last-message",this.editLastMessage),this.options.fileUpload?this.fileupload=this.buildFileupload(this.input):void 0
},r.prototype.findMessage=function(t){return this.messageList.collection.get(t)},r.prototype.resize=function(){return this.messageList.resize(),this.input.triggerAttach()},r.prototype.render=function(){var t;return this.$el.empty().append(this.users.render().$el,this.messageList.render().$el,this.$indicators,this.typing.render().el,this.input.render().$el,null!=(t=this.fileupload)?t.render().$el:void 0),this},r.prototype.destructor=function(){return this.messageList.collection.cleanup(),r.__super__.destructor.apply(this,arguments),this.input=this.messageList=this.users=this.fileupload=null},r.prototype.buildFileupload=function(t){var e;return e=this.subview(new Views.Shared.FileUploader({model:this.model,target:"#chat",targetName:this.model.get("name")})),this.listenTo(e,"new_upload",function(t){return this.messageList.collection.add(t)}),this.listenTo(t,"upload",function(){return e.prompt()}),e},r.prototype.buildMessageList=function(t,e){var n;return n=this.subview(Views.Chat.MessageList.build(t,e)),this.listenTo(n,"indication",function(t){return this.$indicators.append(t)
}),this.model.fullyLoaded.done(function(){return n.renderMessages()}),n},r.prototype.swapMessageList=function(t){return this.messageList.collection.cleanup(),this.removeSubview(this.messageList),this.messageList=t,this.$("#users").after(this.messageList.render().$el),$.contains($("body")[0],this.el)&&this.messageList.triggerAttach(),this.input.triggerAttach()},r.prototype.editLastMessage=function(t,e){var r,o;return(r=this.messageList.lastMessageOf(this.model.me()))?(o=r.asProperty("id").filter(function(t){return null!=t}).take(1),0!==arguments.length?o.onValue(function(){return r.searchReplaceContent(t,e)}):n.call(this.messageList.collection.slice(-10),r)>=0?o.onValue(function(t){return function(){var e;return(e=_.last(t.messageList.findSubviews(r)))?(e.openEditor(),e.once("completed",function(){return _.defer(function(){return t.input.focus()})})):void 0}}(this)):void 0):void 0},r.prototype.jumpToMessage=function(t){return this.messageList.hasMessage(t)?this.messageList.jumpToMessage(t):this.swapMessageList(this.buildMessageList(this.model,_.extend({startAt:t},this.options)))
},r.prototype.jumpToCurrent=function(){return this.swapMessageList(this.buildMessageList(this.model,this.options))},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.Message=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="chat-message",n.prototype.events={"click menu.message-actions button.edit-tags":"openTagInput","click menu.message-actions button.delete":"delete","click menu.message-actions button.edit-message":"openEditor","click menu.message-actions button.save-message":"saveMessage","blur .expanding-input textarea":"saveMessage","keydown .expanding-input textarea":"saveMessage","click .message-author":"toggleUserCard","click .resend":"resendMessage","click .tag.removed":"preventSearch","click .single-view-link":"openSingleView","click .show-more":"toggleTruncated"},n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),t.inbox===!1&&(this.disableInbox=!0),this.inCommentList=t.inCommentList||!1,this.listenTo(this.model.user(),"change:nick change:avatar",this.updateUser),this.model.get("id")?void 0:(this.$el.addClass("hide-actions"),this.listenTo(this.model,"unsent",this.onUnsent),this.listenTo(this.model,"sync",this.onSent),this.tId=setTimeout(function(t){return function(){return t.onUnsaved()
}}(this),1e4))},n.prototype.renderTags=function(){var t,e;return n.__super__.renderTags.apply(this,arguments),e=!(!this.model.hasComments()&&!this.model.parent()),this.$el.toggleClass("thread",e),this.$el.attr("data-parent",this.model.parent()||this.model.id),e&&this.addColor(),t=this.readUsers(),null!=this.model.get("to")?t&&Number(this.model.get("to"))!==this.model.flow().me().id?this.$el.attr("title",t):this.$el.removeAttr("title"):t?this.$el.attr("title",t):this.$el.removeAttr("title")},n.prototype.readUsers=function(){var t,e;return e=this.model.usersReadMessage(),0!==e.length?!this.model.get("to")&&this.model.hasTag(":user:everyone")&&e.length===this.model.flow().users.enabled().length?"Everyone has seen this message":(t=Helpers.format.toSentence(e.map(function(t){return t.get("nick")}).sort()),""+t+" "+(1===e.length?"has":"have")+" seen this message"):void 0},n.prototype.onTagChange=function(t,e,r){var o;return null==r&&(r={}),n.__super__.onTagChange.apply(this,arguments),r.user&&r.user!==this.model.flow().me().id?(o=this.model.flow().users.get(r.user),this.flashMessage(Helpers.TagHelper.textualizeChange(t,t.previousTags(),o))):void 0
},n.prototype.onSent=function(){return this.preserveScrolling(function(t){return function(){return clearTimeout(t.tId),t.stopListening(t.model,"unsent",t.onUnsent),t.$el.removeClass("unsaved hide-actions"),clearInterval(t.ellipsisAnimation),t.$el.find(".unsent").remove()}}(this))},n.prototype.onUnsaved=function(){return this.preserveScrolling(function(t){return function(){var e;return t.$el.addClass("unsaved"),t.$(".unsent").remove(),t.$el.append(HoganTemplates["owl/templates/chat/notifications/message_pending"].render()),e=t.$(".unsent .ellipsis"),t.ellipsisAnimation=setInterval(function(){var t;return t=""+e.text()+".",4===t.length&&(t=""),e.text(t)},1e3)}}(this))},n.prototype.onUnsent=function(){return this.preserveScrolling(function(t){return function(){return t.onUnsaved(),t.$(".unsent").remove(),clearInterval(t.ellipsisAnimation),t.$el.append(HoganTemplates["owl/templates/chat/notifications/unsent"].render())}}(this))},n.prototype.userCardOpen=function(){return this.$(".user-card").length>0},n.prototype.toggleUserCard=function(){return this.userCardOpen()?void 0:Flowdock.mobile?void 0:this.$el.append(new Views.Chat.UserCard({model:this.model.user(),me:this.model.collection.flow.me()}).render({alignTop:this.$el.parent().first().height()-this.$el.position().top<200}).el)
},n.prototype.renderContent=function(){var t,e,n,r,o,i,s,a,l;return i=this.model.presenter(),l=this.model.user(),o=this.model.humanTags(),t=i.body(),n=this.model.get("edited"),r=null!=n&&0===(null!=t?t.length:void 0),a=$("<div>").append(t).find("br").length>10,e=Helpers.TimeHelper.editTime(n,r),s=this.model.get("to"),this.$el.html(HoganTemplates["owl/templates/messages/message"].render({user:l.toJSON(),timestamp:this.messageTimestamp(),editTime:e,emptied:r,editable:this.model.myMessage(),"private":s,content:t,tags:o,truncate:a,showAvatar:this.inCommentList,withoutNick:!l.has("nick")},{messageHeader:HoganTemplates["owl/templates/chat/message_header"]})),this.$el.toggleClass("truncate",a),null==this.model.parent()&&this.$(".single-view-link").tipsy({gravity:this.bubbleTooltipGravity}),this.$(".tags").toggleClass("empty",0===o.length),this.$el.toggleClass("deleted",r),this.toggleClasses(),this.$(".content a").filter(function(){return"CODE"!==$(this).parent()[0].nodeName}).each(function(t){return function(e,n){return t.preview($(n))
}}(this))},n.prototype.toggleClasses=function(){var t;return t=this.model.user(),this.$el.toggleClass("external",t.external()),this.$el.toggleClass("me",this.model.myMessage())},n.prototype.preview=function(t){var e,n,r;return r=t.prop("href"),e=Views.Embed.match(r),null!=e?(n=t.wrap('<div class="embed">').parent(),this.subview(new e({url:r,el:n,parent:this}).render())):void 0},n.prototype.addColor=function(){return this.$(".single-view-link").addClass(Helpers.CommentHelper.color(this.model.get("flow"),this.model.parent()||this.model.id)),null==this.model.parent()?this.$el.addClass("first"):void 0},n.prototype.flashMessage=function(t){var e,n;if(t)return n=this.$el.find(".timestamp").addClass("visible"),e=$("<span>").addClass("message-edit-message").text(t),n.prepend(e),setTimeout(function(){return n.removeClass("visible"),e.remove()},1e3)},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),jQuery.removeData(this.$el),clearTimeout(this.tId),null!=this.model?(this.stopListening(this.model,"unsent",this.onUnsent),this.stopListening(this.model,"sync",this.onSent)):void 0
},n.prototype["delete"]=function(){return Helpers.confirmDelete()?this.model.destroy():void 0},n.prototype.resendMessage=function(t){var e;return t.preventDefault(),this.model.isNew()?(e=this.model.clone(),this.model.destroy(),e.save()):void 0},n.prototype.preventSearch=function(t){return t.preventDefault(),!1},n.prototype.openSingleView=function(t){return t.preventDefault(),!this.disableInbox&&this.model.get("id")?(Flowdock.app.router.navigateTo({message:this.model.parent()||this.model,flow:this.model.flow()}),$(".comment-form .message-input").focus()):void 0},n.prototype.toggleTruncated=function(t){var e,n;return null!=t&&t.preventDefault(),this.$el.toggleClass("truncate-open"),e=this.$(".show-more span"),n=e.hasClass("icon-ellipsis")?"icon-arrow-up-5":"icon-ellipsis",e.attr("class",n)},n.prototype.bubbleTooltipGravity=function(){return $("body").hasClass("chat-only")?"sw":"e"},n.prototype.openEditor=function(){var t,e;return t=this.subview(new Views.Shared.ExpandingInput),this.$(".content").html(t.render().el),t.setText(remojimoji(this.model.getContent())),e=$($.parseHTML("<button>")).addClass("i-button save-message").attr("title","Click to save. Press 'Esc' to cancel.").append($("<span>").addClass("mini-icon icon-checkmark")),this.$("button.edit-message").replaceWith(e),this.$el.addClass("open"),_.defer(function(){return t.focus()
})},n.prototype.saveMessage=function(t,e){var n,r;if(27===t.which)return this.trigger("completed"),this.$("textarea").val(this.model.getContent()),this.render(),void 0;if("keydown"!==t.type||13===t.which&&!t.shiftKey)return"focusout"===t.type&&e||(t.preventDefault(),r=this.$("textarea").val(),r!==this.model.getContent()?(n=this._findChangedTags(r),this.model.modifyTags(_.extend({sync:!1},n)),this.model.updateContent(Helpers.IndentationHelper.parseEmojies(r),{silent:!0})):this.render()),this.$el.removeClass("open"),this.trigger("completed")},n.prototype.updateUser=function(){var t;return t=this.model.user(),this.$(".message-author").text(t.get("nick")),this.$(".avatar").css({"background-image":"url('"+t.avatar(80)+"')"})},n.prototype._findChangedTags=function(t){var e,n,r,o;return e=this.model.getContent(),r=this.model.get("tags"),n=Helpers.TagHelper.parseTags(e,this.model.flow()),o=Helpers.TagHelper.parseTags(t,this.model.flow()),{add:_.difference(o,n,r),remove:_.intersection(_.difference(n,o),r)}},n}(Views.Shared.Message)
}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.ActionMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="action-message",n.prototype.renderContent=function(){var t,e;return e=this.model.get("content").type.replace(/_/g,"-"),t=this.model.presenter(),this.$el.addClass(e),this.$el.html(HoganTemplates["owl/templates/messages/action_message"].render({user:this.model.user().toJSON(),timestamp:this.messageTimestamp(),content:this.format(t.body()),withoutNick:"user-edit"===this.model.get("event"),actionType:e},{messageHeader:HoganTemplates["owl/templates/chat/message_header"]}))},n.prototype.format=function(t){return Helpers.autoLinkUrls(t)},n}(Views.Chat.Message)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.CommentMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="comment-message",n.prototype.events=_.extend({},Views.Chat.Message.prototype.events,{"mouseenter .single-view-link":"showTooltip","mouseleave .single-view-link":"hideTooltip"}),n.prototype.renderContent=function(){var t;return n.__super__.renderContent.apply(this,arguments),$(".tipsy").remove(),t=this.model.get("content").title,t=this.renderEmoji($("<div>").text(t)).html(),this.$(".single-view-link").attr("title",t).tipsy({gravity:this.bubbleTooltipGravity,trigger:"manual",html:!0})},n.prototype.showTooltip=function(){return null!=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(t){return function(){return t.$(".single-view-link").tipsy("show")}}(this),$.fn.tipsy.defaults.delayIn)},n.prototype.hideTooltip=function(){return null!=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(t){return function(){return t.$(".single-view-link").tipsy("hide")
}}(this),$.fn.tipsy.defaults.delayOut)},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),null!=this.timeout?clearTimeout(this.timeout):void 0},n}(Views.Chat.Message)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.FileMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="file-message",n.prototype.events=_.extend({},Views.Chat.Message.prototype.events,{"click menu.message-actions button.discard":"discard"}),n.prototype.modelEvents=_.extend({},Views.Shared.Message.prototype.modelEvents,{"change:content":"render"}),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),null!=this.tId?clearTimeout(this.tId):void 0},n.prototype.renderContent=function(){return this.model.upload?this.renderUploading():this.preserveScrolling(function(t){return function(){return t.renderCompleteUpload()
}}(this))},n.prototype.renderCompleteUpload=function(){var t,e;return t=this.subview(new Views.Shared.Attachment({model:this.model,parent:this,attachment:this.model.get("content")})),e=this.model.get("to"),this.$el.html(HoganTemplates["owl/templates/messages/file_message"].render({user:this.model.user().toJSON(),removable:this.model.myMessage(),"private":e,timestamp:this.messageTimestamp(),showAvatar:this.inCommentList},{messageHeader:HoganTemplates["owl/templates/chat/message_header"]})),this.$el.find(".content").prepend(t.render().el),this.finished&&t.load(),null==this.model.parent()&&this.$(".single-view-link").tipsy({gravity:this.bubbleTooltipGravity}),this.toggleClasses(),this.model.hasComments()?this.addColor():void 0},n.prototype.discard=function(){return this.model.collection?this.model.collection.remove(this.model):void 0},n.prototype.renderUploadedAmount=function(){var t;if(null!=this.model.upload)return t=this.model.upload.get("uploaded"),this.$("progress").prop({value:t}),this.$(".uploaded,progress").text("("+t+"%)"),t>=100?(this.$(".state").text("Processing"),this.$(".uploaded").hide()):void 0
},n.prototype.renderRemoveButton=function(){return this.$("menu.message-actions").append($("<button>").addClass("discard").prop({title:"Hide"}))},n.prototype.renderUploadResult=function(){var t;if(!this.finished&&null!=this.model.upload&&"uploading"!==this.model.upload.get("state"))return this.finished="failed"===(t=this.model.upload.get("state"))||"finished"===t,"failed"===this.model.upload.get("state")&&(this.$el.addClass("failed"),this.renderRemoveButton()),this.stopListening(this.model.upload)},n.prototype.renderUploading=function(){var t;return t={user:this.model.user().toJSON(),fileName:this.model.upload.get("fileName"),timestamp:this.messageTimestamp(),showAvatar:this.inCommentList},this.$el.html(HoganTemplates["owl/templates/messages/file_uploading_message"].render(t,{messageHeader:HoganTemplates["owl/templates/chat/message_header"]})),this.renderUploadedAmount(),this.listenTo(this.model.upload,"change:state",this.renderUploadResult),this.listenTo(this.model.upload,"change:uploaded",this.renderUploadedAmount)
},n}(Views.Chat.Message)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Chat.Input=function(e){function r(){return this.updatePlaceholder=t(this.updatePlaceholder,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.events={"keydown textarea":"onKeydown","click input[type=submit]":"submit","click button.upload":"triggerUpload","focus textarea":function(){return window.lastFocusedInput="chat"}},r.prototype.modelEvents={"change:name":"updatePlaceholder"},r.prototype.keyboardEvents={focusChat:"focus"},r.prototype.initialize=function(t){return this.fileUpload=t.fileUpload,this.autocompleter=t.autocompleter,this.textarea=this.subview(new Views.Shared.ExpandingInput({persistId:this.key()}))},r.prototype.key=function(){var t;return t=this.model.isPrivate()?this.model.users.map(function(t){return t.id
}).sort().join("-"):this.model.id,""+t+"-chat-input"},r.prototype.render=function(){return this.$el.empty().append(HoganTemplates["owl/templates/chat/input"].render()),this.$("li.textarea").append(this.textarea.render().el),this.$el.prepend(new Views.Shared.TextareaAutocompleter({model:this.model,input:this.$("textarea")}).render().el),this.fileUpload||this.$("li.upload").remove(),this.model.fullyLoaded.done(this.updatePlaceholder),this},r.prototype.onAttach=function(){return _.defer(function(t){return function(){return null!=t.model?(t.textarea.setMaxHeight(),t.textarea.mirrorText(),t.focus(),"pending"===t.model.fullyLoaded.state()&&t.model.fullyLoaded.done(function(){return $.contains(t.textarea.el,document.activeElement)?t.focus():void 0}),t.unsubscribeResize=Flowdock.resize.window.end.onValue(t.setMaxHeight)):void 0}}(this))},r.prototype.onDetach=function(){return"function"==typeof this.unsubscribeResize&&this.unsubscribeResize(),delete this.unsubscribeResize},r.prototype.submit=function(t){return t.preventDefault(),this.sendMessage(t),!1
},r.prototype.createMessage=function(t){var e;return e=this.model.buildMessage(t,Models.ChatMessage),e.isValid()?(e.save(),this.textarea.reset(),this.focus()):void 0},r.prototype.updatePlaceholder=function(){var t;return null!=(t=this.textarea)?t.setPlaceholder(this.buildPlaceholder()):void 0},r.prototype.buildPlaceholder=function(){var t,e;return e=this.model.isFlow()?"in":"with",t=this.model.isFlow()?this.model.get("name"):this.model.get("name").replace("@",""),"Chat "+e+" "+t+"\u2026"},r.prototype.destructor=function(){return this.onDetach(),r.__super__.destructor.apply(this,arguments),this.span=this.submit=this.textarea=null},r}(Views.Shared.MessageInput)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.LineMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="line-message",n.prototype.renderContent=function(){var t;
return t=this.model.presenter(),this.$el.html(HoganTemplates["owl/templates/messages/action_message"].render({user:this.model.user().toJSON(),timestamp:this.messageTimestamp(),content:t.body(),actionType:"default"},{messageHeader:HoganTemplates["owl/templates/chat/message_header"]}))},n}(Views.Chat.Message)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Chat.MessageList=function(e){function o(){return this.afterWhitespaceChange=t(this.afterWhitespaceChange,this),this.beforeWhitespaceChange=t(this.beforeWhitespaceChange,this),this.highLightCommentGroup=t(this.highLightCommentGroup,this),this.resize=t(this.resize,this),o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.className="chat-message-list",o.prototype.events={resize:"resize",scroll:"setScrollLocation"},o.prototype.listName="chat",o.prototype.keyboardEvents=_.extend({},Views.Shared.MessageList.prototype.keyboardEvents,{editItem:"editCurrentItem"}),o.build=function(t,e){var n;
return null==e&&(e={}),n=new Collections.ChatMessages([],{flow:t,startAt:e.startAt}),n.consume(t.stream),new Views.Chat.MessageList(_.extend(e,{collection:n}))},o.prototype.initialize=function(){var t,e;return this.commentHoverElem=$("<div>").addClass("group-hover-overlay"),o.__super__.initialize.apply(this,arguments),t=this.asEventStream("view:attach:after").map(Flowdock.resize.window.move),e=this.asEventStream("view:detach:before").map(Bacon.never()),this.addStream(t.merge(e).flatMapLatest(_.identity).map(void 0).onValue(this.resize)),this.currentItemTimeout=null,this.setupMessagePurging(700,100)},o.prototype.resize=function(t){return null!=t&&(this.inputHeight=t),null!=this.inputHeight&&this.$el.css("bottom",this.inputHeight),this.scrollLocation(this.state.scrollLocation)},o.prototype.render=function(){var t,e,n;return o.__super__.render.apply(this,arguments),t=this.$el.asEventStream("mouseenter","li.thread").map(function(t){return{mouseOver:!0,$el:$(t.currentTarget)}}),e=this.$el.asEventStream("mouseleave","li.thread").map(function(t){return{mouseOver:!1,$el:$(t.currentTarget)}
}),n=this.scrollState.map(function(t){return!t}),this.addStream(t.filter(n).merge(e).merge(t.merge(e).toProperty().sampledBy(n.filter(_.identity)).filter(function(t){return t.mouseOver}).skipDuplicates().changes()).onValue(this.highLightCommentGroup)),Flowdock.app.whiteSpaceControl.on("before-change, before-change-chat",this.beforeWhitespaceChange).on("after-change, after-change-chat",this.afterWhitespaceChange),this.toggleEmphasis(),this.listenTo(Flowdock.app.preferences,"change:emphasize_own_nick",this.toggleEmphasis),this},o.prototype.toggleEmphasis=function(){return this.$el.toggleClass("emphasize-me",Flowdock.app.preferences.get("emphasize_own_nick"))},o.prototype.highLightCommentGroup=function(t){var e;return e=t.$el,e.is("[data-parent]")?window.requestAnimationFrame(function(n){return function(){var r;return r=n.$("[data-parent="+e.attr("data-parent")+"]"),t.mouseOver?(r.addClass("comment-group-hover"),window.requestAnimationFrame(function(){return n.$el.before(n.commentHoverElem.css("height",n.el.scrollHeight))
}),n.$el.addClass("group-hovered")):(r.removeClass("comment-group-hover"),n.commentHoverElem.remove(),n.$el.removeClass("group-hovered"))}}(this)):void 0},o.prototype.renderGroup=function(t,e){var n,r,i;return null==e&&(e={}),r=o.__super__.renderGroup.call(this,t,_.extend(e,{reverse:!e.reverse})),"backward"===e.direction&&(n=this.collection.at(this.collection.indexOf(_.last(t))+1),null!=n&&(i=this.findSubviews(n)[0],this.applySeparators(n,i.$el))),r},o.prototype.applySeparators=function(t,e){var n,o,i,s,a,l,u;return i=function(t,e){return String(null!=t?t.get("user"):void 0)===String(null!=e?e.get("user"):void 0)},o=function(t,e){var n,o,i;return n=["message","comment"],o=null!=t?t.get("event"):void 0,r.call(n,o)>=0&&(i=null!=e?e.get("event"):void 0,r.call(n,i)>=0)},u=9e5,a=this.collection.at(this.collection.indexOf(t)-1),s=t.get("sent")||(new Date).getTime(),l=null!=a?a.get("sent"):void 0,n=s-l,null!=a&&moment(l).format("L")!==moment(s).format("L")?$(e).attr("data-timestamp",moment(s).format("dddd, MMMM D")).addClass("date-separator"):n>=u?$(e).addClass("time-separator"):(null!=a?a.get("user"):void 0)&&i(a,t)&&o(a,t)&&$(e).addClass("monologue"),e
},o.prototype.onAdd=function(){return o.__super__.onAdd.apply(this,arguments),this.scrollLocation()>this.scrollThreshold?this.buildMoreMessagesIndicator({direction:"below"}):void 0},o.prototype.destructor=function(){var t;return Flowdock.app.whiteSpaceControl.off("before-change, before-change-chat",this.beforeWhitespaceChange).off("after-change, after-change-chat",this.afterWhitespaceChange),o.__super__.destructor.apply(this,arguments),null!=(t=this.commentHoverElem)&&t.remove(),this.commentHoverElem=null},o.prototype.delegateEvents=function(){return this.addStream=$(window).asEventStream("resize").debounce(75).onValue(this.resize),o.__super__.delegateEvents.apply(this,arguments)},o.prototype.renderOne=function(t){var e,n,r,o,i;try{return r=t.presenter().event,e=Views.Chat[r[0].toUpperCase()+r.substr(1)+"Message"]||Views.Chat.Message,i=this.subview(new e({model:t,tags:this.options.tags})).render().el,[this.applySeparators(t,i)]}catch(s){return n=s,console.error(n.stack),console.log("MessageList renderOne error",n,t),o=this.subview(new Views.Shared.MessageError({app:"chat",model:t,error:n})),[o.render().el]
}},o.prototype.scrollLocation=function(t){return null!=t&&(this.el.scrollTop=this.el.scrollHeight-t-this.$el.outerHeight()),this.el.scrollHeight-this.el.scrollTop-this.$el.outerHeight()},o.prototype.insert=function(t,e){var n,r,o;return null==e&&(e=!1),r=e?"prepend":"append",n=function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],o instanceof Element?r.push(o):(this.subview(o),r.push(o.el));return r}.call(this),this.$el[r](n)},o.prototype.lastElement=function(t,e){return null==e&&(e=0),t.slice(0,e+1).last()},o.prototype.firstElement=function(t,e){return null==e&&(e=0),t.slice(-1-e).first()},o.prototype.beforeWhitespaceChange=function(){return this.setScrollLocation()},o.prototype.afterWhitespaceChange=function(){return this.scrollLocation(this.state.scrollLocation)},o.prototype.isCurrentItemVisible=function(){var t,e;return t=this.$currentItem(),t.length?(e=t.offset().top-this.$el.scrollTop(),e>this.$el.innerHeight):!1},o.prototype.scrollToItem=function(){var t,e;return t=this.$currentItem(),this.isCurrentItemVisible()||0===t.length?void 0:(e=this.$el.scrollTop()+t.position().top,this.$el.stop().animate({scrollTop:e},this.scrollAnimationDuration))
},o.prototype.previousItem=function(t){var e;return null!=t&&t.preventDefault(),e=this.$currentItem(),e.is(":first-child")?void 0:0===e.length?this.$("li:last").addClass("current-item"):(e.removeClass("current-item").prev().addClass("current-item"),this.scrollToItem())},o.prototype.nextItem=function(t){var e;if(null!=t&&t.preventDefault(),e=this.$currentItem(),e.is(":last-child"))e.removeClass("current-item");else{if(0===e.length)return;e.removeClass("current-item").next().addClass("current-item")}return this.scrollToItem()},o.prototype.lastItem=function(t){return null!=t&&t.preventDefault(),this.$("li").removeClass("current-item"),this.$("li:last").addClass("current-item"),this.scrollToItem()},o.prototype.firstItem=function(t){return null!=t&&t.preventDefault(),this.$("li").removeClass("current-item"),this.$("li:first").addClass("current-item"),this.scrollToItem()},o.prototype.selectItem=function(){return this.$currentItem().find("a.single-view-link").click()},o.prototype.editCurrentItem=function(t){return null!=t&&t.preventDefault(),this.$currentItem().find("button.edit-message").click()
},o}(Views.Shared.MessageList)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.StatusMessage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="status-message",n.prototype.renderContent=function(){var t,e;return e=this.model.presenter(),t=e.body(),(null==t||0===t.length)&&(t="cleared status",this.$el.addClass("clear-status")),this.$el.html(HoganTemplates["owl/templates/messages/action_message"].render({user:this.model.user().toJSON(),timestamp:this.messageTimestamp(),content:t,actionType:"default"},{messageHeader:HoganTemplates["owl/templates/chat/message_header"]}))},n}(Views.Chat.LineMessage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Chat.Toolbar=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.AVATAR_CAP=30,n.prototype.tagName="menu",n.prototype.id="users",n.prototype.className="chat-toolbar",n.prototype.events={"click #expand":"toggleExpand","click #invite-button, #user-settings":"showSettings","click .add-people":"showSettings","click #chat-toggle-tab-bar":"showSideNavigation"},n.prototype.keyboardEvents={toggleUserList:"toggleExpand"},n.prototype.initialize=function(t){return this.expandable=t.expandable,this.settings=t.settings},n.prototype.toggleExpandArrow=function(){var t,e;return this.$el.toggleClass("expanded"),t=this.$el.hasClass("expanded"),e=t?"icon-arrow-right-5":"icon-arrow-down-5",this.$("#expand").toggleClass("active").find(".mini-icon").toggleClass("icon-arrow-down-5",t).toggleClass("icon-arrow-right-5",!t)},n.prototype.isExpanded=function(){return this.$el.hasClass("expanded")},n.prototype.toggleExpand=function(){return this.expandable?(this.toggleExpandArrow(),this.isExpanded()?(this.userList=new Views.Chat.UserList({collection:this.collection,flow:this.flow}),this.$el.append(this.userList.render().$el)):(this.userList.remove(),this.userList.destructor(),delete this.userList)):void 0
},n.prototype.disabledChange=function(t,e){return e?this.removeUser(t):this.addUser(t)},n.prototype.render=function(){return this.$el.attr("type","toolbar").html(HoganTemplates["owl/templates/users/users"].render({settings:this.settings})),this.avatarRow&&(this.avatarRow.$el.detach(),this.$el.append(this.avatarRow.render().$el)),this},n.prototype.onAttach=function(){var t,e;return e=new BackboneProjections.Filtered(this.collection,{filter:function(t){return t.id!==Flowdock.app.user.id&&!t.get("disabled")&&["active","idle"].indexOf(t.get("presence"))>=0}}),t=new BackboneProjections.Capped(e,{cap:n.AVATAR_CAP}),t.me=this.collection.me,this.avatarRow=new Views.Shared.UserList({id:"avatar-list",className:"userbar online",collection:t,presenceFilter:"active idle",avatarOnly:!0}),this.$el.append(this.avatarRow.render().$el)},n.prototype.onDetach=function(){return this.avatarRow.collection.underlying.stopListening(),this.avatarRow.collection.stopListening(),this.avatarRow.destructor(),this.avatarRow=void 0},n.prototype.showSettings=function(t){return null!=t&&t.preventDefault(),Flowdock.app.router.navigateTo({flow:this.flow,settings:{active:"people"}})
},n.prototype.showSideNavigation=function(){return Flowdock.eventBus.trigger("mobile:slide-navigation-in")},n}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.UserList=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="user-list",n.prototype.className="touch-scrollable",n.prototype.events={"focus #status-input":"editStatus"},n.prototype.initialize=function(){var t,e,n;return t=Flowdock.app.user.id,n=new BackboneProjections.Filtered(this.collection,{filter:function(e){return e.id!==t&&!e.get("disabled")&&["active","idle"].indexOf(e.get("presence"))>=0}}),e=new BackboneProjections.Filtered(this.collection,{filter:function(e){return e.id!==t&&!e.get("disabled")&&["offline"].indexOf(e.get("presence"))>=0}}),this.onlineList=this.subview(new Views.Shared.UserList({collection:n})),this.offlineList=this.subview(new Views.Shared.UserList({collection:e})),this.invitationsView=this.subview(new Views.Chat.Invitations({collection:this.flow.invitations}))
},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/chat/user_list"].render()),this.renderMe(),this.renderUsers(),this.renderInvitations(),this},n.prototype.destructor=function(){return this.onlineList.collection.stopListening(),this.offlineList.collection.stopListening(),n.__super__.destructor.apply(this,arguments)},n.prototype.renderUsers=function(){return this.$online().append(this.onlineList.render().el),this.$offline().append(this.offlineList.render().el)},n.prototype.renderInvitations=function(){return this.$(".invited-user-list").append(this.invitationsView.render().el)},n.prototype.renderMe=function(){var t,e;return t=this.collection.get(Flowdock.app.user.id),t?(e=this.subview(new Views.Shared.Avatar({model:t,size:120,className:"user-avatar"})),this.$("#me").prepend(e.$el),this.$("#me .user-name").text(""+t.get("nick")+" ("+t.get("name")+")"),this.$("#status-input").val(t.get("status"))):void 0},n.prototype.$online=function(){return this.$(".online-user-list")},n.prototype.$offline=function(){return this.$(".offline-user-list")
},n.prototype.editStatus=function(){var t;return t=this.$("#status-input"),t.on("blur keyup",function(e){return function(n){var r,o;return("blur"===n.type||"keyup"===n.type&&13===n.which)&&(r=e.collection.get(Flowdock.app.user.id),o=t.val(),r.get("status")!==o&&e.flow.buildMessage({event:"status",content:o},Models.ChatMessage).save(),t.off("blur keyup"),"keyup"===n.type&&13===n.which)?t.blur():void 0}}(this))},n}(Flowdock.HierarchicalView)}.call(this),function(){Views.Embed={previewers:[],match:function(t){return Views.Embed.previewers.filter(function(e){return e.match(t)})[0]},register:function(t,e){var n;return null==e&&(e=-1),n=Views.Embed.previewers,-1===e?n.push(t):0>e?n.splice(e+1,0,t):n.splice(e,0,t)}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Embed.Embeddable=function(e){function r(){return this.deferredLoad=t(this.deferredLoad,this),this.onMuteChange=t(this.onMuteChange,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.TIMEOUT=8e3,r.prototype.events={"click .embed-hide-btn":function(t){return t.preventDefault()}},r.prototype.initialize=function(t){return this.$el.append('<i class="embed-show-btn icon-eye icon-large" title="Show preview"/>'),this.original=this.$el.html(),this.parent=t.parent,this._embedded=null,this.muteUnsubscriber=Bacon.mergeAll([this.$el.asEventStream("click",".embed-hide-btn").map(!1),this.$el.asEventStream("click",".embed-show-btn").map(!0),Flowdock.app.preferences.asEventStream("change:link_previews").map(function(t){return t.linkPreviews()})]).onValue(this.onMuteChange),Flowdock.app.preferences.linkPreviews()?this.bindInview():void 0},r.prototype.embed=function(t){return void 0!==t&&(this._embedded=t),this._embedded},r.prototype.render=function(){return null!=this._embedded?this.renderPreview(Flowdock.app.preferences.linkPreviews()):this.$el.addClass("no-embed"),this},r.prototype.renderPreview=function(t){return t?this.showEmbed():this.hideEmbed()},r.prototype.hideEmbed=function(){return this.parent.preserveScrolling(function(t){return function(){return t.$el.addClass("no-embed"),t.$el.html(t.original)
}}(this))},r.prototype.showEmbed=function(){return this.parent.preserveScrolling(function(t){return function(){return t.$el.removeClass("no-embed"),t.$el.addClass(""+(t.type||"embedded")+"-preview"),t.$("a").first().empty().append(t._embedded),t.$("a.external").first().append('<div class="embed-hide-btn"><i class="icon-cross icon-large" title="Hide preview"/></div>')}}(this))},r.prototype.onMuteChange=function(t){return this._embedded?this.renderPreview(t):t?this.bindInview():this.$el.scrollableInview("destroy")},r.prototype.bindInview=function(){return this._embedded!==!1?_.defer(function(t){return function(){return t.addStream(t.parentScrollState().onValue(function(){})),t.$el.scrollableInview({fully:!1,scrollParent:t.scrollParent(),onInview:t.deferredLoad})}}(this)):void 0},r.prototype.scrollParent=function(){var t;return t=this.$el.closest("ul"),0===t.length&&(t=this.$el.closest("article")),t},r.prototype.parentScrollState=function(){return this._scrollState||(this._scrollState=this.scrollParent().asEventStream("scroll").debounceImmediate(500).flatMapLatest(function(){return Bacon.once(!0).merge(Bacon.once(!1).delay(550))
}).skipDuplicates().toProperty(!1)),this._scrollState},r.prototype.deferredLoad=function(){return this.addStream(this.parentScrollState().filter(function(t){return!t}).take(1).onValue(function(t){return function(){return t.load()}}(this)))},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.muteUnsubscriber(),this.$el.scrollableInview("destroy"),this.original=this.parent=this._embedded=null},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Embed.Document=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.type="document",n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.url=t.url,this.fileType=_.last(this.url.split(".")).toLowerCase(),this.previewUrl=Views.Embed.Document.url(this.url)
},n.prototype.load=function(){var t,e;return e=HoganTemplates["owl/templates/shared/embed/document"].render({url:this.url,type:this.fileType}),t=new window.Image,t.src=this.previewUrl,$(t).one("load",function(n){return function(){return n.embed($("<div>").append(t,e).contents()),n.render()}}(this))},n.url=function(t){return"https://docs.google.com/viewer?url="+encodeURIComponent(t)+"&a=bi&pagenumber=1&w=200"},n.match=function(t){return t.match(/^(?:https?:\/\/).*\.(?:pdf|ppt)(#|\?|$)/i)},n}(Views.Embed.Embeddable),Views.Embed.register(Views.Embed.Document)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Embed.Image=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.type="image",n.prototype.events=_.extend({},Views.Embed.Embeddable.prototype.events,{"click img":"openOverlay"}),n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.originalUrl=t.url,this.url=n.url(decodeURI(t.rotatedUrl||t.url)),this.skipTimeout=t.skipTimeout,this.hideable=null!=t.hideable?t.hideable:!0
},n.prototype.load=function(){var t,e,n;return this.$("i.embed-show-button").show(),t=new window.Image,$(t).one("load",function(n){return function(){return n.$("i.embed-show-button").hide(),n.embed(t),n.renderPreview(!0),n.hideable||n.$(".embed-hide-btn").hide(),clearTimeout(e)}}(this)),$(t).one("error",function(e){return function(){return e.$("i.embed-show-button").hide(),e.embed(t=!1)}}(this)),t.src=this.url,t.alt=this.url,t.title=null!=(n=this.url.match(/([^\/]+)$/))?n[0]:void 0,this.skipTimeout?void 0:e=setTimeout(function(e){return function(){return $(t).off("load"),e.embed(t=!1)}}(this),Views.Embed.Embeddable.TIMEOUT)},n.url=function(t){var e;return t.match(/http\:\/\/d.pr\//)&&"+"!==t[t.length-1]?t+"+":t.match(/http\:\/\/cl.ly\//)?t+"/src":t.match(/https\:\/\/www.dropbox.com\//)?t.replace("www.dropbox.com","dl.dropboxusercontent.com"):t.match(/https?\:\/\/pbs.twimg.com\/media/)?t.replace(/\:\w+$/,""):t.match(/https?\:\/\/monosnap.com\/image/)?t.match(/\.\w+$/)?t:(e=t.match(/\w+$/)[0],"https://api.monosnap.com/image/download?id="+e):t
},n.match=function(t){return t.match(/(\.jpg|\.jpeg|\.png|\.gif)(#|\?|$)/i)||n.url(t)!==t},n.prototype.openOverlay=function(t){return(null!=t?t.ctrlKey:void 0)||(null!=t?t.metaKey:void 0)||!this._embedded?void 0:(null!=t&&t.preventDefault(),window.history.pushState({},"image"),new Views.Overlays.Image({image:this.url,target:$("body"),original:this.originalUrl}).attach())},n}(Views.Embed.Embeddable),Views.Embed.register(Views.Embed.Image)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Embed.Youtube=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.type="youtube",n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.url=t.url,this.videoId=n.parseVideoId(this.url),this.skipTimeout=t.skipTimeout},n.prototype.load=function(){var t,e;if(Flowdock.app.preferences.linkPreviews())return e=this.getVideoInfo(),e.then(function(e){return function(n){return e.renderElement(n),clearTimeout(t)
}}(this),function(t){return function(){return t.cancelLoading()}}(this)),this.skipTimeout?void 0:t=setTimeout(function(t){return function(){return t.cancelLoading()}}(this),Views.Embed.Embeddable.TIMEOUT)},n.prototype.renderElement=function(t){var e,n,r,o,i;return n=t.entry.media$group.yt$duration.seconds,r=Math.floor(n/60),o=Helpers.format.pad(n%60,2),e=""+r+":"+o,i=HoganTemplates["owl/templates/embed/youtube"].render({url:this.url,image:this.thumbnailUrl(t),title:t.entry.title.$t,duration:e,statistics:t.entry.yt$statistics,description:t.entry.media$group.media$description.$t,author:{name:t.entry.author[0].name.$t}}),this.embed($.parseHTML(i)),this.render()},n.prototype.cancelLoading=function(){var t;return this.embed(t=!1)},n.prototype.getVideoInfo=function(){var t;return t="https://gdata.youtube.com/feeds/api/videos/"+this.videoId,$.getJSON(t,"v=2&alt=json-in-script")},n.prototype.thumbnailUrl=function(t){var e,n,r;return n=t.entry.media$group.media$thumbnail||[],r=function(){var t,r,o;for(o=[],t=0,r=n.length;r>t;t++)e=n[t],"mqdefault"===e.yt$name&&o.push(e.url);
return o}()[0],r.replace(/^http\:/,"https:")},n.match=function(t){return n.parseVideoId(t)},n.parseVideoId=function(t){var e;return e=t.match(/youtube.com\/watch\?(?:.+&|)v=([\w-]+)|youtu.be\/([\w-]+)$/i),e?e[2]||e[1]:null},n}(Views.Embed.Embeddable),Views.Embed.register(Views.Embed.Youtube)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=770,e=22,Views.Flow=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.className="flow",o.prototype.events={"split-resize-end .inbox-panel":"onSplitResizeEnd","split-resize .inbox-panel":"onSplitResize","click #pane-switcher":"switchPane","dblclick .split-resizer":"toChatOnly","click #flow-overlay":"slideNavigationOut"},o.prototype.modelEvents={"subscribe-failed":"onSubscribeFailed"},o.prototype.initialize=function(){return this.inbox=this.subview(new Views.Inbox({model:this.model})),this.chat=this.subview(new Views.Chat({model:this.model,fileUpload:!0,tags:!0,inbox:!0,expandable:!0,settings:!0}))
},o.prototype.destructor=function(){return o.__super__.destructor.apply(this,arguments),this.inbox=this.chat=this.organizations=this.$inboxPanel=this.single=null},o.prototype.id=function(){return"flow-"+this.model.id},o.prototype.filterInbox=function(t){return this.errorState?void 0:(this.closeSingle(!0),this.$inboxPanel.append(this.inbox.$el),this.inbox.filterInbox(t),this.inbox.triggerAttach())},o.prototype.findMessage=function(t){return this.inbox.findMessage(t)||this.chat.findMessage(t)},o.prototype.openSingle=function(e){var n,r,o,i;if(!this.errorState&&(o=!$("body").is(".inbox-only")&&$(document).width()<t,$("body").is(".chat-only")&&this.switchPane(),(null!=(i=this.single)?i.model.id:void 0)!==parseInt(e,10)))return this.closeInbox(),this.closeSingle(!0),n=this.singleViewMessage(e),(r=n.parent())?(Flowdock.app.router.navigateTo({message:r,flow:this.model}),void 0):(this.single=this.subview(new Views.Inbox.SingleView({model:n})),this.listenTo(this.single,"return-to-list",function(){var t;return t={flow:this.model,filter:this.inbox.filter},Flowdock.app.router.navigateTo(t),o&&$("body").is(".inbox-only")?this.switchPane():void 0
}),this.listenTo(this.single,"show-context",function(t){return this.chat.jumpToMessage(t)}),this.$inboxPanel.addClass("single").append(this.single.$el),this.single.render().triggerAttach(),"function"==typeof n.markAsRead?n.markAsRead():void 0)},o.prototype.closeSingle=function(t){return null==t&&(t=!1),this.single?(this.single.close(t),this.single.model.unlockCleanup(),null==this.single.model.collection&&this.single.model.cleanup(),this.removeSubview(this.single),delete this.single,this.$inboxPanel.removeClass("single")):void 0},o.prototype.closeInbox=function(){return this.inbox.triggerDetach(),this.inbox.$el.detach()},o.prototype.onDetach=function(){var t;return this.$el.detach(),null!=(t=this.$inboxPanel)?"function"==typeof t.splitResize?t.splitResize("destroy"):void 0:void 0},o.prototype.onAttach=function(){var t;return null!=(t=this.$inboxPanel)?t.splitResize(this.chat.$el,{key:"flow-splitter"}):void 0},o.prototype.render=function(){return this.errorState?void 0:(this.$inboxPanel=$("<div/>").addClass("inbox-panel"),this.$inboxPanel.append(this.inbox.render().$el),this.$el.empty(),this.$el.append(this.$inboxPanel,this.chat.render().$el,$("<div id='pane-switcher'>"),$("<div id='split-panel'>").append(HoganTemplates["owl/templates/split"].render()),$("<div id='flow-overlay'>")),this.showAlerts(),this)
},o.prototype.error=function(t,e){var n,r;return this.errorState=!0,this.$el.children().hide(),n=Views.Errors.get(t,"flow"),r=new n({model:e}),this.$el.append(r.render().$el)},o.prototype.onSubscribeFailed=function(t){return this.error("flow-subscribe-failed",{flow:t})},o.prototype.singleViewMessage=function(t){var e,n;return n=function(t){return function(e){return e.comments.consume(t.model.stream),e.consume(t.model.stream),e}}(this),e=this.findMessage(t),(e||n(new Models.InboxMessage({id:t,flow:this.model}))).lockCleanup()},o.prototype.onSplitResizeEnd=function(t,n){var r;return null!=(r=this.single)&&r.onSplitResize(),e>n?(this.$inboxPanel.splitResize("cancel"),this.toSinglePane("chat")):n>100-e?(this.$inboxPanel.splitResize("cancel"),this.toSinglePane("inbox")):void 0},o.prototype.onSplitResize=function(t,n){return e>n?$("body").addClass("splitting-to-left"):$("body").removeClass("splitting-to-left"),n>100-e?$("body").addClass("splitting-to-right"):$("body").removeClass("splitting-to-right")},o.prototype.toSinglePane=function(e){return $("body").removeClass("splitting-to-left splitting-to-right inbox-only chat-only"),$(document).width()>t&&$("body").addClass("single-pane"),$("body").addClass(""+e+"-only")
},o.prototype.switchPane=function(){var e;return $(document).width()>t?($("body").removeClass("single-pane inbox-only chat-only"),this.$inboxPanel.splitResize("storePosition")):$("body").hasClass("inbox-only")||$("body").hasClass("chat-only")?$("body").hasClass("inbox-only")!==$("body").hasClass("chat-only")&&$("body").toggleClass("inbox-only chat-only"):$("body").addClass("inbox-only"),this.chat.resize(),null!=(e=this.single)?e.onSplitResize():void 0},o.prototype.toChatOnly=function(){return this.toSinglePane("chat")},o.prototype.slideNavigationOut=function(){return Flowdock.eventBus.trigger("mobile:slide-navigation-out")},o.prototype.showAlerts=function(){var t,e,n,r,o;if(e=this.model.get("alerts"),null!=e?e.length:void 0){o=[];for(r in e)t=e[r],n=new Views.Errors.Alert({model:t}),this.$el.append(n.render().el),o.push(n.$el.css({"margin-bottom":110*r}));return o}},o}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.FlowManager=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click a[href]":"followLink"},n.prototype.collectionEvents={add:"addFlow",remove:"removeFlow","change:open":"flowOpenChanged","change:url":"onFlowUrlChange"},n.prototype.keyboardEvents={openPreferences:function(){return setTimeout(function(t){return function(){return t.openPreferences("personal")}}(this),50)},openHelp:"openShortcutOverlay",openChatCommandHelp:"openChatCommandOverlay",closeTab:"closeTab"},n.prototype.initialize=function(t){var e,n,r,o;for(this.rendered={},this.flowViews={},o=this.collection.where({open:!0}),n=0,r=o.length;r>n;n++)e=o[n],this.addFlow(e);return this.navigation=this.subview(Views.Navigation.build({collection:this.collection,user:t.user,manager:this}))},n.prototype.addFlow=function(t){return t.get("open")?this.initFlowView(t):void 0},n.prototype.removeFlow=function(t){return this.removeFlowView(t)
},n.prototype.firstOpenFlow=function(){return this.collection.find(function(t){return t.get("open")&&!t.isPrivate()})},n.prototype.flowOpenChanged=function(t){return t.get("open")?this.initFlowView(t):this.removeFlowView(t)},n.prototype.viewClassFor=function(t){return t.isFlow()?Views.Flow:Views.Private},n.prototype.initFlowView=function(t){var e;return e=this.viewClassFor(t),this.flowViews[t.id]=this.subview(new e({model:t}))},n.prototype.removeFlowView=function(t){var e,n,r;return e=(null!=(r=this.currentFlow)?r.id:void 0)===t.id,(n=this.flowViews[t.id])?(e&&n.triggerDetach(),this.removeSubview(n),e&&(this.currentView=this.currentFlow=void 0),this.rendered[t.id]=!1,delete this.flowViews[t.id]):void 0},n.prototype.activate=function(t){var e,n,r;return(null!=(n=this.currentFlow)?n.id:void 0)===t.id?this:(null!=(r=this.currentView)&&r.triggerDetach(),e=this.flowViews[t.id],this.append(e),this.currentFlow=t,this.currentView=e,this.startTutorial(),this.addStream(Flowdock.app.shortcutStream.filter(function(t){return function(e){return null!=t.keyboardEvents[e.action]
}}(this)).onValue(function(t){return function(e){var n;return n=t.keyboardEvents[e.action],_.isFunction(n)||(n=t[t.keyboardEvents[e.action]]),null!=n?n.call(t,e):void 0}}(this))),this.trigger("change",this.currentView),this)},n.prototype.filterInbox=function(t){var e;return this.closeOverlay(),null!=(e=this.currentView)?e.filterInbox(t):void 0},n.prototype.openSingle=function(t){return this.closeOverlay(),this.currentView.openSingle(t)},n.prototype.openSettings=function(t){return this.openOverlay(Views.Settings,{model:this.currentFlow,organizations:Flowdock.app.getOrganizations(),initialTab:t,target:$("body"),loader:!0})},n.prototype.openCreateFlow=function(t){var e,n,r;return e={collection:this.collection,model:new Models.Flow,organizations:Flowdock.app.getOrganizations(),target:$("body"),loader:!0,preselect:(null!=(n=this.currentFlow)?n.isPrivate():void 0)?void 0:t||(null!=(r=this.currentFlow)?"function"==typeof r.organization?r.organization():void 0:void 0)},this.openOverlay(Views.NewFlow,e)},n.prototype.openFlowRename=function(t){return this.openOverlay(Views.Overlays.FlowName,{model:this.collection.get(t),target:$("body")})
},n.prototype.openNewTab=function(){var t,e;return this.closeOverlay(),null!=(e=this.currentView)&&e.triggerDetach(),this.currentFlow=null,t=new Views.Overlays.NewTab({collection:Flowdock.app.flows,privates:Flowdock.app.privates}),this.currentView=t,this.$el.append(t.el),t.render(),t.triggerAttach(),this.trigger("change",this.currentView),this},n.prototype.openCreateOrganization=function(){return this.openOverlay(Views.NewOrganization,{model:new Models.Organization,collection:Flowdock.app.getOrganizations(),target:$("body"),loader:!0})},n.prototype.openNewPrivateDialog=function(){return this.openOverlay(Views.NewPrivateDialog,{target:$("body"),loader:!0})},n.prototype.openPreferences=function(t){return this.openOverlay(Views.Preferences,{initialTab:t,model:Flowdock.app.preferences,notifications:Flowdock.app.notifications,target:$("body")})},n.prototype.openFeedbackForm=function(){return this.openOverlay(Views.Navigation.FeedbackForm,{model:this.currentFlow,removeOnHide:!0,target:$("body")})},n.prototype.openShortcutOverlay=function(){return this.openOverlay(Views.KeyboardShortcuts,{model:Flowdock.app.preferences,target:$("body"),removeOnHide:!0})
},n.prototype.openChatCommandOverlay=function(){var t;return t=this.openOverlay(Views.SlashCommands,{target:$("body"),removeOnHide:!0})},n.prototype.openSlideshow=function(t,e){var n;return null==e&&(e={}),n=this.openOverlay(Views.Overlays.Slideshow,{slides:t}),e.disableClosing&&n.disableDialogDismissal(),n},n.prototype.openOverlay=function(t,e){return null==this.overlay?(this.overlay=new t(e).attach(),this.listenToOnce(this.overlay,"close",function(){return this.overlay=null}),this.overlay):void 0},n.prototype.closeOverlay=function(){return this.overlay?this.overlay.close():void 0},n.prototype.closeTab=function(t){return this.overlay?(this.closeOverlay(),t.stopPropagation(),t.preventDefault()):this.currentView.constructor===Views.Overlays.NewTab?(this.currentView.triggerDetach(),window.history.back()):void 0},n.prototype.append=function(t){return this.renderOnce(t),this.$el.append(t.el),t.triggerAttach(),this},n.prototype.renderOnce=function(t){return this.rendered[t.model.id]||(t.render(),this.rendered[t.model.id]=!0),t
},n.prototype.render=function(){return Flowdock.mobile&&this.$el.addClass("mobile"),this.$el.prepend(this.navigation.render().el),this},n.prototype.resetFlow=function(t){var e,n;if(t.get("open"))return n=this.currentFlow===t,this.removeFlowView(t),e=this.viewClassFor(t),this.flowViews[t.id]=this.subview(new e({model:t})),n&&this.activate(t),this.flowViews[t.id]},n.prototype.followLink=function(t){var e,n;if(!t.isDefaultPrevented()&&(e="a"===t.target.tagName.toLowerCase()?t.target:t.currentTarget,"_blank"!==$(e).attr("target"))){if(n=Helpers.absoluteUrlFor(),0===e.href.indexOf(n)){if(t.metaKey||t.ctrlKey)return;return this.permanentError||Flowdock.app.router.navigate(e.href.replace(n,""),{trigger:!0}),t.preventDefault()}return $(e).attr("target","_blank")}},n.prototype.error=function(t,e,n){var r,o;return null==n&&(n={}),r=Views.Errors.get(t,"global"),null!=(o=this.currentView)&&o.triggerDetach(),this.currentFlow=null,this.currentView=new r({model:e}),this.$el.append(this.currentView.render().$el),n.permanent&&(Flowdock.app.router.disableNavigation(),this.permanentError=!0),this.trigger("change",this.currentView)
},n.prototype.toastError=function(t,e){var n,r;return n=Views.Errors.get(t,"inline"),r=new n({model:e}),this.$el.append(r.render().$el),function(){return r.triggerDetach()}},n.prototype.destructor=function(){return this.stopListening(),n.__super__.destructor.apply(this,arguments),this.currentView=this.currentFlow=this.tabs=this.settings=this.flowViews=this.rendered=this.tutorial=null},n.prototype.remove=function(){return this.$el=this.el=null,this},n.prototype.onFlowUrlChange=function(t){return t===this.currentFlow?Flowdock.app.router.navigate(Helpers.pathFor({flow:t})):void 0},n.prototype.addTutorial=function(t){return this.tutorial=t,this.startTutorial()},n.prototype.startTutorial=function(){var t,e;if(null!=this.tutorial)return(null!=(t=this.currentView)?null!=(e=t.model)?e.id:void 0:void 0)===this.tutorial.flow_id?(this.tutorial.start(this.currentView),delete this.tutorial):void 0},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="inbox",n.prototype.className="detailed",n.prototype.initialize=function(){return this.filter=new Models.Filter.Inbox,this.toolbar=this.subview(new Views.Inbox.Toolbar({model:this.model})),this.filters=this.subview(new Views.Inbox.Filters({model:this.model,collection:this.model.sources,integrations:this.model.get("integrations")})),this.filterInboxMessages(this.filter),this.$indicators=$("<div>").addClass("indicators"),this.listenTo(this.toolbar,"filter",function(){return this.$el.toggleClass("filtering"),this.filters.toggle()}),this.listenTo(this.toolbar.search,"filter-change",this.onSearchChange),this.listenTo(this.filters,"filter-change",this.onFilterChange)},n.prototype.onFilterChange=function(t){var e;return e=this.toolbar.search.current.query?t:t.merge(this.toolbar.search.current),this.navigateToCurrentState(e)},n.prototype.onSearchChange=function(t){var e;
return e=this.filters.current.merge(t),0===e.tags.length&&"all"===e.slug?e=new Models.Filter.Inbox:0===this.currentTagCount&&1===e.tags.length&&"inbox"===e.slug&&(e.slug="all"),this.navigateToCurrentState(e)},n.prototype.navigateToCurrentState=function(t){return Flowdock.app.router.navigateTo({flow:this.model,filter:t})},n.prototype.filterInbox=function(t){var e;return(t.notEqual(this.filter)||!(null!=(e=this.messageList)?e.populated():void 0))&&this.model.fullyLoaded.done(function(e){return function(){return e.filterInboxMessages(t)}}(this)),this.model.fullyLoaded.done(function(e){return function(){return e.toolbar.search.setFilter(t,{trigger:!1})}}(this)),this.filter=t,this.currentTagCount=t.tags.length,this.toolbar.toggleFilterIndicator(t),this.filters.setFilter(t)},n.prototype.onDetach=function(){var t;return this.scrollTop=null!=(t=this.messageList)?t.$el.scrollTop():void 0},n.prototype.onAttach=function(){var t;return this.scrollTop?null!=(t=this.messageList)?t.$el.scrollTop(this.scrollTop):void 0:void 0
},n.prototype.destructor=function(){return this.messageList.collection.cleanup(),n.__super__.destructor.apply(this,arguments),this.messageList=this.filter=this.toolbar=this.filters=null},n.prototype.render=function(){var t,e;return this.listenTo(Flowdock.app.preferences,"change:link_previews",this.onMuteChange),this.$el.empty().append(this.toolbar.render(this.filter).el,this.filters.render(this.filter).el,this.$indicators,null!=(t=this.messageList)?"function"==typeof t.render?null!=(e=t.render())?e.$el:void 0:void 0:void 0),this},n.prototype.findMessage=function(t){return this.messageList.collection.get(t)},n.prototype.rendered=function(){return this.$el.children().length>0},n.prototype.filterInboxMessages=function(t){var e,n;return this.messageList&&(this.messageList.collection.cleanup(),this.removeSubview(this.messageList)),e=new Collections.InboxMessages([],{flow:this.model,filter:t}),e.consume(this.model.stream),this.messageList=n=this.subview(new Views.Inbox.MessageList({collection:e})),this.listenTo(this.messageList,"indication",function(t){return this.$indicators.append(t)
}),delete this.scrollTop,this.model.fullyLoaded.done(function(){return n.renderMessages()}),this.rendered()&&(this.messageList.render(),this.$el.append(this.messageList.$el)),this.messageList},n.prototype.onMuteChange=function(){return this.rendered()?this.$el.find(".message.file").each(function(){return $(this).toggleClass("no-thumbnail",!Flowdock.app.preferences.linkPreviews())}):void 0},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox.CommentForm=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="comment-form",n.prototype.disabledCommands=["hangout","status","away","me","slap"],n.prototype.events={"keydown textarea":"onKeydown","click #comment-upload-btn":"triggerUpload"},n.prototype.initialize=function(){var t;return this.textarea=this.subview(new Views.Shared.ExpandingInput({persistId:this.key(),autofocus:!0,placeholder:"Comment this item"})),t=this.flow().typingUsers(this.key()),this.typing=this.subview(new Views.Shared.TypingUsers({users:t}))
},n.prototype.render=function(){return this.$el.empty(),this.$el.append(HoganTemplates["owl/templates/inbox/comment_form"].render()),this.renderAvatar(),this.$(".textarea").append(this.textarea.render().el),this.$el.prepend(this.typing.render().el),this.$el.find("fieldset").prepend(new Views.Shared.TextareaAutocompleter({model:this.flow(),input:this.$("textarea")}).render().el),this},n.prototype.renderAvatar=function(){var t;return t=this.subview(new Views.Shared.Avatar({model:Flowdock.app.user,size:80,tagName:"li"})),this.$("ol").prepend(t.$el)},n.prototype.flow=function(){return this.model.flow()},n.prototype.key=function(){return""+this.flow().id+"-"+this.model.id+"-comment-form"},n.prototype.value=function(){return this.textarea.value()},n.prototype.parse=function(t){return null!=t.content&&(t=t.content),{content:{title:this.formatTitle(),text:Helpers.IndentationHelper.parseEmojies(t)},tags:this.parseTags(t),flow:this.model.get("flow")}},n.prototype.formatTitle=function(){var t,e,n;return n=this.model.presenter(),t=null!=n.action()?""+n.action()+" ":"",e=n.headline()||n.summary(),unescape(""+t+e)
},n.prototype.submit=function(t){return null!=t&&t.preventDefault(),this.sendMessage(t)},n.prototype.tagThread=function(){return this.model.hasComments()?void 0:this.model.addTags([Models.Tag.special.thread])},n.prototype.focused=function(){return this.textarea.focused()},n.prototype.createMessage=function(t){return t.tags||(t.tags=[]),t.tags=t.tags.concat(["influx:"+this.model.id]),t=this.flow().buildMessage(t,Models.CommentMessage),t.isValid()?(t.save(),this.tagThread(),this.textarea.reset(),this.focus()):void 0},n.prototype.onKeydown=function(t){return KeyEvent.is("left")(t)&&0===$(t.target).val().length?this.trigger("back"):n.__super__.onKeydown.apply(this,arguments)},n}(Views.Shared.MessageInput)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox.CommentList=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="ul",n.prototype.className="single-view-comments",n.prototype.collectionEvents={add:"addComment",remove:"removeSubview",historyAdd:"addHistory"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.commentsLoaded=new $.Deferred,this.commentsLoaded.always(function(t){return function(){var e;
return null!=(e=t.$spinner)?e.remove():void 0}}(this)).fail(function(t){return function(){return t.$el.prepend('<li class="error">Failed loading comments</li>')}}(this)),this.collection.message.commentsFetched()?this.commentsLoaded.resolve():this.fetchComments()},n.prototype.addComment=function(t){var e;if("pending"!==this.collection.flow.fullyLoaded.state())return e=this.renderOne(t),this.$el.append(e),this.trigger("commentRendered",t,e)},n.prototype.addHistory=function(t){return"pending"!==this.collection.flow.fullyLoaded.state()?(this.renderGroup(t),this.trigger("addHistory")):void 0},n.prototype.lastMessageOf=function(t){return this.collection.lastMessageOf(t)},n.prototype.fetchComments=function(){return this.collection.fetchHistory({data:{limit:100},success:function(t){return function(e,n){return 100===n.length?t.fetchComments():t.commentsLoaded.resolve()}}(this),error:function(t){return function(){return t.commentsLoaded.reject()}}(this)})},n.prototype.renderOne=function(t){var e,n,r,o,i;try{return o="file"===t.get("event")?"FileMessage":"Message",e="file"===t.get("event")?"inbox-file-comment-message":"inbox-comment-message",i=this.subview(new Views.Chat[o]({model:t,className:e,inCommentList:!0,showAvatar:!0})),i.render().$el
}catch(s){return n=s,console.error(n.stack),console.log("CommentList renderOne error",n,t),r=this.subview(new Views.Shared.MessageError({app:"chat",model:t,error:n})),r.render().$el}},n.prototype.renderGroup=function(t){return this.$el.prepend(t.map(function(t){return function(e){return t.renderOne(e)}}(this)))},n.prototype.render=function(){return this.$el.empty(),"pending"===this.commentsLoaded.state()&&(this.$spinner=$("<li/>").html(HoganTemplates["owl/templates/spinner"].render()),this.$el.append(this.$spinner)),this.collection.flow.fullyLoaded.done(function(t){return function(){return t.renderGroup(t.collection),t.trigger("addHistory")}}(this)),this},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.$el.empty()},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;
return-1};Views.Inbox.Filters=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="menu",r.prototype.id="filters",r.prototype.className="clean hidden",r.prototype.collectionEvents=function(){return{reset:"render"}},r.prototype.events={"click #add-sources":"openSettings"},r.prototype.initialize=function(t){var e,r,o,i,s,a,l,u,c;for(this.eventFilters=[],u=["mail","rss","twitter"],i=0,a=u.length;a>i;i++)e=u[i],this.eventFilters.push(new Models.Filter.Inbox({event:e}));if(t.integrations)for(c=t.integrations,s=0,l=c.length;l>s;s++)r=c[s],o=r.service,this.eventFilters.push(new Models.Filter.Inbox({event:o}));return this.mainFilters=_.map(_.values(Models.Filter.filterMap()),function(t){return new t}),this.existingEvents=_.uniq(_.flatten(_.pluck(this.eventFilters,"event"))),this.addStream(this.model.stream.filter(function(t){return"influx"===t.app}).filter(function(t){return function(e){var r;return null!=Models.Filter.labelMap()[e.event]&&(r=e.event,!(n.call(t.existingEvents,r)>=0))
}}(this)).map(".event").onValue(function(t){return function(e){return t.existingEvents.push(e),t.addEventFilter(e)}}(this)))},r.prototype.activateFilter=function(t){return this.setFilter(t),this.trigger("filter-change",t)},r.prototype.setFilter=function(t){var e;return e={},t.slug?e.slug=t.slug:e.event=t.event,this.current=Models.Filter.build(e),this.$(".filter").removeClass("active"),this.$(".filter."+t.className()).addClass("active"),this.$(".event-filters").toggleClass("hidden",!this.current.inboxFilter()),this.current.inboxFilter()?this.$(".main-filters .filter.inbox-only").addClass("active"):void 0},r.prototype.toggle=function(){return this.$el.toggleClass("hidden")},r.prototype.render=function(t){return this.$el.html(HoganTemplates["owl/templates/inbox/filters"].render({mainFilters:this.mainFilters,eventFilters:this.eventFilters},{eventFilterItem:HoganTemplates["owl/templates/inbox/event_filter_item"]})),_.each(this.mainFilters.concat(this.eventFilters),function(t){return function(e){return t.$el.find(".filter."+e.className()).on("click",function(){return t.activateFilter(e)
})}}(this)),t&&this.setFilter(t),this},r.prototype.addEventFilter=function(t){var e;return e=new Models.Filter.Inbox({event:t}),this.$(".event-filters menu").append(HoganTemplates["owl/templates/inbox/event_filter_item"].render(e)),this.$el.find(".filter."+e.className()).on("click",function(t){return function(){return t.activateFilter(e)}}(this))},r.prototype.destructor=function(){return this.$el.find(".filter").off(),r.__super__.destructor.apply(this,arguments),this.current=null},r.prototype.openSettings=function(){return Flowdock.app.router.navigateTo({flow:this.model,settings:{active:"inbox"}})},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox.FullText=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="fieldset",n.prototype.className="full-text",n.prototype.events={"click .submit":"submit","blur input":"closeOnEmpty","input input":"closeOnEmpty","keydown input":"onKey"},n.prototype.initialize=function(){return this.$el.hide().append($(HoganTemplates["owl/templates/inbox/full_text"].render()))
},n.prototype.render=function(){return this.$("input").val(this.query),this.query?this.$el.show():this.$el.hide(),this},n.prototype.focus=function(){return this.$("input").focus()},n.prototype.setQuery=function(t){return this.query=t,this.render(),this.trigger("search",t)},n.prototype.submit=function(t){var e;return null!=t&&t.preventDefault(),e=this.$("input").val(),e.length>=3?this.setQuery(e):void 0},n.prototype.close=function(t){return null!=t&&t.preventDefault(),this.setQuery(""),this.render(),this.trigger("close")},n.prototype.closeOnEmpty=function(){return this.$("input").val()?void 0:(this.close(),this.trigger("focus"))},n.prototype.onKey=function(t){return 13===t.which?this.submit(t):void 0},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;
return-1};Views.Inbox.Item=function(e){function o(){return this.afterWhitespaceChange=t(this.afterWhitespaceChange,this),o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.tagName="li",o.prototype.className="inbox-message",o.prototype.events={"click a.delete":"delete","click a.context":"showContext","click .dropdown-toggle":"toggleMenu","click button.edit-tags":"openTagInput","click .dropdown a":"preventOpen","click .dropdown-wrapper":"preventOpen",mouseleave:"hideMenu"},o.prototype.contentClass="title",o.prototype.initialize=function(t){var e;return null==t&&(t={}),o.__super__.initialize.apply(this,arguments),this.alwaysHeadline=t.alwaysHeadline||!1,this.commitCount=this.initCommitCount(),e=this.model.get("event"),this.addStream(this.$el.asEventStream("click").bufferWithTime(300).onValue(function(t){return function(e){return 1===e.length?t.open(e[0]):void 0}}(this))),this.listenTo(this.model.comments,"add",this.updateCommentCount),("message"===e||"comment"===e||"line"===e||"action"===e)&&(this.contentClass="excerpt"),("vcs"===e||"kiln"===e||"mercurial"===e||"hg"===e||"svn"===e)&&Flowdock.app.whiteSpaceControl.on("after-change",this.afterWhitespaceChange),this
},o.prototype.initCommitCount=function(){return $("body").hasClass("compact")?2:3},o.prototype.afterWhitespaceChange=function(t){return this.commitCount="compact"===t?2:3,this.renderContent(),this.updateTagList(this.model.humanTags())},o.prototype.renderContent=function(){var t,e,n,o,i,s,a,l,u,c,p,h,d,f,m,g;if(d=function(t){return Helpers.capitalizeFirst(null!=t?t.replace(/^Open(?: in)? /,""):void 0)},h=this.model.presenter({commitCount:this.commitCount}),!h)throw new Error("No presenter found");return e=h.author()||("function"==typeof(f=this.model).user?f.user():void 0),n=h.avatar(120)||(null!=e?"function"==typeof e.avatar?e.avatar(120):void 0:void 0),t=("function"==typeof h.action?h.action():void 0)||"",c=this.model.humanTags(),a="function"==typeof h.excerpt?h.excerpt():void 0,i=this.model.editable()&&0===(null!=a?null!=(m=a.html)?m.length:void 0:void 0),o=Helpers.TimeHelper.editTime(this.model.get("edited"),i),g=this.model.get("event"),l=r.call(Models.Filter.Chat.prototype.event,g)>=0,u="file"===this.model.get("event")||("function"==typeof h.hasCommits?h.hasCommits():void 0)&&("function"==typeof h.action?h.action().match(/updated/):void 0),p="file"===this.model.get("event"),this.$el.html(HoganTemplates["owl/templates/inbox/item"].render({presenter:h,icon:h.icon(),avatar:n,author:e,headline:h.headline(),htmlHeadline:"function"==typeof h.htmlHeadline?h.htmlHeadline():void 0,meta:h.meta(),excerpt:a,emptied:i,editTime:o,timestamp:Helpers.TimeHelper.timestamp(this.model.get("sent"),{relative:!0,link:this.timestampLink(h)}),commentCount:this.model.comments.length,removable:this.model.removable(),hideHeadline:u&&!this.alwaysHeadline,metaInExcerpt:p,hasContext:l,hasActions:l||this.model.removable()||("function"==typeof h.actions?h.actions().length:void 0)>0,hasAuthor:e.name||e.partial,tags:c,mainLink:"function"==typeof h.link?h.link():void 0,mainLinkTitle:"function"==typeof h.linkTitle?h.linkTitle():void 0,actionLinkTitle:d("function"==typeof h.linkTitle?h.linkTitle():void 0),action:Helpers.capitalizeFirst(t),iconType:this.iconType()},{author:HoganTemplates["owl/templates/inbox/item_author"],headline:HoganTemplates["owl/templates/inbox/item_headline"],excerpt:HoganTemplates["owl/templates/inbox/item_excerpt"],itemMeta:HoganTemplates["owl/templates/inbox/item_meta"],metaItem:HoganTemplates["owl/templates/inbox/item_meta_item"],actions:HoganTemplates["owl/templates/inbox/item_actions"]})),(null!=a?a.html:void 0)&&this.$(".commit-details").each(function(t,e){return $(e).tipsy({title:function(){return"<ul class='commit-changes show'>"+$(e).next(".commit-changes").html()+"</ul>"
},html:!0})}),this.$el.toggleClass("deleted",i),this.$el.addClass("function"==typeof h.additionalClasses?h.additionalClasses():void 0),this.$(".tags").toggleClass("empty",0===c.length),n&&this.$(".avatar").addClass("found").css("background-image","url("+n+")"),s=this.model.get("event"),s=["message","comment","action"].indexOf(s)>=0?"inbox-chat-message":s,this.$el.addClass(s),this.$el.toggleClass("no-thumbnail",!Flowdock.app.preferences.linkPreviews()&&"file"===this.model.get("event")),this.updateCommentCount(),this.menu=this.$("menu"),this.menuButton=this.$("button.more"),this},o.prototype.updateCommentCount=function(){return this.$(".comment-count").text(this.model.comments.length).toggle(this.model.comments.length>0)},o.prototype.open=function(t){return this.model.flow().isPrivate()?Flowdock.app.router.navigateToPrivate(this.model.flow()):Helpers.textSelected()||$(t.target).attr("href")||$(t.target).closest("a[href]").length>0?void 0:Flowdock.app.router.navigateTo({flow:this.model.flow(),message:this.model.id})
},o.prototype.toggleMenu=function(t){return t.stopPropagation(),$(t.target).closest(".dropdown").toggleClass("open")},o.prototype.hideMenu=function(){return this.$(".dropdown").removeClass("open")},o.prototype["delete"]=function(t){return t.stopPropagation(),Helpers.confirmDelete()?this.model.destroy():void 0},o.prototype.preventOpen=function(t){return t.stopPropagation()},o.prototype.newTagInput=function(){return new Views.Shared.TagInput({model:this.model,optionalDirection:"e"})},o.prototype.openTagInput=function(){return this.hideMenu(),o.__super__.openTagInput.apply(this,arguments)},o.prototype.destructor=function(){var t;return o.__super__.destructor.apply(this,arguments),null!=(t=Flowdock.app.whiteSpaceControl)&&t.off("after-change",this.afterWhitespaceChange),this.menu=this.menuButton=null},o.prototype.showContext=function(){var t;return null!=(t=Flowdock.app.manager.currentView)?t.chat.jumpToMessage(this.model.id):void 0},o}(Views.Shared.Message)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)
}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Inbox.MessageList=function(e){function r(){return this.canPurgeMessages=t(this.canPurgeMessages,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="inbox-message-list",r.prototype.scrollThreshold=50,r.prototype.collectionEvents=_.extend({},Views.Shared.MessageList.prototype.collectionEvents,{historyComplete:"onHistoryComplete"}),r.prototype.listName="inbox",r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.setupMessagePurging(500,50)},r.prototype.canPurgeMessages=function(){return this.state.scrollLocation<this.scrollThreshold&&"more"===this.backwardLoader.current},r.prototype.onHistoryComplete=function(t){var e,n;if("forward"!==t)return n=function(t){return function(){return t.$el.append(HoganTemplates["owl/templates/inbox/no_more_messages"].render({url:"/app/"+Helpers.pathFor({flow:t.collection.flow,settings:{active:"inbox"}}),isSearch:"inbox"!==t.collection.messageFilter.slug}))
}}(this),this.state.renderMessages?n():this.on("renderMessages",e=function(){return this.off("renderMessages",e),n()})},r.prototype.populated=function(){return this.$el.children().length>0},r.prototype.renderOne=function(t){var e,n;try{return n=this.subview(new Views.Inbox.Item({model:t})),[n.render().el]}catch(r){return e=r,console.error(e,e.message,e.stack),console.log("Error was caused by",t.get("event"),t),n=this.subview(new Views.Shared.MessageError({app:"inbox",model:t,error:e})),[n.render().el]}},r.prototype.onAdd=function(){return r.__super__.onAdd.apply(this,arguments),this.scrollLocation()>this.scrollThreshold?this.buildMoreMessagesIndicator({direction:"above"}):void 0},r.prototype.messageCount=function(){return this.$("li.inbox-message").length},r.prototype.scrollToItem=function(){var t,e,n;return t=this.$currentItem(),0!==t.length?(e=$(".inbox-message-list"),n=e.scrollTop()+t.position().top,e.stop().animate({scrollTop:n},this.scrollAnimationDuration)):void 0},r.prototype.previousItem=function(t){var e;
return null!=t&&t.preventDefault(),e=this.$currentItem(),0!==e.length?(e.is(":first-child")?e.removeClass("current-item"):e.removeClass("current-item").prev().addClass("current-item"),this.scrollToItem()):void 0},r.prototype.lastItem=function(t){return null!=t&&t.preventDefault(),this.$("li.inbox-message").removeClass("current-item"),this.$("li.inbox-message:last").addClass("current-item"),this.scrollToItem()},r.prototype.firstItem=function(t){return null!=t&&t.preventDefault(),this.$("li.inbox-message").removeClass("current-item"),this.$("li.inbox-message:first").addClass("current-item"),this.scrollToItem()},r.prototype.nextItem=function(t){var e;if(null!=t&&t.preventDefault(),e=this.$currentItem(),0===e.length)this.$("li.inbox-message:first").addClass("current-item");else{if(e.next().is(":last-child"))return;e.removeClass("current-item").next().addClass("current-item")}return this.scrollToItem()},r.prototype.selectItem=function(){return this.$currentItem().click()},r.prototype.openTagEditor=function(){return this.$currentItem().find("button.edit-tags").click()
},r}(Views.Shared.MessageList)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox.Search=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="form",n.prototype.id="search",n.prototype.events={submit:function(t){return t.preventDefault()}},n.prototype.keyboardEvents={focusSearch:"focusSearch"},n.prototype.initialize=function(){return this.initiallyFiltered=!1,this.autocompleter=new Views.Inbox.SearchAutocompleter({collection:this.model.tags}),this.tokenist=new Views.Shared.Tokenist({autocompleter:this.autocompleter}),this.current=new Models.Filter,this.fullText=this.subview(new Views.Inbox.FullText({model:this.model})),this.listenTo(this.tokenist,"token-add",this.tokenAdd),this.listenTo(this.tokenist,"token-remove",this.filterChange),this.listenTo(this.tokenist,"tokenist-blur",function(){return window.lastFocusedInput="search"
}),this.listenTo(this.fullText,"search",this.filterChange),this.listenTo(this.fullText,"close",this.enableTokenist),this.listenTo(this.fullText,"focus",this.focusSearch),this.listenTo(this.tokenist,"token-remove",function(){return this.tokenist.focus()})},n.prototype.focusSearch=function(t){return null!=t&&t.preventDefault(),this.$("input").val()?this.fullText.focus():this.tokenist.focus()},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.autocompleter.destroy(),this.tokenist.destroy(),this.fullText=this.autocompleter=this.tokenist=this.current=null},n.prototype.render=function(){return this.$el.append($("<button>").attr("id","filter-reset").addClass("right i-button").append($("<span>").addClass("mini-icon icon-cross")),$("<button>").attr("id","search-submit").addClass("right i-button").append($("<span>").addClass("mini-icon icon-search")),this.tokenist.render().el,this.autocompleter.render().el,this.fullText.render().el),this},n.prototype.setFilter=function(t,e){var n;
return null==e&&(e={}),_.defaults(e,{trigger:!0}),this.preventFilterEvent=!e.trigger,n=_.chain(t.tags||[]).map(function(t){return function(e){return t.model.tags.getOrAdd(e)}}(this)).filter(function(t){return t.humanize()}).value(),(n.length!==this.tokenist.tokens.length||_.any(this.tokenist.tokens,function(t){return!_.find(n,function(e){return t.id===e.id})}))&&this.tokenist.reset(n),this.autocompleter.filter=t,t.query?this.enableFullText(t.query):(this.fullText.close(),this.setCurrent()),delete this.preventFilterEvent,this.initiallyFiltered=!0},n.prototype.tokenAdd=function(t){return"full-text"===t.type()&&this.enableFullText(t.query),this.filterChange()},n.prototype.enableFullText=function(t){return this.tokenist.$el.hide(),this.tokenist.reset([]),this.fullText.setQuery(t),this.initiallyFiltered&&this.fullText.focus(),this.setCurrent()},n.prototype.enableTokenist=function(){return this.tokenist.$el.show(),this.initiallyFiltered&&!Flowdock.mobile&&this.shouldAutoFocus()?this.tokenist.focus():void 0},n.prototype.shouldAutoFocus=function(){return 0!==this.tokenist.tokens.length||""!==this.fullText.$("input").val()
},n.prototype.filterChange=function(){var t;return t=this.setCurrent(),this.preventFilterEvent?void 0:this.trigger("filter-change",t)},n.prototype.setCurrent=function(){return this.current=Models.Filter.build({query:this.fullText.query,tags:_.map(this.tokenist.tokens,function(t){return t.id})})},n}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Inbox.SearchAutocompleter=function(e){function o(){return this.loadMore=t(this.loadMore,this),this.isAtEnd=t(this.isAtEnd,this),o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.initialize=function(){return o.__super__.initialize.apply(this,arguments),this.maxOptions=100,this.addStream(this.$el.asEventStream("scroll").throttle(50).filter(this.isAtEnd).onValue(this.loadMore))
},o.prototype.completionKey=function(t){var e;return 9===(e=t.which)||13===e?(t.preventDefault(),this.chooseSelection()):void 0},o.prototype.excludeTokens=function(){return this.filter?this.filter.tags:[]},o.prototype.selectNext=function(){return o.__super__.selectNext.apply(this,arguments),this.scrollToSelection()},o.prototype.selectPrev=function(){return o.__super__.selectPrev.apply(this,arguments),this.scrollToSelection()},o.prototype.inScrollTop=function(t){return t[0].offsetTop<this.$el.scrollTop()},o.prototype.inScrollBottom=function(t){return t[0].offsetTop>this.$el.height()+this.$el.scrollTop()},o.prototype.isAtEnd=function(){return this.$el[0].scrollHeight-this.$el[0].scrollTop-this.$el.height()<100},o.prototype.loadMore=function(){var t;return t=this.$(".option.tag-choice, .option.user-choice").length,_.forEach(this.models(t,t+100),function(t){return function(e){return t.$(".option:last").after(t.renderOption(e))}}(this))},o.prototype.scrollToSelection=function(){return this.inScrollTop(this.selection)?this.$el.scrollTop(this.selection[0].offsetTop-this.selection.height()):this.inScrollBottom(this.selection)?this.$el[0].scrollTop+=this.selection[0].offsetTop-(this.$el.height()+this.$el.scrollTop())+this.selection.height():void 0
},o.prototype.models=function(t,e){var n;return n=this.excludeTokens(),this.collection.startingWith(this.query).filter(function(t){var e;return 0===t.id.indexOf(":")||t.get("count")?(e=t.id,r.call(n,e)<0):!1}).slice(t,e)},o.prototype.filterModels=function(){var t,e,n;return t=o.__super__.filterModels.apply(this,arguments),(null!=(e=this.query)?e.length:void 0)>=3&&!(null!=(n=this.filter)?n.tags.length:void 0)&&t.push({count:0,type:function(){return"full-text"},tag:"Full-text search for '"+this.query+"'",toString:function(){return this.tag},query:this.query}),t},o}(Views.Shared.Autocompleter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Inbox.SingleView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.id="single",r.prototype.className="touch-scrollable",r.prototype.events={"click .single-view-close-button":function(){return this.close(),this.returnToList()
},"click .comment-form textarea":"scrollToBottom","keypress .comment-form textarea":"onCommentKeypress","click .single-view-toolbar .delete":"delete","click .single-view-toolbar .context":"showContext","focus .comment-form textarea":function(){return window.lastFocusedInput="comment"}},r.prototype.keyboardEvents={focusComment:"focusCommentInput"},r.prototype.initialize=function(){return this.state={scrollLocation:0},this.listenTo(this,"view:attach:before",function(){return this.scrollLocation(this.state.scrollLocation||0)}),this.listenTo(this,"view:detach:before",function(){return this.setScrollLocation()})},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/inbox/single_view"].render({},{spinner:HoganTemplates["owl/templates/spinner"]})),this.model.get("sent")?(this.model.flow().fullyLoaded.done(function(t){return function(){var e,n,r;try{if(n="function"==typeof(r=t.model).presenter?r.presenter():void 0,!n)throw new Error("No presenter found");return t.model.commentable()&&(t.commentForm=t.subview(new Views.Inbox.CommentForm({model:t.model})),t.commentList=t.subview(new Views.Inbox.CommentList({collection:t.model.comments})),t.fileupload=t.subview(new Views.Shared.FileUploader({model:t.model.flow(),parent:t.model,target:"#single",targetName:"this thread"})),t.listenTo(t.fileupload,"new_upload",t.onUpload),t.listenTo(t.commentList,"commentRendered",t.onCommentRendered),t.listenTo(t.commentList,"addHistory",t.onAddHistory),t.listenTo(t.commentForm,"upload",function(){return this.fileupload.prompt()
}),t.listenTo(t.commentForm,"edit-last-message",t.editLastMessage),t.listenTo(t.commentForm,"back",function(){return this.close(),this.returnToList()}),t.listenTo(t.commentForm.textarea,"scale",t.onCommentFormResize)),t.messageActions=t.subview(new Views.Inbox.SingleViewActions({model:t.model})),t.message=t.subview(new Views.Inbox.SingleViewMessage({model:t.model})),t.$(".loader").remove(),t.$el.append(t.fileupload.render().$el),t.fileupload.triggerAttach(),t.$(".single-view-toolbar").append(t.messageActions.render().el),t.$(".single-view-content").append(t.message.render().el),t.$(".single-view-content").append(t.commentList.render().$el),t.commentForm.render(),t.positionCommentForm(),"message"!==t.model.get("event")&&t.$el.addClass(t.model.get("event")),t.addStream($(window).asEventStream("resize").filter(!Modernizr.touch).merge(t.model.comments.asEventStream("add").delay(0)).merge($(window).asEventStream("orientationchange")).debounce(0).onValue(function(){return t.positionCommentForm()})),_.defer(function(){var e;
return null!=(e=t.model)?e.markAsRead(Flowdock.app.user):void 0})}catch(o){return e=o,console.error(e,e.message,e.stack),console.log("Error was caused by",t.model.get("event"),t.model,t.model.presenter()),t.$el.html(t.subview(new Views.Inbox.SingleViewError({app:"inbox",model:t.model,error:e})).render().el)}}}(this)),this):(this.fetchContent(),this)},r.prototype.scrollLocation=function(t){return null!=t&&this.$(".single-view-content").scrollTop(t),this.$(".single-view-content").scrollTop()},r.prototype.setScrollLocation=function(){return $.contains($("body")[0],this.el)?this.state.scrollLocation=this.scrollLocation():void 0},r.prototype.onAttach=function(){return this.commentKeypress=!1,this.positionCommentForm(),_.defer(function(t){return function(){var e;return null!=(e=t.commentForm)?e.focus():void 0}}(this))},r.prototype.onSplitResize=function(){return this.positionCommentForm()},r.prototype.positionCommentForm=function(){var t,e,n,r,o,i,s;return t=null!=(e=this.commentForm)?e.focused():void 0,this.$(".single-view-content .form-placeholder").remove(),(null!=(n=this.$(".single-view-content")[0])?n.scrollHeight:void 0)>(null!=(r=this.$(".single-view-content")[0])?r.clientHeight:void 0)?(this.$el.append(null!=(o=this.commentForm)?o.$el:void 0),this.$(".single-view-content").append($("<div>").addClass("form-placeholder")),this.onCommentFormResize(this.$(".form-placeholder").outerHeight())):this.$(".single-view-content").append(null!=(i=this.commentForm)?i.$el:void 0),t&&null!=(s=this.commentForm)&&s.focus(),this.$el.parent().length?void 0:Bacon.noMore
},r.prototype.fetchContent=function(){return this.model.fetch({error:function(t){return function(e,n){var r;return r=404===n.status?{title:"Oops, could not find the message!",body:"The message you are looking for does not exist or may have been deleted.",renderComments:!0}:{title:"Oops, could not fetch the message!",body:"An unexpected error occurred.",renderComments:!1},t.$el.html(HoganTemplates["owl/templates/inbox/single_view_error"].render(r)),r.renderComments?(t.commentList=t.subview(new Views.Inbox.CommentList({collection:t.model.comments})),t.$(".single-view-content").append(t.commentList.render().$el)):void 0}}(this),success:function(t){return function(){var e;return(e=t.model.parent())?Flowdock.app.router.navigateTo({message:e,flow:t.model.flow()}):t.model.get("sent")?t.render():void 0}}(this)})},r.prototype.onCommentRendered=function(t,e){return this.atBottom(null!=e?e.outerHeight():void 0)?this.scrollToBottom(null,!0):void 0},r.prototype.editLastMessage=function(t,e){var r,o;return(r=this.commentList.lastMessageOf(Flowdock.app.user))?(o=r.asProperty("id").filter(function(t){return null!=t
}).take(1),0!==arguments.length?o.onValue(function(){return r.searchReplaceContent(t,e)}):n.call(this.commentList.collection.slice(-10),r)>=0?o.onValue(function(t){return function(){var e;return(e=_.last(t.commentList.findSubviews(r)))?(e.openEditor(),e.once("completed",function(){return _.defer(function(){return t.commentForm.focus()})})):void 0}}(this)):void 0):void 0},r.prototype.onAddHistory=function(){return this.positionCommentForm()},r.prototype.atBottom=function(t){var e,n,r,o,i;return null==t&&(t=0),o=this.$(".single-view-content"),i=20,n=o[0].scrollHeight,r=o[0].scrollTop,e=o.outerHeight(),i>n-r-e-t},r.prototype.scrollToBottom=function(t,e){var n;return null==e&&(e=!1),n=this.$el.find(".single-view-content"),e?n[0].scrollTop=n[0].scrollHeight:n.animate({scrollTop:n[0].scrollHeight},300)},r.prototype.onCommentKeypress=function(){return Modernizr.touch||this.commentKeyPress||(this.commentKeypress=!0,this.atBottom(this.$(".form-placeholder").outerHeight()))?void 0:this.scrollToBottom()},r.prototype.onCommentFormResize=function(t){var e;
return null==t&&(t=0),e=this.atBottom(t),this.$(".form-placeholder").css({height:this.commentForm.$el.outerHeight()+"px"}),this.$(".form-placeholder").height(),e?this.scrollToBottom(null,!0):void 0},r.prototype.onUpload=function(t){return this.commentForm.tagThread(),this.commentList.collection.add(t)},r.prototype.returnToList=function(){return this.trigger("return-to-list")},r.prototype["delete"]=function(){return Helpers.confirmDelete()?(this.commentList.off("commentRendered"),this.model.destroy(),this.close(),this.returnToList()):void 0},r.prototype.close=function(t){return null==t&&(t=!1),t?this.remove():(this.$el.addClass("slide-out"),this.$el.one(Helpers.animationend(),function(t){return function(){return t.remove()}}(this)))},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.commentForm=this.commentList=null},r.prototype.showContext=function(){return this.trigger("show-context",this.model.id)},r.prototype.focusCommentInput=function(t){return null!=t&&t.preventDefault(),this.$("textarea").focus()
},r}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Inbox.SingleViewActions=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="ul",r.prototype.className="clean single-view-toolbar-actions",r.prototype.render=function(){var t,e,r;if(t="function"==typeof(e=this.model).presenter?e.presenter():void 0,!t)throw new Error("No presenter found");return this.$el.html(HoganTemplates["owl/templates/inbox/single_view_actions"].render({presenter:t,removable:this.model.removable(),hasContext:(r=this.model.get("event"),n.call(Models.Filter.Chat.prototype.event,r)>=0)})),this},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Inbox.SingleViewError=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="div",n.prototype.className="error",n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/inbox/single_view_error"].render({title:"Sorry, this message could not be rendered",report:!0})),this},n}(Views.Shared.MessageError)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Inbox.SingleViewMessage=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="article",r.prototype.className="single-view-message single-message",r.prototype.events={"click menu.single-message-actions button.edit-tags":"openTagInput"},r.prototype.contentClass="headline",r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.isChatMessage()?this.contentClass="excerpt":void 0
},r.prototype.isChatMessage=function(){var t;return"message"===(t=this.model.get("event"))||"comment"===t||"action"===t||"status"===t||"line"===t||"user-edit"===t},r.prototype.renderContent=function(){var t,e,r,o,i,s,a,l,u,c,p,h,d,f,m,g,y,v,w,b;if(d="function"==typeof(m=this.model).presenter?m.presenter({commitCount:Math.pow(2,32)}):void 0,!d)throw new Error("No presenter found");for(o="function"==typeof d.body?d.body():void 0,u="function"==typeof d.htmlHeadline?d.htmlHeadline():void 0,c=this.model.humanTags(),r=d.author(),l="function"==typeof d.excerpt?d.excerpt():void 0,s=this.model.editable()&&0===(null!=l?null!=(v=l.html)?v.length:void 0:void 0),i=Helpers.TimeHelper.editTime(this.model.get("edited"),s),a=this.model.get("event"),p=this.isChatMessage(),f=p?"single_view_chat_message":"single_view_message",(o&&""===$.trim(o)||(w=this.model.get("event"),n.call(Models.Filter.Chat.prototype.event,w)>=0))&&(o=void 0),this.$el.html(HoganTemplates["owl/templates/inbox/"+f].render({presenter:d,icon:d.icon(),avatar:d.avatar(120),author:r,action:Helpers.capitalizeFirst(d.action()),headline:d.headline(),headlineLink:"function"==typeof d.link?d.link():void 0,excerpt:l,emptied:s,htmlHeadline:u,body:o,meta:d.meta(),linkify_meta:!0,linkify_author:null!=(null!=r?r.link:void 0),timestamp:Helpers.TimeHelper.timestamp(this.model.get("sent"),{relative:!0,link:this.timestampLink(d)}),editTime:i,tags:c,mainLink:"function"==typeof d.link?d.link():void 0,mainLinkTitle:"function"==typeof d.linkTitle?d.linkTitle():void 0,iconType:this.iconType(),hasAttachments:this.model.appendedAttachments().length>0},{author:HoganTemplates["owl/templates/inbox/item_author"],headline:HoganTemplates["owl/templates/inbox/item_headline"],excerpt:HoganTemplates["owl/templates/inbox/item_excerpt"]})),null!=d.events&&this.delegateEvents(_.extend(this.events,d.events())),b=this.model.appendedAttachments(),g=0,y=b.length;y>g;g++)t=b[g],e=this.subview(new Views.Shared.Attachment({model:this.model,parent:this,attachment:t,showFileProperties:"file"!==this.model.get("event"),renderIfPreviewsHidden:"file"!==this.model.get("event")})),this.$(".attachments").append(e.render().$el);
return this.$el.toggleClass("deleted",s),this.$(".tags").toggleClass("empty",0===c.length),p&&this.previewImageLinks(),h=p?"single-chat-message":a,this.$el.addClass(h),this},r.prototype.previewImageLinks=function(){return this.$(".body a").filter(function(){return"CODE"!==$(this).parent()[0].nodeName}).each(function(t){return function(e,n){var r,o,i,s;return o=$(n),s=o.prop("href"),r=Views.Embed.match(s),r?(i=o.wrap('<div class="embed">').parent(),t.subview(new r({url:s,el:i,parent:t}).render())):void 0}}(this))},r.prototype.newTagInput=function(){return new Views.Shared.TagInput({model:this.model,direction:"e"})},r.prototype.toggleCommitSummary=function(){},r}(Views.Shared.Message)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Inbox.Toolbar=function(t){function r(){return r.__super__.constructor.apply(this,arguments)
}return e(r,t),r.prototype.tagName="menu",r.prototype.className="inbox-toolbar",r.prototype.events={"click button#filter-toggle":"toggleFilter","click button#filter-reset":"clearFilter","focus .tokenist,input":"toggleFocus","blur .tokenist,input":"toggleFocus","click #inbox-settings":"openSettings","click #inbox-toggle-tab-bar":"showSideNavigation"},r.prototype.initialize=function(){return this.search=this.subview(new Views.Inbox.Search({model:this.model}))},r.prototype.toggleFilter=function(){var t,e,n,r;return t=this.$("button#filter-toggle"),e=t.hasClass("active"),r=e?"Show filters":"Hide filters",t.attr("title",r).tipsy("hide"),t.toggleClass("active"),n=e?"icon-arrow-right-5":"icon-arrow-down-5",t.find("span").first().attr("class",n),this.$("form input").focus(),this.trigger("filter")},r.prototype.render=function(t){return this.$el.attr("type","toolbar").html(HoganTemplates["owl/templates/inbox/toolbar"].render()),this.$("li.search").append(this.search.render().el),t&&this.toggleFilterIndicator(t),this},r.prototype.toggleFilterIndicator=function(t){var e;
return e=t.inboxFilter()&&0===t.tags.length&&1!==t.event.length,this.$("button#filter-toggle").toggleClass("active-filters",!e).find("span.label").text(this.buttonLabel(t)),this.$("button#filter-reset").toggleClass("hidden",e)},r.prototype.buttonLabel=function(t){return t.getLabel()},r.prototype.clearFilter=function(){return Flowdock.app.router.navigateTo({flow:this.model})},r.prototype.toggleFocus=function(){var t,e;return e=document.activeElement,t=n.call(this.$(".tokenist, input"),e)>=0,this.$("form").toggleClass("focus",t),this.$el.toggleClass("focused",t)},r.prototype.openSettings=function(){return Flowdock.app.router.navigateTo({flow:this.model,settings:{active:"inbox"}})},r.prototype.showSideNavigation=function(){return Flowdock.eventBus.trigger("mobile:slide-navigation-in")},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.search=null},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="tab-bar",n.prototype.tagName="nav",n.build=function(t){return Flowdock.mobile?new Views.Navigation.Mobile(t):new Views.Navigation.Desktop(t)},n.prototype.initialize=function(t){return this.userMenuToggle=this.subview(new Views.Navigation.UserMenuToggle({model:t.user})),this.userMenu=this.subview(new Views.Navigation.UserMenu({model:this.user,manager:t.manager})),this.userMenu.triggerAttach()},n.prototype.render=function(){return this.$el.html(this.tabs.render().el),this.$el.append(this.userMenuToggle.render().el),this.userMenuToggle.$el.append(this.userMenu.render().el),this.tabs.triggerAttach(),this},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.userMenuToggle=this.userMenu=null},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.DropdownFlowItem=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="flow-item",n.prototype.events={"click a":"navigate"},n.prototype.modelEvents={"change:open":"toggleOpen","change:url":"render","change:access_mode":"render","change:name":"onNameChange"},n.prototype.initialize=function(t){return this.options=t,null==this.options.showOrganization?this.options.showOrganization=!0:void 0},n.prototype.toggleOpen=function(){return this.$el.toggle(!this.model.get("open"))},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/dropdown_flow_item"].render({name:this.model.get("name"),showOrganization:this.options.showOrganization,organization:this.model.get("organization"),link:Helpers.urlFor({flow:this.model})})),"invitation"===this.model.get("access_mode")?this.$("i.icon").addClass("icon-lock").attr("title","This flow is invitation-only."):"organization"===this.model.get("access_mode")&&this.$("i.icon").addClass("icon-building").attr("title","This flow can be joined by anyone in the organization."),this.model.get("open")&&this.$el.hide(),this
},n.prototype.onNameChange=function(){return this.$el.find("span.name").text(this.model.get("name")),this.$el.find("a").attr("href",this.model.path())},n.prototype.navigate=function(t){return t.preventDefault(),Flowdock.app.router.navigateTo({flow:this.model})},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Navigation.Tabs=function(e){function r(){return this.initialTabIndex=t(this.initialTabIndex,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.DROPDOWN_DELAY=500,r.CLOSE_DELAY=500,r.prototype.tagName="ul",r.prototype.id="tab-list",r.prototype.collectionEvents={"change:open":"modelOpenChange",add:"addModel",remove:"removeModel"},r.prototype.initialize=function(t){return this.tabs=[],this.more=this.subview(new Views.Navigation.More(t))
},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.tabs=null},r.prototype.modelOpenChange=function(t,e){var n,r,o,i,s,a,l,u,c;if(e)this.addTabAnimated(t,this.collection.where({open:!0}).indexOf(t));else for(l=this.findSubviews(t),o=0,s=l.length;s>o;o++)r=l[o],this.removeTab(r);for(u=this.subviews,c=[],i=0,a=u.length;a>i;i++)n=u[i],c.push("function"==typeof n.updateName?n.updateName():void 0);return c},r.prototype.addModel=function(t){return t.get("open")?this.addTabAnimated(t):void 0},r.prototype.addTabAnimated=function(t,e){return this.renderOne(t,e).indicateNewTab()},r.prototype.removeModel=function(t){var e,n,r,o,i;for(o=this.findSubviews(t),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(this.removeTab(e));return i},r.prototype.render=function(){var t,e,n,r;for(this.$el.empty(),this.$el.append(this.more.render().$el),t=_.sortBy(this.collection.toArray(),this.initialTabIndex),n=0,r=t.length;r>n;n++)e=t[n],e.get("open")&&this.renderOne(e);return this},r.prototype.initialTabIndex=function(t){var e,n,r;
return e=t.isFlow()?null!=(n=Flowdock.app.tabOrder)?n.flows[t.id]:void 0:null!=(r=Flowdock.app.tabOrder)?r.privates[t.id]:void 0,null!=e?e:this.collection.where({open:!0}).indexOf(t)},r.prototype.renderOne=function(t,e){var n,r;return 0>(null!=e)&&(e=void 0),n=this.subview(new Views.Navigation.Tab({model:t,collection:this.collection.getCollectionFor(t)})),n.consume(t.stream),n.on("closing",this.navigateIfActive,this),this.tabs.push(n),n.render(),r=this.$(".tabs-reorderable").length,0===e||0===r?this.$el.prepend(n.$el):!e||e>r?this.$(".tabs-reorderable").last().after(n.$el):this.$(".tabs-reorderable:eq("+(e-1)+")").after(n.$el),n.triggerAttach(),n.$el.reorderable({className:"tabs-reorderable",dragstartTimeout:700,dragstartOffset:10,drop:function(e){return function(r){var o;return n=_.find(e.tabs,function(e){return e.model===t}),o=e.tabs.indexOf(n),null!=n&&o!==r?(e.tabs.splice(o,1),e.tabs.splice(r,0,n),t.save({tab_index:r})):void 0}}(this)}),n},r.prototype.navigateIfActive=function(t){var e,n;if(t.$el.hasClass("current")){if(n=t.$el.prev(".tabs-reorderable"),e=t.$el.next(".tabs-reorderable"),n.length>0)return n.find("a.tab-link").click();
if(e.length>0)return e.find("a.tab-link").click()}},r.prototype.removeTab=function(t){var e;return e=this.tabs.indexOf(t),!t||0>e?void 0:(this.removeSubview(t),this.tabs.splice(e,1))},r}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Navigation.DropdownFlowList=function(e){function r(){return this.limitDropdownHeight=t(this.limitDropdownHeight,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.tagName="li",r.prototype.id="flow-dropdown-item",r.prototype.className="tab dropdown no-flex touch-scrollable",r.prototype.events={"click #more":"toggleMenu"},r.prototype.collectionEvents={"change add remove":"checkEmptyDropdown",add:"renderOne",remove:"removeFlow"},r.prototype.initialize=function(){return this.addStream($(window).asEventStream("resize").onValue(this.limitDropdownHeight))
},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/dropdown_flow_list"].render()),this.$list=this.$("#flow-list"),this.toggle=this.$(".dropdown-toggle"),this.collection.each(this.renderOne,this),this.checkEmptyDropdown(),this.limitDropdownHeight(),this},r.prototype.showOrganization=function(){return!(1===this.organizationCount())},r.prototype.organizationCount=function(){var t;return _.uniq(function(){var e,n,r,o;for(r=this.collection.toArray(),o=[],e=0,n=r.length;n>e;e++)t=r[e],t.get("organization")&&o.push(t.get("organization").id);return o}.call(this)).length},r.prototype.renderOne=function(t){var e,n;if(t.isFlow())return e=this.subview(new Views.Navigation.DropdownFlowItem({model:t,showOrganization:this.showOrganization()})),null!=(n=this.$list)?n.append(e.render().$el):void 0},r.prototype.checkEmptyDropdown=function(){var t;return null!=(t=this.$list)?t.toggleClass("empty",0===this.collection.where({open:!1}).length):void 0},r.prototype.removeFlow=function(t){return this.removeSubview(t)
},r.prototype.toggleMenu=function(t){return t.stopPropagation(),function(t){return function(e){return $(document).one("click",function(){return e?t.$el.removeClass("open"):void 0})}}(this)(this.$el.toggleClass("open").hasClass("open"))},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.$list=this.toggle=null},r.prototype.limitDropdownHeight=function(){var t;return Flowdock.mobile?void 0:null!=(t=this.$list)?t.css("max-height",""+($(window).height()-200)+"px"):void 0},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.DropdownFlowListMobile=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="ul",n.prototype.id="closed-flow-list",n.prototype.className="closed-flows-list",n.prototype.events={"click li.flow-item":function(){return Flowdock.eventBus.trigger("mobile:hide-navigation")
},"click a.new-tab":"openNewTab"},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/dropdown_flow_list_mobile"].render()),this.collection.each(function(t){return function(e){return t.renderOne(e)}}(this)),this},n.prototype.openNewTab=function(t){return null!=t&&t.preventDefault(),Flowdock.app.router.navigateTo({showNewTab:!0,trigger:!0})},n.prototype.renderOne=function(t){var e;if(t.isFlow())return e=this.subview(new Views.Navigation.DropdownFlowItem({model:t})),this.$el.prepend(e.render().$el)},n}(Views.Navigation.DropdownFlowList)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.FeedbackForm=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="feedback-dialog",n.prototype.events={"click #send-feedback":"sendFeedback","click .close":"close"},n.prototype.initialize=function(t){return this.errorData=null!=t?t.errorData:void 0,n.__super__.initialize.apply(this,arguments)
},n.prototype.render=function(){var t;return t=null!=this.errorData?"\n\n-------------------------------------\n"+this.errorData:void 0,this.$el.append(HoganTemplates["owl/templates/overlays/feedback_form"].render({error:t})),this},n.prototype.feedback=function(){return this.$el.find("textarea").val().trim()},n.prototype.disable=function(){return this.$el.find("#send-feedback").text("Sending..."),this.$el.find("#send-feedback, textarea").attr("disabled",!0)},n.prototype.enable=function(){return this.$el.find("#send-feedback").text("Send feedback"),this.$el.find("#send-feedback, textarea").attr("disabled",!1)},n.prototype.focus=function(){return this.$el.find("textarea").focus()},n.prototype.reset=function(){return this.$el.find(".feedback-completed").remove(),this.$el.find("textarea").val(""),this.enable()},n.prototype.close=function(){return n.__super__.close.apply(this,arguments),this.navigateToFlow()},n.prototype.data=function(){var t;return{feedback:this.feedback(),commit:Flowdock.commit,flow:null!=(t=this.model)?t.id:void 0,app:"owl"}
},n.prototype.sendFeedback=function(t){return null!=t&&t.preventDefault(),0!==this.feedback().length?(this.disable(),$.post("/owl/feedback",this.data()).done(function(t){return function(){return t.completed("Feedback sent!")}}(this)).fail(function(t){return function(){return t.completed("Failed to send feedback. Please try again.",!0)}}(this)).always(function(t){return function(){return t.enable()}}(this))):void 0},n.prototype.completed=function(t,e){var n;return null==e&&(e=!1),n=$("<div>").addClass("feedback-completed").toggleClass("error",e).text(t),e||setTimeout(function(t){return function(){return t.reset(),t.close()}}(this),2e3),this.$el.find("form").append(n)},n}(Views.Shared.Overlay)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Navigation.Mentions=function(e){function r(){return this.limitDropdownHeight=t(this.limitDropdownHeight,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.tagName="div",r.prototype.className="mentions-dropdown",r.prototype.events={mousedown:"cancelPropagation","click .mark-read-link":"markAllRead"},r.prototype.collectionEvents={add:"addMessage",messagesAdded:"renderGroup","change:tags":"toggleMarkAsRead"},r.prototype.flowEvents={"change:name":"updateName"},r.prototype.initialize=function(){return this.addStream($(window).asEventStream("resize").onValue(this.limitDropdownHeight))},r.prototype.spin=function(){return this.$spinner=$("<li></li>").html(HoganTemplates["owl/templates/spinner"].render())},r.prototype.unspin=function(){var t;return null!=(t=this.$spinner)&&t.remove(),delete this.$spinner},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/mentions"].render(this.flow.toJSON())),this.$list=this.$el.find("ul"),this.$list.prepend(this.spin()),this.$markAsReadButton=this.$el.find(".mark-read-link"),this.flow.fullyLoaded.done(function(t){return function(){return null!=t.$list?(t.$list.prepend(t.collection.map(function(e){return t.renderOne(e)
})),t.unspin()):void 0}}(this)),this.toggleMarkAsRead(),this.$el.toggleClass("private",this.flow.isPrivate()),this.limitDropdownHeight(),this},r.prototype.renderOne=function(t){var e;return e=this.subview(new Views.Inbox.Item({model:t,disableEyeTracking:!0,className:"mention-message",alwaysHeadline:!0})),e.render().$el.on("click",function(t){return function(){var e;return Flowdock.mobile?(t.$el.hide(),setTimeout(function(){return t.$el.show()},1e3)):(e=Views.Navigation.Tabs.Desktop.ACTIVE_CLASS,t.$el.parents("li."+e).removeClass(e))}}(this))},r.prototype.renderGroup=function(t){var e,n;return n=function(){var n,r,o,i;for(o=t.reverse(),i=[],n=0,r=o.length;r>n;n++)e=o[n],0===this.findSubviews(e).length&&i.push(this.renderOne(e));return i}.call(this),this.$list.append(n),this.toggleMarkAsRead(),this.unspin()},r.prototype.cancelPropagation=function(t){return null!=t?t.stopPropagation():void 0},r.prototype.toggleMarkAsRead=function(){var t;return null!=(t=this.$markAsReadButton)?t.toggle(0!==this.collection.unread().length):void 0
},r.prototype.markAllRead=function(t){return null!=t&&t.preventDefault(),this.collection.markAllRead()},r.prototype.addMessage=function(t){return this.$list.prepend(this.renderOne(t)),this.toggleMarkAsRead()},r.prototype.onOpen=function(){var t,e;return this.$el.toggleClass("empty",0===this.collection.unread().length),t=25,e=$(window).width()-this.$el.offset().left-this.$el.width()-t,0>e?this.$el.addClass("shift-left"):void 0},r.prototype.onClose=function(){return this.$el.removeClass("shift-left")},r.prototype.updateName=function(){return this.$(".flow-name").text(this.flow.get("name"))},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.$list=this.$spinner=null},r.prototype.limitDropdownHeight=function(){var t;return Flowdock.mobile?void 0:null!=(t=this.$list)?t.css("max-height",""+($(window).height()-120)+"px"):void 0},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.More=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="tab no-flex",n.prototype.id="flow-dropdown-item",n.prototype.initialize=function(t){return t.manager.asEventStream("change").map(function(t){return t.constructor===Views.Overlays.NewTab}).takeUntil(this.asEventStream("destructor")).assign(this.$el,"toggleClass","current")},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/more"].render()),this},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.Desktop=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="desktop",n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.tabs=this.subview(new Views.Navigation.Tabs.Desktop({collection:this.collection,manager:t.manager}))
},n}(Views.Navigation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.Mobile=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="mobile",n.prototype.events={"click #user-menu-toggle":"openUserMenu","click #flow-menu-overlay":"closeUserMenu"},n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.tabs=this.subview(new Views.Navigation.Tabs.Mobile({collection:this.collection,manager:t.manager})),this.list=this.subview(new Views.Navigation.DropdownFlowListMobile({collection:this.collection,tabs:this})),this.listenTo(Flowdock.eventBus,"mobile:slide-navigation-in",this.slideNavigationIn),this.listenTo(Flowdock.eventBus,"mobile:slide-navigation-out",this.slideNavigationOut),this.listenTo(Flowdock.eventBus,"mobile:hide-navigation",this.hideNavigation),this.listenTo(Flowdock.eventBus,"mobile:slide-navigation-out",this.reflowUserMenu),this.listenTo(Flowdock.eventBus,"mobile:hide-navigation",this.reflowUserMenu)
},n.prototype.slideNavigationIn=function(){return $("body").removeClass("navigation-out").addClass("navigation-in")},n.prototype.slideNavigationOut=function(){return $("body").removeClass("navigation-in").addClass("navigation-out").one(Helpers.animationend(),function(){return $("body").removeClass("navigation-out")})},n.prototype.hideNavigation=function(){return $("body").removeClass("navigation-out navigation-in")},n.prototype.render=function(){return this.$el.append($("<div>").attr("id","flow-menu").addClass("touch-scrollable").append(this.userMenuToggle.render().el,this.tabs.render().el,this.list.render().el,$("<div>").attr("id","flow-menu-overlay"))),this.$el.append(this.userMenu.render().el),this},n.prototype.reflowUserMenu=function(){return $("#users").css("position","relative"),_.defer(function(){return $("#users").css("position","absolute")})},n.prototype.openUserMenu=function(){return this.$("#flow-menu").addClass("slide-out").removeClass("slide-in")},n.prototype.closeUserMenu=function(){return this.$("#flow-menu").removeClass("slide-out").addClass("slide-in").one(Helpers.animationend(),function(){return $("#flow-menu").removeClass("slide-in")
})},n.prototype.destructor=function(){return this.stopListening(Flowdock.eventBus),n.__super__.destructor.apply(this,arguments),this.tabs=this.list=null},n}(Views.Navigation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.Tab=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="tab dropdown",n.prototype.attributes={"data-hover-delay":Views.Navigation.Tabs.DROPDOWN_DELAY,"data-close-delay":Views.Navigation.Tabs.CLOSE_DELAY},n.prototype.events={"click .tab-close":"close","click a.tab-link":"navigate","hover-delay-open":function(){var t;return null!=(t=this.mentions)?t.onOpen():void 0},"hover-delay-close":function(){var t;return null!=(t=this.mentions)?t.onClose():void 0}},n.prototype.modelEvents={activate:"onActivate",deactivate:"onDeactivate","change:name":"updateName","change:url":"render"},n.prototype.renderActivity=function(){return null!=Flowdock.app.flowActivities&&null!=this.model?Flowdock.app.flowActivities.asyncGet(this.model.id,function(t){return function(e){return t._destroyed?void 0:(t.activityModel=e,t.listenTo(t.activityModel,"change",_.debounce(t.updateActivity,400)),t.listenTo(t.activityModel.mentions,"historyAdd",t.updateActivity),t.mentions=t.subview(new Views.Navigation.Mentions({collection:t.activityModel.mentions,flow:t.model})),t.$el.append($("<div class='mentions-dropdown-wrapper'>").append(t.mentions.render().$el)),t.model.fullyLoaded.done(function(){return t._destroyed?void 0:t.activityModel.mentions.fetchHistory({limit:100})
}))}}(this)):void 0},n.prototype.onActivate=function(){return this.$el.addClass("current"),this.$el.removeClass("attention-tip")},n.prototype.onDeactivate=function(){return this.$el.removeClass("current")},n.prototype.updateName=function(){return this.$(".tab-name").text(this.collection.uniqueName(this.model))},n.prototype.consume=function(t){var e,n;return n=Flowdock.app.user,e=t.filter(function(t){return t.user!==n.id&&(_.include(Models.Filter.Chat.prototype.event,t.event)||new Models.Message(t).highlights(n))}),this.addStream(e.onValue(function(t){return function(){return t.$(".tab").hasClass("current")?void 0:t.blink()}}(this)))},n.prototype.blink=function(){return this.$(".activity-indicator").addClass("activity-indicator-blink").one(Helpers.animationend(),function(){return $(this).removeClass("activity-indicator-blink")}),this},n.prototype.indicateNewTab=function(){return this.$el.addClass("attention-tip")},n.prototype.updateActivity=function(){return this.activityModel?this.$(".activity-indicator").toggleClass("activity-indicator-chat",this.activityModel.get("chat")).toggleClass("activity-indicator-inbox",this.activityModel.get("inbox")).toggleClass("activity-indicator-mentions",this.activityModel.get("mentions")>0).text(this.activityModel.get("mentions")||""):void 0
},n.prototype.render=function(){var t,e;return t=this.model.isPrivate()?this.model.otherParty().get("name"):this.model.fullName(),this.$el.html(HoganTemplates["owl/templates/navigation/tab"].render({title:t,name:this.collection.uniqueName(this.model),link:Helpers.urlFor(this.model.isFlow()?{flow:this.model}:{"private":this.model})})),this.$el.addClass(""+this.tabType()+"-tab"),this.model.id===(null!=(e=Flowdock.app.manager.currentFlow)?e.id:void 0)&&this.$el.addClass("current"),this.renderActivity(),this},n.prototype.close=function(t){var e;return null!=t&&t.stopImmediatePropagation(),null!=t&&t.preventDefault(),this.trigger("closing",this),e=this.model,e.set({open:!1}),"function"==typeof e.saveWithRetry?e.saveWithRetry():void 0},n.prototype.navigate=function(t){var e,n;if(!t.metaKey&&!t.ctrlKey)return t.preventDefault(),this.model.isFlow()?null!=(e=Flowdock.app.router)?e.navigateBackToFlow(this.model):void 0:null!=(n=Flowdock.app.router)?n.navigateToPrivate(this.model):void 0},n.prototype.destructor=function(){return this._destroyed=!0,n.__super__.destructor.apply(this,arguments),this.activityModel=null
},n.prototype.tabType=function(){return this.model.isFlow()?"flow":"private"},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Navigation.Tabs.Desktop=function(e){function r(){return this.positionMoreButton=t(this.positionMoreButton,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.ACTIVE_CLASS="active",r.prototype.className="desktop clean",r.prototype.events={"click #overflow-scroller":"scrollToRight"},r.prototype.collectionEvents=_.extend({},Views.Navigation.Tabs.prototype.collectionEvents,{"change remove add":"resizeTabs"}),r.prototype.keyboardEvents={nextTab:"navigateToNextTab",previousTab:"navigateToPreviousTab",closeTab:"closeTab",navigateToNthTab:"navigateToNthTab",newTab:"navigateToNewTab"},r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.$el.delayedHover(Views.Navigation.Tabs.Desktop.ACTIVE_CLASS,".dropdown"),this.addStream(Flowdock.resize.window.move.bufferWithTime(100).map(_.last).onValue(this.positionMoreButton))
},r.prototype.resizeTabs=function(){var t,e;return t=this.collection.where({open:!0}).length,e=100/t,this.$(".tabs-reorderable").css({"max-width":""+e+"%"}),this.$(".tabs-reorderable").toggleClass("single",1===t),this.lastTab=this.$(".tabs-reorderable").last(),this.positionMoreButton()},r.prototype.positionMoreButton=function(){var t;if(null!=(t=this.lastTab)?t.length:void 0)return this.$el.toggleClass("overflown",this.lastTab.css("min-width")===""+this.lastTab.outerWidth()+"px")},r.prototype.render=function(){return r.__super__.render.apply(this,arguments),this.$el.append('<li id="overflow-scroller">&gt;&gt;</li>'),this.resizeTabs(),this},r.prototype.navigateToNextTab=function(t){var e;return null!=t&&t.preventDefault(),null!=t&&t.stopPropagation(),e=this.$(".current").next(".tabs-reorderable"),0===e.length&&(e=this.$(".tabs-reorderable").first()),e.find("a.tab-link").click()},r.prototype.navigateToPreviousTab=function(t){var e;return null!=t&&t.preventDefault(),null!=t&&t.stopPropagation(),e=this.$(".current").prev(".tabs-reorderable"),0===e.length&&(e=this.$(".tabs-reorderable").last()),e.find("a.tab-link").click()
},r.prototype.navigateToNthTab=function(t){var e;return null!=t?(t.preventDefault(),e=Number(String.fromCharCode(t.originalEvent.which)),$(this.$(".tabs-reorderable")[e-1]).find("a.tab-link").click()):void 0},r.prototype.scrollToRight=function(t){var e,n;return n=$(t.target),n.addClass("hide"),e=this.$("> li").map(function(t,e){return $(e).width()}).toArray().reduce(function(t,e){return t+e})-this.$el.outerWidth(),this.$(".tabs-reorderable").css("right",e),this.$el.one("mouseleave",function(t){return function(){return n.removeClass("hide"),t.$(".tabs-reorderable").css("right",0)}}(this))},r.prototype.closeTab=function(t){return(null!=t?t.isPropagationStopped():void 0)!==!0?this.$(".current .tab-close").click():void 0},r.prototype.navigateToNewTab=function(){return Flowdock.app.router.navigateTo({showNewTab:!0})},r}(Views.Navigation.Tabs)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Navigation.Tabs.Mobile=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="mobile clean",n.prototype.events={"click .tabs-reorderable":function(){return Flowdock.eventBus.trigger("mobile:hide-navigation")}},n}(Views.Navigation.Tabs)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.UserMenu=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="user-menu",n.prototype.tagName="menu",n.prototype.className="dropdown-menu pull-right touch-scrollable",n.prototype.events={"click .feedback":"openFeedback","click #logout":"logout","click .preferences":"openPreferences","click .flow-members":"openPeopleManager","click .inbox-sources":"openInboxSources","click .flow-settings":"openFlowSettings","click .mute .sub-menu li":"mute","click .mute > a":function(t){return t.stopImmediatePropagation()
},"click .unmute":"unmute"},n.prototype.keyboardEvents={quickMute:"quickMute"},n.prototype.initialize=function(t){return this.flowManager=t.manager},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/user_menu"].render()),this.initMute(),this},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.flowManager=null},n.prototype.openFeedback=function(){return Flowdock.app.router.navigateTo({feedback:!0})},n.prototype.openPreferences=function(){return Flowdock.app.router.navigateTo({preferences:{active:"personal"}})},n.prototype.openPeopleManager=function(){return Flowdock.app.router.navigateTo({flow:this.flowManager.currentFlow,settings:{active:"people"}})},n.prototype.openInboxSources=function(){return Flowdock.app.router.navigateTo({flow:this.flowManager.currentFlow,settings:{active:"inbox"}})},n.prototype.openFlowSettings=function(){return Flowdock.app.router.navigateTo({flow:this.flowManager.currentFlow,settings:{active:"flow"}})},n.prototype.initMute=function(){var t;
return t=Flowdock.app.preferences.mute(),this.addStream(t.onValue(function(t){return function(e){return(t.muted=e)?(t.$(".unmute").show(),t.$(".mute").hide()):(t.$(".mute").show(),t.$(".unmute").hide())}}(this))),this.$(".mute").delayedHover("open")},n.prototype.mute=function(t){var e,n;return this.muted?this.unmute():(e=$(t.target),n=e.hasClass("30-min")?30:e.hasClass("1-h")?60:e.hasClass("8-h")?480:void 0,this.muteFor(1e3*n*60))},n.prototype.unmute=function(){return Flowdock.app.preferences.set("muted","0"),Flowdock.app.preferences.save()},n.prototype.quickMute=function(){return this.muted?this.unmute():this.muteFor(18e5)},n.prototype.muteFor=function(t){return Flowdock.app.preferences.set("muted",String(t+Date.now())),Flowdock.app.preferences.save()},n.prototype.logout=function(t){var e;return t.preventDefault(),e=$('meta[name="csrf-token"]').attr("content"),$("<form>").attr({action:"/session",method:"post"}).append("<input type='hidden' name='_method' value='delete'>").append("<input type='hidden' name='authenticity_token' value='"+e+"'>").css({display:"none"}).appendTo($("body")).submit()
},n}(Flowdock.HierarchicalShortcutView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Navigation.UserMenuToggle=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="user-menu-toggle",n.prototype.className="dropdown",n.prototype.modelEvents={"change:nick":"renderName"},n.prototype.events={click:"toggleMenu"},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/navigation/user_menu_toggle"].render()),this.renderName(),this.renderAvatar(),this.initMute(),this},n.prototype.renderName=function(){return this.$(".user-menu-name").text(this.model.get("nick"))},n.prototype.renderAvatar=function(){var t;return t=this.subview(new Views.Shared.Avatar({model:this.model,size:80,className:"user-menu-avatar"})),this.$(".dropdown-toggle").prepend(t.$el)},n.prototype.initMute=function(){var t,e;
return e=new Bacon.Bus,t=Bacon.interval(6e4,1).merge(e),this.addStream(Flowdock.app.preferences.asProperty("muted").sampledBy(t).map(Number).map(this.userReadable).assign(this.$(".dropdown-toggle"),"attr","title")),this.addStream(Flowdock.app.preferences.mute().onValue(function(t){return function(n){return e.push(1),t.$(".user-menu-name").toggleClass("icon-mute",n)}}(this)))},n.prototype.toggleMenu=function(t){var e;return Flowdock.mobile?void 0:(t.stopPropagation(),function(t){return function(e){return $(document).one("click",function(){return e?t.$el.removeClass("open"):void 0})}}(this)(this.$el.toggleClass("flow-menu",!!(null!=(e=Flowdock.app.router.currentFlow)?e.isFlow():void 0)).toggleClass("open").hasClass("open")))},n.prototype.userReadable=function(t){var e;return e=(t-Date.now())/1e3/60,e=Math.ceil(Math.max(e,0)),0===e?"":1===e?"Muted for one more minute":"Muted for "+e+" more minutes"},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)
}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.NewFlow=function(e){function r(){return this.showError=t(this.showError,this),this.saveSuccess=t(this.saveSuccess,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.id="new-flow",r.prototype.events={"submit form":"createFlow","click #rally-link":"displayRallyProjectPicker","click #new-organization-link":"redirectToOrganizationCreate"},r.prototype.initialize=function(t){return null==t&&(t={}),this.organizations=t.organizations,this.preselect=t.preselect,r.__super__.initialize.apply(this,arguments)},r.prototype.destructor=function(){return this.model.id||this.model.destroy(),r.__super__.destructor.apply(this,arguments),this.organizations=this.spinner=null},r.prototype.render=function(){return this.organizations.ready.done(function(t){return function(){var e;return e=0===t.collection.where({open:!0}).length,t.loader&&t.loader.remove(),0===t.organizations.active().length?(t.close(),Flowdock.app.router.routingError(),void 0):(t.$el.addClass("hidden").html(HoganTemplates["owl/templates/dialogs/new_flow"].render({organizations:_.map(t.organizations.active(),function(t){return t.toJSON()
}),noFlows:e})),t.$name=t.$("[name=name]"),t.$description=t.$("[name=description]"),setTimeout(function(){return t.$name.focus()},1e3),t.$el.removeClass("hidden"),e&&t.disableDialogDismissal(),t.preselect&&t.$("select option[value="+t.preselect+"]").prop("selected",!0),t.$("select[name=organization]").asEventStream("change").map(function(){return t.selectedOrganization()}).toProperty(t.selectedOrganization()).onValue(function(e){var n;return e?(n=t.$("#rally-link"),n.addClass("hidden"),$.get("/rally/visible",{organization:e.id}).done(function(t){return t.visible?n.removeClass("hidden"):void 0})):(t.redirectToOrganizationCreate(),void 0)}))}}(this)),this.organizations.ready.fail(function(t){return function(){return t.$el.empty().append(HoganTemplates["owl/templates/errors/new_flow_error"].render())}}(this)),this},r.prototype.close=function(t){return r.__super__.close.call(this,t),this.navigateToFlow()},r.prototype.createFlow=function(t){var e,n,r,o,i;return null!=t&&t.preventDefault(),r=$.trim(this.$name.val()),n=$.trim(this.$description.val()),o=this.selectedOrganization(),e=this.$("input[name=open-flow]").prop("checked")?"organization":"invitation",""!==r&&o?(this.spin(),i={name:r,description:n,organization_subdomain:o.get("parameterized_name"),open:!0,organization:o.get("name"),access_mode:e},this.model.save(i,{success:this.saveSuccess,error:this.showError,wait:!0}),this):void 0
},r.prototype.selectedOrganization=function(){return this.organizations.get(this.$("select[name=organization]").val())},r.prototype.saveSuccess=function(t){return this.unspin(),this.collection.add(t),this.close(),Flowdock.app.router.navigateTo({flow:t})},r.prototype.showError=function(t,e){var n,r,o,i,s,a,l,u,c,p,h,d;this.unspin();try{a=JSON.parse(e.responseText)}catch(f){n=f}if(400===e.status&&a){for(r=$("<p/>").addClass("error save-completed"),i=[],h=["name","parameterized_name"],l=0,c=h.length;c>l;l++)if(s=h[l],a.errors[s])for(d=a.errors[s],u=0,p=d.length;p>u;u++)o=d[u],i.push(o);return r.text("Name "+i.join(", ")),this.$("form ol > li:last-child").append(r)}return a?this.$("form ol > li:last-child").append($("<p>").addClass("save-completed error").text(a.message)):this.$("form ol > li:last-child").append($("<p>").addClass("save-completed error").text("Something went wrong."))},r.prototype.spin=function(){return this.$("#createFlow").prop("disabled",!0).addClass("disabled"),this.$(".error").remove(),this.spinner=new Views.Shared.Progress,this.$("form ol > li:last-child").append(this.spinner.render().el)
},r.prototype.unspin=function(){var t;return this.$("#createFlow").prop("disabled",!1).removeClass("disabled"),null!=(t=this.spinner)&&t.remove(),delete this.spinner},r.prototype.displayRallyProjectPicker=function(){var t;return t=this.selectedOrganization(),this.close(),Flowdock.app.router.navigateTo({iframe:"rally/invitations?organization="+t.id})},r.prototype.redirectToOrganizationCreate=function(){return this.close(),Flowdock.app.router.navigateTo({createOrganization:!0})},r}(Views.Shared.Overlay)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.NewOrganization=function(e){function r(){return this.onError=t(this.onError,this),this.onSuccess=t(this.onSuccess,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.id="new-organization",r.prototype.events={"click .edit-subdomain":"showEditSubdomain"},r.prototype.render=function(){return this.collection.ready.done(function(t){return function(){var e;
return e=0===t.collection.length?HoganTemplates["owl/templates/dialogs/no_organizations"]:0===t.collection.where({active:!0}).length?HoganTemplates["owl/templates/dialogs/no_enabled_organizations"]:void 0,t.$el.html(HoganTemplates["owl/templates/dialogs/new_organization_dialog"].render({host:"flowdock.com",expiredOrganizations:_.map(t.collection.where({active:!1}),function(t){var e;return e=t.get("subscription").trial?"Your trial has expired":t.get("subscription").error||"Your payments have been canceled",_.extend(t.toJSON(),{reason:e})})},{notice:e})),t.eventHandlers(),0===t.collection.active().length?t.disableDialogDismissal():void 0}}(this)),this},r.prototype.destructor=function(){var t,e;return r.__super__.destructor.apply(this,arguments),(null!=(t=this.model)?t.get("id"):void 0)?void 0:null!=(e=this.model)?e.destroy():void 0},r.prototype.showEditSubdomain=function(t){return null!=t&&t.preventDefault(),this.$(".subdomain").addClass("editing"),this.$("input[name=subdomain-name]").focus()},r.prototype.eventHandlers=function(){var t,e,n,r,o,i;
return o=this.valueFrom(this.$("input[name=subdomain-name]")),i=this.$("form").asEventStream("submit").doAction(".preventDefault"),t=this.valueFrom(this.$("input[name=organization-name]")),r=t.map(this.nameToSubdomain).takeUntil(o),e=Bacon.combineTemplate({name:t,subdomain:r.merge(o)}),n=e.sampledBy(i).map(this.newOrganization).flatMapLatest(function(t){return function(e){var n;return t.model=e,n=t.model.save(),n?(t.spin(),Bacon.fromPromise(n)):Bacon.once(new Bacon.Error(t.model.validationError))}}(this)),this.addStream(r.assign(this.$(".email-example .organization-part"),"text")),this.addStream(r.assign(this.$("input[name=subdomain-name]"),"val")),this.addStream(n.onValue(this.onSuccess)),this.addStream(n.onError(this.onError))},r.prototype.newOrganization=function(t){return new Models.Organization(t)},r.prototype.onSuccess=function(){return this.collection.add(this.model),this.close()},r.prototype.onError=function(t){var e;return e=t.responseText?JSON.parse(t.responseText):t,this.$(".validation-errors").html(HoganTemplates["owl/templates/dialogs/new_organization_dialog_errors"].render(this.errors(e))),this.unspin()
},r.prototype.errors=function(t){var e;return e=function(e){var n,r,o,i,s;n=[];for(r in e)if(o=e[r],o.length>0)for(i=0,s=o.length;s>i;i++)t=o[i],n.push({message:""+Helpers.capitalize(r)+" "+t});return n},{message:t.message,errors:e(t.errors)}},r.prototype.valueFrom=function(t){return t.asEventStream("input").map(function(){return t.val()})},r.prototype.nameToSubdomain=function(t){return t=t.toLowerCase().trim().replace(/[^a-z0-9]/g,"-"),t.replace(/^-{1,}/,"").replace(/-{1,}/g,"-")},r.prototype.spin=function(){return this.$(".create-organization").prop("disabled",!0),this.spinner=new Views.Shared.Progress,this.$("form").append(this.spinner.render().el)},r.prototype.unspin=function(){var t;return this.$(".create-organization").prop("disabled",!1),null!=(t=this.spinner)&&t.remove(),delete this.spinner},r.prototype.close=function(){var t,e;return t=this.model,r.__super__.close.apply(this,arguments),null!=(null!=t?t.id:void 0)?(e={createFlow:!0,organization:t.get("id")},Flowdock.app.router.navigateTo(e)):this.navigateToFlow()
},r}(Views.Shared.Overlay)}.call(this),function(){Views.Overlays||(Views.Overlays={})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.IFrame=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="iframe-dialog",n.prototype.className="modal",n.prototype.initialize=function(t){var e;return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.flow=t.flow,this.url=t.url,e=$(window).asEventStream("message"),this.subscribeToPostMessageEvents(e)},n.prototype.render=function(){return this.$el.append(HoganTemplates["owl/templates/overlays/iframe"].render({url:""+window.location.origin+"/"+this.url})),this},n.prototype.subscribeToPostMessageEvents=function(t){var e;return e=this.asEventStream("destructor"),this.addStream(t.filter(function(t){return"closeFrame"===t.originalEvent.data.event
}).take(1).takeUntil(e).onValue(function(t){return function(){return t.close()}}(this)))},n.prototype.close=function(){return n.__super__.close.call(this),this.navigateToFlow()},n}(Views.Shared.Overlay)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Overlays.Image=function(e){function r(){return this.close=t(this.close,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.id="image-overlay",r.prototype.className="image-overlay",r.prototype.events={"click a":"close"},r.prototype.initialize=function(t){return this.image=t.image,this.originalUrl=t.original,r.__super__.initialize.apply(this,arguments),this.removeOnHide=!0,window.addEventListener("popstate",this.close)},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/overlays/image"].render({url:this.image,original:this.originalUrl||this.image})),this
},r.prototype.close=function(){return window.removeEventListener("popstate",this.close),r.__super__.close.call(this)},r}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.KeyboardShortcuts=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click #enable-kbs-btn":"enableShortcuts"},n.prototype.render=function(){var t;return t={macgap:"undefined"!=typeof macgap&&null!==macgap?!0:!1},this.$el.html(HoganTemplates["owl/templates/overlays/keyboard_shortcuts"].render(t)),this.model.get("keyboard_shortcuts")?this.$("#not-enabled-notice").hide():this.$(".shortcut-list").hide(),this},n.prototype.enableShortcuts=function(){return this.model.save({keyboard_shortcuts:!0}),this.$("#not-enabled-notice").hide(),this.$(".shortcut-list").show()},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.NewTab=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="flow new-tab",n.prototype.events={"click .new-tab-flow-label":"scrollToFlows","click .new-tab-people-label":"scrollToPeople","click ul.sort-type":"switchSortSelection","submit form":"submit",keydown:"navigate","mouseenter .new-tab-item":"mouseOver","mouseleave .new-tab-item":"mouseOut"},n.prototype.initialize=function(t){var e,r,o,i,s,a,l,u,c,p;return n.__super__.initialize.apply(this,arguments),s=t.privates,i=this.$el.asEventStream("input",".new-tab-search").map(function(t){return $(t.target).val()}).toProperty("").takeUntil(this.asEventStream("destructor")),i.onValue(this.scrollToFlows),a=this.$el.asEventStream("click",".new-tab-flow-label ul.sort-type li").map(function(t){return $(t.target).is(".date-sort")}).toProperty(!1),l=this.$el.asEventStream("click",".new-tab-people-label ul.sort-type li").map(function(t){return $(t.target).is(".date-sort")
}).toProperty(!1),this.users=new Models.TabSearch(this._flowUsers()),u=this.users.filter(i.map(function(t){return t.replace(/^@/,"")}),["email","name","nick"]).map(function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],e.id!==s.user.id&&o.push(new Views.Overlays.NewTab.UserTab(e,s.get(e.id)));return o}),c=this._sortByDate(i,u,l),this.flows=new Models.TabSearch(this._flows()),e=this.flows.filter(i,["name","description"]).map(function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(new Views.Overlays.NewTab.FlowTab(e));return o}),r=this._sortByDate(i,e,a),p=this.users.loading.changes().takeUntil(this.asEventStream("destructor")).toProperty(!0),o=this.flows.loading.changes().takeUntil(this.asEventStream("destructor")).toProperty(!0),this.results=Bacon.combineAsArray(i,c,r,p,o).takeUntil(this.asEventStream("destructor")).skipDuplicates(_.isEqual).debounce(1),p.onValue(function(t){return function(e){return t.$(".new-tab-people-label").toggleClass("loading",e)}}(this)),o.onValue(function(t){return function(e){return t.$(".new-tab-flow-label").toggleClass("loading",e)
}}(this)),o.filter(function(t){return!t}).take(1).onValue(function(t){return function(){return 0===t.flows.collection.length?t.$("form").prepend($("<div/>").addClass("warning").html("Looks like you don't have any accessible flows. Would you like to create one?")):void 0}}(this)),this.flows.fetch({data:{users:1}}),this.users.fetch()},n.prototype.fetchUsers=function(){return Bacon.fromPromise($.getJSON(Helpers.apiUrl("/users"))).map(function(t){return new Collections.Users(t)})},n.prototype.positionSticky=function(){return-1!==$("<div>").css({position:"-webkit-sticky"}).css({position:"sticky"}).css("position").indexOf("sticky")},n.prototype.onDetach=function(){return this.destructor()},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.users.collection.cleanup(),this.flows.collection.cleanup()},n.prototype.render=function(){var t,e,n,r,o,i,s,a;return this.trigger("render"),n=HoganTemplates["owl/templates/spinner-small"],e=$(HoganTemplates["owl/templates/overlays/new_tab_list_label"].render({main_class:"new-tab-flow-label",title:"Flows"},{loader:n})),o=$(HoganTemplates["owl/templates/overlays/new_tab_list_label"].render({main_class:"new-tab-people-label",title:"People"},{loader:n})),t=e.clone().hide().css({position:"fixed",bottom:null}),r=o.clone().hide().css({position:"fixed",bottom:null}),s=function(){var n,r;
return r=parseInt(e.css("top"),10),e.position().top<r?(n=e.offsetParent().offset().top,t.show().css({position:"fixed",top:n+r})):t.hide()},a=function(){var t,e,n,s;return s=parseInt(o.css("top"),10),t=parseInt(o.css("bottom"),10)||0,n=o.position(),n.top<s?(e=o.offsetParent().offset().top,r.show().css({position:"fixed",top:e+s})):n.top+t>i.height()-o.height()?(e=o.offsetParent().offset().top,r.show().css({position:"fixed",top:e+i.height()-o.height()})):r.hide()},this.$el.html(HoganTemplates["owl/templates/overlays/new_tab"].render()),this.$el.toggleClass("csspositionsticky",this.positionSticky()),i=this.$(".new-tab-results"),this.results.takeUntil(this.asEventStream("render")).onValue(function(n){return function(i){var l,u,c,p,h;return c=i[0],p=i[1],l=i[2],h=i[3],u=i[4],n.$(".new-tab-results").empty().append(t,r,e,n.renderList(l||[]),o,n.renderList(p||[])),n.$(".new-tab-people-label").toggleClass("loading",h),n.$(".new-tab-flow-label").toggleClass("loading",u),c.length>0&&n.$(".new-tab-item").first().addClass("selected"),0===c.length?n.$(".sort-type").show():n.$(".sort-type").hide(),n.positionSticky()?void 0:(s(),a())
}}(this)),this.positionSticky()||$(window).asEventStream("resize").merge(this.$(".new-tab-results").asEventStream("scroll")).takeUntil(this.asEventStream("render")).takeUntil(this.asEventStream("destructor")).onValue(function(){return s(),a()}),this.$(".new-tab-search").focus(),this},n.prototype.scrollToPeople=function(){var t,e,n,r;return n=this.$(".new-tab-results"),e=$(".new-tab-people-label").last().outerHeight()+$(".new-tab-flow-label").last().outerHeight(),t=this.$(".new-tab-people-label").last().next(),r=0===t.length?n[0].scrollHeight:t.position().top,n.scrollTop(n.scrollTop()+r-e+1)},n.prototype.scrollToFlows=function(){return this.$(".new-tab-results").scrollTop(0)},n.prototype.renderList=function(t){return t.map(function(t){return new Views.Overlays.NewTab.Tab({model:t}).render().$el})},n.prototype._sortByDate=function(t,e,n){return Bacon.combineAsArray(t,e,n).map(function(t){var e,n,r;return r=t[0],n=t[1],e=t[2],r.length>0?n:e?_.sortBy(n,function(t){return t.lastMessageAt()}).reverse():_.sortBy(n,function(t){return t.name().toLowerCase()
})})},n.prototype._flows=function(){var t;return t=new Collections.Flows([],{url:Helpers.apiUrl("/flows/all")}),this.collection.each(function(e){return t.add(e.toJSON())}),t},n.prototype._flowUsers=function(){var t;return t=new Collections.Users,this.collection.each(function(e){var n,r;return n=function(){var t,n,o,i;for(o=e.users.enabled(),i=[],t=0,n=o.length;n>t;t++)r=o[t],i.push(r.toJSON());return i}(),t.set(n,{add:!0,merge:!0,remove:!1})}),t},n.prototype.switchSortSelection=function(t){var e;if($(t.target).is("ul.sort-type li"))return e=this.$($(t.currentTarget).data("selector")),e.find("ul.sort-type li").removeClass("selected"),$(t.target).is(".date-sort")?e.find(".date-sort").addClass("selected"):e.find(".abc-sort").addClass("selected")},n.prototype.scrollTo=function(t){var e,n,r,o,i;return n=t.position().top,e=t.outerHeight(),r=this.$(".new-tab-results"),o=r.innerHeight(),i=r.scrollTop(),n+2*e>o?r.scrollTop(n+i-o+2*e):e>n?r.scrollTop(i+n-e):void 0},n.prototype.navigate=function(t){return KeyEvent.is("down")(t)?(this.select("nextAll"),t.preventDefault()):KeyEvent.is("up")(t)?(this.select("prevAll"),t.preventDefault()):void 0
},n.prototype.select=function(t){var e,n,r;return r=this.$(".new-tab-item.selected").removeClass("selected"),n=r[t](".new-tab-item").first(),e=0===r.length?this.$(".new-tab-item").first():0===n.length?r:n,this.scrollTo(e.addClass("selected"))},n.prototype.mouseOver=function(t){return $(".new-tab-item").removeClass("selected"),$(t.currentTarget).addClass("selected")},n.prototype.mouseOut=function(t){return $(t.currentTarget).removeClass("selected")},n.prototype.submit=function(t){return null!=t&&t.preventDefault(),null!=t&&t.stopImmediatePropagation(),this.$(".new-tab-item.selected a").click()},n}(Flowdock.HierarchicalView)}.call(this),function(){Views.Overlays.NewTab.FlowTab=function(){function t(t){this.model=t}return t.prototype.icon=HoganTemplates["owl/templates/overlays/new_tab_flow_icon"],t.prototype.iconClass=function(){return"invitation"===this.model.get("access_mode")?"icon-lock":"icon-building"},t.prototype.title=function(){var t,e;return t="invitation"===this.model.get("access_mode")?"This flow is invitation-only.":"This flow can be joined by anyone in the organization.",e=this.model.get("open")?"You are a part of this flow. ":"",e+t
},t.prototype.description=function(){var t;return(null!=(t=this.model.get("description"))?t.length:void 0)?this.model.get("description"):"No description"},t.prototype.lastMessageAt=function(){return new Date(this.model.get("last_message_at")||0)},t.prototype.name=function(){return this.model.get("name")},t.prototype.users=function(){return this.model.users.active().slice(0,5).map(function(t){return t.toJSON()})},t.prototype.attributes=function(){return{description:this.description(),hasUsers:!0,userCount:this.model.users.length,icon:{open:this.model.get("open"),"class":this.iconClass(),title:this.title()},name:this.name(),specifier:this.model.get("organization").name,url:Helpers.url.stripHost(this.model.get("web_url")),users:this.users()}},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.NewTab.Tab=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.tagName="li",n.prototype.className="new-tab-item",n.prototype.template=HoganTemplates["owl/templates/overlays/new_tab_item"],n.prototype.initialize=function(){return this.icon=this.model.icon,this.className=this.model.className},n.prototype.lastMessageRelative=function(){var t;return t=moment(this.model.lastMessageAt()),0!==t.valueOf()?""+t.fromNow():void 0},n.prototype.lastMessageCalendar=function(){var t;return t=moment(this.model.lastMessageAt()),0!==t.valueOf()?"Last message sent "+t.calendar():void 0},n.prototype.render=function(){var t;return t=_.extend({lastMessageRelative:this.lastMessageRelative(),lastMessageCalendar:this.lastMessageCalendar()},this.model.attributes()),this.$el.html(this.template.render(t,{icon:this.icon})).addClass(this.className),this},n}(Backbone.View)}.call(this),function(){Views.Overlays.NewTab.UserTab=function(){function t(t,e){this.model=t,this["private"]=e}return t.prototype.icon=HoganTemplates["owl/templates/overlays/new_tab_user_icon"],t.prototype.name=function(){return this.model.get("name")
},t.prototype.lastMessageAt=function(){var t;return new Date((null!=(t=this["private"])?t.get("last_message_at"):void 0)||0)},t.prototype.attributes=function(){return{description:this.model.get("email"),hasUsers:!1,icon:{avatar:this.model.avatar(120)},name:"@"+this.model.get("nick"),specifier:this.name(),url:"/app/private/"+this.model.id,users:[]}},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.SlashCommands=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/overlays/slash_commands"].render()),this},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Overlays.Slideshow=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="slideshow",n.prototype.defaults={type:"modal",target:$("body")},n.prototype.events={"click .next-slide":"next","click .previous-slide":"prev","click .slideshow-bullet":"goToSlide","click .close-slideshow":"close"},n.prototype.initialize=function(t){return this.slides=t.slides,t=_.extend({},this.defaults,t),n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/overlays/slideshow"].render()),this.slides.forEach(function(t){return function(e,n){return t.$(".slideshow-bullets").append($("<div>").addClass("slideshow-bullet slideshow-bullet-"+n)),t.$(".slideshow-content").append($("<div>").addClass("slide "+t.slides[n].name).append(t.slides[n].template.render()))}}(this)),this.$(".slideshow-bullet-0").addClass("current"),this.showSlide(0),this},n.prototype.showSlide=function(t){var e,n;return n=this.$(".slide.current").toggleClass("current old"),e=this.$(".slide").eq(t),n.length>0&&e.one(Helpers.animationend(),function(){return n.removeClass("old")
}),e.addClass("current"),this.trigger("slide-rendered",this.slides[t].name),this.currentIndex=t,this.toggleButtonStates(),this},n.prototype.goToSlide=function(t){return this.showSlide($(t.target).index())},n.prototype.next=function(){return this.slides[this.currentIndex+1]&&this.showSlide(this.currentIndex+1),this},n.prototype.prev=function(){return this.currentIndex>0&&this.showSlide(this.currentIndex-1),this},n.prototype.toggleButtonStates=function(){return this.$(".slideshow-bullet").removeClass("current"),this.$(".slideshow-bullet-"+this.currentIndex).addClass("current")},n.prototype.isLastSlide=function(){return this.currentIndex===this.slides.length-1},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.Unauthorized=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="unauthorized",n.prototype.events={"click #login":"redirectToLogin"},n.prototype.render=function(){return this.$el.append(HoganTemplates["owl/templates/overlays/unauthorized"].render()),this
},n.prototype.redirectToLogin=function(){return window.location.href="/session"},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.Upload=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="upload-dialog",n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.apply(this,arguments),this.flow=t.flow,this.targetName=t.targetName},n.prototype.render=function(){return this.$el.append(HoganTemplates["owl/templates/overlays/upload"].render({targetName:this.targetName})),this},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Overlays.WelcomeToTheNewFlowdock=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.id="welcome-to-the-new-flowdock",n.prototype.events={"click button":"close"},n.prototype.render=function(){return this.$el.append(HoganTemplates["owl/templates/overlays/welcome_to_the_new_flowdock"].render()),this},n}(Views.Shared.Overlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Preferences=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="preferences-dialog",n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.removeOnHide=!0,this.tabs=[this.subview(new Views.Preferences.Personal({model:this.model})),this.subview(new Views.Preferences.Notifications({model:this.model,notifications:t.notifications}))],this.initialTab=t.initialTab||"personal"},n.prototype.activateClickedTab=function(t){return this.savePreferences(),n.__super__.activateClickedTab.call(this,t)
},n.prototype.close=function(){return this.savePreferences(),n.__super__.close.call(this),this.navigateToFlow()},n.prototype.route=function(t){return Flowdock.app.router.navigateTo({preferences:{active:t}},{trigger:!1})},n.prototype.savePreferences=function(){return this.model.hasChanged()?this.model.saveWithRetry({error:function(){return Flowdock.app.router.navigateTo({preferences:{active:"personal"}}),Flowdock.app.manager.overlay.showError("Saving preferences failed. Try again.")}}):void 0},n}(Views.Shared.TabbedOverlay)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Preferences.Avatar=function(e){function r(){return this.onAvatarUploadFinished=t(this.onAvatarUploadFinished,this),this.onProgress=t(this.onProgress,this),this.onFileAdd=t(this.onFileAdd,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.PROGRESS_DELAY=1e3,r.prototype.tagName="li",r.prototype.events={"click button.upload":"uploadAvatar","click a.remove":"removeAvatar"},r.prototype.initialize=function(){return this.uploadInProgress=new Bacon.Bus,this.progress=new Bacon.Bus},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.uploadInProgress=this.progress=null},r.prototype.render=function(){var t;return this.$el.html(""),this.$el.append(HoganTemplates["owl/templates/preferences/avatar"].render()),t=this.subview(new Views.Shared.Avatar({model:this.model.user,size:120})),this.$("#preferences-avatar").prepend(t.$el),this.bindFileUpload(),this.bindDynamicElements(),this},r.prototype.bindFileUpload=function(){var t;return t=this.$el.find("input[type=file]"),null!=t?t.fileupload({dataType:"json",url:Helpers.apiUrl("/avatar"),paramName:"avatar",add:this.onFileAdd,progressall:this.onProgress,always:this.onAvatarUploadFinished,fail:function(){return alert("Avatar uploading failed. Please try again!")
}}):void 0},r.prototype.onFileAdd=function(t,e){return this.uploadInProgress.push(!0),e.submit()},r.prototype.onProgress=function(t,e){return this.progress.push(e)},r.prototype.onAvatarUploadFinished=function(){return this.uploadInProgress.push(!1),this.progress.push({loaded:0,total:1}),this.model.user.fetch()},r.prototype.uploadAvatar=function(t){return t.preventDefault(),this.$el.find("input[type=file]").click()},r.prototype.removeAvatar=function(){return confirm("Are you sure you want to remove your avatar?")?$.ajax(Helpers.apiUrl("/avatar"),{type:"DELETE"}).done(function(t){return function(){return t.model.user.fetch()}}(this)):void 0},r.prototype.localAvatar=function(t){return t.indexOf("local")>=0},r.prototype.bindDynamicElements=function(){var t,e;return t=this.uploadInProgress.flatMapLatest(function(t){return t?Bacon.once(!0).delay(Views.Preferences.Avatar.PROGRESS_DELAY):Bacon.once(!1)}).toProperty(!1),this.addStream(t.assign(this.$el.find("progress"),"toggle")),this.addStream(t.not().assign(this.$el.find("button.upload"),"toggle")),this.addStream(this.model.user.asProperty("avatar").map(this.localAvatar).assign(this.$el.find("a.remove"),"toggle")),e=this.progress.map(function(t){return parseInt(t.loaded/t.total*100,10)
}).toProperty(0),this.addStream(e.assign(this.$el.find("progress"),"attr","value")),this.addStream(e.map(function(t){return""+t+"%"}).assign(this.$el.find("progress"),"text"))},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Preferences.Notifications=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="notification-preferences",n.prototype.className="overlay-tab-content",n.prototype.title="Notifications",n.prototype.iconClassName="icon-bell",n.prototype.attributes={rel:"notifications"},n.prototype.events={"change input, select":"setPreference","click .request-desktop-notifications":"requestPremissionToNotify","mouseup #preferences-audio_volume":"playSound","click span.preview":"playSound"},n.prototype.initialize=function(t){return this.notifications=t.notifications
},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/preferences/notifications"].render(this.model.attributes,this.partials())),this.notificationsEnabled()||this.$el.find("#preferences-desktop_notifications").prop("disabled",!0),this.$("select").each(function(t){return function(e,n){return n=$(n),n.val(t.model.get(n.attr("name")))}}(this)),this},n.prototype.requestPremissionToNotify=function(t){return t.preventDefault(),this.notifications.requestPermission(function(t){return function(){return t.render()}}(this))},n.prototype.playSound=function(t){var e,n,r;return n=Flowdock.AudioNotifications.format(),r=$(t.target).closest(".preview").is(".chat-sound")?"chat":"mention",e=new Audio,e.src=Flowdock.audios[n][r],e.volume=this.$("#preferences-audio_volume").val(),e.play()},n.prototype.notificationsEnabled=function(){return"granted"===this.notifications.permissionLevel()},n.prototype.partials=function(){var t,e,n;return e={},this.notificationsEnabled()||(t=this.notifications.permissionLevel(),n=!this.notifications.Notification,e.desktopNotificationsMessage=n?HoganTemplates["owl/templates/preferences/desktop_notifications_unavailable"]:HoganTemplates["owl/templates/preferences/desktop_notifications_"+t]),e
},n.prototype.setPreference=function(t){var e,n;return e=$(t.target),n=e.is(":checkbox")?e.prop("checked"):e.val(),this.model.set(e.attr("name"),n)},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Preferences.Personal=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="personal-preferences",n.prototype.className="overlay-tab-content",n.prototype.title="Personal",n.prototype.iconClassName="icon-user",n.prototype.attributes={rel:"personal"},n.prototype.events={"change input, select":"setPreferences"},n.prototype.modelEvents={"change:locale":"changeLocale"},n.prototype.initialize=function(){return this.avatar=this.subview(new Views.Preferences.Avatar({model:this.model}))},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/preferences/personal"].render(this.model.attributes)),this.$("form ul").prepend(this.avatar.render().$el),this.$("select").each(function(t){return function(e,n){return n=$(n),n.val(t.model.get(n.attr("name")))
}}(this)),this.updateLocale(),this},n.prototype.setPreferences=function(t){var e,n;return e=$(t.target),e.is("#preferences-locale")?this.setLocale(e):(n=e.is(":checkbox")?e.prop("checked"):e.val(),this.model.set(e.attr("name"),n))},n.prototype.setLocale=function(t){var e;return e=t.prop("checked")?"en-24h":"en-12h",this.model.set("locale",e),this.changeLocale()},n.prototype.changeLocale=function(t,e){return Helpers.TimeHelper.updateGlobalLocale(e),this.updateLocale()},n.prototype.updateLocale=function(){return this.$("#preferences-locale").prop("checked",!this.model.use12HourClock())},n}(Flowdock.HierarchicalView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Private=function(e){function r(){return this.error=t(this.error,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="flow private",r.prototype.id=function(){return"private-"+this.model.id
},r.prototype.initialize=function(){return this.chat=this.subview(new Views.Chat({fileUpload:!0,model:this.model,tags:!1,inbox:!1,expandable:!1,settings:!1})),this.model.fullyLoaded.fail(this.error)},r.prototype.onDetach=function(){return this.$el.detach()},r.prototype.render=function(){return this.errorState?void 0:(this.$el.append(this.chat.render().$el),this)},r.prototype.error=function(t){var e,n;return e=function(){switch(t){case"private-not-found":return Views.Errors.PrivateNotFound;case"private-subscribe-failed":return Views.Errors.PrivateSubscribeFailed;default:return Views.Errors.Error}}(),this.errorState=!0,this.$el.children().hide(),n=new e({model:this}),this.$el.append(n.render().$el)},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.chat=null},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Settings=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="settings",n.prototype.initialize=function(t){return n.__super__.initialize.apply(this,arguments),this.organizations=t.organizations,this.organizations.ready.done(function(t){return function(){var e;return t.tabs=[t.subview(new Views.Settings.Inbox({model:t.model})),t.people=t.subview(new Views.Settings.People({model:t.model,collection:t.model.users,organizations:t.organizations})),t.subview(new Views.Settings.Flow({model:t.model}))],null!=t.organizations?(e=t.organizations.get(t.model.organization()),e.updateIfStale(),t.addStream(e.asEventStream("needsUpdate").debounce(1e3).onValue(function(){return e.updateIfStale()}))):void 0}}(this)),this.initialTab=t.initialTab||"inbox"},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.organizations=this.inbox=this.people=null},n.prototype.close=function(){return n.__super__.close.apply(this,arguments),this.navigateToFlow()
},n.prototype.route=function(t){return Flowdock.app.router.navigateTo({flow:this.model,settings:{active:t}},{trigger:!1})},n.prototype.updateUserCount=function(){return this.model.fullyLoaded.done(function(t){return function(){return null!=t.organizations?t.addStream(t.organizations.get(t.model.organization()).userLimit().onValue(function(e){var n,r,o;return n=e[0],r=e[1],o=0!==r?""+n+"/"+r:""+n,t.$(".user-count").text(o)})):void 0}}(this))},n.prototype.togglePlanLink=function(t){return"people"===t?this.$("#plan-link").off("click"):this.$("#plan-link").on("click",function(t){return function(e){return e.preventDefault(),t.activateTab("people"),!1}}(this))},n.prototype.render=function(){return this.organizations.ready.done(function(t){return function(){return null!=t.organizations?(t.$el.removeClass("hidden"),t.loader.remove(),n.__super__.render.call(t),t.$(".overlay-tab[rel='people']").append(HoganTemplates["owl/templates/settings/user_count"].render(t.organizations.get(t.model.organization()).toJSON())),t.updateUserCount(),t.$(".help-link").tipsy({html:!0,gravity:"s",offset:10})):void 0
}}(this)),this},n}(Views.Shared.TabbedOverlay)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.AccessMode=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="access-mode",n.prototype.tagName="form",n.prototype.modelEvents={"change:access_mode":"updateSelection","change:join_url":"updateSelection"},n.prototype.events={"change input[name=access_mode]":"setAccessMode","change input[name=join_url]":"toggleJoinUrl"},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/access_mode"].render({organization:this.model.get("organization"),allowJoinUrlChange:this.model.can("post","join_url"),allowAccessModeChange:this.model.can("put","self","access_mode")})),this.updateSelection(),this},n.prototype.updateSelection=function(){return this.$("input[name=access_mode]").prop("checked","organization"===this.model.get("access_mode")),this.$("input[name=join_url]").prop("checked",this.model.has("join_url"))
},n.prototype.setAccessMode=function(t){var e,n;return e=$(t.target).prop("checked")?"organization":"invitation",n={access_mode:this.model.get("access_mode")},this.model.save({access_mode:e}).fail(function(t){return function(){return t.model.set(n),window.alert("Setting access mode failed. Please try again shortly.")}}(this))},n.prototype.toggleJoinUrl=function(t){var e,n;return e=$(t.target).prop("checked"),e||confirm("Are you sure you want to disable join link? The URL will be different when re-enabled.")?(n=e?(this.model.set({join_url:"Loading..."}),this.model.enableJoinUrl()):this.model.disableJoinUrl(),n.fail(function(){return alert(""+(e?"Enabling":"Disabling")+" the join url failed. Please try again shortly.")})):(t.preventDefault(),this.updateSelection(),void 0)},n}(Flowdock.HierarchicalView)}.call(this),function(){Views.Settings.Authorization=function(){function t(t){this.integrationType=t,this.subscribers=[],this.resultStream=Flowdock.app.postMessages.filter(function(t){return"pairing-result"===t.type
})}return t.prototype.authWindowProperties="scrollbars=no,menubar=no,height=630,width=600,top=50,left=100,resizable=yes,toolbar=no,status=no",t.prototype.authorizationResultStream=function(){return this.resultStream.take(1).flatMap(function(t){return function(e){return e.success&&e.provider===t.integrationType?Bacon.once(e):Bacon.once(new Bacon.Error(e))}}(this))},t.prototype.authorize=function(){var t,e;return e=$("<form></form>").attr({target:""+this.integrationType+"_auth",method:"post",action:"/auth/"+this.integrationType+"?intent=pair"}).css({display:"none"}),t=window.open("",""+this.integrationType+"_auth",this.authWindowProperties),this.subscribers.push(this.resultStream.onValue(function(){return t.close()})),e.appendTo($("body")).trigger("submit").remove()},t.prototype.destructor=function(){var t,e,n,r,o;for(r=this.subscribers,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t());return o},t}()}.call(this),function(){Views.Settings.Configurations={}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)
}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Settings.Configurations.Rally=function(e){function r(){return this.update=t(this.update,this),this.showAuthorizationExpired=t(this.showAuthorizationExpired,this),this.showConfiguration=t(this.showConfiguration,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.events={"change :checkbox":"update","click .save":"save","click .close":"close","click .authenticate":"authenticate"},r.prototype.initialize=function(){return this.authorization=new Views.Settings.Authorization("rally")},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/sources/configurations/rally/container"].render({projectName:this.model.get("config").project.name},{spinner:HoganTemplates["owl/templates/spinner"]})),$.get(this.authenticationUrl()).done(this.showConfiguration).fail(this.showAuthorizationExpired),this
},r.prototype.showConfiguration=function(){return this.$(".settings-content").empty().append(HoganTemplates["owl/templates/settings/sources/configurations/rally/configuration_full"].render({objects:this.model.get("config").objects},{rally_objects:HoganTemplates["owl/templates/settings/sources/configurations/rally/objects"]})),this.selectEnabled(),this.$(".save").prop("disabled",!1)},r.prototype.showAuthorizationExpired=function(){return this.$(".settings-content").empty().append(HoganTemplates["owl/templates/settings/sources/configurations/rally/authorization_expired"].render())},r.prototype.selectEnabled=function(){var t,e,n,r,o;for(e=this.model.get("config").objects,o=[],n=0,r=e.length;r>n;n++)t=e[n],t.enabled&&o.push(this.$("input."+t.id).prop("checked",!0));return o},r.prototype.authenticationUrl=function(){var t;return t=this.model.get("url"),t.substring(0,t.lastIndexOf("/"))+"/authenticated"},r.prototype.update=function(t){var e,n;return e=$(t.target),n=_.find(this.model.get("config").objects,function(t){return t.id===e.prop("class")
}),null!=n?n.enabled=e.is(":checked"):void 0},r.prototype.save=function(t){return null!=t&&(t.preventDefault(),t.stopPropagation()),this.model.saveWithRetry(),this.trigger("close")},r.prototype.authenticate=function(t){var e;return null!=t&&t.preventDefault(),e=this.authorization.authorizationResultStream(),this.addStream(e.onValue(this.showConfiguration)),this.addStream(e.onError(function(){return alert("Authentication failed")})),this.authorization.authorize()},r.prototype.close=function(t){return null!=t&&(t.preventDefault(),t.stopPropagation()),this.trigger("close")},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.authorization.destructor()},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Flow=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.template=HoganTemplates["owl/templates/settings/flow"],n.prototype.id="flow-preferences",n.prototype.className="overlay-tab-content",n.prototype.iconClassName="icon-list",n.prototype.title="Flow",n.prototype.attributes={rel:"flow"},n.prototype.events={"submit #flow-disable-form":"disableFlow","submit #flow-email-form":"changeEmail","submit #flow-name-form":"editFlow","change input":"clearValidationErrors"},n.prototype.modelEvents={"change:name":"setDisableButtonName","change:_links":"render"},n.prototype.serializeData=function(){return _.extend(this.model.toJSON(),{domain:this.model.get("email").split("@")[1],showDisable:this.model.can("update","self","disabled")})},n.prototype.render=function(){return this.$el.html(this.template.render(this.serializeData())),this},n.prototype.setDisableButtonName=function(){return this.$("#flow-disable-form button").text("Disable "+this.model.get("name"))},n.prototype.parseForm=function(t){var e,n;return e={},n=t.find("input"),n.each(function(t,n){return n=$(n),e[n.attr("name")]=n.val()
}),e},n.prototype.onSubmit=function(t,e){var n,r;return null==e&&(e={}),n=t.find("button"),n.prop("disabled",!0),r=this.parseForm(t),this.saveSettings(t,n,r,e)},n.prototype.saveSettings=function(t,e,n,r){return _.defaults(r,{success:function(){return e.prop("disabled",!1),e.after(new Views.Shared.Feedback({message:r.successLabel}).render().el)},error:function(t){return function(n){var o;return t.renderValidationErrors(null!=n?null!=(o=n.responseJSON)?o.errors:void 0:void 0),e.prop("disabled",!1),e.after(new Views.Shared.Feedback({message:r.errorLabel,error:!0}).render().el)}}(this)}),this.model.save(n,{wait:!0}).done(r.success).fail(r.error)},n.prototype.disableFlow=function(t){var e,n;return t.preventDefault(),confirm("Disabling the flow will prevent all users from accessing it. Are you sure you want continue?")?(n={success:function(){return Flowdock.app.router.activateFirst()},errorLabel:"Flow could not be disabled."},e=$(t.target),this.onSubmit(e,n)):!1},n.prototype.editFlow=function(t){var e;return t.preventDefault(),e=$(t.target),this.onSubmit(e,{successLabel:"Saved successfully",errorLabel:"Flow details could not be saved."})
},n.prototype.changeEmail=function(t){var e,n,r;return t.preventDefault(),r=$(t.target),e=r.find("button"),n=_.extend(this.parseForm(r),{name:this.model.get("name")}),/[^A-Za-z0-9-_]/.test(n.parameterized_name)?(e.after(new Views.Shared.Feedback({message:"Only alphanumeric characters, underscores and dashes are allowed in the email.",error:!0}).render().el),void 0):confirm("Are you sure you want to change the e-mail address? The URL of the flow will change and any e-mail based integrations will stop working.")?(e.prop("disabled",!0),$.ajax({url:this.model.renameUrl(),type:"put",data:{flow:n},dataType:"json"}).done(function(t){return function(n){return e.prop("disabled",!1),e.after(new Views.Shared.Feedback({message:"Saved successfully - refreshing\u2026"}).render().el),t.model.set(n),t.refreshTo(Helpers.absoluteUrlFor({flow:t.model,settings:{active:"flow"}}))}}(this)).fail(function(){return e.prop("disabled",!1),e.after(new Views.Shared.Feedback({message:"The email address could not be changed.",error:!0}).render().el)
})):void 0},n.prototype.renderValidationErrors=function(t){return null==t&&(t=[]),_.each(t,function(t){return function(e,n){var r,o;return r=t.$("label[for=flow-"+n+"]"),o=$("<span>").addClass("validation-error").html(" "+e.join(", ")),r.append(o),window.whatta=r}}(this))},n.prototype.clearValidationErrors=function(t){return this.$("label[for="+$(t.target).attr("id")+"] .validation-error").remove()},n.prototype.refreshTo=function(t){return window.location=t},n}(Flowdock.HierarchicalView)}.call(this),function(){Views.Settings.Wizard={}}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Views.Settings.Wizard.Feed=function(n){function o(){return this.isValid=e(this.isValid,this),o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.className="wizard twitter",o.prototype.events={"click .close":"close"},o.prototype.initialize=function(){var t,e,n,r,o,i,s,a;
return this.spinner=new Views.Shared.Progress,this.end=new Bacon.Bus,t=this.$el.asEventStream("keyup","input[type=url]").takeUntil(this.end),s=this.$el.asEventStream("click","button#add-feed").doAction(".preventDefault").takeUntil(this.end),this.input=t.map(function(t){return function(){return t.sanitize(t.$("input[type=url]").val())}}(this)).toProperty("").skipDuplicates(),r=this.input.changes().debounce(1e3).filter(this.isValid).flatMapLatest(function(t){return function(e){return t.requestPreview(e)}}(this)),this.preview=r.merge(this.input.changes().map(function(){return!1})).toProperty(!1).skipDuplicates(),this.addStream(this.preview.onValue(function(t){return function(e){return t.renderPreview(e)}}(this))),n=this.preview.filter(function(t){return t}).map(function(t){return function(e){return t.populateModel(e)}}(this)),i=s.filter(this.preview).map(n).flatMapLatest(function(){return function(t){var e,n;return n=Bacon.fromPromise(t.save()).map(function(){return"saved"}),e=n.errors().mapError(function(){return"unsaved"
}),Bacon.once("loading").merge(n).merge(e)}}(this)).toProperty("unsaved"),this.addStream(i.filter(function(t){return"saved"===t}).onValue(function(t){return function(){return t.close()}}(this))),e=this.input.map(function(t){return t.length>6}).and(this.errorMessage().not()).and(this.preview.not()),o=i.map(function(t){return"loading"===t}),e.or(o).assign(this.spinner,"show"),this.addStream(o.onValue(function(t){return function(e){return t.$("input").prop("disabled",e)}}(this))),a=this.preview.and(i.map(function(t){return"unsaved"===t})),this.addStream(a.not().onValue(function(t){return this.$("button#add-feed").prop("disabled",t)})),this.addStream(this.errorMessage().onValue(function(t){return function(e){return t.renderError(e)}}(this))),this.addStream(i.errors().mapError(function(){return{message:"Failed to save"}}).onValue(function(t){return function(e){return t.renderError(e)}}(this)))},o.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/wizard/feed"].render()),this.$(".scale").append(this.spinner.render().$el),this
},o.prototype.populateModel=function(t){var e;return e={type:"feed",config:{url:t.feed,title:t.title}},new Models.Source(e,{flow:this.collection.flow})},o.prototype.sanitize=function(t){return $.trim(t)},o.prototype.destructor=function(){return this.end.push(!0),this.end.end(),o.__super__.destructor.apply(this,arguments),this.end=this.spinner=this.input=this.preview=null},o.prototype.validate=function(e){return t.url.validate(e)||t.unique.validate(this.collection.findWithConfig("url",e,"feed"))},o.prototype.errors=function(t){var e;return e=function(e){var n,r,o;return n=function(){var n;n=[];for(r in e)o=e[r],o.length>0?n.push(function(){var e,n,r;for(r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push({message:t});return r}()):n.push(void 0);return n}(),_.compact(_.flatten(n))},{message:t.message,errors:e(t.errors)}},o.prototype.clear=function(){return this.$(".error, .preview").addClass("hidden").html("")},o.prototype.renderError=function(t){var e;return this.clear(),e=this.$(".error"),t?(e.html(HoganTemplates["owl/templates/settings/wizard/preview_error"].render(this.errors(t))),e.removeClass("hidden")):e.addClass("hidden")
},o.prototype.renderSpinner=function(t){return t?this.spinner.show():this.spinner.hide()},o.prototype.renderPreview=function(t){var e;return this.clear(),this.$("button#add-feed").prop("disabled",!t),t?(e=HoganTemplates["owl/templates/settings/wizard/feed_preview"],this.$(".preview").html(e.render(t)).removeClass("hidden")):this.$(".preview").text("").addClass("hidden")},o.prototype.errorMessage=function(){var t,e;return e=this.preview.changes().errors().mapError(function(t){return JSON.parse(t.responseText)}),t=this.input.changes().map(function(t){return function(e){return e.length>6?t.validate(e):!1}}(this)),e.merge(this.input.map(function(){return!1}).changes()).merge(t).toProperty(!1)},o.prototype.isValid=function(t){return!this.validate(t)},o.prototype.previewUrl=function(t){return""+this.collection.url()+"/preview?feed="+encodeURIComponent(t)},o.prototype.requestPreview=function(t){return Bacon.fromPromise($.getJSON(this.previewUrl(t)))},o.prototype.close=function(t){return null!=t&&(t.preventDefault(),t.stopPropagation()),this.trigger("close")
},o}(Flowdock.HierarchicalView),t={unique:{validate:function(t){return t?{message:"Feed already added"}:!1}},url:{validate:function(t){return null==t&&(t=""),t.match(/^https?:\/\//)?!1:{message:'"'+t+'" is not a valid url'}}}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Settings.Wizard.PairingWizard=function(e){function r(){return this.handleFailure=t(this.handleFailure,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.integrationType="service",r.prototype.integrationLabel="Service",r.prototype.itemType={singular:"artifact",plural:"artifacts"},r.prototype.className=function(){return"wizard pairing "+this.integrationType},r.prototype.events={"click .close":"close","click .authorize":"authorize","change input[name=items]":"toggleConfiguration","click button.submit":"onSubmit","submit #pairing-select":"onSubmit"},r.prototype.collectionEvents={add:"disableExisting"},r.prototype.initialize=function(){return this.authorization=new Views.Settings.Authorization(this.integrationType),this.authWindowProperties?this.authorization.authWindowProperties=this.authWindowProperties:void 0
},r.prototype.close=function(t){return null!=t&&(t.preventDefault(),t.stopPropagation()),this.trigger("close")},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/wizard/pairing_wizard"].render({service:this.integrationLabel,itemType:this.itemType})),this.authUI=this.$(".authorization").hide(),this.$(".help").tipsy({gravity:"w"}),this.spin("Checking authorization..."),this.fetchAvailable({initial:!0}),this},r.prototype.spin=function(t){var e;return null!=(e=this.loading)&&e.remove(),this.loading=$("<div></div>"),null!=t&&this.loading.append($("<p></p>").text(t)),this.loading.append(HoganTemplates["owl/templates/spinner"].render()),this.$(".settings-content").append(this.loading)},r.prototype.renderAvailable=function(t,e){var n,r,o,i,s,a;this.$(".available").remove(),t.length>0&&this.$("button.submit").attr("disabled",null),s=HoganTemplates["owl/templates/settings/wizard/pairing_wizard_item_list_header"],this.$(".settings-content").append(s.render({me:this.me(e),hasItems:t.length>0,service:this.integrationLabel,itemType:this.itemType},{instructions:this.pairingInstructions})),i=this.groupItems(t,e),o=HoganTemplates["owl/templates/settings/wizard/pairing_wizard_items"];
for(r in i)n=i[r],a=this.transformItems(n),this.$(".item-lists").append(o.render({items:_.sortBy(a,function(t){return t.name}),groupName:r},this.itemConfigurationPartial()));return 1===Object.keys(i).length&&this.$(".group-name").hide(),this.disableExisting()},r.prototype.authorize=function(t){var e;return t.preventDefault(),e=this.authorization.authorizationResultStream(),this.$(".authorize.error").remove(),this.addStream(e.onValue(function(t){return function(){return t.$(".authorization").remove(),t.$(".available").remove(),t.spin("Fetching "+t.itemType.plural+"..."),t.fetchAvailable()}}(this))),this.addStream(e.onError(function(t){return function(e){var n;return t.$(".authorization").show(),t.$(".available").remove(),n="Authorization failed.",null!=e.error&&(n+=" "+e.error),t.$(".settings-content").append($("<p></p>").addClass("authorize error").text(n))}}(this))),this.authorization.authorize()},r.prototype.fetchAvailable=function(t){return null==t&&(t={}),$.ajax({type:"get",dataType:"json",url:this.model.get("url")+("/integrations/"+this.integrationType+"/available")}).done(function(t){return function(e){var n,r;
return n=e.items,r=e.me,t.renderAvailable(n,r)}}(this)).fail(function(e){return function(n){var r;return e.authUI.show(),t.initial?void 0:(console.error(n),alert("Request could not be completed: "+(null!=(r=n.responseJSON)?r.message:void 0)))}}(this)).always(function(t){return function(){return t.loading.detach()}}(this))},r.prototype.onSubmit=function(t){var e,n,r,o,i,s,a;if(null!=t&&t.preventDefault(),o=this.checkedItems(),r=o.length,0===r)return alert("Choose at least one before submitting."),void 0;for(this.$(".available").hide(),this.showLoadingWithCount(r),e=[],a=[],i=0,s=o.length;s>i;i++)n=o[i],a.push(function(t){return function(n){return $.ajax({headers:{"Content-Type":"application/json"},data:JSON.stringify({item_id:n,configuration:t.getItemConfiguration(n)}),type:"post",dataType:"json",url:t.model.get("url")+("/integrations/"+t.integrationType)}).fail(function(){return e.push(""+t.$("[for="+n+"]").text().trim())}).done(function(e){return t.collection.add(e)}).always(function(){return t.loading.detach(),r--,0===r?e.length?t.handleFailure(e):t.close():t.showLoadingWithCount(r)
})}}(this)(n));return a},r.prototype.showLoadingWithCount=function(t){return this.spin("Adding "+t+" "+(1===t?this.itemType.singular:this.itemType.plural)+"...")},r.prototype.handleFailure=function(t){return alert("Failed adding the following "+this.integrationLabel+" "+this.itemType.plural+" to flow:\n"+t.join("\n")),this.disableExisting(),this.$(".available").show()},r.prototype.checkedItems=function(){return _.map(this.$("[name=items]:checked:enabled"),function(t){return $(t).val()})},r.prototype.toggleConfiguration=function(t){var e;return null!=t&&t.preventDefault(),e=$(t.target),e.parents("li.available-item").find(".configuration").toggle(e.is(":checked"))},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.authorization.destructor()},r.prototype.disableExisting=function(){},r.prototype.getItemConfiguration=function(){},r.prototype.me=function(){},r.prototype.groupItems=function(){},r.prototype.transformItems=function(t){return t},r.prototype.itemConfigurationPartial=function(){},r
}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Wizard.Github=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.integrationType="github",n.prototype.integrationLabel="GitHub",n.prototype.itemType={singular:"repository",plural:"repositories"},n.prototype.pairingInstructions=HoganTemplates["owl/templates/settings/wizard/github_instructions"],n.prototype.authWindowProperties="scrollbars=no,menubar=no,height=800,width=1024,top=50,left=100,resizable=yes,toolbar=no,status=no",n.prototype.me=function(t){return{name:t.name,username:t.login}},n.prototype.groupItems=function(t){return _.groupBy(_.sortBy(t,function(t){return t.full_name.toLowerCase()}),function(t){return t.owner.login})},n.prototype.disableExisting=function(){var t,e,n,r,o;for(r=this.collection.where({type:"github"}),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.$('[value="'+t.getConfig("repo").full_name+'"]').prop({disabled:!0,checked:!0}));
return o},n.prototype.transformItems=function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push({id:e.full_name,name:e.name});return o},n}(Views.Settings.Wizard.PairingWizard)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Wizard.Rally=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.integrationType="rally",n.prototype.integrationLabel="Rally",n.prototype.itemType={singular:"project",plural:"projects"},n.prototype.me=function(t){return{name:""+t.first_name+" "+t.last_name,username:t.username}},n.prototype.groupItems=function(t){return _.groupBy(t,function(t){return t.workspace})},n.prototype.transformItems=function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push({id:e.uuid,name:e.name,objects:e.objects});return o},n.prototype.disableExisting=function(){var t,e,n,r,o;
for(r=this.collection.where({type:"rally"}),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.$("[value="+t.getConfig("project").id+"]").prop({disabled:!0,checked:!0}));return o},n.prototype.itemConfigurationPartial=function(){return{itemConfiguration:HoganTemplates["owl/templates/settings/sources/configurations/rally/configuration_inline"],objectsConfiguration:HoganTemplates["owl/templates/settings/sources/configurations/rally/objects"]}},n.prototype.getItemConfiguration=function(t){var e,n,r,o,i;for(o=this.$(".configuration[data-item="+t+"]").find("input[name=objects]"),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push({id:$(e).prop("class"),enabled:$(e).is(":checked")});return i},n}(Views.Settings.Wizard.PairingWizard)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Wizard.Trello=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.integrationType="trello",n.prototype.integrationLabel="Trello",n.prototype.itemType={singular:"board",plural:"boards"},n.prototype.authWindowProperties="scrollbars=no,menubar=no,height=630,width=600,top=50,left=100,resizable=yes,toolbar=no,status=no",n.prototype.me=function(t){return{name:t.name,username:t.nickname}},n.prototype.groupItems=function(t){return _.groupBy(t,function(t){return null!=t.idOrganization?t.organization.displayName:"Others"})},n.prototype.disableExisting=function(){var t,e,n,r,o;for(r=this.collection.where({type:"trello"}),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.$("[value="+t.getConfig("board").id+"]").prop({disabled:!0,checked:!0}));return o},n}(Views.Settings.Wizard.PairingWizard)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Views.Settings.Wizard.Twitter=function(e){function r(){return this.isValid=t(this.isValid,this),r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.className="wizard twitter",r.prototype.events={"click .close":"close"},r.prototype.initialize=function(){var t,e,n,r,o,i,s,a,l,u;return this.spinner=new Views.Shared.Progress,this.spinner.hide(),s=this.eventStream("click","button#add-follow").doAction(".preventDefault"),i=this.eventStream("keyup","input[name=search]").map(function(t){return function(){return t.sanitize(t.$("input[name=search]").val())}}(this)).toProperty("").skipDuplicates(),l=this.eventStream("change","input:radio").map(function(t){return function(){return t.$("input:radio:checked").val()}}(this)).skipDuplicates(),e=this.eventStream("change","input[name=replies]").map(function(t){return function(){return t.$("input[name=replies]").prop("checked")}}(this)).toProperty(!1),n=this.eventStream("change","input[name=retweets]").map(function(t){return function(){return t.$("input[name=retweets]").prop("checked")}}(this)).toProperty(!1),this.input=Bacon.combineTemplate({search:i,replies:e,retweets:n,type:l}).map(function(t){return"twitter_user"===t.type?_.extend(t,{search:t.search.replace(/^@/,"")}):t
}),u=this.input.changes().map(this.isValid).toProperty(!1),t=this.input.map(function(t){return function(e){return t.populateModel(e)}}(this)),o=s.filter(u).map(t).flatMapLatest(function(){return function(t){var e,n;return n=Bacon.fromPromise(t.save()).map(function(){return"saved"}),e=n.errors().mapError(function(){return"unsaved"}),Bacon.once("loading").merge(n).merge(e)}}(this)).toProperty("unsaved"),this.addStream(o.filter(function(t){return"saved"===t}).onValue(function(t){return function(){return t.close()}}(this))),r=o.map(function(t){return"loading"===t}),r.assign(this.spinner,"show"),this.addStream(r.onValue(function(t){return function(e){return t.$("input").prop("disabled",e)}}(this))),this.addStream(i.map(function(t){return t.length>0}).and(this.errorMessage()).onValue(function(t){return function(e){return t.renderError(e)}}(this))),this.addStream(o.errors().mapError(this.parseError).onValue(function(t){return function(e){return t.renderError(e)}}(this))),a=u.and(o.map(function(t){return"unsaved"===t})),this.addStream(a.not().onValue(function(t){return this.$("button#add-follow").prop("disabled",t)
}))},r.prototype.sanitize=function(t){return t.trim().toLowerCase()},r.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/wizard/twitter"].render()),this.$(".help").tipsy({gravity:"w"}),this.$("input:radio").trigger("change"),this.$(".scale").append(this.spinner.render().$el),this},r.prototype.destructor=function(){return r.__super__.destructor.apply(this,arguments),this.spinner=this.input=null},r.prototype.close=function(t){return null!=t&&(t.preventDefault(),t.stopPropagation()),this.trigger("close")},r.prototype.parseError=function(t){return 400===t.status?JSON.parse(t.responseText):{message:"Failed to save"}},r.prototype.renderPreview=function(t,e){var n;return t&&"twitter_keyword"===e.type?(n=HoganTemplates["owl/templates/settings/wizard/twitter_keyword_preview"],this.$(".preview").html(n.render({preview:t,query:e.search})).removeClass("hidden")):t&&"twitter_user"===e.type?(n=HoganTemplates["owl/templates/settings/wizard/twitter_user_preview"],this.$(".preview").html(n.render(t)).removeClass("hidden")):this.$(".preview").text("").addClass("hidden")
},r.prototype.errors=function(t){var e;return e=function(e){var n,r,o;return n=function(){var n;n=[];for(r in e)o=e[r],o.length>0?n.push(function(){var e,n,r;for(r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push({message:t});return r}()):n.push(void 0);return n}(),_.compact(_.flatten(n))},{message:t.message,errors:e(t.errors)}},r.prototype.renderError=function(t){var e;return e=this.$(".error"),t?(e.html(HoganTemplates["owl/templates/settings/wizard/preview_error"].render(this.errors(t))),e.removeClass("hidden")):e.addClass("hidden")},r.prototype.eventStream=function(t,e){return this.$el.asEventStream(t,e).takeUntil(this.asEventStream("end"))},r.prototype.errorMessage=function(){var t;return t=this.input.changes().map(function(t){return function(e){return t.validate(e)}}(this)),t.toProperty(!1)},r.prototype.validate=function(t){var e;return e=_.first(_.compact(_.map(this.validations(t),function(){return function(e){return e(t.search)}}(this)))),e?{message:e}:!1},r.prototype.validations=function(t){var e;return e={twitter_user:{size:function(t){var e;
return e=t.replace(/^@/,""),e.length<1?"User name too short":e.length>15?"User name too long":void 0},screen_name_validity:function(t){return t.match(/^@?[a-zA-Z0-9_]+$/)?void 0:"Invalid user name"},unique:function(t){return function(e){return t.collection.findWithConfig("param",e,"twitter_user")?"User already followed":void 0}}(this)},twitter_keyword:{size:function(t){return t.length<4?"Search string too short":t.length>32?"Search string too long":void 0},search_string_validity:function(t){return t.match(/,/g)?"Searches must not contain commas":void 0},unique:function(t){return function(e){return t.collection.findWithConfig("param",e,"twitter_keyword")?"Term already searched":void 0}}(this)}},e[t.type]},r.prototype.isValid=function(t){return!this.validate(t)},r.prototype.populateModel=function(t){var e;return e={type:t.type,config:{param:t.search,replies:t.replies,retweets:t.retweets}},new Models.Source(e,{flow:this.collection.flow})},r.keywordPreviewUrl=function(t){var e,n;return e=function(t,e){return e=e.replace('"','\\"').trim(),0===e.length?t:"@"===e?t+' "@':"@"===t[t.length-1]?t+e+'" ':t+' "'+e+'" '
},n=t.search.split(/\b/).reduce(e,"").trim(),Helpers.TwitterHelper.searchApiUrl(encodeURIComponent(n),{rpp:3})},r.userPreviewUrl=function(t){return Helpers.TwitterHelper.userTimelineApiUrl(encodeURIComponent(t.search.replace(/^@/,"")),3)},r.previewUrl=function(t){return"twitter_user"===t.type?r.userPreviewUrl(t):r.keywordPreviewUrl(t)},r.requestPreview=function(t){return Bacon.fromPromise($.getJSON(r.previewUrl(t))).flatMapLatest(function(t){return null!=t.error?Bacon.later(0,new Bacon.Error(t.error)):_.isArray(t)?Bacon.once(t[0]):Bacon.once(t)})},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Inbox=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="inbox-settings",n.prototype.className="overlay-tab-content",n.prototype.title="Inbox Sources",n.prototype.iconClassName="icon-cog",n.prototype.attributes={rel:"inbox"},n.prototype.events={"click .add-link":"showWizard","click .reset-link":"resetFlowToken","click .configure-link":"showConfiguration"},n.prototype.modelEvents={"change:api_token":"updateApiToken"},n.prototype.wizards={trello:Views.Settings.Wizard.Trello,twitter:Views.Settings.Wizard.Twitter,feed:Views.Settings.Wizard.Feed,github:Views.Settings.Wizard.Github,rally:Views.Settings.Wizard.Rally},n.configurations={rally:Views.Settings.Configurations.Rally},n.prototype.initialize=function(){return this.view=!1,this.sourceList=new Views.Settings.SourceList({model:this.model,collection:this.model.sources})
},n.prototype.render=function(){var t,e,n,r;for(r=this.subviews.slice(0),e=0,n=r.length;n>e;e++)t=r[e],t!==this.view&&this.removeSubview(t);return this.sourceList.$el.detach(),this.view?this.$el.html(this.view.render().$el):this.renderList(),this},n.prototype.renderList=function(){return this.$el.html(HoganTemplates["owl/templates/settings/inbox"].render()),this.$("ol li").tipsy({gravity:"n"}),this.$(".settings-content").append(this.sourceList.render().$el)},n.prototype.addSource=function(t){return this.$(".sources."+t.get("type")).prepend(this.renderOne(t).$el)},n.prototype.removeSource=function(t){return this.removeSubview(t)},n.prototype.renderOne=function(t){return this.subview(new Views.Settings.Source({model:t}).render())},n.prototype.showWizard=function(t){var e;return t.preventDefault(),e=$(t.target).data("wizard")||$(t.target).closest(".add-link").data("wizard"),null!=this.wizards[e]?this.activate(new this.wizards[e]({collection:this.model.sources,model:this.model})):void 0},n.prototype.showConfiguration=function(t){var e,n,r,o;
return e=$(t.target).data("source")||$(t.target).closest(".configure-link").data("source"),n=this.model.sources.get(e),o=Views.Settings.Inbox.configurations[null!=n?n.get("type"):void 0],null!=o?(r=new o({model:n}),this.activate(r)):void 0},n.prototype.activate=function(t){return this.view&&this.removeSubview(this.view),this.view=t||!1,this.view&&this.listenTo(this.view,"close",this.activate),this.render(),null!=t?this.subview(this.view):void 0},n.prototype.resetFlowToken=function(){return confirm("This will break existing integrations using the token. Are you sure you want to continue?")?this.model.resetToken():void 0},n.prototype.updateApiToken=function(t,e){return this.$("span.api-token").text(e)},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.view=null},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Settings.Invitation=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="invitation row",n.prototype.events={"click .cancel":"cancel","click .resend":"resend"},n.prototype.modelEvents={change:"render"},n.prototype.cancel=function(){return this.model.destroy()},n.prototype.resend=function(t){var e,n,r;return n=$(t.target).attr("disabled","disabled"),r=this.$el.addClass("resending"),e=function(t,e){return t.removeClass("resending"),n.removeAttr("disabled"),t.addClass(e),setTimeout(function(){return t.removeClass(e)},3e3)},this.model.resend({success:function(){return e(r,"resend-success")},error:function(){return e(r,"resend-error")}})},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/invitation"].render(this.model.toJSON())),this},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Settings.InvitationForm=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="form",r.prototype.className="invite-form",r.prototype.events={"click button.submit":"sendInvite","click .from-rally a":"displayRallyInviteDialog",keydown:"sendInviteOnReturn","focus .tokenist":"showMessageField","blur textarea":"hideMessageField"},r.prototype.initialize=function(t){var e;return this.organizations=t.organizations,this.users=t.users,this.flow=t.flow,e=$.get("/rally/visible",{flow:this.flow.id}),this.rallyButtonVisible=Bacon.fromPromise(e).filter(function(t){return t.visible})},r.prototype.destructor=function(){var t,e;return null!=(t=this.tokenist)&&t.destroy(),null!=(e=this.autocompleter)&&e.destroy(),r.__super__.destructor.apply(this,arguments),this.tokenist=this.autocompleter=this.organizations=this.users=this.progress=void 0
},r.prototype.use=function(t){return this.addStream(t.map(function(t){var e,n;return e=t[0],n=t[1],0!==n&&e>=n}).onValue(function(t){return function(e){var n;return e?t.showMessage(HoganTemplates["owl/templates/settings/user_limit_full"],{subLink:null!=(n=t.organizations.get(t.flow.get("organization").id))?n.get("_links").subscription_management.href:void 0}):t.removeMessages()}}(this)))},r.prototype.render=function(){return this.flow.fullyLoaded.done(function(t){return function(){return t._render()}}(this)),this},r.prototype._render=function(){var t;return t=this.flow.can("post","invitations"),this.$el.html(HoganTemplates["owl/templates/settings/invitation_form"].render({canInviteNewUsers:t,organization:this.flow.get("organization")})),this.autocompleter=new Views.Settings.UserAutocompleter({collection:this.organizations.users(),disallowNewTokens:!t}),this.tokenist=new Views.Shared.Tokenist({autocompleter:this.autocompleter}),this.progress=new Views.Shared.Progress({color:"white"}),this.listenTo(this.users,"reset change",this.updateExcludes),this.listenTo(this.tokenist,"token-remove",this.updateExcludes),this.listenTo(this.tokenist,"token-add",this.updateExcludes),this.listenTo(this.tokenist,"tokenist-blur",this.hideMessageField),this.$("li.input").append(this.tokenist.render().el),t||this.tokenist.$el.addClass("only-add-users"),this.$("fieldset").append(this.autocompleter.render().el),this.$("button.submit").prepend(this.progress.render().el),this.rallyButtonVisible.onValue(function(t){return function(){return t.$(".from-rally").show()
}}(this)),this.updateExcludes(),this.progress.hide()},r.prototype.showMessage=function(t,e){return null==e&&(e={}),this.$(".administrative-messages").append(t.render(e))},r.prototype.removeMessages=function(){return this.$(".administrative-messages li.error").remove()},r.prototype.updateExcludes=function(){return this.autocompleter.excludes=this.users.enabled().map(function(t){return t.get("email")}).concat(this.tokenist.tokens)},r.prototype.messageField=function(){return this.$("li.invite-message textarea")},r.prototype.submitButton=function(){return this.$("button.submit")},r.prototype.busy=function(){var t;return t=this.submitButton().addClass("active"),t.find(".text").text("Sending"),this.tokenist.$el.addClass("loading"),this.progress.show()},r.prototype.resetForm=function(){var t;return t=this.submitButton().removeClass("active"),t.find(".text").text("Add People"),this.progress.hide(),this.tokenist.$el.prop("disabled",!1),this.tokenist.reset([]),this.$("li.invite-message").removeClass("open"),this.messageField().val("")
},r.prototype.sendInvite=function(t){var e,n;return t.preventDefault(),this.autocompleter.query.length>0&&this.autocompleter.choose(),this.tokenist.tokens.length>0?(n=this.messageField().val().trim()||null,e={list:this.tokenist.tokens.join(","),message:n},this.busy(),this.collection["import"](e).done(function(t){return function(e){return t.onInvitationSent(e)}}(this)).fail(function(t){return function(e){return t.onInvitationSentError(e)}}(this)).always(function(t){return function(){return t.resetForm()}}(this))):void 0},r.prototype.onInvitationSentError=function(){return window.alert("The invitation(s) could not be sent. Please retry.")},r.prototype.onInvitationSent=function(t){var e,n,r,o,i,s,a;if(t.erroneous_emails.length>0){for(r=[],a=t.erroneous_emails,i=0,s=a.length;s>i;i++){n=a[i];for(e in n)o=n[e],r.push({email:e,error:o})}return this.showMessage(HoganTemplates["owl/templates/settings/erroneous_emails"],{errors:r})}},r.prototype.sendInviteOnReturn=function(t){return 13===t.which&&$(t.target).is(".tokenist")?this.sendInvite(t):void 0
},r.prototype.showMessageField=function(){return this.flow.can("post","invitations")?this.$("li.invite-message").addClass("open"):void 0},r.prototype.hideMessageField=function(){var t;return!this.tokenist.editorNode&&0===this.tokenist.tokens.length&&(t=document.activeElement,n.call(this.$("textarea, .tokenist"),t)<0)?this.$("li.invite-message").removeClass("open"):void 0},r.prototype.displayRallyInviteDialog=function(){return Flowdock.app.router.navigateTo({iframe:"rally/invitations/"+this.flow.path()})},r}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.JoinUrl=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="invite-link",n.prototype.modelEvents={"change:access_mode":"render","change:join_url":"render"},n.prototype.events={"click a":"selectLink"},n.prototype.render=function(){return this.model.fullyLoaded.done(function(t){return function(){return t.$el.html(HoganTemplates["owl/templates/settings/join_url"].render({url:t.model.get("join_url"),accessMode:t.accessModeMessage(),additionalMessage:t.additionalMessage(),restrictedHelp:!t.model.can("post","join_url")&&!t.model.get("join_url")})),t.$("a").tipsy({gravity:"e"})
}}(this)),this},n.prototype.accessModeMessage=function(){return{"invitation;no-link":"Invitation only","invitation;link":"Anyone with the link","organization;no-link":"Any member of "+this.model.get("organization").name,"organization;link":"Any member of "+this.model.get("organization").name+" or anyone with this link"}[this.model.combinedAccessMode()]},n.prototype.additionalMessage=function(){return null==this.model.get("join_url")?{invitation:"This flow is hidden from other members of the company.",organization:"This flow is open for all members of the company."}[this.model.get("access_mode")]:void 0},n.prototype.selectLink=function(t){return t.preventDefault(),Helpers.selectText(t.target)},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.User=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.tagName="li",n.prototype.className="user row",n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/user"].render(_.extend({canBlock:this.canBlock()},this.model.toJSON()))),Helpers.buttonConfirm(this.$(".block"),"Click to confirm",function(t){return function(){return t.model.block({flow:Flowdock.app.router.currentFlow})}}(this)),this.$(".avatar").css("background-image","url("+this.model.avatar(72)+")"),this},n.prototype.canBlock=function(){return"invitation"===Flowdock.app.router.currentFlow.get("access_mode")&&Flowdock.app.router.currentFlow.can("put","self")},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Me=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="article",n.prototype.className="user me row",n.prototype.events={"click .block":"leaveFlow"},n.prototype.modelEvents={"change:access_mode":"render"},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/me"].render(this.model.toJSON())),this.$(".avatar").css("background-image","url("+this.model.avatar(72)+")"),this
},n.prototype.leaveFlow=function(){var t;return t="invitation"===this.flow.get("access_mode")?" You won't able to return without a new invitation.":"",window.confirm("Are you sure you want to leave this flow?"+t)?(this.model.block({flow:this.flow}),Flowdock.app.router.removeFlow(this.flow)):void 0},n}(Views.Settings.User)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.People=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="people-settings",n.prototype.className="overlay-tab-content",n.prototype.title="People",n.prototype.iconClassName="icon-users",n.prototype.attributes={rel:"people"},n.prototype.events={"click #expand-access-mode":"expandAccessMode"},n.prototype.initialize=function(t){return this.me=this.subview(new Views.Settings.Me({model:Flowdock.app.user,flow:this.model})),this.organizations=t.organizations,this.userList=this.subview(new Views.Shared.List({className:"users clean",collection:this.collection,modelView:Views.Settings.User,filter:function(t){return!t.get("disabled")&&t.id!==Flowdock.app.user.id
}})),this.invitationList=this.subview(new Views.Shared.List({className:"invitations clean",collection:this.model.invitations,modelView:Views.Settings.Invitation})),this.invitationsForm=this.subview(new Views.Settings.InvitationForm({flow:this.model,collection:this.model.invitations,organizations:this.organizations,users:this.collection})),this.joinUrl=this.subview(new Views.Settings.JoinUrl({model:this.model}))},n.prototype.sendInvite=function(t){return t.preventDefault(),!1},n.prototype.destructor=function(){return n.__super__.destructor.apply(this,arguments),this.organizations=this.invitationsForm=this.joinUrl=this.invitationsList=this.userList=this.me=void 0},n.prototype.render=function(){return this.model.fullyLoaded.done(function(t){return function(){var e;return t.$el.html(HoganTemplates["owl/templates/settings/people"].render({flowName:t.model.get("name")})),t.model.can("update","self","access_mode")||t.model.can("post","join_url")?t.$(".settings-content").before(t.subview(new Views.Settings.AccessMode({model:t.model})).render().el):t.$("#expand-access-mode").hide(),t.$(".settings-content").append(t.me.render().el,t.userList.render().el,t.invitationList.render().el),t.$(".settings-header").append(t.invitationsForm.render().el),t.$(".settings-info").append(t.joinUrl.render().el),t.$("a.edit").tipsy({gravity:"w"}),e=t.organizations.get(t.model.organization()),t.invitationsForm.use(e.userLimit())
}}(this)),this},n.prototype.expandAccessMode=function(){var t;return t=this.$("a.edit .text").text(),this.$("a.edit .text").text("Close"===t?"Change":"Close"),this.$("#access-mode").toggleClass("open"),this.$(".mini-icon").toggleClass("icon-arrow-down-7 icon-arrow-up-7")},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.Source=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="source",n.prototype.tagName="li",n.prototype.modelEvents={change:"render"},n.prototype.events={"click button.delete":"delete"},n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/settings/source"].render({source:this.model.toJSON(),feedTitle:this.feedTitle(),twitterOptions:this.twitterOptionsString(),configure:this.showConfigureLink()},{content:HoganTemplates["owl/templates/settings/sources/"+this.model.get("type")]})),this.$el.addClass(this.model.get("type")),this.$("button.delete").tipsy({gravity:"w"}),this.setAvatar(),this
},n.prototype.feedTitle=function(){return"feed"===this.model.get("type")?this.model.getConfig("title")||this.model.getConfig("url"):void 0},n.prototype.twitterOptionsString=function(){var t,e;return"twitter_keyword"===(e=this.model.get("type"))||"twitter_user"===e?(t={retweets:this.model.getConfig("retweets"),replies:this.model.getConfig("replies")},t.retweets&&t.replies?"including retweets and replies":t.retweets||t.replies?t.replies?"including replies but not retweets":"including retweets but not replies":"without retweets and replies"):void 0},n.prototype.setAvatar=function(){var t;return"twitter_user"===this.model.get("type")?(t=Helpers.TwitterHelper.profileImageApiUrl(this.model.getConfig("twitter_user_id"),"bigger"),this.$(".avatar").css("background-image","url("+t+")")):void 0},n.prototype["delete"]=function(){return this.model.destroy()},n.prototype.showConfigureLink=function(){return null!=Views.Settings.Inbox.configurations[this.model.get("type")]},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Settings.SourceGroup=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="row source-group",n.prototype.collectionEvents={add:"checkAdd",remove:"checkRemove"},n.prototype.initialize=function(t){return this.active=!1,this.type=t.type,this.label=t.label},n.prototype.render=function(){var t,e,n,r;if(e=this.collection.filter(function(t){return function(e){return e.get("type").indexOf(t.type)>=0}}(this)),this.$el.html(HoganTemplates["owl/templates/settings/source_group"].render({name:this.label,helpLink:"/help/"+this.type,sourceCountString:this.sourceCountString(e.length),kind:this.type})),e.length>0)for(this.active=!0,this.$el.addClass("active"),n=0,r=e.length;r>n;n++)t=e[n],this.$("ul.source-list").append(this.subview(new Views.Settings.Source({model:t})).render().el);return this.$("a.help-link, span.add").tipsy({gravity:"w"}),this.$el.addClass(this.type),this
},n.prototype.checkAdd=function(t){return t.get("type").indexOf(this.type)>=0?(this.$("ul.source-list").prepend(this.subview(new Views.Settings.Source({model:t})).render().el),this.updateCount()):void 0},n.prototype.checkRemove=function(t){var e,n,r,o;if(t.get("type").indexOf(this.type)>=0){for(o=this.removeSubview(t,{destroy:!0}),n=0,r=o.length;r>n;n++)e=o[n],e.remove();return $(".tipsy").remove(),this.updateCount()}},n.prototype.sourceCountString=function(t){return t>0?"(following "+t+" source"+(t>1?"s":"")+")":""},n.prototype.updateCount=function(){var t;return t=this.collection.filter(function(t){return function(e){return e.get("type").indexOf(t.type)>=0}}(this)).length,this.active=t>0,this.$(".count").text(this.sourceCountString(t)),this.active||this.$el.removeClass("open"),this.$el.toggleClass("active",this.active)},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Settings.SourceList=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="sources",n.prototype.tagName="ul",n.prototype.collectionEvents={add:"addSource",remove:"removeSource","add remove":"updateCount",reset:"render"},n.prototype.events={"click .source-group.active .expand-link":"toggleGroup","click .source-group.static .expand-link":"toggleGroup","click #flow-email .expand-link, #flow-api-token .expand-link":"selectDetail"},n.renderGroups=[{type:"feed",label:"RSS feeds"},{type:"twitter",label:"Twitter follows"},{type:"trello",label:"Trello boards"},{type:"github",label:"GitHub repositories"}],n.prototype.initialize=function(){return this.collection.fetch()},n.prototype.render=function(){var t,e,r,o,i,s,a,l,u,c,p;for(p=this.model.get("email").split("@"),o=p[0],t=p[1],this.$el.html(HoganTemplates["owl/templates/settings/source_list"].render({inboxEmail:this.model.email(),mailLocal:o,mailDomain:t,apiToken:this.model.get("api_token"),sources:function(){var t;
t=[];for(l in Collections.Sources.names)t.push({name:this.collection.nameFor(l),helpLink:Collections.Sources.helpPath(l)});return t}.call(this)})),r=this.collection.groupBy(function(t){return t.get("type").split("_")[0]}),a=this.$("ol#static-sources"),s=_.clone(n.renderGroups),["rally-software","ghx","inthinc","arenanet"].indexOf(this.model.get("organization").parameterized_name)>=0&&s.push({type:"rally",label:"Rally projects"}),u=0,c=s.length;c>u;u++)i=s[u],e=new Views.Settings.SourceGroup({collection:this.collection,type:i.type,label:i.label}),a.append(e.render().el);return a.append(this.$("li.source-group.feed, li.source-group.twitter,li.source-group.trello, li.source-group.github,li.source-group.rally")),this},n.prototype.toggleGroup=function(t){var e,n;return e=$(t.target).closest(".source-group"),n=e.find(".arrow"),e.hasClass("open")?(n.toggleClass("icon-arrow-down-4 icon-arrow-right-4"),e.removeClass("open")):(n.toggleClass("icon-arrow-down-4 icon-arrow-right-4"),e.addClass("open"))},n.prototype.selectDetail=function(t){var e,n;
return t.preventDefault(),n=$(t.target),e=n.is(".light")?n:n.children(".light"),Helpers.selectText(e[0])},n}(Flowdock.HierarchicalView)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Views.Settings.UserAutocompleter=function(n){function i(){return this.filterModels=e(this.filterModels,this),i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.initialize=function(t){return i.__super__.initialize.apply(this,arguments),this.disallowNewTokens=t.disallowNewTokens,this.excludes=[]},i.prototype.splitQuery=function(t){return t.split(/[\s,?|\s<|>,]/)},i.prototype.refreshQuery=function(t){var e;return null==t&&(t=""),this.query=t.trim(),/\s/.test(this.query)?(e=this.splitQuery(this.query).filter(function(t){return function(e){return t.validQuery(e)
}}(this)),e.length&&this.trigger("chosen",e),this.refreshQuery("")):this.render()},i.prototype.validQuery=function(e){return this.disallowNewTokens?!1:e&&t(e)&&o.call(this.excludes,e)<0},i.prototype.destroy=function(){return this.excludes=[],this.collection.cleanup(),delete this.collection,i.__super__.destroy.call(this)},i.prototype.renderOption=function(t){return $("<li>").addClass("option").data("token",t.get("email")).html(HoganTemplates["owl/templates/settings/user_autocomplete_option"].render(t.toJSON()))},i.prototype.chooseSelection=function(){var t;return this.selection.length?(t=this.selection.data("token"),this.trigger("chosen",t),this.refreshQuery("")):void 0},i.prototype.chooseQuery=function(){return this.validToken()&&this.addableToken(this.query)?(this.trigger("chosen",this.query),this.refreshQuery("")):void 0},i.prototype.excludeTokens=function(){return this.excludes},i.prototype.filterModels=function(){var t;return t=this.excludeTokens(),this.collection.startingWith(this.query).filter(function(e){var n;
return n=e.get("email"),o.call(t,n)<0})},i.prototype.validToken=function(){return t(this.query)},i.prototype.addableToken=function(){return!this.disallowNewTokens},i.prototype.renderError=function(){return this.disallowNewTokens?i.__super__.renderError.call(this,"Not allowed to invite new users"):i.__super__.renderError.call(this,"No matches \u2013 type an email address to send a new invitation")},i.prototype.completionKey=function(t){var e;return t.preventDefault(),9!==(e=t.which)&&13!==e&&32!==e&&188!==e||(this.choose(),13!==t.which)?void 0:t.stopImmediatePropagation()},i.prototype.render=function(){var t;return i.__super__.render.apply(this,arguments),this.$el.css("max-height",this.$el.closest(".overlay-tab-content").height()-(null!=(t=this.$el.closest("fieldset").position())?t.top:void 0)),this},i}(Views.Shared.ScrollingAutocompleter),t=function(t){return/.@./.test(t)}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
};Views.Chat.Invitation=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="user invitation clearfix tipsy-tooltip",n.prototype.render=function(){return this.$el.html(HoganTemplates["owl/templates/users/invitation"].render({email:this.model.get("email")})),this.$el.find(".avatar").css("background-image","url("+Presenters.Helper.avatarFromEmail(this.model.get("email"),72)+")"),this},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.Invitations=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="ul",n.prototype.className="invite-list",n.prototype.collectionEvents={add:"addInvite",remove:"removeInvite",reset:"render"},n.prototype.reset=function(){var t,e,n,r;for(r=this.subviews,e=0,n=r.length;n>e;e++)t=r[e],null!=(null!=t?t.model:void 0)&&this.removeSubview(t);
return this.$el.empty()},n.prototype.render=function(){return this.reset(),this.$el.append(this.collection.map(function(t){return function(e){return t.renderOne(e).$el}}(this))),this.$el.html(),this},n.prototype.renderOne=function(t){var e;return e=this.subview(new Views.Chat.Invitation({model:t})),e.render()},n.prototype.addInvite=function(t){return this.$el.append(this.renderOne(t).$el)},n.prototype.removeInvite=function(t){return this.removeSubview(t)},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.User=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.ACTIVITY_EVENTS=["last_activity","last_ping","presence"],n.prototype.tagName="li",n.prototype.className="user clearfix tipsy-tooltip",n.prototype.modelEvents={change:"onChange"},n.prototype.initialize=function(t){this.options=t
},n.prototype.onChange=function(){var t;return t=_.keys(this.model.changedAttributes()),_.all(t,function(t){return-1!==n.ACTIVITY_EVENTS.indexOf(t)})?_.isEqual(t,["last_ping"])?void 0:this.setPresenceClass():_.all(t,function(t){return"status"===t})?this.setStatus():this.renderData()},n.prototype.setPresenceClass=function(){return this.$el.removeClass("active offline idle").addClass(this.model.get("presence"))},n.prototype.renderData=function(){var t;return this.setPresenceClass(),this.setStatus(),this.$(".mail").attr({href:"mailto:"+this.model.get("email"),title:this.model.get("email")}),this.$(".user-name").attr({title:this.model.get("name")}).text(""+this.model.get("nick")+" ("+this.model.get("name")+")"),t=this.model.avatar(72)||"",t?this.$(".user-avatar").css("background-image","url("+t+")"):void 0},n.prototype.setStatus=function(){return this.$el.attr("title",this.model.get("status")?""+this.model.nick()+': "'+this.model.get("status")+'"':this.model.nick())},n.prototype.render=function(){var t,e;return t=this.subview(new Views.Shared.Avatar({model:this.model,size:72,className:"user-avatar",avatarOnly:this.options.avatarOnly})),this.$el.html(t.$el),this.options.avatarOnly||(e=0===this.model.get("last_activity")?"never":Helpers.TimeHelper.timestamp(this.model.get("last_activity"),{relative:!0}),this.$el.append(HoganTemplates["owl/templates/users/user"].render({idle:e,privateUrl:Helpers.urlFor({"private":this.model}),linkToPrivate:this.model.get("id")!==Flowdock.app.user.id}))),this.renderData(),this
},n}(Flowdock.HierarchicalView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Views.Chat.UserCard=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="user-card",n.prototype.events={"click .user-card-wrapper":"preventClose","click .private-chat-link":"openPrivate",mouseleave:"delayedRemove",mouseenter:"cancelRemove"},n.prototype.modelEvents={change:"render"},n.prototype.initialize=function(t){return this.timeout=null,this.me=t.me,_.defer(function(t){return function(){return $(window).asEventStream("blur click").takeUntil(t.asEventStream("destructor")).onValue(function(){return t.destructor()})}}(this))},n.prototype.render=function(t){return this.$el.html(HoganTemplates["owl/templates/users/user_card"].render(this.model.toJSON())),0===this.model.get("last_activity")?this.$("time.activity").text("never"):this.$("time.activity").replaceWith(Helpers.TimeHelper.render(this.model.get("last_activity"),{relative:!0,classes:"activity"})),this.me===this.model&&this.$(".private-chat-link").hide(),(null!=t?t.alignTop:void 0)&&this.$el.addClass("align-top"),null==this.timeout&&this.delayedRemove(),this
},n.prototype.destructor=function(){return this.cancelRemove(),this.me=null,n.__super__.destructor.call(this,{removeDomElement:!0})},n.prototype.delayedRemove=function(){return this.cancelRemove(),this.timeout=setTimeout(function(t){return function(){return t.destructor()}}(this),2e3)},n.prototype.cancelRemove=function(){return clearTimeout(this.timeout)},n.prototype.preventClose=function(t){return t.stopPropagation()},n.prototype.openPrivate=function(){return this.model.canChatWith(this.me)?(Flowdock.app.router.navigateTo({"private":this.model}),this.destructor()):void 0},n}(Flowdock.HierarchicalView)}.call(this),function(){Presenters.Attachment=function(){function t(t){this.content=Helpers.FileHelper.parseAttachment(t)}return t.prototype.dimensions=function(){return this.isImage()?""+this.content.image.width+"x"+this.content.image.height:void 0},t.prototype.size=function(){return this.content.file.size},t.prototype.name=function(){return this.content.file.name},t.prototype.meta=function(){var t;return t=[{text:this.name()},{text:this.size()}],this.isImage()&&t.push({text:"("+this.dimensions()+")"}),t
},t.prototype.type=function(){return this.content.file.type},t.prototype.path=function(){return this.content.file.path},t.prototype.thumbnail=function(){return this.content.thumbnail?Presenters.Helper.renderTemplate("shared/thumbnail",{attachment:this.content},{details:"shared/file_details"}):void 0},t.prototype.info=function(){return Presenters.Helper.renderTemplate("shared/file_info",{attachment:this.content},{details:"shared/file_details"})},t.prototype.rotatedPath=function(){var t;return null!=(t=this.content.rotated)?t.path:void 0},t.prototype.isImage=function(){return this.content.image},t}()}.call(this),function(){Presenters.ChatMessage=function(){function t(t,e,n){this.event=t,this.content=e,this.data=n}return t.SUPPORTED_EVENTS=["message","status","line","comment"],t.prototype.avatar=function(t){var e;return""+(null!=(e=this.data.user)?e.avatar:void 0)+t},t.prototype.icon=function(){},t.prototype.author=function(){return this.data.user?{name:this.data.user.nick}:void 0},t.prototype.excerpt=function(){var t;
return t=this.body(),null!=t?{html:t}:void 0},t.prototype.meta=function(){},t.prototype.action=function(){},t.prototype.htmlHeadline=function(){},t.prototype.headline=function(){},t.prototype.body=function(){return this.format(this.escape(this.summary()))},t.prototype.summary=function(){var t;return"message"===(t=this.event)||"line"===t?this.content:"status"===this.event?this.content||"cleared status":"comment"===this.event?this.content.text:"file"===this.event?"Uploaded a file: "+this.content.file_name:void 0},t.prototype.format=function(t){return Presenters.Helper.autoLink(Helpers.IndentationHelper.formatIndented(t),this.data)},t.prototype.escape=function(t){return $("<div>").text(t).html()},t}()}.call(this),function(){var t;Presenters.Helper=function(){function e(){}return e.avatarFromEmail=function(e,n){return null==n&&(n=100),null!=e?t(md5(e.toLowerCase()),n):void 0},e.avatarFromHash=function(e,n){return null==n&&(n=100),null!=e?t(e,n):void 0},e.renderTemplate=function(t,e,n){var r,o,i,s,a;null==n&&(n={}),i={};
for(o in e)r=e[o],r&&(i[o]=null!=r.html?r.html:null!=r.text?this.escape(r.text).replace(/\n/g,"<br/>"):r);for(s in n)a=n[s],n[s]=HoganTemplates["owl/presenters/templates/"+a];return HoganTemplates["owl/presenters/templates/"+t].render(i,n)},e.unsafeUnescapeHTML=function(t){return null==t&&(t=""),$("<div/>").html(t).text()},e.unsafeStripHTML=function(t){var e;return null==t&&(t=""),_.isString(t)?(e=$("<div>").html(t.replace(/<img /g,"<img src ")),e.find("br").replaceWith(" "),e.text()):void 0},e.stripExcessWhitespace=function(t){var e;return null!=t?"function"==typeof t.replace?"function"==typeof(e=t.replace(/\s+/g," ")).trim?e.trim():void 0:void 0:void 0},e.sliceExcerpt=function(t,e){return null==e&&(e=200),null!=(null!=t?t.trim:void 0)?Presenters.Helper.stripExcessWhitespace(t.trim().slice(0,e)):void 0},e.keyValuePairs=function(t){var e,n,r;return e=function(){var e;e=[];for(n in t)r=t[n],n&&r?e.push({key:n,value:Presenters.Helper.escape(r).replace(/\n/g,"<br/>")}):e.push(void 0);return e}(),_.compact(e)},e.escape=function(t){return $("<div/>").text(t).html()
},e.autoLink=function(t,e){var n,r;return null==e&&(e={}),_.isString(t)?(n=["@all","@anybody","@anyone","@everybody","@everyone"],r=(e.users||[]).map(function(t){return"@"+t.nick}),Helpers.autoLink(t,{hashtagClass:"tag",hashtagUrlBase:""+Helpers.absoluteUrlFor({flow:e.flowPath})+"/filter/all?tags=",userTags:r.concat(n)})):void 0},e.restifyFilepaths=function(t){var e;return e=t.replace(/<img src="\/files\/([^"]*)/gm,function(t,e){return'<img src="/rest/files/'+e})},e.capitalize=function(t){return t.split(" ").map(function(){return function(t){return capitalizeFirst(t)}}(this)).join(" ")},e.capitalizeFirst=function(t){var e;return t||(t=""),""+((null!=(e=t[0])?e.toUpperCase():void 0)||"")+t.slice(1)},e}(),t=function(t,e){return null==e&&(e=null),Helpers.assetPath("/avatars/"+t+"/"+e)}}.call(this),function(){Presenters.InboxMessage=function(){function t(t,e){this.event=t,this.content=e}return t.prototype.meta=function(){return[]},t.prototype.actions=function(){return[]},t.prototype.author=function(){},t.prototype.avatar=function(t){var e,n;
return e=null!=(n=this.author())?n.email:void 0,null==t&&(t=100),Presenters.Helper.avatarFromEmail(e,t)},t.prototype.classNameFor=function(t){var e;return e={"integration-comment":"comment-from-integration"},e[t]||""},t.prototype.linkTitle=function(){return"Open in "+Helpers.capitalizeFirst(this.event)},t}()}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};window.Presenters.TeamInbox=window.Presenters.TeamInbox||{},window.Presenters.createPresenter=function(e,n,r){var o,i;return null==r&&(r=null),i={pivotaltracker:Presenters.TeamInbox.PivotalTracker,mail:Presenters.TeamInbox.Mail,rss:Presenters.TeamInbox.Rss,jira:Presenters.TeamInbox.Jira,confluence:Presenters.TeamInbox.Confluence,twitter:Presenters.TeamInbox.Twitter,zendesk:Presenters.TeamInbox.Zendesk,uservoice:Presenters.TeamInbox.UserVoice,vcs:Presenters.TeamInbox.Git,mercurial:Presenters.TeamInbox.Mercurial,hg:Presenters.TeamInbox.Mercurial,svn:Presenters.TeamInbox.Subversion,kiln:Presenters.TeamInbox.Kiln,agilezen:Presenters.TeamInbox.Agilezen,scout:Presenters.TeamInbox.Scout,action:Presenters.ChatMessage.Action,file:Presenters.ChatMessage.File,"user-edit":Presenters.ChatMessage.UserEdit,trello:Presenters.TeamInbox.Trello,rally:Presenters.TeamInbox.Rally,newrelic:Presenters.TeamInbox.Newrelic},t.call(Presenters.ChatMessage.SUPPORTED_EVENTS,e)>=0?new Presenters.ChatMessage(e,n,r):(o=i[e],o?new o(e,n,r):void 0)
}}.call(this),function(){var t,e,n,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t="https://beta.agilezen.com",Presenters.TeamInbox.Agilezen=function(r){function s(){return s.__super__.constructor.apply(this,arguments)}var a,l;return o(s,r),a=["cardMovedUp","cardMovedForward","cardCreated","cardRemoved","archived","tagAdded","tagRemoved","flag","people"],l=["noteCreated"],s.prototype.icon=function(){return Flowdock.icons.agilezen},s.prototype.link=function(){var t,e;return(e=this.content.link)||(e=this.projectLink(),(t=this.cardId())&&(e+="/card/"+t)),e},s.prototype.author=function(){var t,e;return{name:null!=(t=this.content.result)?null!=(e=t.user)?e.name:void 0:void 0}},s.prototype.headline=function(){return e(this.summaryWithMarkup().replace(/\*[\w\s]+\*\s/,""))},s.prototype.meta=function(){return[{link:this.projectLink(),text:this.projectName()}]
},s.prototype.summary=function(){return e(this.summaryWithMarkup())},s.prototype.body=function(){var t,n;return n=this.content.result.action,t=i.call(l,n)>=0?e(this.document().text):"",Presenters.Helper.renderTemplate("bodyWithProperties",{body:{text:t},propertyList:Presenters.Helper.keyValuePairs(this.cardProperties())},{propertyList:"shared/propertyList"})},s.prototype.action=function(){},s.prototype.avatar=function(){var t,e;return null!=(t=this.content.result)?null!=(e=t.user)?e.avatar:void 0:void 0},s.prototype.excerpt=function(){var t;return t=this.content.result.action,i.call(a,t)>=0?e(this.document().text):n(this.content.result.details)},s.prototype.summaryWithMarkup=function(){var t,e,r,o;return e=(null!=(r=this.content.result)?r.summary:void 0)||"",t=null!=(o=this.content.result)?o.action:void 0,"flag"===t?e=e.replace(/(a flag|the flag)/,"the '"+n(this.content.result.details)+"' flag"):"people"===t&&(e+=": "+this.content.result.details),e.replace(/\* [a-z]{1}/,function(t){return t.toUpperCase()}).trim()
},s.prototype.cardId=function(){var t;return null!=(t=this.content.result)?t.card:void 0},s.prototype.projectName=function(){var t;return null!=(t=this.content.project)?t.name:void 0},s.prototype.projectLink=function(){var e;return this.content.projectUrl||""+t+"/#!/projects/"+(null!=(e=this.content.project)?e._id:void 0)},s.prototype.document=function(){var t;return _.toArray(null!=(t=this.content.result)?t.documents:void 0)[0]||{}},s.prototype.metadataDocument=function(t){var e,n;return _.toArray(null!=(e=this.content.result)?null!=(n=e.metadata)?n[t]:void 0:void 0)[0]||{}},s.prototype.tags=function(t){return t||(t=[]),t.map(function(t){return function(e){var n;return null!=(n=_.find(t.content.project.tags,function(t){return t._id===e}))?n.name:void 0}}(this))},s.prototype.flag=function(t){var e;return null!=(e=_.find(this.content.project.flags,function(e){return e._id===t}))?e.name:void 0},s.prototype.cardProperties=function(){var t;return t=this.document(),"Card"!==t.resultType&&(t=this.metadataDocument("Card")),{Description:t.text,Number:t.number,Color:t.color,Tags:this.tags(t.tags).join(", "),Flag:this.flag(t.flag)}
},s}(Presenters.InboxMessage),e=function(t){return(t||"").replace(/[\*_]/g,"")},n=function(t){return e((t||"").replace(/_[^_]+_:\s?/g,""))}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.Confluence=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.icon=function(){return Flowdock.icons.confluence},n.prototype.author=function(){var t,e,n;return t=null!=(e=this.content)?e.user_email:void 0,{name:null!=(n=this.content)?n.user_name:void 0,link:"mailto:"+t,email:t}},n.prototype.action=function(){var t;return t=this.content.event,"comment_create"===t?"commented wiki page":""+t+"d wiki page"},n.prototype.headline=function(){return this.content.page_title},n.prototype.link=function(){return this.content.page_url},n.prototype.meta=function(){var t;return t=[{text:this.content.space_name,link:this.content.space_url}],this.isComment()&&t.push({text:this.content.page_title,link:this.content.page_url}),t
},n.prototype.summary=function(){var t;return t=""+this.action()+' wiki page "'+this.content.page_title+'"',this.isComment()?""+t+": "+this.content.comment_content_summary:t},n.prototype.body=function(){var t,e;return t=(e=this.htmlBody())?{html:e}:{text:this.textBody()},Presenters.Helper.renderTemplate("confluence",{body:t,diff:this.content.diff})},n.prototype.additionalClasses=function(){return this.isComment()?this.classNameFor("integration-comment"):void 0},n.prototype.excerpt=function(){var t;return t=this.textBody(),Presenters.Helper.sliceExcerpt(t)},n.prototype.htmlBody=function(){return this.isComment()?this.content.comment_content_summary_html:void 0},n.prototype.textBody=function(){return this.isComment()?this.content.comment_content_summary:this.content.version_comment},n.prototype.isComment=function(){return"comment_create"===this.content.event},n}(Presenters.InboxMessage)}.call(this),function(){var t,e,n,r,o,i,s,a,l,u,c,p,h,d,f,m,g,y,v,w,b,k,x,T,C,P,S,E,F=function(t,e){return function(){return t.apply(e,arguments)
}},R={}.hasOwnProperty,N=function(t,e){function n(){this.constructor=t}for(var r in e)R.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Presenters.TeamInbox.Git=function(e){function o(t,e,n){this.event=t,this.content=e,null==n&&(n={}),this.actions=F(this.actions,this),this.commitCount=n.commitCount||3,this.renderedContent=T(this.content)}return N(o,e),o.prototype.icon=function(){return Flowdock.icons.git},o.prototype.avatar=function(t){var e,n;return null==t&&(t=100),(null!=(e=this.author())?e.email:void 0)?Presenters.Helper.avatarFromEmail(this.author().email,t):(null!=(n=this.author())?n.gravatarId:void 0)?Presenters.Helper.avatarFromHash(this.author().gravatarId,t):void 0},o.prototype.link=function(){var t,e;return t=this.renderedContent.link||(null!=(e=this.branch())?e.url:void 0),(null!=t?t.match(/^https?/):void 0)?t:void 0},o.prototype.author=function(){return t(this.content)},o.prototype.action=function(){return this.renderedContent.action},o.prototype.headline=function(){return c(this.renderedContent.headline)
},o.prototype.summary=function(){return c(E(this.content))},o.prototype.body=function(){return c("edited"===this.renderedContent.action?this.renderPages():n(this.content)||r(this.content)?null:this.hasCommits()?this.renderCommits():Presenters.Helper.renderTemplate("body",{body:this.renderedContent.body}))},o.prototype.renderPages=function(){return Presenters.Helper.renderTemplate("github/pages",{pages:this.renderedContent.pages})},o.prototype.renderCommits=function(t){var e,n;return n=this.renderedContent.commits.map(function(t){return function(e){return b(e,t.content.before)}}(this)).reverse(),e=n.length,t&&e-t>0&&(n=n.slice(0,t)),Presenters.Helper.renderTemplate("github/commits",{commits:n,forced:this.renderedContent.forced},{commit:"github/commit",commit_summary:"github/commit_summary"})},o.prototype.additionalClasses=function(){return this.content.comment?this.classNameFor("integration-comment"):void 0},o.prototype.excerpt=function(){var t;return this.hasCommits()?{html:c(this.renderCommits(this.commitCount))}:(t=Presenters.Helper.unsafeStripHTML(this.body()),c(Presenters.Helper.sliceExcerpt(t)))
},o.prototype.meta=function(){var t,e,n,r;return r=this.repository(),t=this.branch(),e=[{text:r.name,link:r.url}],(null!=t?t.name:void 0)&&e.push({text:t.name,link:t.url}),h(this.content)&&e.unshift({text:"Forced update"}),n=y(this.content,this.commitCount),n>0&&e.unshift({text:""+n+" more commit"+(n>1?"s":"")}),e},o.prototype.actions=function(){var t;return t=[],r(this.content)?[]:(this.content.compare&&t.push({text:"diff",link:this.content.compare}),this.pullRequestPossible()&&t.push({text:"pull request",link:""+this.repository().url+"/compare/"+this.branch().name}),t)},o.prototype.events=function(){return{"click .commit-list .commit-details":this.toggleCommitSummary}},o.prototype.linkAndDescription=function(t,e){return 0===t.indexOf("view")?{text:t,link:e,className:t.split(" ")[0]}:{text:t,link:e}},o.prototype.pullRequestPossible=function(){var t,e;return t=this.content.ref,(null!=(e=this.repository().url)?e.match(/^https?:\/\/github.com/):void 0)&&t&&"refs/heads/master"!==t&&!this.tag()&&!r(this.content)},o.prototype.linkTitle=function(){return"vcs"===this.event&&String(this.link()).indexOf("github.com")>=0?"Open in GitHub":"Open original"
},o.prototype.repository=function(){return P(this.content)},o.prototype.branch=function(){return this.renderedContent.branch},o.prototype.tag=function(){return this.renderedContent.tag},o.prototype.gitEvent=function(){return f(this.content)},o.prototype.commits=function(){return this.renderedContent.commits},o.prototype.pages=function(){return this.renderedContent.pages},o.prototype.issue=function(){return this.renderedContent.issue},o.prototype.pullRequest=function(){return this.renderedContent.pullRequest},o.prototype.hasCommits=function(){return(null!=this.renderedContent.commits)>0},o.prototype.toggleCommitSummary=function(t){var e;if(!$(t.target).is("a"))return e=$(t.target).closest(".commit"),$(e).toggleClass("toggled"),$(e).find(".details").toggleClass("show")},o}(Presenters.InboxMessage),b=function(t,e){var n,r,o,i;return n=$.extend(!0,{},t),n.id=null!=(o=n.id)?o.slice(0,7):void 0,n.before=null!=e?e.slice(0,7):void 0,n.author.avatar=Presenters.Helper.avatarFromEmail(n.author.email,20),["added","modified","removed"].forEach(function(t){var e;
return n.changes[t]=function(){var r,o,i,s;for(i=n.changes[t],s=[],r=0,o=i.length;o>r;r++)e=i[r],s.push(p(e,n,t));return s}()}),r=null!=(i=c(n.message))?i.split("\n\n"):void 0,r.length>1&&(n.message=r[0],n.furthermore=r[1]),n},c=function(t){return null!=t?emojimoji(t):t},p=function(t,e,n){var r,o;return o={file:t},e.url&&(r=e.url.split("/commit/")[0],o.link="removed"!==n?""+r+"/blob/"+e.id+"/"+t:""+r+"/blob/"+e.before+"/"+t),o},T=function(t){var e;return e=t.event||f(t),C[e](t)},u=function(t){return null==t.commits?[]:t.commits.map(function(t){return{author:t.author,url:t.url||t.link,id:t.id||t.sha,message:t.message,changes:{added:t.added||[],removed:t.removed||[],modified:t.modified||[]}}})},y=function(t,e){var n,r;return n=null!=(r=t.commits)?r.length:void 0,_.isNumber(n)?Math.max(n-e,0):0},w=function(t){return null==t.pages?[]:t.pages.map(function(t){return{title:t.title,url:t.html_url,summary:t.summary,action:t.action}})},h=function(t){return t.forced&&"push"===t.event&&!t.created&&!t.deleted&&"tag"!==t.refType
},m=function(t){return t?t.replace("//api.github.com/repos","//github.com"):void 0},x=function(t){var e;return"tags"===(null!=(e=t.ref)?e.split("/")[1]:void 0)?"tag":"branch"},e=function(t){var e;return null!=(e=t.ref)?e.split("/").slice(2).join("/"):void 0},o=function(t){var n,r,o,i,s;return i=function(t){return 1===t?"a commit":""+t+" commits"},r=e(t)?e(t)+" ":"",n={headline:Number(null!=(s=t.commits)?s.length:void 0)>0?""+r+"with "+i(t.commits.length):e(t)||"",forced:h(t)},o=t.repository.url&&0===t.repository.url.indexOf("https://github.com")?t.repository.url+"/tree/"+e(t):t.repository.url,n[x(t)]={name:e(t),url:o},n},i=function(t){var o,i;return r(t)?"Deleted "+x(t)+" "+e(t):n(t)?"Created "+x(t)+" "+e(t):(o=e(t)?" "+e(t):"",i=""+x(t)+o+" at "+t.repository.name+" updated",h(t)&&(i+=" (forced)"),i)},P=function(t){return null!=t.repository?{name:t.repository.name,url:m(t.repository.url)}:void 0},t=function(t){var e,n;return(e=t.sender||t.pusher||(null!=(n=_.last(t.commits))?n.author:void 0))?{name:e.login||e.name,email:e.email,link:e.email?"mailto:"+e.email:"https://github.com/"+e.login,gravatarId:e.gravatar_id}:void 0
},l=function(t){var e;return null!=(null!=(e=t.issue.pull_request)?e.html_url:void 0)?"Pull request":"Issue"},a=function(t){var e,n;return e=C[t.event||f(t)](t).body,e=e.html?Presenters.Helper.unsafeStripHTML(e.html):e.text,n=t.issue?""+l(t)+" # "+t.issue.number+": "+t.issue.title:"Commit "+t.comment.commit_id.substr(0,10),""+n+" in "+t.repository.name+" commented by "+t.sender.login+':\n"'+(null!=e?"function"==typeof e.trim?e.trim():void 0:void 0)+'"'},f=function(t){return t.commits?"push":t.comment&&t.comment.commit_id?"commit_comment":t.comment?"issue_comment":t.pages?"gollum":t.pull_request?"pull_request":t.issue?"issues":"push"},v=function(t){var e,n;return n=t.pages.map(function(t){return t.title}),e=_.first(n,t.pages.length-1).join(", ")+(" & "+_.last(n)),{action:"edited wiki pages",headline:e,summary:"Edited wiki pages "+e,pages:w(t),link:m(t.repository.url+"/wiki/_pages")}},S=function(t){var e;return e=t.pages[0],{action:e.action+" wiki page",headline:e.title,summary:String.capitalize(e.action)+" wiki page "+e.title,pages:w(t),link:e.html_url}
},r=function(t){return t.deleted},n=function(t){var e;return t.created&&0===(null!=(e=t.commits)?e.length:void 0)},C={push:function(t){var e,i;return r(t)?(e="deleted",i=t.compare):n(t)?(e="created",i=t.compare):(e="updated",h(t)&&(e=""+e+" (forced)")),e+=" "+x(t),_.extend(o(t),{action:e,commits:u(t),link:i})},gollum:function(t){return(1===t.pages.length?S:v)(t)},pull_request:function(t){var e,n;return e="closed"===t.action&&t.pull_request.merged?"merged":t.action,n=t.pull_request,{action:e,link:n.html_url,headline:k(n),summary:""+String.capitalize(e)+" pull request "+n.number+" \u201c"+n.title+"\u201d",body:d(n),pullRequest:{title:n.title,number:n.number}}},issues:function(t){var e;return e=t.issue,{action:t.action,link:e.html_url,headline:g(e),body:d(e),issue:{title:e.title,number:e.number}}},commit_comment:function(t){return{action:"commented",link:t.comment.html_url,headline:"commit "+t.comment.commit_id.slice(0,7),body:d(t.comment)}},issue_comment:function(t){var e,n,r,o;return n=t.issue,r=null!=(null!=(o=n.pull_request)?o.html_url:void 0)?{title:n.title,number:n.number}:void 0,e=r?k(n):g(n),{action:"commented",link:m(t.issue.url),headline:e,body:d(t.comment),pullRequest:r}
}},C.pull_request_review_comment=C.commit_comment,d=function(t){return t.body_html?{html:t.body_html}:t.body?{text:t.body}:void 0},k=function(t){return"pull request #"+t.number+': "'+t.title+'"'},g=function(t){return"issue #"+t.number+': "'+t.title+'"'},s=function(t){var e;return e=t.body.indexOf("\n"),-1!==e?t.body.substring(0,e):t.body},E=function(t){var e;return t.commits?i(t):t.comment?a(t):(e=t.event||f(t),C[e](t).summary)}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.Jira=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.icon=function(){return Flowdock.icons.jira},n.prototype.author=function(){var t,e,n;return t=null!=(e=this.content)?e.user_email:void 0,{name:null!=(n=this.content)?n.user_name:void 0,link:"mailto:"+t,email:t}},n.prototype.action=function(){var t;return t=this.content.event_type,"start_work"===t?"started":t&&"unknown"!==t?"e"===t[t.length-1]?t+"d":t+"ed":"updated"
},n.prototype.headline=function(){return this.issueName()},n.prototype.linkTitle=function(){return"Open in JIRA"},n.prototype.link=function(){return this.content.issue_url},n.prototype.meta=function(){return[{text:this.content.project_name,link:this.content.project_url}]},n.prototype.summary=function(){var t;return t=""+this.action()+' "'+this.issueName()+'"',"comment"===this.content.event_type?""+t+": "+this.content.comment_body:t},n.prototype.body=function(){var t,e,n;return t=(e=this.htmlBody())?{html:e}:{text:this.textBody()},n=this.content.issue_changelog?void 0:Presenters.Helper.keyValuePairs(this.issueProperties()),Presenters.Helper.renderTemplate("jira",{changeLog:this.content.issue_changelog,body:t,propertyList:n},{changeLog:"shared/changeLog",propertyList:"shared/propertyList"})},n.prototype.additionalClasses=function(){return"comment"===this.content.event_type?this.classNameFor("integration-comment"):void 0},n.prototype.excerpt=function(){return Presenters.Helper.sliceExcerpt(this.textBody())},n.prototype.issueProperties=function(){return{Type:this.content.issue_type,Status:this.content.issue_status,Priority:this.content.issue_priority,Assignee:this.content.issue_assignee_name,Reporter:this.content.issue_reporter_name,Summary:this.content.issue_summary}
},n.prototype.htmlBody=function(){return null!=this.content.comment_body_html?this.content.comment_body_html:null!=this.content.issue_description_html?this.content.issue_description_html:void 0},n.prototype.textBody=function(){return null!=this.content.comment_body?this.content.comment_body:null!=this.content.issue_description?this.content.issue_description:""},n.prototype.issueName=function(){var t;return t=""+this.content.issue_key+" ("+this.content.issue_type+"): "+this.content.issue_summary,this.content.issue_resolution?t+(" as "+this.content.issue_resolution):t},n}(Presenters.InboxMessage)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Presenters.TeamInbox.Kiln=function(t){function n(t,r){this.content=r,n.__super__.constructor.call(this,t,e(this.content))}return r(n,t),n.prototype.icon=function(){return Flowdock.icons.kiln},n.prototype.linkTitle=function(){return"Open in Kiln"
},n}(Presenters.TeamInbox.Git),t=function(t){var e;return e=_.last(t.commits||[]),null!=e?e.branch:void 0},e=function(e){var n;return _.extend(e,{ref:"refs/head/"+t(e),commits:null!=(n=e.commits)?n.map(function(t){return _.extend(t,{added:[],modified:[],removed:[]})}):void 0})}}.call(this),function(){var t,e,n,r=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Presenters.TeamInbox.Mail=function(t){function o(t,e,n){this.event=t,this.content=e,this.data=n,this.actions=r(this.actions,this)}return i(o,t),o.prototype.icon=function(){return Flowdock.icons.mail},o.prototype.author=function(){var t,e,n,r,o;return t=null!=(e=this.content.from)?null!=(n=e[0])?n.address:void 0:void 0,{name:(null!=(r=this.content.from)?null!=(o=r[0])?o.name:void 0:void 0)||(null!=t?t.split("@")[0]:void 0),link:"mailto:"+t,email:t}},o.prototype.htmlHeadline=function(){return Presenters.Helper.escape(this.content.subject)
},o.prototype.headline=function(){return this.content.subject},o.prototype.summary=function(){return this.content.subject},o.prototype.body=function(){var t;return t=n(this.content.content),t&&0!==t.length?(t=Presenters.Helper.restifyFilepaths(t),t=Presenters.Helper.autoLink(t,this.data),Presenters.Helper.renderTemplate("mail",{headers:e(this.content),body:{html:t}})):void 0},o.prototype.meta=function(){var t;return t=[],this.content.source&&t.push({text:this.content.source}),this.content.project&&t.push({text:this.content.project}),t},o.prototype.action=function(){},o.prototype.actions=function(){var t,e;return[{text:"reply",link:Helpers.MailHelper.mailtoUrl(this.content,"reply",null!=(t=this.data)?t.sent:void 0)},{text:"forward",link:Helpers.MailHelper.mailtoUrl(this.content,"forward",null!=(e=this.data)?e.sent:void 0)}]},o.prototype.excerpt=function(){var t;return t=Presenters.Helper.unsafeStripHTML(n(this.content.content)),Presenters.Helper.sliceExcerpt(t)},o.prototype.linkTitle=function(){return this.content.source?"Open in "+this.content.source:"Open original"
},o.prototype.link=function(){return this.content.link},o}(Presenters.InboxMessage),n=function(t){return _.isArray(t)&&(t=t.filter(function(t){return _.isString(t)&&t.length>0}).join()),t},e=function(e){var n,r,o,i;return r=_.object(function(){var r,o,i,s;for(i=["from","to","cc","bcc","replyTo"],s=[],r=0,o=i.length;o>r;r++)n=i[r],e[n]&&s.push([n,_.compact(_.map(e[n],t))]);return s}()),null!=(null!=(o=r.replyTo)?o[0]:void 0)&&null!=(null!=(i=r.from)?i[0]:void 0)&&r.replyTo[0].address===r.from[0].address&&delete r.replyTo,r},t=function(t){return t?(t=_.extend({},t),t.name=t.name&&""!==t.name?""+t.name+" <"+t.address+">":t.address,t):void 0}}.call(this),function(){var t,e,n,r,o={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Presenters.TeamInbox.Mercurial=function(t){function e(t,n){this.content=n,e.__super__.constructor.call(this,t,r(this.content))}return i(e,t),e.prototype.icon=function(){return Flowdock.icons.mercurial
},e.prototype.linkTitle=function(){return"mercurial"===this.event?"Open in Bitbucket":"Open original"},e}(Presenters.TeamInbox.Git),t=function(t){return{email:(t.match(/<(.*)>/)||[])[1],name:t.match(/^([^<]*)/)[0].trim()}},e=function(t,e){var n;return null!=(n=t.files)?n.filter(function(t){return t.type.toString()===e.toString()}).map(function(t){return t.file}):void 0},n=function(t){var e;return e=_.last(t.commits||[]),(null!=e?e.branch:void 0)||""},r=function(r){var o;return _.extend(r,{ref:"refs/head/"+n(r),commits:null!=(o=r.commits)?o.map(function(n){return _.extend(n,{author:t(n.raw_author),url:n.link,id:n.raw_node,added:e(n,"added"),modified:e(n,"modified"),removed:e(n,"removed")})}):void 0})}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.Newrelic=function(t){function n(){return n.__super__.constructor.apply(this,arguments)
}return e(n,t),n.prototype.icon=function(){return Flowdock.icons.newrelic},n.prototype.linkTitle=function(){return"New Relic"},n.prototype.author=function(){return"deployment"===this._type()?{name:this._content().deployed_by}:void 0},n.prototype.headline=function(){var t;return t="deployment"===this._type()?this._content().application_name:null!=this._content().short_description?-1!==this._content().short_description.indexOf(this._content().message)?this._content().short_description:this._content().short_description+": "+this._content().message:this._content().application_name+": "+this._content().message,Presenters.Helper.unsafeUnescapeHTML(t)},n.prototype.link=function(){return this._content().alert_url},n.prototype.meta=function(){var t;return t=[{text:this._content().account_name}],_.each(["application_name","severity","version","revision"],function(e){return function(n){return null!=e._content()[n]?t.push({text:e._content()[n]}):void 0}}(this)),null!=this._content().servers&&(this._content().servers.length>1?t.push({text:""+this._content().servers.length+" servers"}):t.push({text:this._content().servers[0]})),t
},n.prototype.summary=function(){return this.action()?""+this.action()+" "+this.headline():this.headline()},n.prototype.body=function(){var t;return t="deployment"===this._type()?""+this._content().description+"\n\n"+this._content().changelog:(this._content().long_description||this._content().message).replace(/\-\-/g,"\n"),null!=this._content().servers&&(t="Servers: "+this._content().servers.join(", ")+"\n\n"+t),Presenters.Helper.renderTemplate("body",{body:{html:t.replace(/\n/g,"<br/>")}})},n.prototype.excerpt=function(){var t;return t=Presenters.Helper.unsafeStripHTML(this.body()),Presenters.Helper.sliceExcerpt(t)},n.prototype.action=function(){return"deployment"===this._type()?"deployed":void 0},n.prototype._type=function(){return this.content.alert?"alert":this.content.deployment?"deployment":void 0},n.prototype._content=function(){return this.content.alert||this.content.deployment},n}(Presenters.InboxMessage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);
return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Presenters.TeamInbox.PivotalTracker=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}var o,i,s,a,l,u,c,p,h,d,f,m,g;return e(r,t),m=["story_create","multi_story_edit","multi_story_delete","story_update","story_delete","story_move"],p=["move_into_project","move_from_project"],l=["add_story_label","remove_story_label"],c=["note_create"],r.prototype.icon=function(){return Flowdock.icons.pivotaltracker},r.prototype.link=function(){return null!=this.content.stories&&1===this.content.stories.length?this.storyUrl(this.content.stories[0]):void 0},r.prototype.projectUrl=function(){return"https://www.pivotaltracker.com/projects/"+this.content.project_id},r.prototype.storyUrl=function(t){return"https://www.pivotaltracker.com/story/show/"+t.id},r.prototype.storyName=function(){var t;return null!=this.content.stories&&1===this.content.stories.length?(t=this.content.description.match(/"(.*)" with comment[s]?: "(.*)"/),null!=t?t[1]:g(this.content,!0)):void 0
},r.prototype.author=function(){var t;return t=Flowdock.app.users.find(function(t){return function(e){return e.get("name").toLowerCase().trim()===t.content.author.toLowerCase().trim()}}(this)),{name:this.content.author,email:null!=t?t.get("email"):void 0}},r.prototype.action=function(){},r.prototype.isComment=function(){return null!=this.summary().match(/added comment[s]?/)||null!=this.summary().match(/^.* with comment[s]?/)},r.prototype.additionalClasses=function(){return this.isComment()?this.classNameFor("integration-comment"):void 0},r.prototype.headline=function(){var t,e;return t=this.summary(),e=t.match(/^.* with comment[s]?/),t=(null!=e?e[0]:void 0)||t,Presenters.Helper.capitalizeFirst(t)},r.prototype.summary=function(){var t,e,r;return r=this.content.event_type,n.call(l,r)>=0?a(this.content):null!=this.content.stories&&this.content.stories.length>1?i(this.content):(e=o(this.content),t=i(this.content),null!=t&&(e+=t),e)},r.prototype.meta=function(){var t,e;return e=this.storyName(),t=this.link(),e&&t?[{text:this.storyName(),link:this.link()}]:[]
},r.prototype.body=function(){return Presenters.Helper.renderTemplate("pivotaltracker",{body:s(this.content),stories:this.stories()},{story:"pivotaltracker/story",stories:"pivotaltracker/stories",propertyList:"shared/propertyList"})},r.prototype.excerpt=function(){var t,e;return t=Presenters.Helper.unsafeStripHTML(null!=(e=s(this.content))?e.text:void 0),Presenters.Helper.sliceExcerpt(t)},r.prototype.stories=function(){var t;return null!=(t=this.content.stories)?t.map(function(t){return function(e){return{name:e.name||t.storyUrl(e),url:t.storyUrl(e),description:e.description,propertyList:Presenters.Helper.keyValuePairs({Type:e.story_type,Estimate:e.estimate,Labels:e.labels,"Current state":e.current_state,"Owned by":e.owned_by,"Requested by":e.requested_by})}}}(this)):void 0},s=function(t){var e;return e=t.event_type,n.call(m,e)>=0?f(t):n.call(c,e)>=0?u(t):void 0},f=function(t){var e;return e=t.description.match(/"(.*)" with comment[s]?: "(.*)"/),null!=e?{text:e[2]}:void 0},u=function(t){var e;return e=t.stories[0].notes.sort(function(t,e){return e.id-t.id
}),{text:e[0].text}},a=function(t){var e,n;return n=t.description.match(/(added|removed) this label (to|from) (\d+) (story|stories)/),e=n[1],e+=" label "+t.label+" "+n[2]+" "+n[3]+" "+n[4]},o=function(t){var e,r,o,i,s,a;return"story_update"===t.event_type&&"unscheduled"===t.stories[0].current_state?"moved to icebox ":"story_update"===t.event_type&&"unstarted"===t.stories[0].current_state&&-1===t.description.indexOf("moved this story")?"moved to backlog ":("story_move"===(o=t.event_type)||"story_update"===o)&&t.description.indexOf("moved this story before ")>=0?"moved this story before ":("story_move"===(i=t.event_type)||"story_update"===i)&&t.description.indexOf("moved this story after ")>=0?"moved this story after ":("story_move"===(s=t.event_type)||"story_update"===s)&&t.description.indexOf("moved this story")>=0?"moved this story":(a=t.event_type,n.call(p,a)>=0?"":(e=t.description,r=-1===e.indexOf('"')?e.indexOf(":"):e.indexOf('"'),e=h(t.author,e.substring(0,r)),e.replace(/added comment\:[\s]*/,"added comment")))
},i=function(t){var e,r;return t.stories.length>1||(r=t.event_type,n.call(p,r)>=0)?h(t.author,t.description):(e=g(t))?d(e,t.description):void 0},d=function(t,e){var n,r;return r=_.max([e.lastIndexOf("'"),e.lastIndexOf('"')]),n=e.substring(r+1),null!=n?""+t+n:t},h=function(t,e){return e.substring(t.length+1)},g=function(t,e){var n;return n=t.description.match(/[\s]["'](.*)["']/),n&&!t.description.match(/added comment/)?e?n[1]:'"'+n[1]+'"':void 0},r.prototype.linkTitle=function(){return"Open in Pivotal Tracker"},r}(Presenters.InboxMessage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.RallyFields=Presenters.TeamInbox.RallyFields||{},Presenters.TeamInbox.Rally=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var r,o;return e(n,t),o=["object_type","subscription_id","Recycled","Name"],r=["CreationDate","InProgressDate","AcceptedDate"],n.prototype.author=function(){var t;
return t=this.content.transaction.user[0],{name:null!=t?t.username:void 0,link:this.detailUrl("user/"+(null!=t?t.uuid:void 0))}},n.prototype.icon=function(){},n.prototype.avatar=function(t){var e,n;return null==t&&(t=100),e=null!=(n=this.content.transaction.user[0])?n.email:void 0,Presenters.Helper.avatarFromEmail(e,t)},n.prototype.link=function(){var t,e;return t=null!=(e=this.findByName("object_type",this.content.state))?e.toLowerCase():void 0,null!=t?this.detailUrl(""+t+"/"+this.content.id):""},n.prototype.action=function(){return"Updated"===this.content.action?this.humanActionForUpdate():this.content.action},n.prototype.headline=function(){var t,e,n,r;return r=this.objectState(),e=this.splitCamelCase(this.findByName("object_type",r)),t=this.findByName("FormattedID",r)||"",n=this.findByName("Name",r),null!=n&&(e+=": "+t+" "+n),e},n.prototype.summary=function(){return""+this.action()+" "+this.headline()},n.prototype.excerpt=function(){var t;return"Updated"===this.content.action&&(t=this.updatedFields(),1===t.length)?""+t[0].key+" was changed to "+t[0].value:void 0
},n.prototype.body=function(){var t,e;switch(this.content.action){case"Created":return Presenters.Helper.renderTemplate("rally/create",{stateFields:this.stateFields(),description:this.findByName("Description",this.objectState())},{state:"rally/state"});case"Updated":return e=this.updatedFields(),e.length>1?Presenters.Helper.renderTemplate("rally/update_many_fields",{updatedFields:this.updatedFields({formatValue:!0}),stateFields:this.stateFields(),description:this.findByName("Description",this.objectState())},{state:"rally/state",updated:"rally/updated"}):1===e.length?(t=e[0],Presenters.Helper.renderTemplate("rally/update_one_field",{key:t.key,value:t.value,stateFields:this.stateFields()},{state:"rally/state"})):Presenters.Helper.renderTemplate("rally/create",{stateFields:this.stateFields(),description:this.findByName("Description",this.objectState())},{state:"rally/state"});case"Recycled":return Presenters.Helper.renderTemplate("rally/recycle",{updatedFields:this.updatedFields()},{updated:"rally/updated"})}},n.prototype.events=function(){return{"click .toggle-details":this.toggleDetails}
},n.prototype.toggleDetails=function(t){var e;return t.preventDefault(),e=$(t.target).closest("section"),e.find(".state").toggleClass("hidden")},n.prototype.objectState=function(){return this.content.state||this.content.changes},n.prototype.detailUrl=function(t){return""+this.content.url+"/#/detail/"+t},n.prototype.updatedFields=function(t){var e,n,r,o;r=this.content.changes,o=[];for(e in r)n=r[e],this.renderItem(n)&&o.push(this.formKeyValue(n,t));return o},n.prototype.stateFields=function(){var t,e,n;return t=function(){var t,r;t=this.content.state,r=[];for(e in t)n=t[e],this.renderItem(n)&&r.push(this.formKeyValue(n,{formatValue:!0}));return r}.call(this)},n.prototype.renderItem=function(t){return o.indexOf(t.name)<0&&"uuid"!==t.type},n.prototype.findByName=function(t,e){var n,r;for(n in e)if(r=e[n],r.name===t)return null!=r.value?r.value:r.old_value;return null},n.prototype.splitCamelCase=function(t){return t.replace(/([A-Z])/g," $1").trim()},n.prototype.formKeyValue=function(t,e){var n,r;return null==e&&(e={}),n=t.display_name,r=null!=t.value?t.value:t.old_value,_.isObject(r)&&(r=r._ref_name),e.formatValue&&(r=this.formatValue(t.name,r)),{key:n,value:r}
},n.prototype.formatValue=function(t,e){switch(r.indexOf(t)>=0&&(e=moment(e).format("LLL")),t){case"ScheduleState":return new Presenters.TeamInbox.RallyFields.ScheduleState(e).format();default:return e}},n.prototype.humanActionForUpdate=function(){var t,e;if(this.findByName("ScheduleState",this.content.changes)){if(e=this.findByName("ScheduleState",this.content.state),"Defined"===e||"Released"===e||"Accepted"===e||"Completed"===e)return e;if("In-Progress"===e)return"Started"}else if(this.findByName("Ready",this.content.changes)&&(t=this.findByName("Ready",this.content.state)))return"Finished";return this.content.action},n}(Presenters.InboxMessage)}.call(this),function(){Presenters.TeamInbox.RallyFields.ScheduleState=function(){function t(t){this.value=t}var e;return e=["Idea","Defined","In-Progress","Completed","Accepted","Released"],t.prototype.format=function(){var t;return e.indexOf(this.value)>=0?t=HoganTemplates["owl/presenters/templates/rally/fields/schedule_state"].render({value:this.value,states:[{ready:this.readyClass(this.idea())},{ready:this.readyClass(this.defined())},{ready:this.readyClass(this.inProgress())},{ready:this.readyClass(this.completed())},{ready:this.readyClass(this.accepted())},{ready:this.readyClass(this.released())}]}):this.value
},t.prototype.readyClass=function(t){return t?"ready":""},t.prototype.idea=function(){return e.indexOf(this.value)>=0},t.prototype.defined=function(){return e.indexOf(this.value)>=1},t.prototype.inProgress=function(){return e.indexOf(this.value)>=2},t.prototype.completed=function(){return e.indexOf(this.value)>=3},t.prototype.accepted=function(){return e.indexOf(this.value)>=4},t.prototype.released=function(){return e.indexOf(this.value)>=5},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.Rss=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.icon=function(){return Flowdock.icons.rss},n.prototype.linkTitle=function(){return"Open original"},n.prototype.link=function(){return this.content.link},n.prototype.author=function(){var t;return{name:null!=(t=this.content.feed)?t.title:void 0}
},n.prototype.headline=function(){return this.content.title},n.prototype.meta=function(){return this.content.author?[{text:"by "+this.content.author}]:[]},n.prototype.summary=function(){var t,e;return(null!=(t=this.content.feed)?t.title:void 0)?""+(null!=(e=this.content.feed)?e.title:void 0)+": "+this.headline():this.headline()},n.prototype.body=function(){return Presenters.Helper.renderTemplate("body",{body:{html:this.content.content}})},n.prototype.action=function(){},n.prototype.avatar=function(){},n.prototype.excerpt=function(){var t;return t=Presenters.Helper.unsafeStripHTML(this.body()),Presenters.Helper.sliceExcerpt(t)},n}(Presenters.InboxMessage)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Presenters.TeamInbox.Scout=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.icon=function(){return Flowdock.icons.scout
},r.prototype.author=function(){},r.prototype.action=function(){},r.prototype.headline=function(){var t;return"end"===(null!=(t=this.content.lifecycle)?t.toLowerCase():void 0)?"Back to normal: "+this.content.title:this.content.title},r.prototype.link=function(){return this.content.url},r.prototype.meta=function(){return[{text:this.content.server_name},{text:this.content.plugin_name}]},r.prototype.summary=function(){return this.headline()},r.prototype.body=function(){return Presenters.Helper.renderTemplate("bodyWithProperties",{body:{text:""},propertyList:Presenters.Helper.keyValuePairs(t(this.content))},{propertyList:"shared/propertyList"})},r.prototype.excerpt=function(){return Presenters.Helper.sliceExcerpt(Presenters.Helper.unsafeStripHTML(this.body()))},r}(Presenters.InboxMessage),t=function(t){return{Time:t.time,"Plugin name":t.plugin_name,Server:t.server_name,Lifecycle:t.lifecycle,"Metric name":t.metric_name,"Metric value":t.metric_value}}}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t
}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Presenters.TeamInbox.Subversion=function(t){function n(t,r){this.content=r,n.__super__.constructor.call(this,t,e(this.content))}return r(n,t),n.prototype.icon=function(){return Flowdock.icons.svn},n}(Presenters.TeamInbox.Git),t=function(t,e){var n,r;return null!=(n=t.changes)?null!=(r=n[e])?r.map(function(t){return t.path}):void 0:void 0},e=function(e){var n,r,o;return n=e.revision_url?e.revision_url.replace(/:revision/,e.revision):void 0,_.extend(e,{ref:"refs/head/"+(e.branch||"trunk"),sender:e.author,created:"branch_create"===e.action,deleted:"branch_delete"===e.action,commits:[{author:{name:e.author.name,email:e.author.email},url:n,id:e.revision,message:e.message,added:t(e,"added"),modified:t(e,"modified"),removed:t(e,"removed")}]}),(e.created||e.deleted)&&(e.compare=null!=(r=e.commits)?null!=(o=r[0])?o.url:void 0:void 0,e.commits=[]),e}}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t
}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Presenters.TeamInbox.Trello=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return n(o,e),o.actions={add:"added",comment:"commented",convert:"converted",copy:"copied",create:"added","delete":"deleted",move:"transferred",remove:"removed",update:"updated",make:"made",memberJoinedTrello:"joined Trello",unconfirmedBoardInvitation:"invited"},o.prototype.icon=function(){},o.prototype.link=function(){return this.attachmentUrl()||this.cardUrl()||this.boardUrl()},o.prototype.author=function(){return{name:this.authorName(),link:this.authorUrl()}},o.prototype.headline=function(){switch(this.content.action.type){case"addAttachmentToCard":return'an attachment to card "'+this.cardName()+'"';case"addChecklistToCard":return'checklist "'+this.checklistName()+'" to card "'+this.cardName()+'"';
case"addMemberToCard":return""+this.otherMemberName()+' to card "'+this.cardName()+'"';case"addLabelToCard":return'label "'+this.labelName()+'" to card "'+this.cardName()+'"';case"commentCard":return'card "'+this.cardName()+'"';case"createCard":return'card "'+this.cardName()+'" to "'+this.listName()+'"';case"convertToCardFromCheckItem":return"";case"copyCard":return this.cardName()===this.sourceCardName()?'card "'+this.cardName()+'" in "'+this.listName()+'"':'card "'+this.cardName()+'" from "'+this.sourceCardName()+'" in "'+this.listName()+'"';case"updateCard":return null!=this.actionData("old.pos")?'position of card "'+this.cardName()+'"':null!=this.actionData("old.idList")?'card "'+this.cardName()+'" from "'+this.actionData("listBefore.name")+'" to "'+this.actionData("listAfter.name")+'"':null!=this.actionData("old.name")?'card "'+this.actionData("old.name")+'" to "'+this.cardName()+'"':null!=this.actionData("old.desc")?'description of card "'+this.cardName()+'"':r.call(Object.keys(this.actionData("old")),"due")>=0?'due date of card "'+this.cardName()+'"':'card "'+this.cardName()+'"';
case"updateCheckItemStateOnCard":return"complete"===this.actionData("checkItem.state")?'"'+this.actionData("checkItem.name")+'" on card "'+this.cardName()+'"':'"'+this.actionData("checkItem.name")+'" uncomplete on card "'+this.cardName()+'"';case"updateChecklist":return'checklist "'+this.actionData("old.name")+'" to "'+this.checklistName()+'"';case"addMemberToBoard":return""+this.otherMemberName()+' to board "'+this.boardName()+'"';case"deleteCard":return"card #"+this.content.action.data.card.idShort+' from "'+this.listName()+'"';case"createList":return'list "'+this.listName()+'"';case"updateList":return null!=this.actionData("old.pos")&&'position of list "'+this.listName()+'"',null!=this.actionData("old.name")?'list "'+this.actionData("old.name")+'" to "'+this.listName()+'"':'list "'+this.listName()+'"';case"removeMemberFromBoard":return""+this.otherMemberName()+' from board "'+this.boardName()+'"';case"moveCardFromBoard":return'card "'+this.cardName()+'" from board "'+this.boardName()+'" to board "'+this.actionData("boardTarget.name")+'"';
case"moveListFromBoard":return'list "'+this.listName()+'" from board "'+this.boardName()+'" to board "'+this.actionData("boardTarget.name")+'"';case"moveCardToBoard":return'card "'+this.cardName()+'" from board "'+this.actionData("boardSource.name")+'" to board "'+this.boardName()+'"';case"moveListToBoard":return'list "'+this.listName()+'" from board "'+this.actionData("boardSource.name")+'" to board "'+this.boardName()+'"';case"unconfirmedBoardInvitation":return'someone to board "'+this.boardName()+'"';case"updateBoard":return null!=this.actionData("old.name")?'board "'+this.actionData("old.name")+'" to "'+this.boardName()+'"':null!=this.actionData("old.desc")?'description of board "'+this.boardName()+'"':null!=this.actionData("old.prefs.permissionLevel")?'visibility of board "'+this.boardName()+'"':null!=this.actionData("old.labelNames")?'label names of board "'+this.boardName()+'"':'board "'+this.boardName()+'"';default:return this.content.action.type+" MISSING"}},o.prototype.meta=function(){var t;return t=[],this.content.action.type.indexOf("Member")>=0&&t.push({text:this.otherMemberName(),link:this.otherMemberUrl()}),this.isActionType("addAttachmentToCard")&&t.push({text:this.cardName(),link:this.cardUrl()}),null!=this.boardUrl()&&t.push({text:this.boardName(),link:this.boardUrl()}),this.organizationUrl()&&t.push({text:this.organizationName(),link:this.organizationUrl()}),t
},o.prototype.summary=function(){return""+this.action()+" "+this.headline()+(null!=this.excerpt()?": "+this.excerpt():"")},o.prototype.body=function(){return this.isActionType("updateBoard")&&null!=this.actionData("board.desc_html")?this.actionData("board.desc_html"):this.isActionType("commentCard")&&null!=this.actionData("text_html")?this.actionData("text_html"):this.isActionType("updateCard")&&null!=this.actionData("card.desc_html")?this.actionData("card.desc_html"):this.isActionType("createCard")&&this.content.model.desc?this.content.model.desc:this.excerpt()},o.prototype.action=function(){var t,e,n;if(this.isActionType("updateCard")){if(null!=this.actionData("old.closed"))return this.actionData("card.closed")?"archived":"unarchived";if(null!=this.actionData("old.idList"))return"moved";if(null!=this.actionData("old.name"))return"renamed";if(null!=this.actionData("old.due")&&null==this.actionData("card.due"))return"removed";if(null!=this.actionData("old.desc")&&_.isString(this.actionData("card.desc"))&&0===this.actionData("card.desc").length)return"removed"
}if(this.isActionType("updateCheckItemStateOnCard"))return"complete"===this.actionData("checkItem.state")?"completed":"marked";if(this.isActionType("updateChecklist"))return"renamed";if(this.isActionType("updateBoard")){if(null!=this.actionData("old.name"))return"renamed";if(null!=this.actionData("old.desc")&&0===this.actionData("board.desc").length)return"removed"}if(this.isActionType("updateList")){if(null!=this.actionData("old.closed"))return this.actionData("list.closed")?"archived":"unarchived";if(null!=this.actionData("old.pos"))return"moved";if(null!=this.actionData("old.name"))return"renamed"}n=o.actions;for(e in n)if(t=n[e],this.isActionType(e))return t},o.prototype.avatar=function(){return null!=this.content.action.memberCreator.avatarHash?"https://trello-avatars.s3.amazonaws.com/"+this.content.action.memberCreator.avatarHash+"/170.png":Flowdock.icons.defaultAvatar},o.prototype.excerpt=function(){var e,n,o;switch(this.content.action.type){case"addAttachmentToCard":return"Uploaded "+this.attachmentName();
case"updateCard":if(null!=this.actionData("old.desc")&&_.isString(this.actionData("card.desc"))&&this.actionData("card.desc").length>0)return null!=this.actionData("card.desc_html")?Presenters.Helper.unsafeStripHTML(this.actionData("card.desc_html")):this.actionData("card.desc");if(r.call(Object.keys(this.actionData("old")),"due")>=0&&null==this.actionData("old.due"))return"Card is due on "+moment(this.actionData("card.due")).format("LLL");break;case"commentCard":return null!=this.actionData("text_html")?Presenters.Helper.unsafeStripHTML(this.actionData("text_html")):t(this.actionData("text"));case"updateBoard":if(null!=this.actionData("old.desc")){if((null!=(o=this.actionData("board.desc_html"))?o.length:void 0)>0)return Presenters.Helper.unsafeStripHTML(this.actionData("board.desc_html"));if(this.actionData("board.desc").length>0)return this.actionData("board.desc")}if(null!=this.actionData("old.prefs.permissionLevel"))return"Board is now "+this.boardVisibility();if(this.actionData("old.labelNames"))return t(function(){var t,r;
t=this.actionData("board.labelNames"),r=[];for(e in t)n=t[e],r.push(""+e+' label is now "'+n+'"');return r}.call(this).join(", "))}},o.prototype.additionalClasses=function(){return this.isComment()?this.classNameFor("integration-comment"):void 0},o.prototype.isComment=function(){return"commentCard"===this.content.action.type},o.prototype.isActionType=function(t){return 0===this.content.action.type.indexOf(t)},o.prototype.authorUrl=function(){return"https://trello.com/"+this.content.action.memberCreator.username},o.prototype.cardUrl=function(){return this.actionData("card.idShort")?"https://trello.com/card/"+this.content.model.id+"/"+this.actionData("card.idShort"):void 0},o.prototype.boardUrl=function(){return this.content.model.url},o.prototype.attachmentUrl=function(){return this.actionData("attachment.url")},o.prototype.otherMemberUrl=function(){return"https://trello.com/"+this.content.action.member.username},o.prototype.organizationUrl=function(){var t;return null!=(t=this.content.model.organization)?t.url:void 0
},o.prototype.authorName=function(){return this.content.action.memberCreator.fullName},o.prototype.boardName=function(){return this.content.model.name},o.prototype.organizationName=function(){var t;return null!=(t=this.content.model.organization)?t.displayName:void 0},o.prototype.otherMemberName=function(){return this.content.action.member.fullName},o.prototype.listName=function(){return this.actionData("list.name")},o.prototype.cardName=function(){return this.actionData("card.name")},o.prototype.labelName=function(){return this.actionData("text")||this.actionData("value")},o.prototype.sourceCardName=function(){return this.actionData("cardSource.name")},o.prototype.checklistName=function(){return this.actionData("checklist.name")},o.prototype.attachmentName=function(){return this.actionData("attachment.name")},o.prototype.actionData=function(t){var e,n,r,o,i;for(r=t.split("."),e=this.content.action.data,o=0,i=r.length;i>o;o++)n=r[o],e=null!=e?e[n]:void 0;return e},o.prototype.boardVisibility=function(){var t;switch(t=this.actionData("board.prefs.permissionLevel")){case"org":return"visible to organization";
case"private":return"private";case"public":return"public"}},o}(Presenters.InboxMessage),t=function(t){return t.substring(0,1).toUpperCase()+t.substring(1)}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Presenters.TeamInbox.Twitter=function(e){function r(){return this.actions=t(this.actions,this),r.__super__.constructor.apply(this,arguments)}var o,i,s,a,l,u;return n(r,e),r.prototype.icon=function(){return Flowdock.icons.twitter},r.prototype.author=function(){var t,e,n;return t=(null!=(n=this.retweet())?n.user:void 0)||this.content.user,e=l(t.screen_name),{name:t.name,link:e,partial:Presenters.Helper.renderTemplate("twitter/author",{author:t,profileLink:e})}},r.prototype.avatar=function(){var t;return(t=function(t){return t.replace(/_normal\./,"_reasonably_small.")})(this.retweet()?this.retweet().user.profile_image_url_https||this.retweet().user.profile_image_url:this.content.user.profile_image_url_https||this.content.user.profile_image_url)
},r.prototype.headline=function(){return this.tweetText()},r.prototype.htmlHeadline=function(){return""+this.author().partial+"<br> "+this.formatTweet()},r.prototype.summary=function(){var t,e;return e=this.author().name,t="tweeted:",this.retweet()&&(t="retweeted by "+this.content.user.name+":"),""+e+" "+t+" "+this.tweetText()},r.prototype.body=function(){var t,e,n;return e=null!=(n=this.entities())?n.media:void 0,null==e?null:(t=e.reduce(function(t,e){return"photo"===e.type&&(t=$(t).add($("<a>").attr("href",e.expanded_url).html($("<img>").attr({src:e.media_url_https,alt:"Twitter photo"})))),t},$()),t[0].outerHTML)},r.prototype.action=function(){},r.prototype.link=function(){return l(this.content.user.screen_name,this.content.id_str)},r.prototype.timestampLink=function(){return this.link()},r.prototype.meta=function(){var t,e,n,r;return t=[],n=this.content.in_reply_to_screen_name,e=this.content.in_reply_to_status_id_str,r=this.retweet(),n&&t.push({text:"in reply to @"+n,link:l(n,e)}),r&&t.push({text:"retweeted by "+this.content.user.name,link:l(this.content.user.screen_name)}),t
},r.prototype.actions=function(){return[{text:"reply",link:Helpers.TwitterHelper.intentReplyUrl(this.content.id_str)},{text:"retweet",link:Helpers.TwitterHelper.intentRetweetUrl(this.content.id_str)},{text:"favorite",link:Helpers.TwitterHelper.intentFavoriteUrl(this.content.id_str)}]},r.prototype.entities=function(){return this.retweet()?this.retweet().entities:this.content.entities},r.prototype.retweet=function(){return this.content.retweeted_status},r.prototype.tweetText=function(){var t,e;return t=(null!=(e=this.retweet())?e.text:void 0)||this.content.text,t.replace(/[<>]/g,function(t){var e;return e={"<":"&lt;",">":"&gt;"},e[t]})},r.prototype.formatTweet=function(){return this.entities()?this.applyEntities():this.tweetText()},r.prototype.applyEntities=function(){var t,e,n,r,o,i,s;for(n=function(t){return function(e){return t.entities()[e]||[]}}(this),r=this.tweetText(),t=n("urls").concat(n("hashtags"),n("user_mentions"),n("media")),t=t.sort(function(t,e){return(null!=t?t.indices[0]:void 0)-(null!=e?e.indices[0]:void 0)
}).reverse(),o=function(t){var e,n,o,i,s;return e=t.indices[0],s=t.indices[1],i=r.slice(0,e),n=r.slice(e,s),o=r.slice(s),r=""+i+a(n,t)+o},i=0,s=t.length;s>i;i++)e=t[i],o(e);return r},l=function(t,e){var n;return null==e&&(e=null),n="https://twitter.com/"+t,null!=e&&(n=""+n+"/status/"+e),n},a=function(t,e){return e.screen_name?u(e):e.url?i(e):e.text?o(e):void 0},s=function(t){return $("<div/>").text(t).html()},o=function(t){var e;return e=s(t.text),"<a href='https://twitter.com/search/?q="+encodeURIComponent("#"+e)+"'>#"+e+"</a>"},u=function(t){var e;return e=s(t.screen_name),"<a href='https://twitter.com/"+encodeURIComponent(e)+"'>@"+e+"</a>"},i=function(t){return"<a href='"+s(t.expanded_url)+"'>"+s(t.display_url)+"</a>"},r}(Presenters.InboxMessage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.TeamInbox.UserVoice=function(t){function n(t,e){this.content=e,this.item=a(this.content)
}var r,o,i,s,a,l;return e(n,t),n.prototype.icon=function(){return Flowdock.icons.uservoice},n.prototype.author=function(){return{name:this.item.user.name,email:this.item.user.email,link:"mailto:"+this.item.user.email}},n.prototype.action=function(){return this.item.action},n.prototype.headline=function(){return this.item.headline},n.prototype.summary=function(){var t,e;return t=this.item.action?""+this.item.action+" ":"",e=String.capitalize(""+t+this.item.headline),this.isComment()&&(e=""+e+': "'+this.item.message.text+'"'),e},n.prototype.body=function(){return Presenters.Helper.renderTemplate("body",{body:this.item.message})},n.prototype.isComment=function(){return"new_comment"===this.content.event},n.prototype.additionalClasses=function(){return this.isComment()?this.classNameFor("integration-comment"):void 0},n.prototype.linkTitle=function(){return"Open in UserVoice"},n.prototype.link=function(){return this.item.link},n.prototype.meta=function(){return[]},n.prototype.excerpt=function(){var t;return t=this.item.message.text||Presenters.Helper.unsafeStripHTML(this.item.message.html),Presenters.Helper.sliceExcerpt(t)
},a=function(t){var e;return e=t.event||"test",{user:l[e](t),action:r[e](t),headline:i[e](t),message:s[e]?s[e](t):{text:null},link:o(t)}},o=function(t){var e,n;return(n="new_ticket_reply"===t.event?"message":"suggestion_status_update"===t.event?"audit_status":t.event?t.event.split("_").slice(1).join("_"):void 0)?(e=t[n],"new_comment"===t.event||"suggestion_status_update"===t.event?e.suggestion.url:"new_kudo"===t.event?e.ticket.url:e&&e.url?e.url:void 0):void 0},l={new_suggestion:function(t){return t.suggestion.creator},new_comment:function(t){return t.comment.creator},new_article:function(t){return t.article.updated_by},new_forum:function(t){return t.forum.updated_by},new_kudo:function(t){return t.kudo.sender},new_ticket:function(t){return t.ticket.created_by},new_ticket_reply:function(t){return t.message.sender},suggestion_status_update:function(t){return t.audit_status.user},test:function(){return{name:"Test User",email:"no-reply@uservoice.com"}}},r={new_suggestion:function(){return"suggested"},new_comment:function(){return"commented suggestion"
},new_article:function(){return"created article"},new_forum:function(){return"created forum"},new_kudo:function(){return"received kudos for"},new_ticket:function(){return"created ticket"},new_ticket_reply:function(){return"replied to"},suggestion_status_update:function(t){var e;return(null!=(e=t.audit_status.final_status)?e.name:void 0)||t.audit_status.suggestion.state},test:function(){return""}},i={new_suggestion:function(t){return t.suggestion.title},new_comment:function(t){return t.comment.suggestion.title},new_article:function(t){return t.article.question},new_forum:function(t){return t.forum.name},new_kudo:function(t){return t.kudo.ticket.subject},new_ticket:function(t){return t.ticket.subject},new_ticket_reply:function(t){return t.ticket.subject},suggestion_status_update:function(t){return t.audit_status.suggestion.title},test:function(){return"Test message from UserVoice"}},s={new_suggestion:function(t){return{html:t.suggestion.formatted_text,text:t.suggestion.text||t.suggestion.title}},new_comment:function(t){return{html:t.comment.formatted_text,text:t.comment.text}
},new_article:function(t){return{html:t.article.answer_html}},new_forum:function(t){return{text:t.forum.welcome}},new_kudo:function(t){return{text:t.kudo.message.body}},new_ticket:function(t){var e,n,r,o;return{text:(null!=(e=t.ticket.notes)?null!=(n=e[0])?n.body:void 0:void 0)||(null!=(r=t.ticket.messages)?null!=(o=r[0])?o.body:void 0:void 0)}},new_ticket_reply:function(t){return{text:t.message.body}},suggestion_status_update:function(t){var e;return(null!=(e=t.audit_status.suggestion.response)?e.text:void 0)?{html:t.audit_status.suggestion.response.formatted_text,text:t.audit_status.suggestion.response.text}:{text:""}},test:function(){return{text:"Test message from UserVoice"}}},n}(Presenters.InboxMessage)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Presenters.TeamInbox.Zendesk=function(e){function r(){return r.__super__.constructor.apply(this,arguments)
}return n(r,e),r.prototype.icon=function(){return Flowdock.icons.zendesk},r.prototype.author=function(){var t,e,n;return t=null!=(e=this.content.user)?e.email:void 0,{name:null!=(n=this.content.user)?n.name:void 0,link:"mailto:"+t,email:t}},r.prototype.headline=function(){var t;return null!=(t=this.content.message)?t.split("\n")[0]:void 0},r.prototype.link=function(){return this.content.url},r.prototype.meta=function(){return[{text:this.content.title,link:this.link()}]},r.prototype.summary=function(){return this.headline()},r.prototype.body=function(){return Presenters.Helper.renderTemplate("bodyWithProperties",{body:{text:this.content.message},propertyList:Presenters.Helper.keyValuePairs(t(this.content))},{propertyList:"shared/propertyList"})},r.prototype.excerpt=function(){var t;return t=Presenters.Helper.unsafeStripHTML(this.body()),Presenters.Helper.sliceExcerpt(t).replace(/^(-{3,})/,"")},r.prototype.action=function(){},r}(Presenters.InboxMessage),t=function(t){var e,n;return{Priority:t.priority,Status:t.status,"Due Date":t.due_date,Assignee:null!=(e=t.assignee)?e.name:void 0,Requester:null!=(n=t.requester)?n.name:void 0}
}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.ChatMessage.Action=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.body=function(){return Presenters.Helper.renderTemplate("body",{body:this.description()})},n.prototype.summary=function(){var t;return t=this.description(),null!=t.html?Presenters.Helper.unsafeStripHTML(t.html):t.text},n.prototype.description=function(){var t,e,n,r;return t=this.content.type,r=this.getTypeObj(t),n=this.content[r.field],e=this.descriptionFormatter(t,n,this.data,this.content),r.description(e)},n.prototype.getTypeObj=function(t){var e;return e={"user-edit":{field:"user",description:function(t){return{text:""+t.name+" is now known as "+t.nick}}},add_people:{field:"message",description:function(t){return{text:"Added "+t+" to the flow."}}},join:{description:function(){return{text:"Joined the flow."}
}},invite:{field:"email",description:function(t){return{html:"Invited "+t+" to the flow."}}},decline:{field:"email",description:function(t){return{html:""+t+" declined invitation to the flow."}}},uninvite:{field:"email",description:function(t){return{html:"Canceled invite for "+t+"."}}},add_rss_feed:{field:"description",description:function(t){return{text:"Added an RSS feed "+t+"."}}},remove_rss_feed:{field:"description",description:function(t){return{text:"Removed an RSS feed "+t+"."}}},add_twitter_follow:{field:"description",description:function(t){return{html:"Added a Twitter follow "+t+"."}}},remove_twitter_follow:{field:"description",description:function(t){return{html:"Removed a Twitter follow "+t+"."}}},add_twitter_search:{field:"description",description:function(t){return{text:"Added a Twitter search for "+t+"."}}},remove_twitter_search:{field:"description",description:function(t){return{text:"Removed a Twitter search for "+t+"."}}}},e[t]},n.prototype.descriptionFormatter=function(t,e,n,r){var o,i,s;return s=function(t,e,n){return n.original_message?Presenters.Helper.renderTemplate("twitter/actionAuthor",{name:n.original_message.name,screen_name:n.original_message.param}).trim():t
},o=function(t){return Presenters.Helper.renderTemplate("shared/emailLink",{name:t,email:t}).trim()},i={add_people:function(t){var e,n;return n=t,1===n.length?n[0]:2===n.length?n.join(" and "):(e=n.pop(),""+n.join(", ")+" and "+e)},add_twitter_follow:s,remove_twitter_follow:s,invite:o,uninvite:o,decline:o},("function"==typeof i[t]?i[t](e,n,r):void 0)||e},n}(Presenters.ChatMessage)}.call(this),function(){Presenters.ChatMessage.File=function(){function t(t,e,n){this.event=t,this.content=e,this.data=n,this.content&&(this.file=new Presenters.Attachment(this.content))}return t.prototype.avatar=function(t){var e;return""+(null!=(e=this.data.user)?e.avatar:void 0)+t},t.prototype.icon=function(){},t.prototype.author=function(){return this.data.user?{name:this.data.user.nick}:void 0},t.prototype.excerpt=function(){var t;return t=this.file.thumbnail(),t?{html:t}:{html:this.file.info()}},t.prototype.action=function(){},t.prototype.meta=function(){},t.prototype.headline=function(){var t;return t=""+this.file.content.file.name+" - "+this.file.content.file.size,this.file.content.image&&(t+=" ("+this.file.content.image.width+"x"+this.file.content.image.height+")"),t
},t.prototype.body=function(){return this.content.file_name},t.prototype.linkTitle=function(){return"Download"},t.prototype.link=function(){return"/rest"+this.content.path},t.prototype.summary=function(){return"Uploaded a file: "+this.content.file_name},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Presenters.ChatMessage.UserEdit=function(t){function n(t,e,r){e.type="user-edit",n.__super__.constructor.call(this,"action",e,r)}return e(n,t),n}(Presenters.ChatMessage.Action)}.call(this),function(){}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};window.Router=function(n){function o(){this.removeFlow=e(this.removeFlow,this),this.storeFlowInboxState=e(this.storeFlowInboxState,this),this.route(/^(.+)$/,"catchall",function(){return this.navigate("",{trigger:!0,replace:!0})
}),o.__super__.constructor.apply(this,arguments)}return r(o,n),o.root="/app/",o.prototype.routes={"":"activateFirst","new-tab":"showNewTab","private(/:id)":"routePrivate",":org/:name/welcome":"welcome","iframe/*url":"iFrame","preferences/:initialTab":"viewPreferences",preferences:"viewPreferences","create-flow(/:organizationId)":"viewCreateFlow",":org/:name":"routeFlow",":org/:name/filter/:filter":"filterInbox",":org/:name/inbox/:id":"viewInboxItem",":org/:name/settings/:initialTab":"viewSettings",":org/:name/settings":"viewSettings","create-organization":"viewCreateOrganization","new-1-to-1":"viewNewPrivateDialog",feedback:"viewFeedbackForm"},o.prototype.initialize=function(t){return null==t&&(t={}),this.flows=t.flows,this.privates=t.privates,this.manager=t.manager,this.flowInboxStates={},this.flows.each(function(t){return function(e){return t.storeFlowInboxState(e)}}(this)),this.listenTo(this.flows,"add",function(t){return this.storeFlowInboxState(t)}),this.listenTo(this.flows,"remove",function(t){return this.removeFlow(t)
}),this.route(/^(.+)\/$/,"removeTrailingSlash",function(t){return this.navigate(t,{trigger:!0,replace:!0})})},o.prototype.findFlow=function(t,e){var n;return n=""+t+"/"+e,this.flows.find(function(t){return t.path()===n})},o.prototype.findPrivate=function(t){return this.privates.withUser(parseInt(t,10))},o.prototype.activateFlow=function(t,e,n){var r,o,i;return null==n&&(n=function(){}),this.navigationDisabled?void 0:(r=t&&e?this.findFlow(t,e):this.findPrivate(t))?(null!=(i=this.currentFlow)?i.id:void 0)===r.id?(n(r),r):(this.currentFlow=r,o=function(t){return function(){return t.trigger("flowActivated",r),t.manager.activate(r),n(r)}}(this),r.isFlow()&&!r.get("joined")?r.save({open:!0},{wait:!0,success:o}):(r.get("open")||(r.set({open:!0}),"function"==typeof r.saveWithRetry&&r.saveWithRetry()),o()),r):(this.currentFlow=null,this.trigger("flowActivated",null),this.flowNotFound(t,e),void 0)},o.prototype.routeFlow=function(t,e){return e=e.replace(/\?.*$/,""),this.activateFlow(t,e,function(t){return function(e){var n;
return t.storeFlowInboxState(e,{}),(null!=(n=t.currentFlow)?n.id:void 0)===e.id?t.manager.filterInbox(new Models.Filter.Inbox):void 0}}(this))},o.prototype.routePrivate=function(t){return t?(this.manager.closeOverlay(),this.activateFlow(t)):this.viewNewPrivateDialog()},o.prototype.viewInboxItem=function(t,e,n){return this.activateFlow(t,e,function(t){return function(e){return null!=e?(t.storeFlowInboxState(e,{message:n}),t.manager.openSingle(n)):void 0}}(this))},o.prototype.filterInbox=function(t,e,n,r){return null==n&&(n=""),null==r&&(r={}),this.activateFlow(t,e,function(t){return function(e){var o;if(null!=e)return o=Models.Filter.fromQuery(n,r),e.fullyLoaded.done(function(){return o.normalize(e)}),t.storeFlowInboxState(e,{filter:o}),t.manager.filterInbox(o)}}(this))},o.prototype.welcome=function(t,e){var n,r;return this.flows.where({open:!0}).length>1?(this.navigate(""+t+"/"+e,{trigger:!0,replace:!0}),void 0):(r=this.manager.openSlideshow(Flowdock.Tutorial.slides,{disableClosing:!0}),n=new Date,this.listenToOnce(r,"close",function(){var o;
return o=new Date-n,$.post("/owl/tutorial/duration",{duration:o,finished:r.isLastSlide()}),this.navigate(""+t+"/"+e,{trigger:!0})}))},o.prototype.viewSettings=function(t,e,n){return this.activateFlow(t,e,function(t){return function(e){return null!=e?t.manager.openSettings(n):void 0}}(this))},o.prototype.viewCreateFlow=function(t){return this.manager.openCreateFlow(t)},o.prototype.viewCreateOrganization=function(){return this.manager.openCreateOrganization()},o.prototype.viewNewPrivateDialog=function(){return this.manager.openNewPrivateDialog()},o.prototype.viewPreferences=function(t){return Flowdock.app.ready.done(function(e){return function(){return e.manager.openPreferences(t)}}(this))},o.prototype.viewFeedbackForm=function(){return Flowdock.app.ready.done(function(t){return function(){return t.manager.openFeedbackForm()}}(this))},o.prototype.storeFlowInboxState=function(t,e){return null==e&&(e={}),this.flowInboxStates[t.id]=_.extend({flow:t},e),this.lastRoute=e.filter?this.filterInbox:e.message?this.viewInboxItem:this.routeFlow
},o.prototype.reloadFlow=function(){var t,e,n;return console.log("Router: Reloading flow",null!=(n=this.currentFlow)?n.path():void 0),this.currentFlow?(t=this.currentFlow.path().split("/"),e=this.flowInboxStates[this.currentFlow.id],e.message&&t.push(e.message),e.filter&&(t.push(e.filter.slug),t.push(e.filter)),this.currentFlow=null,this.lastRoute.apply(this,t)):this.activateFirst()},o.prototype.removeFlow=function(t){var e,n;return console.log("Router: removing flow",null!=t?t.path():void 0),delete this.flowInboxStates[t.id],t.id===(null!=(n=this.currentFlow)?n.id:void 0)?(this.currenFlow=null,(e=this.flows.find(function(e){return e.get("open")&&e.id!==t.id}))?this.navigateBackToFlow(e):this.showNewTab()):void 0},o.prototype.activateFirst=function(){var t;return this.manager.closeOverlay(),t=this.flows.firstOpen(),t?this.navigateTo({flow:t}):this.showNewTab()},o.prototype.navigateTo=function(e,n){return null==n&&(n={}),this.navigationDisabled?void 0:(n=_.extend({},t,n),this.navigate(Helpers.pathFor(e),n))},o.prototype.navigateBackToFlow=function(t,e){return t?t.isFlow()?this.navigateTo(this.flowInboxStates[t.id],e):this.navigateToPrivate(t,e):void 0
},o.prototype.navigateToPrivate=function(t,e){return this.navigateTo({"private":t},e)},o.prototype.flowNotFound=function(t,e){return this.manager.error("flow-not-found",{org:t,name:e}),this.trigger("flowActivated",void 0)},o.prototype.routingError=function(){return this.manager.error("routing-error"),this.trigger("flowActivated",void 0)},o.prototype.showNewTab=function(){return this.manager.openNewTab(),this.currentFlow=null,this.trigger("flowActivated",void 0)},o.prototype.disableNavigation=function(){return this.navigationDisabled=!0},o.prototype.iFrame=function(t){return new Views.Overlays.IFrame({target:$("body"),flow:this.currentFlow,url:t}).attach()},o.prototype.isMessageOpen=function(){return null!=this.currentFlow&&null!=this.flowInboxStates[this.currentFlow.id].message},o}(Backbone.Router),_.extend(window.Router.prototype,Backbone.Bacon),t={trigger:!0}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Flowdock.App=function(){function e(e){this.removeFlow=t(this.removeFlow,this),this.setupNewFlow=t(this.setupNewFlow,this),this.activateFlow=t(this.activateFlow,this),this.end=new Bacon.Bus,this._subscriptions=[],this.user=new Models.User(e.user),this.preferences=new Models.Preferences(e.preferences,{user:this.user,parse:!0}),this.flows=e.flows instanceof Collections.Flows?e.flows:new Collections.Flows(e.flows),this.privates=e.privates instanceof Collections.PrivateConversations?e.privates:new Collections.PrivateConversations(e.privates,{user:this.user}),null!=e.tabOrder&&(this.tabOrder=e.tabOrder),this.combinedCollection=new Collections.Combined(this.flows,this.privates),this.users=function(t,e,n){n.prototype=t.prototype;
var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Collections.Combined,this.flows.map(function(t){return t.users}),function(){}),this.ready=new $.Deferred,this.manager=new Views.FlowManager({collection:this.combinedCollection,app:this,el:$("body")[0],user:this.user}),this.setupWhiteSpaceControl(),e.tutorial&&(this.tutorial=new Flowdock.Tutorial(e.tutorial)),this.router=new Router({flows:this.flows,privates:this.privates,manager:this.manager}),this.flows.active=this.router.asEventStream("flowActivated").toProperty(),this._subscriptions.push(this.flows.active.onValue(this.activateFlow)),this.flowActivities=new Collections.FlowActivities(null,{flows:this.combinedCollection,user:this.user,activeFlowProperty:Flowdock.appFocus.and(this.flows.active)}),this.flows.loaded=new $.Deferred,this.flows.on("add",this.setupNewFlow),this.flows.on("remove",this.removeFlow),this.flows.on("external-close",function(t){return function(e){return t.router.removeFlow(e)}}(this)),this.combinedCollection.on("change:open",function(t){return function(e,n){return n||null==t.activeFlow||e.id!==t.activeFlow.id?void 0:(console.log("Closed active tab, need to open another.",e,n),t.router.removeFlow(e))
}}(this)),this.flows.on("flow-unloaded",function(t){return function(e){var n;return t.manager.resetFlow(e),(null!=(n=t.activeFlow)?n.id:void 0)===e.id?t.router.reloadFlow():void 0}}(this)),this.activeFlow=null,this.user.on("change",function(t){return function(e){return _.each(t.users.where({id:e.id}),function(t){return t.set(e.changedAttributes())})}}(this)),this.initKeyboardShortcuts()}return e.CONNECTION_ERROR_THRESHOLD=5e3,e.prototype.initConnection=function(){var t;return this.connection=new Models.Connection,this._subscriptions.push(this.connection.state.onError(function(t){return function(e){return"handshake error"===e?t.manager.error("handshake-failed",null,{permanent:!0}):"handshake unauthorized"===e?window.location.reload():void 0}}(this))),t=null,this._subscriptions.push(this.connection.state.filter(function(t){return t===Models.Connection.CLOSED}).onValue(function(e){return function(){var n;return n=e.connection.state.changes().filter(function(t){return t===Models.Connection.OPEN}).take(1).map(!0),Bacon.later(Flowdock.App.CONNECTION_ERROR_THRESHOLD,!1).merge(n).takeWhile(function(t){return!t
}).merge(n).onValue(function(n){return"function"==typeof t&&t(),n?t=null:null==t?t=e.manager.toastError("connection-closed"):void 0})}}(this))),this._subscriptions.push(this.connection.state.filter(function(t){return t===Models.Connection.CLOSED}).flatMapLatest(function(t){return function(){return t.connection.state.filter(function(t){return t===Models.Connection.OPEN})}}(this)).onValue(function(t){return function(){return t.privates.each(function(e){return t.manager.resetFlow(e)}),t.privates.fetch({update:!0})}}(this))),this.user.consume(this.connection.messages)},e.prototype.start=function(){return this.initPostMessages(),Backbone.history.start({root:Router.root,pushState:!0}),this.subscribeToConnections(),this.setupTitleManager(),this.manager.render(),this.setupUserActivityHeartbeats(),this.initDesktopNotifications(),this.initAudioNotifications(),this.initFlowdockTutorial(),this.checkForFluid(),this.initTypingActivity(),this.ready.resolve()},e.prototype.initPostMessages=function(){return this.postMessages=Bacon.fromEventTarget(window,"message").takeUntil(this.end).filter(function(t){return t.origin===document.location.origin
}).map(function(t){return JSON.parse(t.data)})},e.prototype.initFlowdockTutorial=function(){return this.tutorial?(this.tutorial.consume(this.connection.messages),this.manager.addTutorial(this.tutorial)):void 0},e.prototype.initTypingActivity=function(){var t,e;return e=Flowdock.TypingActivity.build($("body"),"textarea.message-input",1e4),t=e.when(this.preferences.typingActivity()).toMessages(this.flows.active,15e3),this.connection.messages.plug(t.takeUntil(this.end))},e.prototype.initAudioNotifications=function(){var t,e,n;return this.audioNotifications=Flowdock.AudioNotifications.create(this.flows.active,this.user),this.audioNotifications?(t=this.preferences.asProperty("audio_notifications"),n=this.preferences.asProperty("audio_volume").map(Number),this.audioNotifications.load(t,n),this._subscriptions.push(this.preferences.mute().assign(this.audioNotifications,"mute")),e=this.preferences.filterMessages(this.connection.messages,"audio"),this.audioNotifications.consume(e)):void 0},e.prototype.initDesktopNotifications=function(){return this.notifications=Flowdock.NotificationCenter.create(),this.withNotificationPermission(function(t){return function(){var e;
return e=t.preferences.filterMessages(t.connection.messages,"desktop"),Flowdock.messageDesktopNotifications(t.notifications,e,t.flows,t.flows.active)}}(this))},e.prototype.initKeyboardShortcuts=function(){var t,e,n;return e=Flowdock.KeyboardShortcuts.keyStream(),t=this.preferences.asEventStream("change:keyboard_shortcuts").map(function(t){return t.keyboardShortcuts()}).toProperty(this.preferences.keyboardShortcuts()),n=[new Flowdock.KeyboardShortcuts(e,Flowdock.shortcutMap.web).when(t).toStream(),new Flowdock.KeyboardShortcuts(e,Flowdock.shortcutMap.alwaysAvailable).toStream(t)],"undefined"!=typeof macgap&&null!==macgap&&n.push(Flowdock.KeyboardShortcuts.forMacGap()),this.shortcutStream=Bacon.mergeAll(n)},e.prototype.withNotificationPermission=function(t){switch(this.notifications.permissionLevel()){case"granted":return t();case"default":return this.setupRequestToNotify(t)}},e.prototype.setupRequestToNotify=function(t){return $(document).one("click",".expanding-input",function(e){return function(){return e.notifications.requestPermission(function(e){return"granted"===e?t():void 0
})}}(this))},e.prototype.activateFlow=function(t){var e,n;return null!=(e=this.activeFlow)&&e.trigger("deactivate"),this.activeFlow=t,null!=(n=this.activeFlow)?n.trigger("activate"):void 0},e.prototype.subscribeToConnections=function(){var t,e;return this.flows.consume(this.connection.messages),this.privates.consume(this.connection.messages),this.privates.each(function(t){return t.fullyLoaded.resolve()}),e=null,this.activeFlow&&this.activeFlow.id&&this.activeFlow.isFlow()&&(e=this.activeFlow.subscribe(this.connection)),this.activeFlow&&(t=this.activeFlow.id),_.each(this.flows.filter(function(t){return t.get("open")}),function(n){return function(r){return t!==r.id?(null!=e&&e.always(function(){return r.subscribe(n.connection)}),e||(e=r.subscribe(n.connection))):void 0}}(this)),$.when.apply($,this.flows.map(function(t){return t.fullyLoaded})).always(function(t){return function(){return t.flows.loaded.resolve()}}(this)),this._subscriptions.push(this.flows.asEventStream("change:open").onValue(function(t){return function(e){return e.get("open")?e.subscribe(t.connection):e.unsubscribe(t.connection)
}}(this))),this.connection.state.errors().mapError(function(t){return t}).filter(function(t){return"flow sync failed"===(null!=t?t.error:void 0)}).skipDuplicates().onValue(function(t){return function(e){var n,r,o,i,s,a,l;for(i=t.flows.filter(function(t){return t.get("open")===!0&&"pending"===t.fullyLoaded.state()}),r=_.unique(function(){var t,n,r,i;for(r=e.flows,i=[],t=0,n=r.length;n>t;t++)o=r[t],i.push(this.flows.get(o));return i}.call(t).concat(i)),console.log("Resubscribe to flows",r),l=[],s=0,a=r.length;a>s;s++)n=r[s],l.push(function(e){return console.log(new Date,"Resetting flow",e.id,"after resync failed"),e.reset(),e.subscribe(t.connection)}(n));return l}}(this))},e.prototype.setupUserActivityHeartbeats=function(){var t;return t=new Flowdock.ActivityHeartbeats(Flowdock.userActivity,this.connection,this.flows.active,this.combinedCollection),t.start(),t},e.prototype.setupTitleManager=function(){return this.titleManager=new Flowdock.TitleManager(this.flowActivities.activityProperty,this.flows.active,this.user),this.titleManager.start()
},e.prototype.setupWhiteSpaceControl=function(){var t;return t=Flowdock.resize.moves.bufferWithTime(100).map(_.last),this.whiteSpaceControl=new Flowdock.WhiteSpaceControl(this.preferences.asProperty("whitespace"),t),this.whiteSpaceControl.start()},e.prototype.checkForFluid=function(){return navigator.userAgent.match(/fluid/i)?this.manager.toastError("use-mac-app"):void 0},e.prototype.setupNewFlow=function(t){return t.get("open")&&t.subscribe(this.connection),this.users.collections.push(t.users)},e.prototype.removeFlow=function(t){var e,n;return null!=(e=this.flowActivities[t.id])&&e.cleanup(),this.users.collections.splice(this.users.collections.indexOf(t.users),1),(null!=(n=this.connection)?n.unsubscribe:void 0)&&t.unsubscribe(this.connection),t.off(),t.cleanup()},e.prototype.destructor=function(){var t,e,n,r,o,i,s;for(this.end.push(!0),this.flows.off(),this.flows.each(this.removeFlow),this.flows.cleanup(),null!=(r=this.organizations)&&r.cleanup(),this.combinedCollection.cleanup(),this.combinedCollection.off(),this.privates.cleanup(),this.privates.off(),this.user.off(),null!=(o=this.audioNotifications)&&o.cleanup(),null!=(i=this.tutorial)&&i.cleanup(),this.manager.destructor(),s=this._subscriptions,e=0,n=s.length;n>e;e++)(t=s[e])();
return this._subscriptions=[]},e.prototype.getOrganizations=function(){return this.organizations||(this.organizations=new Collections.Organizations,this.organizations.consume(this.connection.messages),this.organizations.fetch({update:!0})),this.organizations},e}()}.call(this),function(){}.call(this),function(){var t;t=$('meta[name="csrf-token"]').attr("content"),$.ajaxSetup({dataType:"json",headers:{"X-CSRF-Token":t}})}.call(this),function(){var t,e;e=window.navigator.userAgent.toLowerCase(),t=e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(e),t&&$(function(){return $(window).keypress(function(t){return 27===t.keyCode?t.preventDefault():void 0})})}.call(this),function(t,e,n,r,o,i,s){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,i=e.createElement(n),s=e.getElementsByTagName(n)[0],i.async=1,i.src=r,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-2741725-7","flowdock.com"),ga("send","pageview"),function(){$(document).ajaxError(function(t,e){return 403===e.status&&e.getResponseHeader("Flowdock-Authenticate")?new Views.Overlays.Unauthorized({target:$("body")}).attach():void 0
})}.call(this),function(){$(function(){return $(window).on("drop",function(t){return $(t.target).is(":enabled")?void 0:t.preventDefault()})})}.call(this),function(){var t,e,n;n=function(t){var e;return e=function(t){var e;return _.some(function(){var n,r,o,i;for(o=["message-list","touch-scrollable","new-tab-results"],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(-1!==t.indexOf(e));return i}())},t.className&&e(t.className)||"ARTICLE"===t.tagName?t:null==t.parentElement?!1:n(t.parentElement)},e=function(t){return t.preventDefault()},t=function(t){return t.scrollTop<=0?t.scrollTop=1:t.scrollTop+t.clientHeight>=t.scrollHeight?t.scrollTop=t.scrollHeight-t.clientHeight-1:void 0},$(function(){return document.body.addEventListener("touchstart",function(r){var o;return o=n(r.target),o?t(o):document.body.addEventListener("touchmove",e,!1)}),document.body.addEventListener("touchend",function(){return document.body.removeEventListener("touchmove",e,!1)})})}.call(this),function(){Modernizr.touch?$.fn.tipsy=function(){}:(_.extend($.fn.tipsy.defaults,{delayIn:1500,delayOut:100}),$.fn.tipsy.elementOptions=function(t,e){var n;
return n={gravity:$(t).data("tipsy-gravity")},$.extend({},e,n)},$(".tipsy-tooltip").tipsy({live:!0}),$(window).on("flowdock-start",function(){return Flowdock.app.router.on("all",function(){return $(".tipsy").remove()})}))}.call(this),function(){var t,e,n;t=72e5,n=3e4,e=12e4,$(function(){var r;return r=function(t){var e,n,r;return e=new Date($("meta[name=flowdock-version]").prop("content")),(null!=(n=t[0])?n.date:void 0)?new Date(null!=(r=t[0])?r.date:void 0)>e:!1},Bacon.interval(t,!0).delay(n).flatMap(function(){return Bacon.fromPromise($.getJSON("/changelog"))}).filter(r).take(1).delay(e).onValues(function(t){var e;return e=new Views.Errors.Update({model:t}),$("body").append(e.render().$el)})})}.call(this),function(){var t,e;$("html").userAgentClass(),t=$.get("/rest/bootstrap",null,"json"),Flowdock.mobile=document.documentElement.clientWidth<=767&&_.some(["ios","android"],function(t){return $("html").hasClass(t)}),Flowdock.eventBus=_.extend({},Backbone.Events),e=function(t){var e;return e=new Views.Shared.Progress({el:$(".loading-screen-spinner")}),e.render(),$("#loading-screen").addClass("loading-screen-active"),e.show(),t(function(){return $("#loading-screen").removeClass("loading-screen-active").one(Helpers.transitionend(),function(){return $("#loading-screen").remove(),e.remove()
})})},$(function(){return e(function(e){return t.success(function(t){return e(),window.japiplexResource=t.japiplex_resource,Flowdock.app=new Flowdock.App({flows:t.flows,privates:t.privates,user:t.user,preferences:t.preferences,tutorial:t.tutorial,tabOrder:t.tab_order}),null!=("undefined"!=typeof macgap&&null!==macgap?macgap.growl:void 0)&&(window.addEventListener("macGapNotificationClick",function(t){var e,n;return e=JSON.parse(t.payload),n=e.flowPath,null!=e.message&&(n=""+n+"/inbox/"+e.message),Flowdock.app.router.navigate(n,{trigger:!0}),window.focus()},!1),window.addEventListener("macgapWantsToGoToPreferences",function(){return Flowdock.app.manager.openPreferences()},!1)),moment.lang(Flowdock.app.preferences.get("locale")),console.log("init connection"),Flowdock.app.initConnection(),Flowdock.app.start(),$(window).trigger("flowdock-start"),setInterval(Helpers.TimeHelper.updateAllTimestamps,1e4),setInterval(Helpers.TimeHelper.updateDetailedTimestamps,6e4),Flowdock.app.router.on("all",function(){return _.defer(Helpers.TimeHelper.updateAllTimestamps)
})})})})}.call(this),function(){}.call(this);